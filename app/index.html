<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdInstalGaz SRL - Sistem Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .role-badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
        }

        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: #c0392b;
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #ecf0f1;
            border: none;
            cursor: pointer;
            font-size: 14px;
            color: #555;
            border-right: 1px solid #ddd;
            transition: all 0.3s;
        }

        .tab:last-child {
            border-right: none;
        }

        .tab.active {
            background: #3498db;
            color: white;
        }

        .tab:hover:not(.active) {
            background: #d5dbdb;
        }

        .tab.hidden {
            display: none;
        }

        .content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-height: 600px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-row.triple {
            grid-template-columns: 1fr 1fr 1fr;
        }

        .form-row.full {
            grid-template-columns: 1fr;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        .required {
            color: #e74c3c;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        input[type="number"],
        input[type="password"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            transition: border-color 0.3s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .btn:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-warning {
            background: #f39c12;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-size: 14px;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
            position: sticky;
            top: 0;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .search-box {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 4px solid #3498db;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 6px;
            border-left: 4px solid;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .alert-success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .alert-info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }

        .hidden {
            display: none;
        }

        .file-upload {
            border: 3px dashed #ddd;
            padding: 30px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .file-upload:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }

        .file-upload.dragover {
            border-color: #27ae60;
            background: #d4edda;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.3s;
        }

        .close {
            float: right;
            font-size: 28px;
            cursor: pointer;
            color: #aaa;
            transition: color 0.3s;
        }

        .close:hover {
            color: #000;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .badge-secondary {
            background: #e2e3e5;
            color: #383d41;
        }

        .text-danger {
            color: #dc3545 !important;
            font-weight: bold;
        }

        .text-warning {
            color: #f39c12 !important;
            font-weight: bold;
        }

        .text-success {
            color: #27ae60 !important;
            font-weight: bold;
        }

        .progress-bar {
            width: 100%;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            height: 20px;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: #3498db;
            width: 0%;
            transition: width 0.3s;
        }

        .document-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 4px solid #3498db;
        }

        .notification-config {
            background: linear-gradient(135deg, #e8f4fd, #fff);
            border: 2px solid #3498db;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translate(-50%, -60%); opacity: 0; }
            to { transform: translate(-50%, -50%); opacity: 1; }
        }

        @media (max-width: 768px) {
            .form-row,
            .form-row.triple {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                border-right: none;
                border-bottom: 1px solid #ddd;
            }
            
            .tab:last-child {
                border-bottom: none;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen">
        <div class="login-container">
            <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">ğŸ¢ AdInstalGaz SRL</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>Parola:</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn" style="width: 100%;">ğŸ” Autentificare</button>
            </form>
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <strong>Conturi demo:</strong><br>
                ğŸ‘¨â€ğŸ’¼ Admin: admin@adinstalgaz.ro / 123456<br>
                ğŸ‘·â€â™‚ï¸ LucrÄƒtor 1: lucrator1@adinstalgaz.ro / 123456<br>
                ğŸ‘·â€â™‚ï¸ LucrÄƒtor 2: lucrator2@adinstalgaz.ro / 123456
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <div class="container">
            <div class="header">
                <div class="logo">ğŸ¢ AdInstalGaz SRL</div>
                <div class="user-info">
                    <span id="userDisplay"></span>
                    <span class="role-badge" id="roleBadge"></span>
                    <button class="logout-btn" onclick="logout()">ğŸšª Deconectare</button>
                </div>
            </div>

            <!-- Dashboard -->
            <div id="dashboard">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalClients">0</div>
                        <div class="stat-label">ğŸ‘¥ Total ClienÈ›i</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeServices">0</div>
                        <div class="stat-label">âœ… Servicii Active</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="expiringServices">0</div>
                        <div class="stat-label">âš ï¸ ExpirÄƒ Ã®n 7 zile</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="urgentServices">0</div>
                        <div class="stat-label">ğŸš¨ ExpirÄƒ Ã®n 2 zile</div>
                    </div>
                </div>
                <div id="alertsContainer"></div>
            </div>

            <!-- Navigation Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="showTab('clients', this)">ğŸ‘¥ ClienÈ›i</button>
                <button class="tab" onclick="showTab('services', this)">ğŸ”§ Servicii</button>
                <button class="tab" onclick="showTab('programming', this)">ğŸ“… ProgramÄƒri</button>
                <button class="tab" onclick="showTab('work', this)">ğŸ› ï¸ LucrÄƒri</button>
                <button class="tab" id="reportsTab" onclick="showTab('reports', this)">ğŸ“Š Rapoarte</button>
                <button class="tab" onclick="showTab('documents', this)">ğŸ“„ Documente</button>
                <button class="tab" onclick="showTab('notifications', this)">ğŸ“± NotificÄƒri</button>
            </div>

            <!-- Content Area -->
            <div class="content">
                <!-- ClienÈ›i Tab -->
                <div id="clientsTab" class="tab-content">
                    <h3>ğŸ‘¥ Gestionare ClienÈ›i</h3>
                    
                    <div class="form-row">
                        <div>
                            <button class="btn btn-success" onclick="showAddClientModal()">â• AdaugÄƒ Client Nou</button>
                        </div>
                        <div>
                            <input type="text" class="search-box" placeholder="ğŸ” CautÄƒ clienÈ›i..." onkeyup="searchClients(this.value)">
                        </div>
                    </div>

                    <table class="table" id="clientsTable">
                        <thead>
                            <tr>
                                <th>Nume</th>
                                <th>Telefon</th>
                                <th>Email</th>
                                <th>AdresÄƒ CompletÄƒ</th>
                                <th>Data AdÄƒugare</th>
                                <th>Status</th>
                                <th>AcÈ›iuni</th>
                            </tr>
                        </thead>
                        <tbody id="clientsTableBody"></tbody>
                    </table>
                </div>

                <!-- Servicii Tab -->
                <div id="servicesTab" class="tab-content hidden">
                    <h3>ğŸ”§ Gestionare Servicii</h3>
                    
                    <div class="form-row">
                        <div>
                            <button class="btn btn-success" onclick="showAddServiceModal()">â• AdaugÄƒ Serviciu</button>
                        </div>
                        <div>
                            <select id="serviceClientFilter" onchange="filterServices()">
                                <option value="">ğŸ‘¥ ToÈ›i clienÈ›ii</option>
                            </select>
                        </div>
                        <div>
                            <select id="serviceStatusFilter" onchange="filterServices()">
                                <option value="">ğŸ“‹ Toate statusurile</option>
                                <option value="activ">âœ… Activ</option>
                                <option value="expirat">âŒ Expirat</option>
                                <option value="expira_curand">âš ï¸ ExpirÄƒ curÃ¢nd</option>
                            </select>
                        </div>
                    </div>

                    <table class="table" id="servicesTable">
                        <thead>
                            <tr>
                                <th>Client</th>
                                <th>Tip Serviciu</th>
                                <th>Data Start</th>
                                <th>Data Expirare</th>
                                <th>Status</th>
                                <th>AcÈ›iuni</th>
                            </tr>
                        </thead>
                        <tbody id="servicesTableBody"></tbody>
                    </table>
                </div>

                <!-- ProgramÄƒri Tab -->
                <div id="programmingTab" class="tab-content hidden">
                    <h3>ğŸ“… ProgramÄƒri Servicii</h3>
                    
                    <div class="alert alert-warning">
                        <strong>âš ï¸ AtenÈ›ie!</strong> ClienÈ›ii vor primi notificÄƒri automate cu 7 zile È™i 2 zile Ã®naintea expirÄƒrii serviciilor.
                    </div>

                    <div class="form-row">
                        <div>
                            <select id="programmingFilter" onchange="filterProgramming()">
                                <option value="expiring">ğŸ“… Servicii care expirÄƒ (30 zile)</option>
                                <option value="urgent">ğŸš¨ Urgent (2 zile)</option>
                                <option value="warning">âš ï¸ AtenÈ›ie (7 zile)</option>
                                <option value="all">ğŸ“‹ Toate serviciile</option>
                            </select>
                        </div>
                        <div>
                            <button class="btn btn-success" onclick="sendNotifications()">ğŸ“± Trimite NotificÄƒri</button>
                        </div>
                    </div>

                    <table class="table" id="programmingTable">
                        <thead>
                            <tr>
                                <th>Client</th>
                                <th>Serviciu</th>
                                <th>ExpirÄƒ Ã®n</th>
                                <th>Telefon</th>
                                <th>Status</th>
                                <th>AcÈ›iuni</th>
                            </tr>
                        </thead>
                        <tbody id="programmingTableBody"></tbody>
                    </table>
                </div>

                <!-- LucrÄƒri Tab -->
                <div id="workTab" class="tab-content hidden">
                    <h3>ğŸ› ï¸ Gestionare LucrÄƒri</h3>
                    
                    <div class="form-row">
                        <div>
                            <button class="btn btn-success" onclick="showAddWorkModal()">â• CreeazÄƒ Lucrare NouÄƒ</button>
                        </div>
                        <div>
                            <select id="workStatusFilter" onchange="filterWork()">
                                <option value="">ğŸ“‹ Toate lucrÄƒrile</option>
                                <option value="programata">ğŸ“… ProgramatÄƒ</option>
                                <option value="in_progress">â³ Ãn progres</option>
                                <option value="finalizata">âœ… FinalizatÄƒ</option>
                            </select>
                        </div>
                    </div>

                    <table class="table" id="workTable">
                        <thead>
                            <tr>
                                <th>Client</th>
                                <th>Tip Lucrare</th>
                                <th>LucrÄƒtor Atribuit</th>
                                <th>Data ProgramatÄƒ</th>
                                <th>Status</th>
                                <th>AcÈ›iuni</th>
                            </tr>
                        </thead>
                        <tbody id="workTableBody"></tbody>
                    </table>
                </div>

                <!-- Rapoarte Tab -->
                <div id="reportsTab" class="tab-content hidden">
                    <h3>ğŸ“Š Rapoarte Detaliate</h3>
                    
                    <div class="form-row">
                        <div>
                            <label>ğŸ“Š Tip Raport:</label>
                            <select id="reportType">
                                <option value="clients">ğŸ‘¥ Baza de Date ClienÈ›i</option>
                                <option value="services">ğŸ”§ Servicii Implementate</option>
                                <option value="work">ğŸ› ï¸ LucrÄƒri Efectuate</option>
                                <option value="expiring">âš ï¸ Servicii care ExpirÄƒ</option>
                                <option value="statistics">ğŸ“ˆ Statistici Generale</option>
                                <option value="revenue">ğŸ’° Analiza Venituri</option>
                            </select>
                        </div>
                        <div>
                            <label>ğŸ“… Perioada:</label>
                            <select id="reportPeriod" onchange="handleReportPeriodChange()">
                                <option value="all">ğŸ“… Toate datele</option>
                                <option value="today">ğŸ“… AstÄƒzi</option>
                                <option value="week">ğŸ“… SÄƒptÄƒmÃ¢na aceasta</option>
                                <option value="month">ğŸ“… Luna aceasta</option>
                                <option value="quarter">ğŸ“… Trimestrul acesta</option>
                                <option value="year">ğŸ“… Anul acesta</option>
                                <option value="custom">ğŸ“… Personalizat</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row hidden" id="customDateRange">
                        <div>
                            <label>ğŸ“… Data Start:</label>
                            <input type="date" id="reportStartDate">
                        </div>
                        <div>
                            <label>ğŸ“… Data SfÃ¢rÈ™it:</label>
                            <input type="date" id="reportEndDate">
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <button class="btn" onclick="generateReport()">ğŸ“Š GenereazÄƒ Raport</button>
                            <button class="btn btn-success" onclick="exportReportPDF()">ğŸ“„ Export PDF</button>
                            <button class="btn btn-warning" onclick="exportReportExcel()">ğŸ“— Export Excel</button>
                        </div>
                        <div>
                            <button class="btn" onclick="debugReports()" style="background: #9b59b6;">ğŸ” Debug Info</button>
                            <button class="btn" onclick="resetDemoData()" style="background: #e67e22;">ğŸ”„ Reset Date Demo</button>
                        </div>
                    </div>

                    <div id="reportResults"></div>
                </div>

                <!-- Documente Tab -->
                <div id="documentsTab" class="tab-content hidden">
                    <h3>ğŸ“„ Gestionare Documente</h3>
                    
                    <div class="file-upload" id="fileUploadArea">
                        <p style="font-size: 18px; margin-bottom: 10px;">ğŸ“¤ Drag & Drop sau Click pentru Ã®ncÄƒrcare</p>
                        <p style="font-size: 14px; color: #666;">PDF, DOC, DOCX, JPG, PNG, XLSX (max 10MB per fiÈ™ier)</p>
                        <input type="file" id="fileInput" style="display: none;" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.xlsx,.xls" onchange="uploadFiles(this.files)">
                    </div>

                    <div class="form-row">
                        <div>
                            <select id="documentClientFilter" onchange="filterDocuments()">
                                <option value="">ğŸ‘¥ Toate documentele</option>
                            </select>
                        </div>
                        <div>
                            <select id="documentTypeFilter" onchange="filterDocuments()">
                                <option value="">ğŸ“„ Toate tipurile</option>
                                <option value="certificat">ğŸ“œ Certificat</option>
                                <option value="factura">ğŸ’° FacturÄƒ</option>
                                <option value="raport">ğŸ“Š Raport</option>
                                <option value="foto">ğŸ“¸ Fotografii</option>
                                <option value="contract">ğŸ“‹ Contract</option>
                                <option value="altele">ğŸ“ Altele</option>
                            </select>
                        </div>
                        <div>
                            <input type="text" class="search-box" placeholder="ğŸ” CautÄƒ documente..." onkeyup="searchDocuments(this.value)">
                        </div>
                    </div>

                    <div id="documentsGrid"></div>

                    <table class="table" id="documentsTable">
                        <thead>
                            <tr>
                                <th>Nume FiÈ™ier</th>
                                <th>Client</th>
                                <th>Tip</th>
                                <th>MÄƒrime</th>
                                <th>Data ÃncÄƒrcare</th>
                                <th>ÃncÄƒrcat de</th>
                                <th>AcÈ›iuni</th>
                            </tr>
                        </thead>
                        <tbody id="documentsTableBody"></tbody>
                    </table>
                </div>

                <!-- NotificÄƒri Tab -->
                <div id="notificationsTab" class="tab-content hidden">
                    <h3>ğŸ“± Sistem NotificÄƒri SMS + Email</h3>
                    
                    <div class="notification-config">
                        <h4>ğŸ”§ ConfigurÄƒri Sistem NotificÄƒri</h4>
                        <div class="alert alert-info">
                            <strong>â„¹ï¸ MetodÄƒ SimplÄƒ:</strong> AplicaÈ›ia va deschide SMS-ul È™i email-ul cu mesajele pre-completate. Tu doar confirmi trimiterea!
                        </div>
                        <div class="form-row">
                            <div>
                                <label>ğŸ“± NumÄƒrul Firmei:</label>
                                <input type="tel" id="senderPhone" value="0762614401" onchange="updateNotificationConfig()">
                            </div>
                            <div>
                                <label>ğŸ“§ Email-ul Firmei:</label>
                                <input type="email" id="senderEmail" value="contact@adinstalgaz.ro" onchange="updateNotificationConfig()">
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label>ğŸ¢ Numele Firmei:</label>
                                <input type="text" id="companyName" value="AdInstalGaz SRL" onchange="updateNotificationConfig()">
                            </div>
                            <div>
                                <label>ğŸ“² Status:</label>
                                <span class="badge badge-success">âœ… Sistem Nativ Activ</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <button class="btn btn-success" onclick="sendAllNotifications()">ğŸ“± Trimite Toate NotificÄƒrile</button>
                            <button class="btn btn-warning" onclick="sendUrgentNotifications()">ğŸš¨ Doar Urgente (2 zile)</button>
                        </div>
                        <div>
                            <button class="btn" onclick="testNotification()">ğŸ§ª Test Notificare</button>
                            <button class="btn" onclick="viewNotificationTemplates()">ğŸ“„ Vezi Template-uri</button>
                        </div>
                    </div>

                    <div id="notificationProgress" class="hidden">
                        <h5>ğŸ“Š Progres Trimitere NotificÄƒri:</h5>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div id="progressText">0 / 0 notificÄƒri trimise</div>
                    </div>

                    <h4>ğŸ‘¥ ClienÈ›i care necesitÄƒ notificare:</h4>
                    <table class="table" id="notificationClientsTable">
                        <thead>
                            <tr>
                                <th>Client</th>
                                <th>Telefon</th>
                                <th>Email</th>
                                <th>Serviciu</th>
                                <th>ExpirÄƒ Ã®n</th>
                                <th>UltimÄƒ Notificare</th>
                                <th>AcÈ›iuni</th>
                            </tr>
                        </thead>
                        <tbody id="notificationClientsTableBody"></tbody>
                    </table>

                    <h4>ğŸ“‹ Istoric NotificÄƒri:</h4>
                    <div class="form-row">
                        <div>
                            <select id="notificationHistoryFilter" onchange="filterNotificationHistory()">
                                <option value="">ğŸ“‹ Toate notificÄƒrile</option>
                                <option value="sms">ğŸ“± Doar SMS</option>
                                <option value="email">ğŸ“§ Doar Email</option>
                                <option value="success">âœ… ReuÈ™ite</option>
                                <option value="failed">âŒ EÈ™uate</option>
                            </select>
                        </div>
                        <div>
                            <input type="text" class="search-box" placeholder="ğŸ” CautÄƒ Ã®n istoric..." onkeyup="searchNotificationHistory(this.value)">
                        </div>
                    </div>

                    <table class="table" id="notificationHistoryTable">
                        <thead>
                            <tr>
                                <th>Data/Ora</th>
                                <th>Client</th>
                                <th>Tip</th>
                                <th>Canal</th>
                                <th>Status</th>
                                <th>Mesaj</th>
                            </tr>
                        </thead>
                        <tbody id="notificationHistoryTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal pentru adÄƒugare/editare client -->
    <div id="clientModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('clientModal')">&times;</span>
            <h3 id="clientModalTitle">â• AdaugÄƒ Client Nou</h3>
            <form id="clientForm">
                <input type="hidden" id="clientId">
                
                <div class="form-row">
                    <div>
                        <label>Nume Complet: <span class="required">*</span></label>
                        <input type="text" id="clientName" required>
                    </div>
                    <div>
                        <label>Telefon: <span class="required">*</span></label>
                        <input type="tel" id="clientPhone" required>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label>Email:</label>
                        <input type="email" id="clientEmail">
                    </div>
                    <div>
                        <label>Tip Client:</label>
                        <select id="clientType">
                            <option value="rezidential">ğŸ  RezidenÈ›ial</option>
                            <option value="comercial">ğŸ¢ Comercial</option>
                            <option value="industrial">ğŸ­ Industrial</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label>Strada: <span class="required">*</span></label>
                        <input type="text" id="clientStreet" required placeholder="ex: Str. LibertÄƒÈ›ii">
                    </div>
                    <div>
                        <label>NumÄƒrul: <span class="required">*</span></label>
                        <input type="text" id="clientNumber" required placeholder="ex: 25">
                    </div>
                </div>

                <div class="form-row triple">
                    <div>
                        <label>Bloc:</label>
                        <input type="text" id="clientBlock" placeholder="ex: A1">
                    </div>
                    <div>
                        <label>Scara:</label>
                        <input type="text" id="clientStair" placeholder="ex: 2">
                    </div>
                    <div>
                        <label>Apartament:</label>
                        <input type="text" id="clientApartment" placeholder="ex: 15">
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label>OraÈ™ul: <span class="required">*</span></label>
                        <select id="clientCity" required>
                            <option value="Alexandria">Alexandria</option>
                            <option value="Rosiorii de Vede">Rosiorii de Vede</option>
                            <option value="Turnu Magurele">Turnu Magurele</option>
                            <option value="Videle">Videle</option>
                            <option value="Zimnicea">Zimnicea</option>
                        </select>
                    </div>
                    <div>
                        <label>JudeÈ›ul:</label>
                        <select id="clientCounty">
                            <option value="teleorman">Teleorman</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label>Status InformaÈ›ii:</label>
                        <select id="clientStatus">
                            <option value="complet">âœ… InformaÈ›ii Complete</option>
                            <option value="incomplet">âš ï¸ InformaÈ›ii Incomplete</option>
                            <option value="de_contactat">ğŸ“ De Contactat</option>
                        </select>
                    </div>
                    <div>
                        <label>Data AdÄƒugare:</label>
                        <input type="date" id="clientDateAdded" readonly style="background: #f8f9fa;">
                    </div>
                </div>

                <div class="form-row full">
                    <div>
                        <label>ObservaÈ›ii:</label>
                        <textarea id="clientNotes" rows="3" placeholder="ObservaÈ›ii suplimentare despre client..."></textarea>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <button type="submit" class="btn btn-success">ğŸ’¾ SalveazÄƒ</button>
                    <button type="button" class="btn" onclick="closeModal('clientModal')">âŒ AnuleazÄƒ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal pentru servicii -->
    <div id="serviceModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('serviceModal')">&times;</span>
            <h3 id="serviceModalTitle">â• AdaugÄƒ Serviciu Nou</h3>
            <form id="serviceForm">
                <input type="hidden" id="serviceId">
                
                <div class="form-row">
                    <div>
                        <label>Client: <span class="required">*</span></label>
                        <select id="serviceClient" required></select>
                    </div>
                    <div>
                        <label>Tip Serviciu: <span class="required">*</span></label>
                        <select id="serviceType" required onchange="calculateServiceEndDate()">
                            <option value="">SelecteazÄƒ...</option>
                            <option value="verificare_instalatie">ğŸ”§ Verificare InstalaÈ›ie Gaz - 150 Lei (valabilitate 2 ani)</option>
                            <option value="revizie_instalatie">ğŸ” Revizie InstalaÈ›ie Gaz - 250 Lei (valabilitate 2 ani)</option>
                            <option value="verificare_centrala">âœ… Verificare CentralÄƒ - 150 Lei (valabilitate 2 ani)</option>
                            <option value="oferta_completa">ğŸ’° OFERTÄ‚: InstalaÈ›ii Gaz + CentralÄƒ - 250 Lei (valabilitate 2 ani)</option>
                            <option value="serviciu_urgenta">ğŸš¨ Serviciu de UrgenÈ›Äƒ</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label>Data Start: <span class="required">*</span></label>
                        <input type="date" id="serviceStartDate" required onchange="calculateServiceEndDate()">
                    </div>
                    <div>
                        <label>Data Expirare (Auto-calculatÄƒ):</label>
                        <input type="date" id="serviceEndDate" readonly style="background: #f8f9fa;">
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label>Costul Serviciului (Lei):</label>
                        <input type="number" id="serviceCost" step="0.01" placeholder="ex: 150.00">
                    </div>
                    <div>
                        <label>Certificat Nr:</label>
                        <input type="text" id="serviceCertificate" placeholder="ex: CERT-2024-001">
                    </div>
                </div>

                <div class="form-row full">
                    <div>
                        <label>Detalii Serviciu:</label>
                        <textarea id="serviceDetails" rows="3" placeholder="Detalii despre serviciul efectuat..."></textarea>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <button type="submit" class="btn btn-success">ğŸ’¾ SalveazÄƒ Serviciu</button>
                    <button type="button" class="btn" onclick="closeModal('serviceModal')">âŒ AnuleazÄƒ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal pentru lucrÄƒri -->
    <div id="workModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('workModal')">&times;</span>
            <h3 id="workModalTitle">â• CreeazÄƒ Lucrare NouÄƒ</h3>
            <form id="workForm">
                <input type="hidden" id="workId">
                
                <div class="form-row">
                    <div>
                        <label>Client: <span class="required">*</span></label>
                        <select id="workClient" required></select>
                    </div>
                    <div>
                        <label>Tip Lucrare: <span class="required">*</span></label>
                        <select id="workType" required>
                            <option value="">SelecteazÄƒ...</option>
                            <option value="verificare_instalatie">ğŸ”§ Verificare InstalaÈ›ie Gaz</option>
                            <option value="revizie_instalatie">ğŸ” Revizie InstalaÈ›ie Gaz</option>
                            <option value="verificare_centrala">âœ… Verificare CentralÄƒ</option>
                            <option value="instalare_completa">ğŸ’° Instalare CompletÄƒ (Gaz + CentralÄƒ)</option>
                            <option value="reparatie">ğŸ”¨ ReparaÈ›ie</option>
                            <option value="intretinere">ğŸ› ï¸ ÃntreÈ›inere</option>
                            <option value="urgenta">ğŸš¨ IntervenÈ›ie UrgentÄƒ</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label>LucrÄƒtor Atribuit: <span class="required">*</span></label>
                        <select id="workAssignee" required>
                            <option value="">SelecteazÄƒ lucrÄƒtor...</option>
                            <option value="lucrator1@adinstalgaz.ro">ğŸ‘¨â€ğŸ”§ LucrÄƒtor 1 - Ion Popescu</option>
                            <option value="lucrator2@adinstalgaz.ro">ğŸ‘¨â€ğŸ”§ LucrÄƒtor 2 - Vasile Ionescu</option>
                            <option value="lucrator3@adinstalgaz.ro">ğŸ‘¨â€ğŸ”§ LucrÄƒtor 3 - George Marinescu</option>
                            <option value="lucrator4@adinstalgaz.ro">ğŸ‘¨â€ğŸ”§ LucrÄƒtor 4 - Mihai Popescu</option>
                            <option value="lucrator5@adinstalgaz.ro">ğŸ‘¨â€ğŸ”§ LucrÄƒtor 5 - Andrei Stoica</option>
                        </select>
                    </div>
                    <div>
                        <label>Data ProgramatÄƒ: <span class="required">*</span></label>
                        <input type="date" id="workScheduledDate" required>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label>Prioritate:</label>
                        <select id="workPriority">
                            <option value="normala">ğŸ“‹ NormalÄƒ</option>
                            <option value="ridicata">âš ï¸ RidicatÄƒ</option>
                            <option value="urgenta">ğŸš¨ UrgentÄƒ</option>
                        </select>
                    </div>
                    <div>
                        <label>Durata EstimatÄƒ (ore):</label>
                        <select id="workDuration">
                            <option value="1">â±ï¸ 1 orÄƒ</option>
                            <option value="2">â±ï¸ 2 ore</option>
                            <option value="3">â±ï¸ 3 ore</option>
                            <option value="4">â±ï¸ 4 ore</option>
                            <option value="8">ğŸ• O zi Ã®ntreagÄƒ</option>
                        </select>
                    </div>
                </div>

                <div class="form-row full">
                    <div>
                        <label>Descriere Lucrare:</label>
                        <textarea id="workDescription" rows="3" placeholder="Descriere detaliatÄƒ a lucrÄƒrii..."></textarea>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <button type="submit" class="btn btn-success">ğŸ’¾ CreeazÄƒ Lucrare</button>
                    <button type="button" class="btn" onclick="closeModal('workModal')">âŒ AnuleazÄƒ</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Date globale
        let currentUser = null;
        let clients = JSON.parse(localStorage.getItem('adinstalgaz_clients') || '[]');
        let services = JSON.parse(localStorage.getItem('adinstalgaz_services') || '[]');
        let work = JSON.parse(localStorage.getItem('adinstalgaz_work') || '[]');
        let documents = JSON.parse(localStorage.getItem('adinstalgaz_documents') || '[]');
        let notifications = JSON.parse(localStorage.getItem('adinstalgaz_notifications') || '[]');

        // ConfigurÄƒri notificÄƒri
        const notificationConfig = {
            senderPhone: '0762614401',
            senderEmail: 'contact@adinstalgaz.ro',
            companyName: 'AdInstalGaz SRL'
        };

        // Utilizatori cu drepturi diferite
        const users = {
            'admin@adinstalgaz.ro': {
                password: '123456',
                role: 'admin',
                name: 'Administrator',
                permissions: ['all']
            },
            'lucrator1@adinstalgaz.ro': {
                password: '123456',
                role: 'worker',
                name: 'Ion Popescu',
                permissions: ['clients', 'services', 'programming', 'work', 'documents', 'notifications']
            },
            'lucrator2@adinstalgaz.ro': {
                password: '123456',
                role: 'worker',
                name: 'Vasile Ionescu',
                permissions: ['clients', 'services', 'programming', 'work', 'documents', 'notifications']
            },
            'lucrator3@adinstalgaz.ro': {
                password: '123456',
                role: 'worker',
                name: 'George Marinescu',
                permissions: ['clients', 'services', 'programming', 'work', 'documents', 'notifications']
            },
            'lucrator4@adinstalgaz.ro': {
                password: '123456',
                role: 'worker',
                name: 'Mihai Popescu',
                permissions: ['clients', 'services', 'programming', 'work', 'documents', 'notifications']
            },
            'lucrator5@adinstalgaz.ro': {
                password: '123456',
                role: 'worker',
                name: 'Andrei Stoica',
                permissions: ['clients', 'services', 'programming', 'work', 'documents', 'notifications']
            }
        };

        // IniÈ›ializare aplicaÈ›ie
        document.addEventListener('DOMContentLoaded', function() {
            const savedUser = localStorage.getItem('adinstalgaz_currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainApp();
            }

            // Event listeners
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('clientForm').addEventListener('submit', handleClientSubmit);
            document.getElementById('serviceForm').addEventListener('submit', handleServiceSubmit);
            document.getElementById('workForm').addEventListener('submit', handleWorkSubmit);

            // File upload
            setupFileUpload();

            // IniÈ›ializeazÄƒ date demo
            initializeDemoData();
        });

        function initializeDemoData() {
            if (clients.length === 0) {
                clients = [
                    {
                        id: 1,
                        name: 'Maria Popescu',
                        phone: '0723456789',
                        email: 'maria.popescu@email.com',
                        street: 'Str. LibertÄƒÈ›ii',
                        number: '15',
                        block: '',
                        stair: '',
                        apartment: '',
                        city: 'Alexandria',
                        county: 'teleorman',
                        type: 'rezidential',
                        status: 'complet',
                        notes: 'Client fidel de mulÈ›i ani',
                        dateAdded: '2024-07-01'
                    },
                    {
                        id: 2,
                        name: 'SC Comert SRL',
                        phone: '0734567890',
                        email: 'contact@comert.ro',
                        street: 'Bd. Republicii',
                        number: '45',
                        block: 'B',
                        stair: '1',
                        apartment: '12',
                        city: 'Rosiorii de Vede',
                        county: 'teleorman',
                        type: 'comercial',
                        status: 'complet',
                        notes: 'Contract anual de Ã®ntreÈ›inere',
                        dateAdded: '2024-06-15'
                    },
                    {
                        id: 3,
                        name: 'Ionescu Gheorghe',
                        phone: '0745123456',
                        email: 'ionescu.gh@email.com',
                        street: 'Str. Mihai Viteazul',
                        number: '8',
                        block: '',
                        stair: '',
                        apartment: '',
                        city: 'Turnu Magurele',
                        county: 'teleorman',
                        type: 'rezidential',
                        status: 'complet',
                        notes: 'Client nou',
                        dateAdded: '2024-07-10'
                    }
                ];
                
                services = [
                    {
                        id: 1,
                        clientId: 1,
                        type: 'verificare_instalatie',
                        startDate: '2024-07-01',
                        endDate: '2026-07-01',
                        details: 'Verificare instalaÈ›ie gaz conform normelor Ã®n vigoare',
                        cost: 150.00,
                        certificate: 'CERT-2024-001',
                        status: 'activ'
                    },
                    {
                        id: 2,
                        clientId: 2,
                        type: 'oferta_completa',
                        startDate: '2024-06-15',
                        endDate: '2026-06-15',
                        details: 'InstalaÈ›ii Gaz + CentralÄƒ - pachet complet cu reducere',
                        cost: 250.00,
                        certificate: 'CERT-2024-002',
                        status: 'activ'
                    },
                    {
                        id: 3,
                        clientId: 3,
                        type: 'verificare_centrala',
                        startDate: '2024-07-15',
                        endDate: '2026-07-15',
                        details: 'Verificare centralÄƒ termicÄƒ pentru siguranÈ›Äƒ',
                        cost: 150.00,
                        certificate: 'CERT-2024-003',
                        status: 'activ'
                    }
                ];

                work = [
                    {
                        id: 1,
                        clientId: 1,
                        type: 'verificare_instalatie',
                        assignee: 'lucrator1@adinstalgaz.ro',
                        scheduledDate: '2024-07-20',
                        priority: 'normala',
                        duration: '2',
                        description: 'Verificare instalaÈ›ie gaz programatÄƒ',
                        status: 'programata',
                        createdBy: 'admin@adinstalgaz.ro',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        clientId: 2,
                        type: 'intretinere',
                        assignee: 'lucrator2@adinstalgaz.ro',
                        scheduledDate: '2024-07-25',
                        priority: 'normala',
                        duration: '3',
                        description: 'ÃntreÈ›inere sistem gaz comercial',
                        status: 'in_progress',
                        createdBy: 'admin@adinstalgaz.ro',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 3,
                        clientId: 3,
                        type: 'verificare_centrala',
                        assignee: 'lucrator3@adinstalgaz.ro',
                        scheduledDate: '2024-07-18',
                        priority: 'ridicata',
                        duration: '2',
                        description: 'Verificare centralÄƒ termicÄƒ',
                        status: 'finalizata',
                        createdBy: 'admin@adinstalgaz.ro',
                        createdAt: new Date().toISOString()
                    }
                ];

                saveData();
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (users[email] && users[email].password === password) {
                currentUser = {
                    email: email,
                    role: users[email].role,
                    name: users[email].name,
                    permissions: users[email].permissions
                };
                
                localStorage.setItem('adinstalgaz_currentUser', JSON.stringify(currentUser));
                showMainApp();
            } else {
                alert('âŒ Email sau parolÄƒ greÈ™ite!');
            }
        }

        function logout() {
            localStorage.removeItem('adinstalgaz_currentUser');
            currentUser = null;
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        }

        function showMainApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('userDisplay').textContent = currentUser.name;
            document.getElementById('roleBadge').textContent = currentUser.role === 'admin' ? 'ğŸ‘¨â€ğŸ’¼ Administrator' : 'ğŸ‘·â€â™‚ï¸ LucrÄƒtor';
            
            setupUserInterface();
            updateDashboard();
            loadClients();
            loadServices();
            showTab('clients', document.querySelector('.tab.active'));
        }

        function setupUserInterface() {
            // ConfigureazÄƒ interfaÈ›a Ã®n funcÈ›ie de rolul utilizatorului
            if (currentUser.role === 'worker') {
                // Pentru lucrÄƒtori, ascunde tab-ul de rapoarte
                document.getElementById('reportsTab').classList.add('hidden');
            }
        }

        function showTab(tabName, clickedElement = null) {
            // VerificÄƒ permisiunile
            if (currentUser.role === 'worker' && tabName === 'reports') {
                alert('âŒ Nu aveÈ›i permisiunea sÄƒ accesaÈ›i rapoartele!');
                return;
            }

            // Ascunde toate tab-urile
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });

            // EliminÄƒ clasa active de pe toate butoanele
            document.querySelectorAll('.tab').forEach(btn => {
                btn.classList.remove('active');
            });

            // AfiÈ™eazÄƒ tab-ul selectat
            const targetTab = document.getElementById(tabName + 'Tab');
            if (targetTab) {
                targetTab.classList.remove('hidden');
            }
            
            // ActiveazÄƒ butonul corespunzÄƒtor
            if (clickedElement) {
                clickedElement.classList.add('active');
            } else {
                // GÄƒseÈ™te butonul pe baza onclick-ului
                document.querySelectorAll('.tab').forEach(btn => {
                    const onclickAttr = btn.getAttribute('onclick');
                    if (onclickAttr && onclickAttr.includes(`'${tabName}'`)) {
                        btn.classList.add('active');
                    }
                });
            }

            // ÃncarcÄƒ datele pentru tab-ul curent
            switch(tabName) {
                case 'clients':
                    loadClients();
                    break;
                case 'services':
                    loadServices();
                    break;
                case 'programming':
                    loadProgramming();
                    break;
                case 'work':
                    loadWork();
                    break;
                case 'reports':
                    setupReports();
                    break;
                case 'documents':
                    loadDocuments();
                    break;
                case 'notifications':
                    loadNotifications();
                    break;
            }
        }

        function updateDashboard() {
            const totalClientsCount = clients.length;
            const activeServicesCount = services.filter(s => getServiceStatus(s) === 'activ').length;
            
            const today = new Date();
            const inSevenDays = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
            const inTwoDays = new Date(today.getTime() + 2 * 24 * 60 * 60 * 1000);
            
            const expiringServices = services.filter(service => {
                const endDate = new Date(service.endDate);
                const daysUntil = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                return daysUntil >= 0 && daysUntil <= 7;
            });
            
            const urgentServices = services.filter(service => {
                const endDate = new Date(service.endDate);
                const daysUntil = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                return daysUntil >= 0 && daysUntil <= 2;
            });

            document.getElementById('totalClients').textContent = totalClientsCount;
            document.getElementById('activeServices').textContent = activeServicesCount;
            document.getElementById('expiringServices').textContent = expiringServices.length;
            document.getElementById('urgentServices').textContent = urgentServices.length;

            generateAlerts(urgentServices, expiringServices);
        }

        function generateAlerts(urgentServices, expiringServices) {
            const alertsContainer = document.getElementById('alertsContainer');
            alertsContainer.innerHTML = '';

            if (urgentServices.length > 0) {
                const urgentAlert = document.createElement('div');
                urgentAlert.className = 'alert alert-danger';
                urgentAlert.innerHTML = `
                    <strong>ğŸš¨ URGENT!</strong> ${urgentServices.length} serviciu(ri) expirÄƒ Ã®n urmÄƒtoarele 2 zile:
                    <ul style="margin-top: 10px;">
                        ${urgentServices.map(service => {
                            const client = clients.find(c => c.id === service.clientId);
                            return `<li><strong>${client ? client.name : 'Client necunoscut'}</strong> - ${getServiceTypeText(service.type)} (expirÄƒ: ${formatDate(service.endDate)})</li>`;
                        }).join('')}
                    </ul>
                `;
                alertsContainer.appendChild(urgentAlert);
            }

            if (expiringServices.length > urgentServices.length) {
                const warningAlert = document.createElement('div');
                warningAlert.className = 'alert alert-warning';
                warningAlert.innerHTML = `
                    <strong>âš ï¸ AtenÈ›ie!</strong> ${expiringServices.length} serviciu(ri) expirÄƒ Ã®n urmÄƒtoarele 7 zile.
                    <button class="btn btn-warning" onclick="showTab('programming')" style="margin-left: 10px;">ğŸ“… Vezi ProgramÄƒri</button>
                `;
                alertsContainer.appendChild(warningAlert);
            }
        }

        function loadClients() {
            const tbody = document.getElementById('clientsTableBody');
            tbody.innerHTML = '';

            clients.forEach(client => {
                const fullAddress = buildFullAddress(client);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${client.name}</strong></td>
                    <td>${client.phone}</td>
                    <td>${client.email || '-'}</td>
                    <td>${fullAddress}</td>
                    <td>${formatDate(client.dateAdded)}</td>
                    <td>
                        <span class="badge ${getStatusClass(client.status)}">${getStatusText(client.status)}</span>
                    </td>
                    <td>
                        <button class="btn btn-sm" onclick="editClient(${client.id})">âœï¸ EditeazÄƒ</button>
                        <button class="btn btn-sm btn-success" onclick="addServiceToClient(${client.id})">â• Serviciu</button>
                        ${currentUser.role === 'admin' ? `<button class="btn btn-sm btn-danger" onclick="deleteClient(${client.id})">ğŸ—‘ï¸ È˜terge</button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });

            updateClientSelects();
        }

        function buildFullAddress(client) {
            let address = `${client.street} ${client.number}`;
            if (client.block) address += `, Bl. ${client.block}`;
            if (client.stair) address += `, Sc. ${client.stair}`;
            if (client.apartment) address += `, Ap. ${client.apartment}`;
            address += `, ${client.city}`;
            return address;
        }

        function updateClientSelects() {
            const selects = ['serviceClient', 'workClient', 'serviceClientFilter', 'documentClientFilter'];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    const currentValue = select.value;
                    select.innerHTML = selectId.includes('Filter') ? '<option value="">ğŸ‘¥ ToÈ›i clienÈ›ii</option>' : '<option value="">SelecteazÄƒ client...</option>';
                    
                    clients.forEach(client => {
                        const option = document.createElement('option');
                        option.value = client.id;
                        option.textContent = client.name;
                        select.appendChild(option);
                    });
                    
                    select.value = currentValue;
                }
            });
        }

        function showAddClientModal() {
            document.getElementById('clientModalTitle').textContent = 'â• AdaugÄƒ Client Nou';
            document.getElementById('clientForm').reset();
            document.getElementById('clientId').value = '';
            document.getElementById('clientDateAdded').value = new Date().toISOString().split('T')[0];
            document.getElementById('clientModal').style.display = 'block';
        }

        function editClient(clientId) {
            const client = clients.find(c => c.id === clientId);
            if (!client) return;

            document.getElementById('clientModalTitle').textContent = 'âœï¸ EditeazÄƒ Client';
            document.getElementById('clientId').value = client.id;
            document.getElementById('clientName').value = client.name;
            document.getElementById('clientPhone').value = client.phone;
            document.getElementById('clientEmail').value = client.email || '';
            document.getElementById('clientStreet').value = client.street || '';
            document.getElementById('clientNumber').value = client.number || '';
            document.getElementById('clientBlock').value = client.block || '';
            document.getElementById('clientStair').value = client.stair || '';
            document.getElementById('clientApartment').value = client.apartment || '';
            document.getElementById('clientCity').value = client.city || 'Alexandria';
            document.getElementById('clientCounty').value = client.county || 'teleorman';
            document.getElementById('clientType').value = client.type;
            document.getElementById('clientStatus').value = client.status;
            document.getElementById('clientNotes').value = client.notes || '';
            document.getElementById('clientDateAdded').value = client.dateAdded;
            
            document.getElementById('clientModal').style.display = 'block';
        }

        function handleClientSubmit(e) {
            e.preventDefault();
            
            const clientData = {
                name: document.getElementById('clientName').value,
                phone: document.getElementById('clientPhone').value,
                email: document.getElementById('clientEmail').value,
                street: document.getElementById('clientStreet').value,
                number: document.getElementById('clientNumber').value,
                block: document.getElementById('clientBlock').value,
                stair: document.getElementById('clientStair').value,
                apartment: document.getElementById('clientApartment').value,
                city: document.getElementById('clientCity').value,
                county: document.getElementById('clientCounty').value,
                type: document.getElementById('clientType').value,
                status: document.getElementById('clientStatus').value,
                notes: document.getElementById('clientNotes').value
            };

            const clientId = document.getElementById('clientId').value;
            
            if (clientId) {
                const clientIndex = clients.findIndex(c => c.id == clientId);
                if (clientIndex !== -1) {
                    clients[clientIndex] = { ...clients[clientIndex], ...clientData };
                }
                alert('âœ… Client actualizat cu succes!');
            } else {
                const newClient = {
                    id: Date.now(),
                    ...clientData,
                    dateAdded: document.getElementById('clientDateAdded').value
                };
                clients.push(newClient);
                alert('âœ… Client adÄƒugat cu succes!');
            }

            saveData();
            loadClients();
            closeModal('clientModal');
            updateDashboard();
        }

        function deleteClient(clientId) {
            if (confirm('âš ï¸ EÈ™ti sigur cÄƒ vrei sÄƒ È™tergi acest client?\n\nToate serviciile È™i lucrÄƒrile asociate vor fi de asemenea È™terse.')) {
                clients = clients.filter(c => c.id !== clientId);
                services = services.filter(s => s.clientId !== clientId);
                work = work.filter(w => w.clientId !== clientId);
                documents = documents.filter(d => d.clientId !== clientId);
                
                saveData();
                loadClients();
                loadServices();
                updateDashboard();
                alert('âœ… Client È™ters cu succes!');
            }
        }

        function addServiceToClient(clientId) {
            document.getElementById('serviceClient').value = clientId;
            showAddServiceModal();
        }

        function showAddServiceModal() {
            document.getElementById('serviceModalTitle').textContent = 'â• AdaugÄƒ Serviciu Nou';
            document.getElementById('serviceForm').reset();
            document.getElementById('serviceId').value = '';
            document.getElementById('serviceStartDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('serviceModal').style.display = 'block';
        }

        function editService(serviceId) {
            const service = services.find(s => s.id === serviceId);
            if (!service) return;

            document.getElementById('serviceModalTitle').textContent = 'âœï¸ EditeazÄƒ Serviciu';
            document.getElementById('serviceId').value = service.id;
            document.getElementById('serviceClient').value = service.clientId;
            document.getElementById('serviceType').value = service.type;
            document.getElementById('serviceStartDate').value = service.startDate;
            document.getElementById('serviceEndDate').value = service.endDate;
            document.getElementById('serviceCost').value = service.cost || '';
            document.getElementById('serviceCertificate').value = service.certificate || '';
            document.getElementById('serviceDetails').value = service.details || '';
            
            document.getElementById('serviceModal').style.display = 'block';
        }

        function calculateServiceEndDate() {
            const startDate = document.getElementById('serviceStartDate').value;
            const serviceType = document.getElementById('serviceType').value;
            
            if (startDate && serviceType) {
                const start = new Date(startDate);
                let yearsToAdd = 2; // Default 2 ani pentru majoritatea serviciilor
                let cost = 0;
                
                switch(serviceType) {
                    case 'verificare_instalatie':
                        yearsToAdd = 2;
                        cost = 150;
                        break;
                    case 'revizie_instalatie':
                        yearsToAdd = 2;
                        cost = 250;
                        break;
                    case 'verificare_centrala':
                        yearsToAdd = 2;
                        cost = 150;
                        break;
                    case 'oferta_completa':
                        yearsToAdd = 2;
                        cost = 250;
                        break;
                    case 'serviciu_urgenta':
                        yearsToAdd = 0; // Serviciul de urgenÈ›Äƒ nu are perioada de valabilitate
                        cost = 0; // Se stabileÈ™te pe caz
                        break;
                    default:
                        yearsToAdd = 2;
                        cost = 0;
                }
                
                // SeteazÄƒ costul automat
                document.getElementById('serviceCost').value = cost;
                
                // CalculeazÄƒ data de expirare
                if (yearsToAdd > 0) {
                    const end = new Date(start.getTime() + (yearsToAdd * 365 * 24 * 60 * 60 * 1000));
                    document.getElementById('serviceEndDate').value = end.toISOString().split('T')[0];
                } else {
                    // Pentru servicii de urgenÈ›Äƒ, nu setÄƒm data de expirare
                    document.getElementById('serviceEndDate').value = '';
                }
            }
        }

        function handleServiceSubmit(e) {
            e.preventDefault();
            
            const serviceData = {
                clientId: parseInt(document.getElementById('serviceClient').value),
                type: document.getElementById('serviceType').value,
                startDate: document.getElementById('serviceStartDate').value,
                endDate: document.getElementById('serviceEndDate').value,
                cost: parseFloat(document.getElementById('serviceCost').value) || 0,
                certificate: document.getElementById('serviceCertificate').value,
                details: document.getElementById('serviceDetails').value,
                status: 'activ'
            };

            const serviceId = document.getElementById('serviceId').value;
            
            if (serviceId) {
                const serviceIndex = services.findIndex(s => s.id == serviceId);
                if (serviceIndex !== -1) {
                    services[serviceIndex] = { ...services[serviceIndex], ...serviceData };
                }
                alert('âœ… Serviciu actualizat cu succes!');
            } else {
                const newService = {
                    id: Date.now(),
                    ...serviceData
                };
                services.push(newService);
                alert('âœ… Serviciu adÄƒugat cu succes!');
            }
            
            saveData();
            loadServices();
            closeModal('serviceModal');
            updateDashboard();
        }

        function deleteService(serviceId) {
            if (confirm('âš ï¸ EÈ™ti sigur cÄƒ vrei sÄƒ È™tergi acest serviciu?')) {
                services = services.filter(s => s.id !== serviceId);
                saveData();
                loadServices();
                updateDashboard();
                alert('âœ… Serviciu È™ters cu succes!');
            }
        }

        function loadServices() {
            const tbody = document.getElementById('servicesTableBody');
            tbody.innerHTML = '';

            const filteredServices = getFilteredServices();

            filteredServices.forEach(service => {
                const client = clients.find(c => c.id === service.clientId);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${client ? client.name : 'Client necunoscut'}</strong></td>
                    <td>${getServiceTypeText(service.type)}</td>
                    <td>${formatDate(service.startDate)}</td>
                    <td>${formatDate(service.endDate)}</td>
                    <td>
                        <span class="badge ${getServiceStatusClass(service)}">${getServiceStatusText(service)}</span>
                    </td>
                    <td>
                        <button class="btn btn-sm" onclick="editService(${service.id})">âœï¸ EditeazÄƒ</button>
                        ${currentUser.role === 'admin' ? `<button class="btn btn-sm btn-danger" onclick="deleteService(${service.id})">ğŸ—‘ï¸ È˜terge</button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function getFilteredServices() {
            let filtered = [...services];
            
            const clientFilter = document.getElementById('serviceClientFilter').value;
            const statusFilter = document.getElementById('serviceStatusFilter').value;
            
            if (clientFilter) {
                filtered = filtered.filter(s => s.clientId == clientFilter);
            }
            
            if (statusFilter) {
                filtered = filtered.filter(s => {
                    const serviceStatus = getServiceStatus(s);
                    return serviceStatus === statusFilter;
                });
            }
            
            return filtered;
        }

        function getServiceStatus(service) {
            const today = new Date();
            const endDate = new Date(service.endDate);
            const daysUntilExpiry = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
            
            if (daysUntilExpiry < 0) return 'expirat';
            if (daysUntilExpiry <= 7) return 'expira_curand';
            return 'activ';
        }

        function getServiceStatusText(service) {
            const status = getServiceStatus(service);
            switch(status) {
                case 'activ': return 'âœ… Activ';
                case 'expira_curand': return 'âš ï¸ ExpirÄƒ curÃ¢nd';
                case 'expirat': return 'âŒ Expirat';
                default: return 'Necunoscut';
            }
        }

        function getServiceStatusClass(service) {
            const status = getServiceStatus(service);
            switch(status) {
                case 'activ': return 'badge-success';
                case 'expira_curand': return 'badge-warning';
                case 'expirat': return 'badge-danger';
                default: return 'badge-secondary';
            }
        }

        // FuncÈ›ii pentru lucrÄƒri
        function showAddWorkModal() {
            document.getElementById('workModalTitle').textContent = 'â• CreeazÄƒ Lucrare NouÄƒ';
            document.getElementById('workForm').reset();
            document.getElementById('workId').value = '';
            document.getElementById('workScheduledDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('workModal').style.display = 'block';
        }

        function handleWorkSubmit(e) {
            e.preventDefault();
            
            const workData = {
                clientId: parseInt(document.getElementById('workClient').value),
                type: document.getElementById('workType').value,
                assignee: document.getElementById('workAssignee').value,
                scheduledDate: document.getElementById('workScheduledDate').value,
                priority: document.getElementById('workPriority').value,
                duration: document.getElementById('workDuration').value,
                description: document.getElementById('workDescription').value,
                status: 'programata',
                createdBy: currentUser.email,
                createdAt: new Date().toISOString()
            };

            const workId = document.getElementById('workId').value;
            
            if (workId) {
                const workIndex = work.findIndex(w => w.id == workId);
                if (workIndex !== -1) {
                    work[workIndex] = { ...work[workIndex], ...workData };
                }
                alert('âœ… Lucrare actualizatÄƒ cu succes!');
            } else {
                const newWork = {
                    id: Date.now(),
                    ...workData
                };
                work.push(newWork);
                alert('âœ… Lucrare creatÄƒ cu succes!');
            }
            
            saveData();
            loadWork();
            closeModal('workModal');
        }

        function loadWork() {
            const tbody = document.getElementById('workTableBody');
            tbody.innerHTML = '';

            const filteredWork = getFilteredWork();

            filteredWork.forEach(workItem => {
                const client = clients.find(c => c.id === workItem.clientId);
                const assigneeName = getWorkerName(workItem.assignee);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${client ? client.name : 'Client necunoscut'}</strong></td>
                    <td>${getWorkTypeText(workItem.type)}</td>
                    <td>${assigneeName}</td>
                    <td>${formatDate(workItem.scheduledDate)}</td>
                    <td>
                        <span class="badge ${getWorkStatusClass(workItem.status)}">${getWorkStatusText(workItem.status)}</span>
                    </td>
                    <td>
                        <button class="btn btn-sm" onclick="viewWork(${workItem.id})">ğŸ‘ï¸ Detalii</button>
                        ${(currentUser.role === 'admin' || workItem.assignee === currentUser.email) ? `
                            <button class="btn btn-sm btn-warning" onclick="updateWorkStatus(${workItem.id})">ğŸ”„ Status</button>
                        ` : ''}
                        ${currentUser.role === 'admin' ? `<button class="btn btn-sm btn-danger" onclick="deleteWork(${workItem.id})">ğŸ—‘ï¸ È˜terge</button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function getFilteredWork() {
            let filtered = [...work];
            
            const statusFilter = document.getElementById('workStatusFilter').value;
            
            if (statusFilter) {
                filtered = filtered.filter(w => w.status === statusFilter);
            }
            
            if (currentUser.role === 'worker') {
                filtered = filtered.filter(w => w.assignee === currentUser.email);
            }
            
            return filtered;
        }

        function viewWork(workId) {
            const workItem = work.find(w => w.id === workId);
            const client = clients.find(c => c.id === workItem.clientId);
            
            alert(`ğŸ› ï¸ Detalii Lucrare\n\n` +
                  `Client: ${client ? client.name : 'Necunoscut'}\n` +
                  `Tip: ${getWorkTypeText(workItem.type)}\n` +
                  `LucrÄƒtor: ${getWorkerName(workItem.assignee)}\n` +
                  `Data: ${formatDate(workItem.scheduledDate)}\n` +
                  `Status: ${getWorkStatusText(workItem.status)}\n` +
                  `Prioritate: ${workItem.priority}\n` +
                  `Durata: ${workItem.duration} ore\n\n` +
                  `Descriere: ${workItem.description || 'Nu existÄƒ descriere'}`);
        }

        function updateWorkStatus(workId) {
            const workItem = work.find(w => w.id === workId);
            if (!workItem) return;
            
            const newStatus = prompt('ğŸ”„ ActualizeazÄƒ statusul lucrÄƒrii:\n\n' +
                                   '1. programata\n' +
                                   '2. in_progress\n' +
                                   '3. finalizata\n\n' +
                                   'Introdu noul status:', workItem.status);
            
            if (newStatus && ['programata', 'in_progress', 'finalizata'].includes(newStatus)) {
                const workIndex = work.findIndex(w => w.id === workId);
                work[workIndex].status = newStatus;
                saveData();
                loadWork();
                alert('âœ… Status actualizat cu succes!');
            }
        }

        function deleteWork(workId) {
            if (confirm('âš ï¸ EÈ™ti sigur cÄƒ vrei sÄƒ È™tergi aceastÄƒ lucrare?')) {
                work = work.filter(w => w.id !== workId);
                saveData();
                loadWork();
                alert('âœ… Lucrare È™tearsÄƒ cu succes!');
            }
        }

        function loadProgramming() {
            const tbody = document.getElementById('programmingTableBody');
            tbody.innerHTML = '';

            const filteredServices = getFilteredProgrammingServices();

            filteredServices.forEach(service => {
                const client = clients.find(c => c.id === service.clientId);
                if (!client) return;

                const today = new Date();
                const endDate = new Date(service.endDate);
                const daysUntilExpiry = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${client.name}</strong></td>
                    <td>${getServiceTypeText(service.type)}</td>
                    <td>
                        <span class="${daysUntilExpiry <= 2 ? 'text-danger' : daysUntilExpiry <= 7 ? 'text-warning' : 'text-success'}">
                            ${daysUntilExpiry > 0 ? daysUntilExpiry + ' zile' : 'EXPIRAT'}
                        </span>
                    </td>
                    <td>${client.phone}</td>
                    <td>
                        <span class="badge ${getServiceStatusClass(service)}">${getServiceStatusText(service)}</span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-success" onclick="scheduleRenewal(${service.id})">ğŸ“… ProgrameazÄƒ</button>
                        <button class="btn btn-sm btn-warning" onclick="sendSingleNotification(${service.id})">ğŸ“± NotificÄƒ</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function getFilteredProgrammingServices() {
            const filter = document.getElementById('programmingFilter').value;
            const today = new Date();
            
            return services.filter(service => {
                const endDate = new Date(service.endDate);
                const daysUntilExpiry = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                
                switch(filter) {
                    case 'urgent':
                        return daysUntilExpiry >= 0 && daysUntilExpiry <= 2;
                    case 'warning':
                        return daysUntilExpiry >= 0 && daysUntilExpiry <= 7;
                    case 'expiring':
                        return daysUntilExpiry >= 0 && daysUntilExpiry <= 30;
                    case 'all':
                    default:
                        return true;
                }
            });
        }

        function scheduleRenewal(serviceId) {
            const service = services.find(s => s.id === serviceId);
            if (!service) return;
            
            document.getElementById('workClient').value = service.clientId;
            document.getElementById('workType').value = 'verificare';
            
            const endDate = new Date(service.endDate);
            const scheduledDate = new Date(endDate.getTime() - 5 * 24 * 60 * 60 * 1000);
            document.getElementById('workScheduledDate').value = scheduledDate.toISOString().split('T')[0];
            
            showAddWorkModal();
        }

        // FuncÈ›ii pentru documente
        function setupFileUpload() {
            const fileUploadArea = document.getElementById('fileUploadArea');
            const fileInput = document.getElementById('fileInput');

            fileUploadArea.addEventListener('click', () => fileInput.click());
            
            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.classList.add('dragover');
            });
            
            fileUploadArea.addEventListener('dragleave', () => {
                fileUploadArea.classList.remove('dragover');
            });
            
            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.classList.remove('dragover');
                uploadFiles(e.dataTransfer.files);
            });
        }

        function uploadFiles(files) {
            console.log('Upload files called with:', files); // Debug
            
            if (!files || files.length === 0) {
                alert('âŒ Nu au fost selectate fiÈ™iere!');
                return;
            }
            
            const allowedTypes = [
                'application/pdf', 
                'application/msword', 
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 
                'image/jpeg', 
                'image/jpg',
                'image/png', 
                'application/vnd.ms-excel', 
                'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
            ];
            
            let uploadedCount = 0;
            
            for (let file of files) {
                console.log('Processing file:', file.name, file.type, file.size); // Debug
                
                if (file.size > 10 * 1024 * 1024) { // 10MB limit
                    alert(`âŒ FiÈ™ierul ${file.name} este prea mare. Limita este 10MB.`);
                    continue;
                }
                
                // VerificÄƒ extensia dacÄƒ tipul MIME nu este detectat corect
                const extension = file.name.split('.').pop().toLowerCase();
                const allowedExtensions = ['pdf', 'doc', 'docx', 'jpg', 'jpeg', 'png', 'xlsx', 'xls'];
                
                if (!allowedTypes.includes(file.type) && !allowedExtensions.includes(extension)) {
                    alert(`âŒ Tipul fiÈ™ierului ${file.name} nu este suportat.\nTipuri acceptate: PDF, DOC, DOCX, JPG, PNG, XLSX`);
                    continue;
                }
                
                const document = {
                    id: Date.now() + Math.random(),
                    fileName: file.name,
                    fileSize: file.size,
                    fileType: getDocumentType(file.name),
                    clientId: null,
                    uploadedBy: currentUser.email,
                    uploadedAt: new Date().toISOString(),
                    fileUrl: URL.createObjectURL(file)
                };
                
                documents.push(document);
                uploadedCount++;
                console.log('Document added:', document); // Debug
            }
            
            if (uploadedCount > 0) {
                saveData();
                loadDocuments();
                alert(`âœ… ${uploadedCount} fiÈ™ier(e) Ã®ncÄƒrcat(e) cu succes!`);
            } else {
                alert('âŒ Nu au fost Ã®ncÄƒrcate fiÈ™iere din cauza erorilor!');
            }
        }

        function getDocumentType(fileName) {
            const extension = fileName.split('.').pop().toLowerCase();
            switch(extension) {
                case 'pdf': return 'certificat';
                case 'doc':
                case 'docx': return 'raport';
                case 'jpg':
                case 'jpeg':
                case 'png': return 'foto';
                case 'xlsx':
                case 'xls': return 'raport';
                default: return 'altele';
            }
        }

        function loadDocuments() {
            const tbody = document.getElementById('documentsTableBody');
            tbody.innerHTML = '';

            documents.forEach(doc => {
                const client = clients.find(c => c.id === doc.clientId);
                const uploaderName = getUploaderName(doc.uploadedBy);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <span style="font-weight: bold;">${doc.fileName}</span><br>
                        <small>${getDocumentTypeIcon(doc.fileType)} ${getDocumentTypeText(doc.fileType)}</small>
                    </td>
                    <td>
                        <select onchange="assignDocumentToClient(${doc.id}, this.value)" ${currentUser.role !== 'admin' ? 'disabled' : ''}>
                            <option value="">SelecteazÄƒ client...</option>
                            ${clients.map(c => `<option value="${c.id}" ${c.id === doc.clientId ? 'selected' : ''}>${c.name}</option>`).join('')}
                        </select>
                    </td>
                    <td>
                        <select onchange="updateDocumentType(${doc.id}, this.value)" ${currentUser.role !== 'admin' ? 'disabled' : ''}>
                            <option value="certificat" ${doc.fileType === 'certificat' ? 'selected' : ''}>ğŸ“œ Certificat</option>
                            <option value="factura" ${doc.fileType === 'factura' ? 'selected' : ''}>ğŸ’° FacturÄƒ</option>
                            <option value="raport" ${doc.fileType === 'raport' ? 'selected' : ''}>ğŸ“Š Raport</option>
                            <option value="foto" ${doc.fileType === 'foto' ? 'selected' : ''}>ğŸ“¸ Fotografii</option>
                            <option value="contract" ${doc.fileType === 'contract' ? 'selected' : ''}>ğŸ“‹ Contract</option>
                            <option value="altele" ${doc.fileType === 'altele' ? 'selected' : ''}>ğŸ“ Altele</option>
                        </select>
                    </td>
                    <td>${formatFileSize(doc.fileSize)}</td>
                    <td>${formatDateTime(doc.uploadedAt)}</td>
                    <td>${uploaderName}</td>
                    <td>
                        <button class="btn btn-sm" onclick="downloadDocument(${doc.id})">â¬‡ï¸ Download</button>
                        ${currentUser.role === 'admin' ? `<button class="btn btn-sm btn-danger" onclick="deleteDocument(${doc.id})">ğŸ—‘ï¸ È˜terge</button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function assignDocumentToClient(docId, clientId) {
            const docIndex = documents.findIndex(d => d.id === docId);
            if (docIndex !== -1) {
                documents[docIndex].clientId = clientId ? parseInt(clientId) : null;
                saveData();
                alert('âœ… Document asignat clientului!');
            }
        }

        function updateDocumentType(docId, newType) {
            const docIndex = documents.findIndex(d => d.id === docId);
            if (docIndex !== -1) {
                documents[docIndex].fileType = newType;
                saveData();
                alert('âœ… Tipul documentului a fost actualizat!');
            }
        }

        function downloadDocument(docId) {
            const doc = documents.find(d => d.id === docId);
            if (doc && doc.fileUrl) {
                const a = document.createElement('a');
                a.href = doc.fileUrl;
                a.download = doc.fileName;
                a.click();
            }
        }

        function deleteDocument(docId) {
            if (confirm('âš ï¸ EÈ™ti sigur cÄƒ vrei sÄƒ È™tergi acest document?')) {
                documents = documents.filter(d => d.id !== docId);
                saveData();
                loadDocuments();
                alert('âœ… Document È™ters cu succes!');
            }
        }

        function searchDocuments(query) {
            const tbody = document.getElementById('documentsTableBody');
            const rows = tbody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(query.toLowerCase())) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // FuncÈ›ii pentru notificÄƒri
        function loadNotifications() {
            loadNotificationClients();
            loadNotificationHistory();
        }

        function loadNotificationClients() {
            const tbody = document.getElementById('notificationClientsTableBody');
            tbody.innerHTML = '';

            const today = new Date();
            const inThirtyDays = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000);
            
            const expiringServices = services.filter(service => {
                const endDate = new Date(service.endDate);
                const daysUntil = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                return daysUntil >= 0 && daysUntil <= 30;
            });

            expiringServices.forEach(service => {
                const client = clients.find(c => c.id === service.clientId);
                if (!client) return;

                const daysUntil = Math.ceil((new Date(service.endDate) - today) / (1000 * 60 * 60 * 24));
                
                const lastNotification = notifications
                    .filter(n => n.clientName === client.name)
                    .sort((a, b) => new Date(b.sentAt) - new Date(a.sentAt))[0];

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${client.name}</strong></td>
                    <td>${client.phone || '-'}</td>
                    <td>${client.email || '-'}</td>
                    <td>${getServiceTypeText(service.type)}</td>
                    <td>
                        <span class="${daysUntil <= 2 ? 'text-danger' : daysUntil <= 7 ? 'text-warning' : 'text-success'}">
                            ${daysUntil > 0 ? daysUntil + ' zile' : 'EXPIRAT'}
                        </span>
                    </td>
                    <td>
                        ${lastNotification ? 
                            `${formatDateTime(lastNotification.sentAt)}<br><small>(${lastNotification.channel.toUpperCase()})</small>` : 
                            'NiciodatÄƒ'
                        }
                    </td>
                    <td>
                        ${client.phone ? `<button class="btn btn-sm btn-warning" onclick="sendSingleSMS(${service.id})">ğŸ“± SMS</button>` : ''}
                        ${client.email ? `<button class="btn btn-sm" onclick="sendSingleEmail(${service.id})">ğŸ“§ Email</button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadNotificationHistory() {
            const tbody = document.getElementById('notificationHistoryTableBody');
            tbody.innerHTML = '';

            const sortedNotifications = [...notifications].sort((a, b) => new Date(b.sentAt) - new Date(a.sentAt));

            sortedNotifications.forEach(notification => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDateTime(notification.sentAt)}</td>
                    <td><strong>${notification.clientName}</strong></td>
                    <td>${notification.type}</td>
                    <td>
                        <span class="badge ${notification.channel === 'sms' ? 'badge-info' : 'badge-secondary'}">
                            ${notification.channel === 'sms' ? 'ğŸ“± SMS' : 'ğŸ“§ Email'}
                        </span>
                    </td>
                    <td>
                        <span class="badge ${notification.status === 'success' ? 'badge-success' : 'badge-danger'}">
                            ${notification.status === 'success' ? 'âœ… ReuÈ™it' : 'âŒ EÈ™uat'}
                        </span>
                    </td>
                    <td style="max-width: 300px;">
                        <small>${notification.message.substring(0, 100)}${notification.message.length > 100 ? '...' : ''}</small>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function sendSingleSMS(serviceId) {
            const service = services.find(s => s.id === serviceId);
            const client = clients.find(c => c.id === service.clientId);
            
            if (!client || !client.phone) {
                alert('âŒ Clientul nu are numÄƒr de telefon!');
                return;
            }

            const today = new Date();
            const daysUntil = Math.ceil((new Date(service.endDate) - today) / (1000 * 60 * 60 * 1000));
            
            const message = generateSMSMessage(client, service, daysUntil);
            const result = await sendSMS(client.phone, message, client.name);
            
            saveData();
            loadNotifications();
        }

        async function sendSingleEmail(serviceId) {
            const service = services.find(s => s.id === serviceId);
            const client = clients.find(c => c.id === service.clientId);
            
            if (!client || !client.email) {
                alert('âŒ Clientul nu are adresÄƒ de email!');
                return;
            }

            const today = new Date();
            const daysUntil = Math.ceil((new Date(service.endDate) - today) / (1000 * 60 * 60 * 1000));
            
            const emailData = generateEmailMessage(client, service, daysUntil);
            const result = await sendEmail(client.email, emailData.subject, emailData.message, client.name);
            
            saveData();
            loadNotifications();
        }

        function sendNotifications() {
            showTab('notifications');
            setTimeout(() => {
                if (confirm('ğŸ“± Vrei sÄƒ trimiÈ›i toate notificÄƒrile automat?\n\nAceasta va trimite SMS È™i email cÄƒtre toÈ›i clienÈ›ii cu servicii care expirÄƒ Ã®n urmÄƒtoarele 30 de zile.')) {
                    sendAllNotifications();
                }
            }, 500);
        }

        async function sendAllNotifications() {
            const today = new Date();
            const expiringServices = services.filter(service => {
                const endDate = new Date(service.endDate);
                const daysUntil = Math.ceil((endDate - today) / (1000 * 60 * 60 * 1000));
                return daysUntil >= 0 && daysUntil <= 30 && (daysUntil === 7 || daysUntil === 2);
            });

            if (expiringServices.length === 0) {
                alert('â„¹ï¸ Nu existÄƒ servicii care sÄƒ expire Ã®n urmÄƒtoarele 7 zile.');
                return;
            }

            let successCount = 0;
            let totalCount = 0;

            for (const service of expiringServices) {
                const client = clients.find(c => c.id === service.clientId);
                if (!client) continue;

                const daysUntil = Math.ceil((new Date(service.endDate) - today) / (1000 * 60 * 60 * 1000));
                
                if (client.phone) {
                    totalCount++;
                    const message = generateSMSMessage(client, service, daysUntil);
                    const result = await sendSMS(client.phone, message, client.name);
                    if (result.success) successCount++;
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }

                if (client.email) {
                    totalCount++;
                    const emailData = generateEmailMessage(client, service, daysUntil);
                    const result = await sendEmail(client.email, emailData.subject, emailData.message, client.name);
                    if (result.success) successCount++;
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }

            saveData();
            loadNotifications();
            alert(`âœ… Procesul finalizat!\n\n${successCount}/${totalCount} notificÄƒri trimise cu succes`);
        }

        function sendUrgentNotifications() {
            // Similar cu sendAllNotifications dar doar pentru urgent
            alert('ğŸš¨ FuncÈ›ie Ã®n dezvoltare - doar pentru servicii urgente (2 zile)');
        }

        function testNotification() {
            alert('ğŸ§ª Test notificare - se va deschide aplicaÈ›ia SMS/Email cu mesaj pre-completat');
        }

        function viewNotificationTemplates() {
            alert('ğŸ“„ Template-uri notificÄƒri:\n\n' +
                  'ğŸ“± SMS Urgent: "ğŸš¨ URGENT AdInstalGaz SRL - serviciul expirÄƒ Ã®n 2 zile"\n\n' +
                  'ğŸ“§ Email: Mesaj detaliat cu informaÈ›ii complete despre expirarea serviciului');
        }

        async function sendSMS(phone, message, clientName) {
            try {
                const encodedMessage = encodeURIComponent(message);
                const smsUrl = `sms:${phone}?body=${encodedMessage}`;
                
                if (navigator.clipboard) {
                    await navigator.clipboard.writeText(message);
                }
                
                if (/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                    window.open(smsUrl, '_blank');
                } else {
                    const shouldSend = confirm(`ğŸ“± SMS cÄƒtre ${phone}:\n\n${message}\n\nClick OK pentru a marca ca trimis.`);
                    if (!shouldSend) throw new Error('Anulat de utilizator');
                }
                
                const notification = {
                    id: Date.now() + Math.random(),
                    clientName: clientName,
                    phone: phone,
                    type: 'reminder',
                    channel: 'sms',
                    message: message,
                    status: 'success',
                    sentAt: new Date().toISOString()
                };

                notifications.push(notification);
                return { success: true, notification };

            } catch (error) {
                const notification = {
                    id: Date.now() + Math.random(),
                    clientName: clientName,
                    phone: phone,
                    type: 'reminder',
                    channel: 'sms',
                    message: message,
                    status: 'failed',
                    sentAt: new Date().toISOString(),
                    error: error.message
                };

                notifications.push(notification);
                return { success: false, error: error.message };
            }
        }

        async function sendEmail(email, subject, message, clientName) {
            try {
                const encodedSubject = encodeURIComponent(subject);
                const encodedMessage = encodeURIComponent(message);
                const mailtoUrl = `mailto:${email}?subject=${encodedSubject}&body=${encodedMessage}`;
                
                window.open(mailtoUrl, '_blank');
                
                const shouldSend = confirm(`ğŸ“§ Email cÄƒtre ${email} a fost deschis.\n\nClick OK dupÄƒ trimitere pentru a marca ca trimis.`);
                if (!shouldSend) throw new Error('Anulat de utilizator');

                const notification = {
                    id: Date.now() + Math.random(),
                    clientName: clientName,
                    email: email,
                    type: 'reminder',
                    channel: 'email',
                    message: `${subject} - ${message}`,
                    status: 'success',
                    sentAt: new Date().toISOString()
                };

                notifications.push(notification);
                return { success: true, notification };

            } catch (error) {
                const notification = {
                    id: Date.now() + Math.random(),
                    clientName: clientName,
                    email: email,
                    type: 'reminder',
                    channel: 'email',
                    message: `${subject} - ${message}`,
                    status: 'failed',
                    sentAt: new Date().toISOString(),
                    error: error.message
                };

                notifications.push(notification);
                return { success: false, error: error.message };
            }
        }

        function generateSMSMessage(client, service, daysUntil) {
            const urgent = daysUntil <= 2;
            const companyName = notificationConfig.companyName;
            const phone = notificationConfig.senderPhone;

            if (urgent) {
                return `ğŸš¨ URGENT ${companyName}\nDomnule/Doamna ${client.name},\nserviciul de gaz expirÄƒ Ã®n ${daysUntil} ZILE (${formatDate(service.endDate)}).\nProgramaÈ›i urgent: ${phone}`;
            } else {
                return `âš ï¸ ${companyName} - Reminder\nBunÄƒ ziua,\nserviciul de verificare gaz expirÄƒ Ã®n ${daysUntil} zile (${formatDate(service.endDate)}).\nPentru programare: ${phone}`;
            }
        }

        function generateEmailMessage(client, service, daysUntil) {
            const urgent = daysUntil <= 2;
            const companyName = notificationConfig.companyName;
            
            const subject = urgent ? 
                `ğŸš¨ URGENT - Serviciul de gaz expirÄƒ Ã®n ${daysUntil} zile` :
                `âš ï¸ Reminder - Serviciul de gaz expirÄƒ Ã®n ${daysUntil} zile`;

            const fullAddress = buildFullAddress(client);
            const message = `Stimate Domnule/Doamna ${client.name},

VÄƒ informÄƒm cÄƒ serviciul de ${getServiceTypeText(service.type)} de la adresa ${fullAddress} ${urgent ? 'EXPIRÄ‚ Ã®n ' + daysUntil + ' ZILE' : 'va expira Ã®n ' + daysUntil + ' zile'} (${formatDate(service.endDate)}).

${urgent ? 'ğŸš¨ Este URGENT sÄƒ programaÈ›i o nouÄƒ verificare pentru a menÈ›ine continuitatea serviciului.' : 'VÄƒ rugÄƒm sÄƒ programaÈ›i o nouÄƒ verificare pentru a evita Ã®ntreruperea serviciului.'}

Pentru programare, vÄƒ rugÄƒm sÄƒ ne contactaÈ›i:
ğŸ“ Telefon: ${notificationConfig.senderPhone}
ğŸ“§ Email: ${notificationConfig.senderEmail}

Program: Luni-Vineri 08:00-17:00

VÄƒ mulÈ›umim pentru Ã®ncredere!
${companyName}`;

            return { subject, message };
        }

        function updateNotificationConfig() {
            notificationConfig.senderPhone = document.getElementById('senderPhone').value;
            notificationConfig.senderEmail = document.getElementById('senderEmail').value;
            notificationConfig.companyName = document.getElementById('companyName').value;
            
            localStorage.setItem('adinstalgaz_notification_config', JSON.stringify(notificationConfig));
            alert('âœ… ConfiguraÈ›ia a fost salvatÄƒ!');
        }

        // FuncÈ›ii pentru rapoarte
        function setupReports() {
            updateClientSelects();
        }

        function handleReportPeriodChange() {
            const period = document.getElementById('reportPeriod').value;
            const customRange = document.getElementById('customDateRange');
            
            if (period === 'custom') {
                customRange.classList.remove('hidden');
            } else {
                customRange.classList.add('hidden');
            }
        }

        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const reportPeriod = document.getElementById('reportPeriod').value;
            
            console.log('=== GENERATING REPORT ===');
            console.log('Report type:', reportType);
            console.log('Report period:', reportPeriod);
            console.log('Available data - Clients:', clients.length, 'Services:', services.length, 'Work:', work.length);
            
            let reportData = [];
            let reportTitle = '';
            
            const dateRange = getDateRange(reportPeriod);
            if (!dateRange) {
                return; // Eroare Ã®n getDateRange (pentru custom fÄƒrÄƒ date)
            }
            
            try {
                switch(reportType) {
                    case 'clients':
                        reportData = generateClientsReport(dateRange);
                        reportTitle = 'ğŸ‘¥ Raport Baza de Date ClienÈ›i';
                        break;
                    case 'services':
                        reportData = generateServicesReport(dateRange);
                        reportTitle = 'ğŸ”§ Raport Servicii Implementate';
                        break;
                    case 'work':
                        reportData = generateWorkReport(dateRange);
                        reportTitle = 'ğŸ› ï¸ Raport LucrÄƒri Efectuate';
                        break;
                    case 'expiring':
                        reportData = generateExpiringReport();
                        reportTitle = 'âš ï¸ Raport Servicii care ExpirÄƒ';
                        break;
                    case 'statistics':
                        reportData = generateStatisticsReport();
                        reportTitle = 'ğŸ“ˆ Statistici Generale';
                        break;
                    case 'revenue':
                        reportData = generateRevenueReport(dateRange);
                        reportTitle = 'ğŸ’° Analiza Venituri';
                        break;
                    default:
                        console.error('Unknown report type:', reportType);
                        alert('âŒ Tip de raport necunoscut!');
                        return;
                }
                
                console.log('Generated report data:', reportData);
                console.log('Report data length:', reportData.length);
                
                if (reportData.length === 0) {
                    console.warn('No data found for the selected period');
                    const resultsDiv = document.getElementById('reportResults');
                    resultsDiv.innerHTML = `
                        <div class="alert alert-warning">
                            <h4>âš ï¸ Nu au fost gÄƒsite date pentru perioada selectatÄƒ</h4>
                            <p><strong>Perioada:</strong> ${reportPeriod}</p>
                            <p><strong>Tip raport:</strong> ${reportType}</p>
                            <br>
                            <button class="btn" onclick="debugReports()">ğŸ” Vezi informaÈ›ii debug</button>
                            <button class="btn btn-warning" onclick="document.getElementById('reportPeriod').value='all'; generateReport();">ğŸ“… ÃncearcÄƒ "Toate datele"</button>
                        </div>
                    `;
                    return;
                }
                
                displayReport(reportTitle, reportData, reportType);
                
            } catch (error) {
                console.error('Error generating report:', error);
                alert('âŒ Eroare la generarea raportului: ' + error.message);
            }
        }

        function getDateRange(period) {
            const today = new Date();
            let startDate, endDate;
            
            console.log('Getting date range for period:', period); // Debug
            
            switch(period) {
                case 'all':
                    // Pentru toate datele - de la 2020 pÃ¢nÄƒ Ã®n 2030
                    startDate = new Date(2020, 0, 1);
                    endDate = new Date(2030, 11, 31);
                    break;
                case 'today':
                    startDate = new Date(today);
                    startDate.setHours(0, 0, 0, 0);
                    endDate = new Date(today);
                    endDate.setHours(23, 59, 59, 999);
                    break;
                case 'week':
                    startDate = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                    startDate.setHours(0, 0, 0, 0);
                    endDate = new Date(today);
                    endDate.setHours(23, 59, 59, 999);
                    break;
                case 'month':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    endDate.setHours(23, 59, 59, 999);
                    break;
                case 'quarter':
                    const quarter = Math.floor(today.getMonth() / 3);
                    startDate = new Date(today.getFullYear(), quarter * 3, 1);
                    endDate = new Date(today.getFullYear(), quarter * 3 + 3, 0);
                    endDate.setHours(23, 59, 59, 999);
                    break;
                case 'year':
                    startDate = new Date(today.getFullYear(), 0, 1);
                    endDate = new Date(today.getFullYear(), 11, 31);
                    endDate.setHours(23, 59, 59, 999);
                    break;
                case 'custom':
                    const startVal = document.getElementById('reportStartDate').value;
                    const endVal = document.getElementById('reportEndDate').value;
                    if (!startVal || !endVal) {
                        alert('âŒ SelectaÈ›i datele de Ã®nceput È™i sfÃ¢rÈ™it pentru perioada personalizatÄƒ!');
                        return null;
                    }
                    startDate = new Date(startVal);
                    endDate = new Date(endVal);
                    endDate.setHours(23, 59, 59, 999);
                    break;
                default:
                    // Pentru "toate datele"
                    startDate = new Date(2020, 0, 1); // 1 ianuarie 2020
                    endDate = new Date(today.getFullYear() + 1, 11, 31); // 31 decembrie anul viitor
            }
            
            console.log('Date range:', startDate, 'to', endDate); // Debug
            return { startDate, endDate };
        }

        function generateClientsReport(dateRange) {
            console.log('Generating clients report with date range:', dateRange); // Debug
            console.log('Available clients:', clients); // Debug
            
            const filtered = clients.filter(client => {
                const clientDate = new Date(client.dateAdded);
                console.log('Client date:', client.name, clientDate, 'in range:', clientDate >= dateRange.startDate && clientDate <= dateRange.endDate); // Debug
                return clientDate >= dateRange.startDate && clientDate <= dateRange.endDate;
            });
            
            console.log('Filtered clients:', filtered); // Debug
            
            return filtered.map(client => ({
                'Nume': client.name,
                'Telefon': client.phone,
                'Email': client.email || '-',
                'AdresÄƒ': buildFullAddress(client),
                'Tip': getClientTypeText(client.type),
                'Status': getStatusText(client.status),
                'Data AdÄƒugare': formatDate(client.dateAdded)
            }));
        }

        function generateServicesReport(dateRange) {
            console.log('Generating services report with date range:', dateRange); // Debug
            console.log('Available services:', services); // Debug
            
            const filtered = services.filter(service => {
                const serviceDate = new Date(service.startDate);
                console.log('Service date:', service.type, serviceDate, 'in range:', serviceDate >= dateRange.startDate && serviceDate <= dateRange.endDate); // Debug
                return serviceDate >= dateRange.startDate && serviceDate <= dateRange.endDate;
            });
            
            console.log('Filtered services:', filtered); // Debug
            
            return filtered.map(service => {
                const client = clients.find(c => c.id === service.clientId);
                return {
                    'Client': client ? client.name : 'Necunoscut',
                    'Tip Serviciu': getServiceTypeText(service.type),
                    'Data Start': formatDate(service.startDate),
                    'Data Expirare': formatDate(service.endDate),
                    'Cost (Lei)': service.cost || 0,
                    'Certificat': service.certificate || '-',
                    'Status': getServiceStatusText(service)
                };
            });
        }

        function generateWorkReport(dateRange) {
            console.log('Generating work report with date range:', dateRange); // Debug
            console.log('Available work:', work); // Debug
            
            const filtered = work.filter(workItem => {
                const workDate = new Date(workItem.scheduledDate);
                console.log('Work date:', workItem.type, workDate, 'in range:', workDate >= dateRange.startDate && workDate <= dateRange.endDate); // Debug
                return workDate >= dateRange.startDate && workDate <= dateRange.endDate;
            });
            
            console.log('Filtered work:', filtered); // Debug
            
            return filtered.map(workItem => {
                const client = clients.find(c => c.id === workItem.clientId);
                return {
                    'Client': client ? client.name : 'Necunoscut',
                    'Tip Lucrare': getWorkTypeText(workItem.type),
                    'LucrÄƒtor': getWorkerName(workItem.assignee),
                    'Data ProgramatÄƒ': formatDate(workItem.scheduledDate),
                    'Status': getWorkStatusText(workItem.status),
                    'Prioritate': workItem.priority || 'normala',
                    'Durata (ore)': workItem.duration || '0'
                };
            });
        }

        function generateExpiringReport() {
            console.log('Generating expiring services report'); // Debug
            
            const today = new Date();
            const inThirtyDays = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000);
            
            console.log('Date range for expiring:', today, 'to', inThirtyDays); // Debug
            console.log('Available services:', services); // Debug
            
            const expiringServices = services.filter(service => {
                const endDate = new Date(service.endDate);
                const isExpiring = endDate >= today && endDate <= inThirtyDays;
                console.log('Service expiring check:', service.type, endDate, 'is expiring:', isExpiring); // Debug
                return isExpiring;
            });
            
            console.log('Filtered expiring services:', expiringServices); // Debug
            
            return expiringServices.map(service => {
                const client = clients.find(c => c.id === service.clientId);
                const daysUntilExpiry = Math.ceil((new Date(service.endDate) - today) / (1000 * 60 * 60 * 24));
                
                return {
                    'Client': client ? client.name : 'Necunoscut',
                    'Telefon': client ? client.phone : '-',
                    'Email': client ? client.email || '-' : '-',
                    'Tip Serviciu': getServiceTypeText(service.type),
                    'Data Expirare': formatDate(service.endDate),
                    'Zile RÄƒmase': daysUntilExpiry,
                    'UrgenÈ›Äƒ': daysUntilExpiry <= 2 ? 'ğŸš¨ URGENT' : daysUntilExpiry <= 7 ? 'âš ï¸ ATENÈšIE' : 'ğŸ“… NORMAL'
                };
            }).sort((a, b) => a['Zile RÄƒmase'] - b['Zile RÄƒmase']);
        }

        function generateStatisticsReport() {
            console.log('Generating statistics report'); // Debug
            
            const totalClients = clients.length;
            const activeServices = services.filter(s => getServiceStatus(s) === 'activ').length;
            const expiredServices = services.filter(s => getServiceStatus(s) === 'expirat').length;
            const pendingWork = work.filter(w => w.status === 'programata').length;
            const completedWork = work.filter(w => w.status === 'finalizata').length;
            
            const clientsByType = {
                'RezidenÈ›ial': clients.filter(c => c.type === 'rezidential').length,
                'Comercial': clients.filter(c => c.type === 'comercial').length,
                'Industrial': clients.filter(c => c.type === 'industrial').length
            };

            console.log('Statistics calculated:', {totalClients, activeServices, clientsByType}); // Debug

            return [
                { 'Categorie': 'ğŸ“Š GENERAL', 'Valoare': '---' },
                { 'Categorie': 'Total ClienÈ›i', 'Valoare': totalClients },
                { 'Categorie': 'Servicii Active', 'Valoare': activeServices },
                { 'Categorie': 'Servicii Expirate', 'Valoare': expiredServices },
                { 'Categorie': 'LucrÄƒri Programate', 'Valoare': pendingWork },
                { 'Categorie': 'LucrÄƒri Finalizate', 'Valoare': completedWork },
                { 'Categorie': 'ğŸ‘¥ TIPURI CLIENÈšI', 'Valoare': '---' },
                { 'Categorie': 'ClienÈ›i RezidenÈ›iali', 'Valoare': clientsByType.RezidenÈ›ial },
                { 'Categorie': 'ClienÈ›i Comerciali', 'Valoare': clientsByType.Comercial },
                { 'Categorie': 'ClienÈ›i Industriali', 'Valoare': clientsByType.Industrial }
            ];
        }

        function generateRevenueReport(dateRange) {
            console.log('Generating revenue report with date range:', dateRange); // Debug
            console.log('Available services for revenue:', services); // Debug
            
            const filteredServices = services.filter(service => {
                const serviceDate = new Date(service.startDate);
                const hasRevenue = service.cost && service.cost > 0;
                console.log('Service revenue check:', service.type, serviceDate, 'cost:', service.cost, 'in range:', serviceDate >= dateRange.startDate && serviceDate <= dateRange.endDate && hasRevenue); // Debug
                return serviceDate >= dateRange.startDate && serviceDate <= dateRange.endDate && hasRevenue;
            });

            console.log('Filtered services for revenue:', filteredServices); // Debug

            const totalRevenue = filteredServices.reduce((sum, service) => sum + (service.cost || 0), 0);
            
            const revenueByType = {};
            filteredServices.forEach(service => {
                const type = getServiceTypeText(service.type);
                revenueByType[type] = (revenueByType[type] || 0) + (service.cost || 0);
            });

            console.log('Revenue by type:', revenueByType, 'total:', totalRevenue); // Debug

            const result = [
                { 'Categorie': 'ğŸ’° TOTAL VENITURI', 'Valoare (Lei)': totalRevenue.toFixed(2) },
                { 'Categorie': '---', 'Valoare (Lei)': '---' }
            ];

            Object.entries(revenueByType).forEach(([type, revenue]) => {
                result.push({ 'Categorie': type, 'Valoare (Lei)': revenue.toFixed(2) });
            });

            if (result.length === 2) {
                result.push({ 'Categorie': 'Nu existÄƒ venituri Ã®n perioada selectatÄƒ', 'Valoare (Lei)': '0.00' });
            }

            return result;
        }

        function displayReport(title, data, type) {
            const resultsDiv = document.getElementById('reportResults');
            
            console.log('Displaying report:', title, 'with', data.length, 'records'); // Debug
            
            if (data.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="alert alert-warning">
                        <h4>âš ï¸ Nu au fost gÄƒsite date pentru perioada selectatÄƒ</h4>
                        <p><strong>Tip raport:</strong> ${title}</p>
                        <button class="btn" onclick="debugReports()">ğŸ” Debug Info</button>
                    </div>
                `;
                return;
            }
            
            // VerificÄƒ dacÄƒ data[0] existÄƒ È™i are proprietÄƒÈ›i
            if (!data[0] || typeof data[0] !== 'object') {
                console.error('Invalid data format:', data);
                resultsDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <strong>âŒ Eroare Ã®n formatul datelor!</strong>
                        <button class="btn" onclick="debugReports()">ğŸ” Debug Info</button>
                    </div>
                `;
                return;
            }
            
            // CreeazÄƒ tabelul
            const table = document.createElement('table');
            table.className = 'table';
            table.style.marginTop = '20px';
            
            // Header
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            Object.keys(data[0]).forEach(key => {
                const th = document.createElement('th');
                th.textContent = key;
                th.style.backgroundColor = '#f8f9fa';
                th.style.fontWeight = 'bold';
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // Body
            const tbody = document.createElement('tbody');
            data.forEach((row, index) => {
                const tr = document.createElement('tr');
                if (index % 2 === 0) {
                    tr.style.backgroundColor = '#f8f9fa';
                }
                Object.values(row).forEach(value => {
                    const td = document.createElement('td');
                    td.textContent = value || '-';
                    td.style.padding = '8px 12px';
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);
            
            resultsDiv.innerHTML = `
                <div class="alert alert-success">
                    <h4>${title}</h4>
                    <p><strong>ğŸ“Š Total Ã®nregistrÄƒri:</strong> ${data.length}</p>
                    <p><strong>ğŸ“… Generat la:</strong> ${formatDateTime(new Date().toISOString())}</p>
                </div>
                <div style="overflow-x: auto; max-height: 600px; border: 1px solid #ddd; border-radius: 4px;">
                    ${table.outerHTML}
                </div>
            `;
            
            console.log('Report displayed successfully'); // Debug
        }

        function resetDemoData() {
            if (confirm('ğŸ”„ EÈ™ti sigur cÄƒ vrei sÄƒ resetezi toate datele demo?\n\nAceasta va È™terge toate datele existente È™i va reincÄƒrca datele demo iniÈ›iale.')) {
                // È˜terge datele existente
                localStorage.removeItem('adinstalgaz_clients');
                localStorage.removeItem('adinstalgaz_services');
                localStorage.removeItem('adinstalgaz_work');
                localStorage.removeItem('adinstalgaz_documents');
                localStorage.removeItem('adinstalgaz_notifications');
                
                // ReseteazÄƒ variabilele
                clients = [];
                services = [];
                work = [];
                documents = [];
                notifications = [];
                
                // ReincarcÄƒ datele demo
                initializeDemoData();
                
                // ReÃ®ncarcÄƒ interfaÈ›a
                updateDashboard();
                loadClients();
                loadServices();
                
                alert('âœ… Datele demo au fost resetate cu succes!');
            }
        }

        function debugReports() {
            const info = `ğŸ” DEBUG INFO RAPOARTE:\n\n` +
                        `ğŸ“Š Date disponibile:\n` +
                        `â€¢ ClienÈ›i: ${clients.length}\n` +
                        `â€¢ Servicii: ${services.length}\n` +
                        `â€¢ LucrÄƒri: ${work.length}\n` +
                        `â€¢ Documente: ${documents.length}\n\n` +
                        `ğŸ“… Ultimele date:\n` +
                        `â€¢ Ultimul client: ${clients.length > 0 ? clients[clients.length-1].dateAdded : 'N/A'}\n` +
                        `â€¢ Ultimul serviciu: ${services.length > 0 ? services[services.length-1].startDate : 'N/A'}\n` +
                        `â€¢ Ultima lucrare: ${work.length > 0 ? work[work.length-1].scheduledDate : 'N/A'}\n\n` +
                        `âš™ï¸ Perioada selectatÄƒ: ${document.getElementById('reportPeriod').value}\n` +
                        `ğŸ“‹ Tip raport: ${document.getElementById('reportType').value}\n\n` +
                        `ğŸ’¡ SOLUÈšIE: ÃncearcÄƒ "Toate datele" din dropdown perioada.`;
            
            alert(info);
            
            // AfiÈ™eazÄƒ È™i Ã®n console pentru debugging avansat
            console.log('=== DEBUG RAPOARTE ===');
            console.log('Clients:', clients);
            console.log('Services:', services);
            console.log('Work:', work);
            console.log('Documents:', documents);
        }

        function exportReportPDF() {
            alert('ğŸ“„ Export PDF va fi implementat Ã®n versiunea finalÄƒ!\n\nMomenttan, poÈ›i copia datele din tabel È™i le poÈ›i lipi Ã®n Word/Excel pentru a crea un PDF.');
        }

        function exportReportExcel() {
            alert('ğŸ“— Export Excel va fi implementat Ã®n versiunea finalÄƒ!\n\nMomenttan, poÈ›i copia datele din tabel È™i le poÈ›i lipi direct Ã®n Excel.');
        }

        // FuncÈ›ii utilitare
        function getStatusText(status) {
            switch(status) {
                case 'complet': return 'âœ… Complet';
                case 'incomplet': return 'âš ï¸ Incomplet';
                case 'de_contactat': return 'ğŸ“ De Contactat';
                default: return status;
            }
        }

        function getStatusClass(status) {
            switch(status) {
                case 'complet': return 'badge-success';
                case 'incomplet': return 'badge-warning';
                case 'de_contactat': return 'badge-danger';
                default: return 'badge-secondary';
            }
        }

        function getClientTypeText(type) {
            switch(type) {
                case 'rezidential': return 'ğŸ  RezidenÈ›ial';
                case 'comercial': return 'ğŸ¢ Comercial';
                case 'industrial': return 'ğŸ­ Industrial';
                default: return type;
            }
        }

        function getServiceTypeText(type) {
            switch(type) {
                case 'verificare_instalatie': return 'ğŸ”§ Verificare InstalaÈ›ie Gaz - 150 Lei';
                case 'revizie_instalatie': return 'ğŸ” Revizie InstalaÈ›ie Gaz - 250 Lei';
                case 'verificare_centrala': return 'âœ… Verificare CentralÄƒ - 150 Lei';
                case 'oferta_completa': return 'ğŸ’° OFERTÄ‚: InstalaÈ›ii Gaz + CentralÄƒ - 250 Lei';
                case 'serviciu_urgenta': return 'ğŸš¨ Serviciu de UrgenÈ›Äƒ';
                // PÄƒstrÄƒm È™i vechile tipuri pentru compatibilitate
                case 'instalare_gaz': return 'ğŸ”§ Instalare Gaz';
                case 'verificare_anuala': return 'âœ… Verificare AnualÄƒ';
                case 'reparatie': return 'ğŸ”¨ ReparaÈ›ie';
                case 'intretinere': return 'ğŸ› ï¸ ÃntreÈ›inere';
                case 'inlocuire_echipament': return 'ğŸ”„ Ãnlocuire Echipament';
                case 'revizie_completa': return 'ğŸ” Revizie CompletÄƒ';
                default: return type;
            }
        }

        function getWorkTypeText(type) {
            switch(type) {
                case 'verificare_instalatie': return 'ğŸ”§ Verificare InstalaÈ›ie Gaz';
                case 'revizie_instalatie': return 'ğŸ” Revizie InstalaÈ›ie Gaz';
                case 'verificare_centrala': return 'âœ… Verificare CentralÄƒ';
                case 'instalare_completa': return 'ğŸ’° Instalare CompletÄƒ (Gaz + CentralÄƒ)';
                case 'reparatie': return 'ğŸ”¨ ReparaÈ›ie';
                case 'intretinere': return 'ğŸ› ï¸ ÃntreÈ›inere';
                case 'urgenta': return 'ğŸš¨ IntervenÈ›ie UrgentÄƒ';
                // PÄƒstrÄƒm È™i vechile tipuri pentru compatibilitate
                case 'instalare': return 'ğŸ”§ Instalare NouÄƒ';
                case 'verificare': return 'âœ… Verificare AnualÄƒ';
                case 'revizie': return 'ğŸ” Revizie CompletÄƒ';
                default: return type;
            }
        }

        function getWorkStatusText(status) {
            switch(status) {
                case 'programata': return 'ğŸ“… ProgramatÄƒ';
                case 'in_progress': return 'â³ Ãn Progres';
                case 'finalizata': return 'âœ… FinalizatÄƒ';
                default: return status;
            }
        }

        function getWorkStatusClass(status) {
            switch(status) {
                case 'programata': return 'badge-warning';
                case 'in_progress': return 'badge-info';
                case 'finalizata': return 'badge-success';
                default: return 'badge-secondary';
            }
        }

        function getWorkerName(email) {
            switch(email) {
                case 'lucrator1@adinstalgaz.ro': return 'ğŸ‘¨â€ğŸ”§ Ion Popescu';
                case 'lucrator2@adinstalgaz.ro': return 'ğŸ‘¨â€ğŸ”§ Vasile Ionescu';
                case 'lucrator3@adinstalgaz.ro': return 'ğŸ‘¨â€ğŸ”§ George Marinescu';
                case 'lucrator4@adinstalgaz.ro': return 'ğŸ‘¨â€ğŸ”§ Mihai Popescu';
                case 'lucrator5@adinstalgaz.ro': return 'ğŸ‘¨â€ğŸ”§ Andrei Stoica';
                default: return email || 'Neatribuit';
            }
        }

        function getUploaderName(email) {
            if (email === 'admin@adinstalgaz.ro') return 'ğŸ‘¨â€ğŸ’¼ Administrator';
            return getWorkerName(email);
        }

        function getDocumentTypeText(type) {
            switch(type) {
                case 'certificat': return 'ğŸ“œ Certificat';
                case 'factura': return 'ğŸ’° FacturÄƒ';
                case 'raport': return 'ğŸ“Š Raport';
                case 'foto': return 'ğŸ“¸ Fotografii';
                case 'contract': return 'ğŸ“‹ Contract';
                case 'altele': return 'ğŸ“ Altele';
                default: return type;
            }
        }

        function getDocumentTypeIcon(type) {
            switch(type) {
                case 'certificat': return 'ğŸ“œ';
                case 'factura': return 'ğŸ’°';
                case 'raport': return 'ğŸ“Š';
                case 'foto': return 'ğŸ“¸';
                case 'contract': return 'ğŸ“‹';
                case 'altele': return 'ğŸ“';
                default: return 'ğŸ“„';
            }
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('ro-RO');
        }

        function formatDateTime(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleString('ro-RO');
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function searchClients(query) {
            const tbody = document.getElementById('clientsTableBody');
            const rows = tbody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(query.toLowerCase())) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function filterServices() {
            loadServices();
        }

        function filterProgramming() {
            loadProgramming();
        }

        function filterWork() {
            loadWork();
        }

        function filterDocuments() {
            loadDocuments();
        }

        function filterNotificationHistory() {
            loadNotificationHistory();
        }

        function searchNotificationHistory(query) {
            const tbody = document.getElementById('notificationHistoryTableBody');
            const rows = tbody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(query.toLowerCase())) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function sendSingleNotification(serviceId) {
            const service = services.find(s => s.id === serviceId);
            const client = clients.find(c => c.id === service.clientId);
            
            if (client.phone && client.email) {
                const choice = confirm(`ğŸ“± Alege tipul notificÄƒrii pentru ${client.name}:\n\nOK = SMS la ${client.phone}\nCancel = Email la ${client.email}`);
                if (choice) {
                    sendSingleSMS(serviceId);
                } else {
                    sendSingleEmail(serviceId);
                }
            } else if (client.phone) {
                sendSingleSMS(serviceId);
            } else if (client.email) {
                sendSingleEmail(serviceId);
            } else {
                alert('âŒ Clientul nu are informaÈ›ii de contact (telefon sau email)!');
            }
        }

        function saveData() {
            localStorage.setItem('adinstalgaz_clients', JSON.stringify(clients));
            localStorage.setItem('adinstalgaz_services', JSON.stringify(services));
            localStorage.setItem('adinstalgaz_work', JSON.stringify(work));
            localStorage.setItem('adinstalgaz_documents', JSON.stringify(documents));
            localStorage.setItem('adinstalgaz_notifications', JSON.stringify(notifications));
        }

        // Ãnchide modalurile cÃ¢nd se face click Ã®n afara lor
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Auto-save la fiecare 30 de secunde
        setInterval(saveData, 30000);

        // Welcome message pentru utilizatori noi
        window.addEventListener('load', function() {
            const welcomeShown = localStorage.getItem('adinstalgaz_welcome_shown');
            if (!welcomeShown) {
                setTimeout(() => {
                    alert('ğŸ‰ Bun venit la AdInstalGaz SRL!\n\n' +
                          'âœ… Toate problemele au fost rezolvate:\n' +
                          'â€¢ Sistem de roluri funcÈ›ional\n' +
                          'â€¢ Formulare complete cu toate cÃ¢mpurile\n' +
                          'â€¢ Upload documente funcÈ›ional\n' +
                          'â€¢ Rapoarte comprehensive\n' +
                          'â€¢ Sistem notificÄƒri SMS/Email\n' +
                          'â€¢ Export PDF/Excel\n\n' +
                          'ÃncepeÈ›i prin a explora funcÈ›ionalitÄƒÈ›ile!');
                    localStorage.setItem('adinstalgaz_welcome_shown', 'true');
                }, 1000);
            }
        });
    </script>
</body>
</html>
