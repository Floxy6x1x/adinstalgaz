<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdInstalGaz - Sistem Management</title>
    
    <!-- ğŸ”¥ Firebase Dependencies -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <!-- ğŸ“¦ Export Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .header h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .header .subtitle {
            text-align: center;
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ecf0f1;
        }
        
        .auth-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            max-width: 400px;
            margin: 50px auto;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.7);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .tab.active {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .tab-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(45deg, #27ae60, #229954);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #d68910);
            color: white;
        }
        
        .btn-info {
            background: linear-gradient(45deg, #17a2b8, #138496);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #6c757d, #545b62);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .card {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .data-table th {
            background: #34495e;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #e74c3c;
        }
        
        .export-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            border-left: 4px solid;
        }
        
        .alert-success {
            background-color: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        
        .alert-error {
            background-color: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        
        .alert-warning {
            background-color: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none !important;
        }
        
        .expiring-urgent {
            background-color: #ffebee !important;
        }
        
        .expiring-warning {
            background-color: #fff3e0 !important;
        }
        
        .notifications-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .form-grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .form-grid-4 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
        }
        
        .city-badge {
            background: #e3f2fd;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            color: #1565c0;
        }
        
        .client-name {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .address-tooltip {
            cursor: help;
            border-bottom: 1px dotted #999;
        }
        
        .modal-content h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .tabs {
                justify-content: center;
            }
            
            .tab {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .export-buttons {
                grid-template-columns: 1fr;
            }
            
            .form-grid-2, .form-grid-4 {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                margin: 2% auto;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ”§ AdInstalGaz SRL</h1>
            <p class="subtitle">Sistem de Management InstalaÈ›ii cu NotificÄƒri SMS</p>
            <div class="user-info" id="userInfo" style="display: none;">
                <span id="userEmail"></span>
                <span id="userRole"></span>
                <button class="btn btn-danger" onclick="logout()">Logout</button>
            </div>
        </div>

        <!-- Authentication Forms -->
        <div id="authContainer" class="auth-container">
            <!-- Login Form -->
            <div id="loginForm">
                <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">ğŸ” Autentificare</h2>
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="loginEmail">ğŸ“§ Email:</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">ğŸ”’ ParolÄƒ:</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">ConecteazÄƒ-te</button>
                </form>
                <p style="text-align: center; margin-top: 20px;">
                    Nu ai cont? <a href="#" onclick="showRegisterForm()" style="color: #3498db;">ÃnregistreazÄƒ-te</a>
                </p>
            </div>

            <!-- Register Form -->
            <div id="registerForm" style="display: none;">
                <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">ğŸ“ Ãnregistrare</h2>
                <form onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label for="registerName">ğŸ‘¤ Nume complet:</label>
                        <input type="text" id="registerName" required>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">ğŸ“§ Email:</label>
                        <input type="email" id="registerEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">ğŸ”’ ParolÄƒ:</label>
                        <input type="password" id="registerPassword" required minlength="6">
                    </div>
                    <button type="submit" class="btn btn-success" style="width: 100%;">CreeazÄƒ cont</button>
                </form>
                <p style="text-align: center; margin-top: 20px;">
                    Ai deja cont? <a href="#" onclick="showLoginForm()" style="color: #3498db;">ConecteazÄƒ-te</a>
                </p>
            </div>
        </div>

        <!-- Main Application -->
        <div id="mainApp" style="display: none;">
            <!-- Navigation Tabs -->
            <div class="tabs" id="navigationTabs">
                <!-- Tabs will be populated by JavaScript based on user role -->
            </div>

            <!-- Dashboard -->
            <div id="dashboard" class="tab-content">
                <h2>ğŸ“Š Dashboard</h2>
                <div class="stats-grid" id="statsGrid">
                    <!-- Stats will be loaded by JavaScript -->
                </div>
                <div id="recentActivity">
                    <h3>ğŸ“ˆ Activitate RecentÄƒ</h3>
                    <div id="activityList" class="card">
                        <!-- Recent activity will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- ClienÈ›i Tab (Admin only) -->
            <div id="clienti" class="tab-content" style="display: none;">
                <h2>ğŸ‘¥ Gestionare ClienÈ›i</h2>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="showAddClientModal()">â• AdaugÄƒ Client</button>
                    <button class="btn btn-info" onclick="refreshClients()">ğŸ”„ ActualizeazÄƒ</button>
                </div>
                <div id="clientsList">
                    <table class="data-table" id="clientsTable">
                        <thead>
                            <tr>
                                <th>ğŸ‘¤ Nume Complet</th>
                                <th>ğŸ“ Telefon</th>
                                <th>ğŸ“§ Email</th>
                                <th>ğŸ™ï¸ OraÈ™ul</th>
                                <th>ğŸ  Adresa</th>
                                <th>ğŸ“… Data adÄƒugÄƒrii</th>
                                <th>âš¡ AcÈ›iuni</th>
                            </tr>
                        </thead>
                        <tbody id="clientsTableBody">
                            <!-- Clients will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- LucrÄƒtori Tab (Admin only) -->
            <div id="lucratori" class="tab-content" style="display: none;">
                <h2>ğŸ‘¨â€ğŸ”§ Gestionare LucrÄƒtori</h2>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="showAddWorkerModal()">â• AdaugÄƒ LucrÄƒtor</button>
                    <button class="btn btn-info" onclick="refreshWorkers()">ğŸ”„ ActualizeazÄƒ</button>
                </div>
                <div id="workersList">
                    <table class="data-table" id="workersTable">
                        <thead>
                            <tr>
                                <th>ğŸ‘¤ Nume</th>
                                <th>ğŸ“§ Email</th>
                                <th>ğŸ“ Telefon</th>
                                <th>ğŸŒ ZonÄƒ</th>
                                <th>ğŸ“Š Status</th>
                                <th>âš¡ AcÈ›iuni</th>
                            </tr>
                        </thead>
                        <tbody id="workersTableBody">
                            <!-- Workers will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- LucrÄƒrile Mele Tab (Worker only) -->
            <div id="lucrarile-mele" class="tab-content" style="display: none;">
                <h2>ğŸ”§ LucrÄƒrile Mele</h2>
                <div id="myWorksList">
                    <table class="data-table" id="myWorksTable">
                        <thead>
                            <tr>
                                <th>ğŸ‘¤ Client</th>
                                <th>ğŸ”§ Tip Lucrare</th>
                                <th>ğŸ’° PreÈ›</th>
                                <th>ğŸ“… Data AsignÄƒrii</th>
                                <th>ğŸ“Š Status</th>
                                <th>âš¡ AcÈ›iuni</th>
                            </tr>
                        </thead>
                        <tbody id="myWorksTableBody">
                            <!-- My works will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- LucrÄƒri Finalizate Tab (Worker only) -->
            <div id="finalizate" class="tab-content" style="display: none;">
                <h2>âœ… LucrÄƒri Finalizate</h2>
                <div id="completedWorksList">
                    <table class="data-table" id="completedWorksTable">
                        <thead>
                            <tr>
                                <th>ğŸ‘¤ Client</th>
                                <th>ğŸ”§ Tip Lucrare</th>
                                <th>ğŸ’° PreÈ›</th>
                                <th>ğŸ“… Data FinalizÄƒrii</th>
                                <th>ğŸ“… UrmÄƒtorul Serviciu</th>
                                <th>ğŸ“„ Documente</th>
                            </tr>
                        </thead>
                        <tbody id="completedWorksTableBody">
                            <!-- Completed works will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- AsignÄƒri Tab (Admin only) -->
            <div id="asignari" class="tab-content" style="display: none;">
                <h2>ğŸ“‹ Asignare LucrÄƒri</h2>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="showAssignWorkModal()">â• AsigneazÄƒ Lucrare</button>
                </div>
                <div id="assignmentsList">
                    <table class="data-table" id="assignmentsTable">
                        <thead>
                            <tr>
                                <th>ğŸ‘¤ Client</th>
                                <th>ğŸ‘¨â€ğŸ”§ LucrÄƒtor</th>
                                <th>ğŸ”§ Tip Lucrare</th>
                                <th>ğŸ’° PreÈ›</th>
                                <th>ğŸ“… Data AsignÄƒrii</th>
                                <th>ğŸ“Š Status</th>
                                <th>âš¡ AcÈ›iuni</th>
                            </tr>
                        </thead>
                        <tbody id="assignmentsTableBody">
                            <!-- Assignments will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- NotificÄƒri Tab (Admin only) -->
            <div id="notificari" class="tab-content" style="display: none;">
                <h2>ğŸ”” NotificÄƒri È™i ExpirÄƒri Servicii</h2>
                <div id="notificationsContainer">
                    <!-- Notifications content will be loaded by JavaScript -->
                </div>
            </div>

            <!-- Rapoarte Tab (Admin only) -->
            <div id="rapoarte" class="tab-content" style="display: none;">
                <h2>ğŸ“Š Rapoarte È™i Export</h2>
                
                <div class="card">
                    <h3>ğŸš€ Export Rapid</h3>
                    <div class="export-buttons">
                        <button class="btn btn-primary" onclick="quickExport.completePDF()">
                            ğŸ“„ Export PDF Complet
                        </button>
                        <button class="btn btn-success" onclick="quickExport.completeExcel()">
                            ğŸ“Š Export Excel Complet
                        </button>
                        <button class="btn btn-info" onclick="quickExport.monthlyPDF()">
                            ğŸ“… Raport Lunar PDF
                        </button>
                        <button class="btn btn-warning" onclick="quickExport.clientsPDF()">
                            ğŸ‘¥ Doar ClienÈ›i PDF
                        </button>
                        <button class="btn btn-secondary" onclick="quickExport.worksExcel()">
                            ğŸ”§ Doar LucrÄƒri Excel
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3>ğŸ¯ Export Personalizat</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div class="form-group">
                            <label for="startDate">ğŸ“… Data Ã®nceput:</label>
                            <input type="date" id="startDate">
                        </div>
                        <div class="form-group">
                            <label for="endDate">ğŸ“… Data sfÃ¢rÈ™it:</label>
                            <input type="date" id="endDate">
                        </div>
                        <div class="form-group">
                            <label for="reportStatus">ğŸ“Š Status lucrÄƒri:</label>
                            <select id="reportStatus">
                                <option value="">Toate</option>
                                <option value="pending">Ãn aÈ™teptare</option>
                                <option value="in_progress">Ãn progres</option>
                                <option value="completed">Completate</option>
                            </select>
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <button class="btn btn-primary" onclick="generateCustomReport('pdf')">
                            ğŸ“„ GenereazÄƒ PDF
                        </button>
                        <button class="btn btn-success" onclick="generateCustomReport('excel')">
                            ğŸ“Š GenereazÄƒ Excel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Se Ã®ncarcÄƒ...</p>
        </div>

        <!-- Modals -->
        <!-- Add Client Modal -->
        <div id="addClientModal" class="modal">
            <div class="modal-content" style="max-width: 600px;">
                <span class="close" onclick="closeModal('addClientModal')">&times;</span>
                <h2>â• AdaugÄƒ Client Nou</h2>
                <form onsubmit="addClient(event)">
                    <div class="form-grid-2">
                        <div class="form-group">
                            <label for="clientFirstName">ğŸ‘¤ Nume:</label>
                            <input type="text" id="clientFirstName" required placeholder="ex: Popescu">
                        </div>
                        <div class="form-group">
                            <label for="clientLastName">ğŸ‘¤ Prenume:</label>
                            <input type="text" id="clientLastName" required placeholder="ex: Ion">
                        </div>
                    </div>
                    
                    <div class="form-grid-2">
                        <div class="form-group">
                            <label for="clientPhone">ğŸ“ Telefon:</label>
                            <input type="tel" id="clientPhone" required placeholder="ex: 0755123456">
                        </div>
                        <div class="form-group">
                            <label for="clientEmail">ğŸ“§ Email:</label>
                            <input type="email" id="clientEmail" placeholder="ex: client@email.ro">
                        </div>
                    </div>

                    <h3 style="margin: 20px 0 15px 0; color: #2c3e50;">ğŸ  Adresa CompletÄƒ</h3>
                    
                    <div class="form-grid-2">
                        <div class="form-group">
                            <label for="clientStreet">ğŸ›£ï¸ Strada:</label>
                            <input type="text" id="clientStreet" required placeholder="ex: Calea Victoriei">
                        </div>
                        <div class="form-group">
                            <label for="clientNumber">ğŸ”¢ NumÄƒrul:</label>
                            <input type="text" id="clientNumber" required placeholder="ex: 15A">
                        </div>
                    </div>

                    <div class="form-grid-4">
                        <div class="form-group">
                            <label for="clientBlock">ğŸ¢ Bloc:</label>
                            <input type="text" id="clientBlock" placeholder="ex: A1">
                        </div>
                        <div class="form-group">
                            <label for="clientStair">ğŸªœ Scara:</label>
                            <input type="text" id="clientStair" placeholder="ex: B">
                        </div>
                        <div class="form-group">
                            <label for="clientApartment">ğŸšª Apartament:</label>
                            <input type="text" id="clientApartment" placeholder="ex: 15">
                        </div>
                        <div class="form-group">
                            <label for="clientFloor">ğŸ“¶ Etaj:</label>
                            <input type="number" id="clientFloor" min="0" max="50" placeholder="ex: 3">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="clientCity">ğŸ™ï¸ OraÈ™:</label>
                        <select id="clientCity" required>
                            <option value="">SelecteazÄƒ oraÈ™ul</option>
                            <option value="Bucuresti">BucureÈ™ti</option>
                            <option value="Cluj-Napoca">Cluj-Napoca</option>
                            <option value="Timisoara">TimiÈ™oara</option>
                            <option value="Iasi">IaÈ™i</option>
                            <option value="Constanta">ConstanÈ›a</option>
                            <option value="Craiova">Craiova</option>
                            <option value="Brasov">BraÈ™ov</option>
                            <option value="Galati">GalaÈ›i</option>
                            <option value="Ploiesti">PloieÈ™ti</option>
                            <option value="Oradea">Oradea</option>
                            <option value="Braila">BrÄƒila</option>
                            <option value="Arad">Arad</option>
                            <option value="Pitesti">PiteÈ™ti</option>
                            <option value="Sibiu">Sibiu</option>
                            <option value="Bacau">BacÄƒu</option>
                            <option value="Targu-Mures">TÃ¢rgu MureÈ™</option>
                            <option value="Baia-Mare">Baia Mare</option>
                            <option value="Buzau">BuzÄƒu</option>
                            <option value="Botosani">BotoÈ™ani</option>
                            <option value="Satu-Mare">Satu Mare</option>
                            <option value="Ramnicu-Valcea">RÃ¢mnicu VÃ¢lcea</option>
                            <option value="Suceava">Suceava</option>
                            <option value="Piatra-Neamt">Piatra NeamÈ›</option>
                            <option value="Drobeta-Turnu-Severin">Drobeta-Turnu Severin</option>
                            <option value="Focsani">FocÈ™ani</option>
                            <option value="Targu-Jiu">TÃ¢rgu Jiu</option>
                            <option value="Tulcea">Tulcea</option>
                            <option value="Resita">ReÈ™iÈ›a</option>
                            <option value="Alba-Iulia">Alba Iulia</option>
                            <option value="Bistrita">BistriÈ›a</option>
                            <option value="Slatina">Slatina</option>
                            <option value="Calarasi">CÄƒlÄƒraÈ™i</option>
                            <option value="Deva">Deva</option>
                            <option value="Hunedoara">Hunedoara</option>
                            <option value="Vaslui">Vaslui</option>
                            <option value="Roman">Roman</option>
                            <option value="Turda">Turda</option>
                            <option value="Medias">MediaÈ™</option>
                            <option value="Sfantu-Gheorghe">SfÃ¢ntu Gheorghe</option>
                            <option value="Alexandria">Alexandria</option>
                            <option value="Miercurea-Ciuc">Miercurea Ciuc</option>
                            <option value="Zalau">ZalÄƒu</option>
                            <option value="Giurgiu">Giurgiu</option>
                            <option value="Slobozia">Slobozia</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">
                        â• AdaugÄƒ Client
                    </button>
                </form>
            </div>
        </div>

        <!-- Add Worker Modal -->
        <div id="addWorkerModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('addWorkerModal')">&times;</span>
                <h2>â• AdaugÄƒ LucrÄƒtor Nou</h2>
                <form onsubmit="addWorker(event)">
                    <div class="form-group">
                        <label for="workerName">ğŸ‘¤ Nume:</label>
                        <input type="text" id="workerName" required>
                    </div>
                    <div class="form-group">
                        <label for="workerEmail">ğŸ“§ Email:</label>
                        <input type="email" id="workerEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="workerPhone">ğŸ“ Telefon:</label>
                        <input type="tel" id="workerPhone" required>
                    </div>
                    <div class="form-group">
                        <label for="workerZone">ğŸŒ ZonÄƒ:</label>
                        <select id="workerZone" required>
                            <option value="">SelecteazÄƒ zona</option>
                            <option value="Bucuresti">BucureÈ™ti</option>
                            <option value="Cluj-Napoca">Cluj-Napoca</option>
                            <option value="Timisoara">TimiÈ™oara</option>
                            <option value="Iasi">IaÈ™i</option>
                            <option value="Constanta">ConstanÈ›a</option>
                            <option value="Craiova">Craiova</option>
                            <option value="Brasov">BraÈ™ov</option>
                            <option value="Galati">GalaÈ›i</option>
                            <option value="Ploiesti">PloieÈ™ti</option>
                            <option value="Oradea">Oradea</option>
                            <option value="Braila">BrÄƒila</option>
                            <option value="Arad">Arad</option>
                            <option value="Pitesti">PiteÈ™ti</option>
                            <option value="Sibiu">Sibiu</option>
                            <option value="Bacau">BacÄƒu</option>
                            <option value="Targu-Mures">TÃ¢rgu MureÈ™</option>
                            <option value="Baia-Mare">Baia Mare</option>
                            <option value="Buzau">BuzÄƒu</option>
                            <option value="Botosani">BotoÈ™ani</option>
                            <option value="Satu-Mare">Satu Mare</option>
                            <option value="Ramnicu-Valcea">RÃ¢mnicu VÃ¢lcea</option>
                            <option value="Suceava">Suceava</option>
                            <option value="Piatra-Neamt">Piatra NeamÈ›</option>
                            <option value="Drobeta-Turnu-Severin">Drobeta-Turnu Severin</option>
                            <option value="Focsani">FocÈ™ani</option>
                            <option value="Targu-Jiu">TÃ¢rgu Jiu</option>
                            <option value="Tulcea">Tulcea</option>
                            <option value="Resita">ReÈ™iÈ›a</option>
                            <option value="Alba-Iulia">Alba Iulia</option>
                            <option value="Bistrita">BistriÈ›a</option>
                            <option value="Slatina">Slatina</option>
                            <option value="Calarasi">CÄƒlÄƒraÈ™i</option>
                            <option value="Deva">Deva</option>
                            <option value="Hunedoara">Hunedoara</option>
                            <option value="Vaslui">Vaslui</option>
                            <option value="Roman">Roman</option>
                            <option value="Turda">Turda</option>
                            <option value="Medias">MediaÈ™</option>
                            <option value="Sfantu-Gheorghe">SfÃ¢ntu Gheorghe</option>
                            <option value="Alexandria">Alexandria</option>
                            <option value="Miercurea-Ciuc">Miercurea Ciuc</option>
                            <option value="Zalau">ZalÄƒu</option>
                            <option value="Giurgiu">Giurgiu</option>
                            <option value="Slobozia">Slobozia</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">AdaugÄƒ LucrÄƒtor</button>
                </form>
            </div>
        </div>

        <!-- Assign Work Modal -->
        <div id="assignWorkModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('assignWorkModal')">&times;</span>
                <h2>ğŸ“‹ AsigneazÄƒ Lucrare</h2>
                <form onsubmit="assignWork(event)">
                    <div class="form-group">
                        <label for="assignClient">ğŸ‘¤ Client:</label>
                        <select id="assignClient" required>
                            <option value="">SelecteazÄƒ clientul</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="assignWorker">ğŸ‘¨â€ğŸ”§ LucrÄƒtor:</label>
                        <select id="assignWorker" required>
                            <option value="">SelecteazÄƒ lucrÄƒtorul</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="workType">ğŸ”§ Tip Lucrare:</label>
                        <select id="workType" required onchange="updateServicePrice()">
                            <option value="">SelecteazÄƒ tipul</option>
                            <option value="verificare_instalatie_gaz" data-price="150">Verificare InstalaÈ›ie Gaz (150 lei)</option>
                            <option value="revizie_instalatie_gaz" data-price="250">Revizie InstalaÈ›ie Gaz (250 lei)</option>
                            <option value="verificare_centrala" data-price="250">Verificare CentralÄƒ (250 lei)</option>
                            <option value="oferta_instalatii_centrala" data-price="250">OFERTÄ‚: InstalaÈ›ii Gaz + CentralÄƒ (250 lei)</option>
                            <option value="servicii_urgenta" data-price="0">Servicii de UrgenÈ›Äƒ (preÈ› personalizat)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="workPrice">ğŸ’° PreÈ› (lei):</label>
                        <input type="number" id="workPrice" min="0" step="1" placeholder="PreÈ› automat sau personalizat">
                    </div>
                    <div class="form-group">
                        <label for="workDescription">ğŸ“ Descriere:</label>
                        <textarea id="workDescription" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="workPriority">âš¡ Prioritate:</label>
                        <select id="workPriority" required>
                            <option value="normal">NormalÄƒ</option>
                            <option value="urgent">UrgentÄƒ</option>
                            <option value="critical">CriticÄƒ</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">AsigneazÄƒ Lucrarea</button>
                </form>
            </div>
        </div>

        <!-- Complete Work Modal -->
        <div id="completeWorkModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('completeWorkModal')">&times;</span>
                <h2>âœ… FinalizeazÄƒ Lucrarea</h2>
                <form onsubmit="completeWorkWithDetails(event)">
                    <input type="hidden" id="completeWorkId" />
                    <div class="form-group">
                        <label for="nextServiceDate">ğŸ“… Data urmÄƒtorului serviciu:</label>
                        <input type="date" id="nextServiceDate" required>
                    </div>
                    <div class="form-group">
                        <label for="workNotes">ğŸ“ ObservaÈ›ii:</label>
                        <textarea id="workNotes" rows="3" placeholder="Detalii despre lucrarea executatÄƒ..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-success">FinalizeazÄƒ cu Expirare</button>
                </form>
            </div>
        </div>

        <!-- Client Details Modal -->
        <div id="clientDetailsModal" class="modal">
            <div class="modal-content" style="max-width: 600px;">
                <span class="close" onclick="closeModal('clientDetailsModal')">&times;</span>
                <h2>ğŸ‘ï¸ Detalii Client</h2>
                <div id="clientDetailsContent">
                    <!-- Client details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ğŸ”¥ Firebase Configuration - ACTUALIZAT pentru adinstalgaz-pwa
        const firebaseConfig = {
            apiKey: "AIzaSyD9yoIQ__cK0zIPlvSRlu1h7O1MtmrfLXA",
            authDomain: "adinstalgaz-pwa.firebaseapp.com",
            projectId: "adinstalgaz-pwa",
            storageBucket: "adinstalgaz-pwa.firebasestorage.app",
            messagingSenderId: "623851795901",
            appId: "1:623851795901:web:63072fdef30693f4698ed4"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const storage = firebase.storage();

        // Global variables
        let currentUser = null;
        let userRole = null;
        let workerId = null;

        // FuncÈ›ie pentru actualizarea automatÄƒ a preÈ›ului
        function updateServicePrice() {
            const workTypeSelect = document.getElementById('workType');
            const priceInput = document.getElementById('workPrice');
            const selectedOption = workTypeSelect.options[workTypeSelect.selectedIndex];
            
            if (selectedOption && selectedOption.dataset.price) {
                const price = selectedOption.dataset.price;
                if (price === "0") {
                    priceInput.value = '';
                    priceInput.placeholder = 'IntroduceÈ›i preÈ›ul personalizat';
                    priceInput.required = true;
                } else {
                    priceInput.value = price;
                    priceInput.placeholder = 'PreÈ› standard';
                    priceInput.required = false;
                }
            }
        }

        // FuncÈ›ie pentru formatarea tipului de serviciu
        function formatServiceType(serviceType) {
            const serviceNames = {
                'verificare_instalatie_gaz': 'Verificare InstalaÈ›ie Gaz',
                'revizie_instalatie_gaz': 'Revizie InstalaÈ›ie Gaz',
                'verificare_centrala': 'Verificare CentralÄƒ',
                'oferta_instalatii_centrala': 'InstalaÈ›ii Gaz + CentralÄƒ',
                'servicii_urgenta': 'Servicii de UrgenÈ›Äƒ'
            };
            return serviceNames[serviceType] || serviceType;
        }

        // FuncÈ›ie pentru afiÈ™area detaliilor clientului
        async function showClientDetails(clientId) {
            try {
                const clientDoc = await db.collection('clients').doc(clientId).get();
                
                if (!clientDoc.exists) {
                    alert('Clientul nu a fost gÄƒsit');
                    return;
                }
                
                const client = clientDoc.data();
                const createdAt = client.createdAt ? client.createdAt.toDate().toLocaleDateString('ro-RO') : 'N/A';
                
                // CalculeazÄƒ numÄƒrul de lucrÄƒri ale clientului
                const worksSnapshot = await db.collection('lucrari').where('clientId', '==', clientId).get();
                const totalWorks = worksSnapshot.size;
                const completedWorks = worksSnapshot.docs.filter(doc => doc.data().status === 'completed').length;
                const totalSpent = worksSnapshot.docs
                    .filter(doc => doc.data().status === 'completed' && doc.data().price)
                    .reduce((sum, doc) => sum + (doc.data().price || 0), 0);
                
                let detailsHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="card" style="margin: 0;">
                            <h3>ğŸ‘¤ InformaÈ›ii Personale</h3>
                            <p><strong>Nume complet:</strong> ${client.name || 'N/A'}</p>
                            <p><strong>Telefon:</strong> ${client.phone || 'N/A'}</p>
                            <p><strong>Email:</strong> ${client.email || 'N/A'}</p>
                            <p><strong>Data Ã®nregistrÄƒrii:</strong> ${createdAt}</p>
                        </div>
                        
                        <div class="card" style="margin: 0;">
                            <h3>ğŸ“Š Statistici LucrÄƒri</h3>
                            <p><strong>Total lucrÄƒri:</strong> ${totalWorks}</p>
                            <p><strong>LucrÄƒri completate:</strong> ${completedWorks}</p>
                            <p><strong>Ãn progres:</strong> ${worksSnapshot.docs.filter(doc => doc.data().status === 'in_progress').length}</p>
                            <p><strong>Total cheltuit:</strong> ${totalSpent} lei</p>
                        </div>
                    </div>
                    
                    <div class="card" style="margin: 20px 0 0 0;">
                        <h3>ğŸ  Adresa CompletÄƒ</h3>
                `;
                
                if (client.addressDetails) {
                    const addr = client.addressDetails;
                    detailsHTML += `
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <p><strong>ğŸ›£ï¸ Strada:</strong> ${addr.street || 'N/A'}</p>
                                <p><strong>ğŸ”¢ NumÄƒrul:</strong> ${addr.number || 'N/A'}</p>
                                <p><strong>ğŸ™ï¸ OraÈ™ul:</strong> ${addr.city || 'N/A'}</p>
                            </div>
                            <div>
                                <p><strong>ğŸ¢ Bloc:</strong> ${addr.block || 'N/A'}</p>
                                <p><strong>ğŸªœ Scara:</strong> ${addr.stair || 'N/A'}</p>
                                <p><strong>ğŸšª Apartament:</strong> ${addr.apartment || 'N/A'}</p>
                                <p><strong>ğŸ“¶ Etaj:</strong> ${addr.floor || 'N/A'}</p>
                            </div>
                        </div>
                    `;
                } else {
                    detailsHTML += `<p>${client.address || 'Adresa nu este disponibilÄƒ'}</p>`;
                }
                
                detailsHTML += '</div>';
                
                // AdaugÄƒ istoricul lucrÄƒrilor dacÄƒ existÄƒ
                if (totalWorks > 0) {
                    detailsHTML += `
                        <div class="card" style="margin: 20px 0 0 0;">
                            <h3>ğŸ“‹ Istoric LucrÄƒri (ultimele 5)</h3>
                            <table class="data-table" style="margin-top: 10px;">
                                <thead>
                                    <tr>
                                        <th>ğŸ”§ Serviciu</th>
                                        <th>ğŸ’° PreÈ›</th>
                                        <th>ğŸ“Š Status</th>
                                        <th>ğŸ“… Data</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    // AfiÈ™eazÄƒ ultimele 5 lucrÄƒri
                    const recentWorks = worksSnapshot.docs
                        .sort((a, b) => (b.data().createdAt || new Date()) - (a.data().createdAt || new Date()))
                        .slice(0, 5);
                    
                    recentWorks.forEach(workDoc => {
                        const work = workDoc.data();
                        const workDate = work.createdAt ? work.createdAt.toDate().toLocaleDateString('ro-RO') : 'N/A';
                        const statusText = work.status === 'completed' ? 'âœ… CompletatÄƒ' : 
                                         work.status === 'in_progress' ? 'ğŸ”„ Ãn progres' : 'â³ Ãn aÈ™teptare';
                        
                        detailsHTML += `
                            <tr>
                                <td>${formatServiceType(work.workType)}</td>
                                <td>${work.price ? work.price + ' lei' : 'N/A'}</td>
                                <td>${statusText}</td>
                                <td>${workDate}</td>
                            </tr>
                        `;
                    });
                    
                    detailsHTML += '</tbody></table></div>';
                }
                
                document.getElementById('clientDetailsContent').innerHTML = detailsHTML;
                document.getElementById('clientDetailsModal').style.display = 'block';
                
            } catch (error) {
                console.error('âŒ Eroare la Ã®ncÄƒrcarea detaliilor clientului:', error);
                alert('Eroare la Ã®ncÄƒrcarea detaliilor clientului');
            }
        }
        // ğŸ” FUNCÈšII DE ÃNREGISTRARE AUTOMATÄ‚
        // ====================================================================
        const handleRegistration = async (name, email, password) => {
            try {
                console.log('ğŸ”„ Ãncepe Ã®nregistrarea pentru:', email);
                
                const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                const userId = userCredential.user.uid;
                
                console.log('âœ… Cont Auth creat:', userId);
                
                const workerQuery = await firebase.firestore()
                    .collection('workers')
                    .where('email', '==', email)
                    .get();
                
                let userData = {
                    name: name,
                    email: email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                if (!workerQuery.empty) {
                    const workerDoc = workerQuery.docs[0];
                    userData.role = 'worker';
                    userData.workerId = workerDoc.id;
                    
                    console.log('ğŸ‘¨â€ğŸ”§ Utilizator detectat ca LUCRÄ‚TOR:', workerDoc.id);
                    
                    await workerDoc.ref.update({
                        userId: userId,
                        registeredAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                } else {
                    userData.role = 'admin';
                    console.log('ğŸ‘¤ Utilizator Ã®nregistrat ca ADMIN');
                }
                
                await firebase.firestore().collection('users').doc(userId).set(userData);
                
                console.log('âœ… Ãnregistrare completÄƒ cu rolul:', userData.role);
                
                return {
                    success: true,
                    role: userData.role,
                    message: userData.role === 'worker' ? 
                        'Cont lucrÄƒtor creat cu succes!' : 
                        'Cont admin creat cu succes!'
                };
                
            } catch (error) {
                console.error('âŒ Eroare Ã®nregistrare:', error);
                
                let errorMessage = 'Eroare la Ã®nregistrare';
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Acest email este deja folosit';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'Parola trebuie sÄƒ aibÄƒ cel puÈ›in 6 caractere';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Email invalid';
                }
                
                return {
                    success: false,
                    message: errorMessage
                };
            }
        };

        // ====================================================================
        // ğŸ“± FUNCÈšII SMS È˜I NOTIFICÄ‚RI
        // ====================================================================

        // FuncÈ›ie principalÄƒ pentru trimitere SMS
        async function sendSMSNotification(phoneNumber, clientName, serviceName, expiryDate, servicePrice = null) {
            try {
                showLoading(true);
                
                let message = `BunÄƒ ziua ${clientName}! Serviciul ${serviceName} expirÄƒ pe ${expiryDate}.`;
                if (servicePrice) {
                    message += ` PreÈ›: ${servicePrice} lei.`;
                }
                message += ` ContactaÈ›i AdInstalGaz pentru reprogramare: 0755123456`;
                
                console.log('ğŸ“± Trimit SMS cÄƒtre:', phoneNumber);
                console.log('ğŸ“„ Mesaj:', message);
                
                // Pentru demo - simulÄƒm trimiterea SMS
                await simulateSMSSend(phoneNumber, message);
                
                // SalvÄƒm notificarea Ã®n Firestore
                await db.collection('notifications').add({
                    clientName: clientName,
                    phoneNumber: phoneNumber,
                    message: message,
                    serviceName: serviceName,
                    servicePrice: servicePrice,
                    expiryDate: expiryDate,
                    sentAt: firebase.firestore.FieldValue.serverTimestamp(),
                    sentBy: currentUser.uid,
                    status: 'sent'
                });
                
                alert(`âœ… SMS trimis cu succes cÄƒtre ${clientName} (${phoneNumber})`);
                
            } catch (error) {
                console.error('âŒ Eroare trimitere SMS:', error);
                alert('Eroare la trimiterea SMS-ului: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // Simulare trimitere SMS (pentru demo)
        async function simulateSMSSend(phoneNumber, message) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    console.log('ğŸ“± SMS DEMO trimis cÄƒtre:', phoneNumber);
                    resolve({ success: true, messageId: 'demo_' + Date.now() });
                }, 1500);
            });
        }

        // VerificÄƒ serviciile care expirÄƒ Ã®n urmÄƒtoarele zile
        async function checkExpiringServices(daysAhead = 3) {
            try {
                console.log(`ğŸ” Verific servicii care expirÄƒ Ã®n urmÄƒtoarele ${daysAhead} zile...`);
                
                const today = new Date();
                const checkDate = new Date();
                checkDate.setDate(today.getDate() + daysAhead);
                
                const worksSnapshot = await db.collection('lucrari')
                    .where('nextServiceDate', '<=', checkDate)
                    .where('nextServiceDate', '>=', today)
                    .where('status', '==', 'completed')
                    .get();
                
                const expiringServices = [];
                
                for (const doc of worksSnapshot.docs) {
                    const work = doc.data();
                    
                    const clientDoc = await db.collection('clients').doc(work.clientId).get();
                    if (clientDoc.exists) {
                        const client = clientDoc.data();
                        
                        expiringServices.push({
                            workId: doc.id,
                            clientId: work.clientId,
                            clientName: client.name,
                            clientPhone: client.phone,
                            serviceName: formatServiceType(work.workType),
                            servicePrice: work.price,
                            expiryDate: work.nextServiceDate.toDate(),
                            daysUntilExpiry: Math.ceil((work.nextServiceDate.toDate() - today) / (1000 * 60 * 60 * 24))
                        });
                    }
                }
                
                console.log(`ğŸ“‹ GÄƒsite ${expiringServices.length} servicii care expirÄƒ`);
                return expiringServices;
                
            } catch (error) {
                console.error('âŒ Eroare verificare expirÄƒri:', error);
                return [];
            }
        }

        // Verificare automatÄƒ la login admin
        async function autoCheckExpirations() {
            if (userRole === 'admin') {
                try {
                    const expiringServices = await checkExpiringServices(3);
                    
                    if (expiringServices.length > 0) {
                        const message = `ğŸ”” ATENÈšIE: ${expiringServices.length} servicii expirÄƒ Ã®n urmÄƒtoarele 3 zile!\n\nVezi tab "NotificÄƒri" pentru detalii.`;
                        
                        setTimeout(() => {
                            if (confirm(message + '\n\nVrei sÄƒ trimiÈ›i SMS automat tuturor clienÈ›ilor?')) {
                                sendBulkExpirationSMS(expiringServices);
                            }
                        }, 2000);
                    }
                } catch (error) {
                    console.error('âŒ Eroare verificare automatÄƒ:', error);
                }
            }
        }

        // Trimitere SMS Ã®n masÄƒ pentru expirÄƒri
        async function sendBulkExpirationSMS(expiringServices) {
            try {
                showLoading(true);
                let successCount = 0;
                let errorCount = 0;
                
                for (const service of expiringServices) {
                    try {
                        const expiryDateStr = service.expiryDate.toLocaleDateString('ro-RO');
                        await sendSMSNotification(
                            service.clientPhone,
                            service.clientName,
                            service.serviceName,
                            expiryDateStr,
                            service.servicePrice
                        );
                        successCount++;
                        
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                    } catch (error) {
                        console.error(`âŒ Eroare SMS pentru ${service.clientName}:`, error);
                        errorCount++;
                    }
                }
                
                alert(`ğŸ“± SMS-uri trimise:\nâœ… Succes: ${successCount}\nâŒ Erori: ${errorCount}`);
                
            } catch (error) {
                console.error('âŒ Eroare trimitere Ã®n masÄƒ:', error);
                alert('Eroare la trimiterea SMS-urilor Ã®n masÄƒ');
            } finally {
                showLoading(false);
            }
        }

        // ÃncarcÄƒ tab-ul NotificÄƒri
        async function loadNotifications() {
            try {
                const notificationsContainer = document.getElementById('notificationsContainer');
                
                const expiringServices = await checkExpiringServices(7);
                
                const notificationsSnapshot = await db.collection('notifications')
                    .orderBy('sentAt', 'desc')
                    .limit(50)
                    .get();
                
                let html = `
                    <div class="card">
                        <h3>ğŸ”” Servicii care ExpirÄƒ (urmÄƒtoarele 7 zile)</h3>
                        ${expiringServices.length === 0 ? 
                            '<p>âœ… Nu sunt servicii care expirÄƒ Ã®n perioada urmÄƒtoare</p>' :
                            generateExpiringServicesTable(expiringServices)
                        }
                        <div style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="checkExpiringServices(3).then(loadNotifications)">
                                ğŸ”„ VerificÄƒ ExpirÄƒri
                            </button>
                            <button class="btn btn-warning" onclick="sendExpirationReminders()">
                                ğŸ“± Trimite Toate SMS-urile
                            </button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>ğŸ“± Istoric NotificÄƒri SMS</h3>
                        ${generateNotificationsHistory(notificationsSnapshot)}
                    </div>
                `;
                
                notificationsContainer.innerHTML = html;
                
            } catch (error) {
                console.error('âŒ Eroare Ã®ncÄƒrcare notificÄƒri:', error);
            }
        }

        // GenereazÄƒ tabelul cu servicii care expirÄƒ
        function generateExpiringServicesTable(expiringServices) {
            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ğŸ‘¤ Client</th>
                            <th>ğŸ“ Telefon</th>
                            <th>ğŸ”§ Serviciu</th>
                            <th>ğŸ’° PreÈ›</th>
                            <th>ğŸ“… Data ExpirÄƒrii</th>
                            <th>â° Zile RÄƒmase</th>
                            <th>ğŸ“± AcÈ›iuni</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            expiringServices.forEach(service => {
                const urgencyClass = service.daysUntilExpiry <= 1 ? 'expiring-urgent' : 
                                   service.daysUntilExpiry <= 2 ? 'expiring-warning' : '';
                
                html += `
                    <tr class="${urgencyClass}">
                        <td>${service.clientName}</td>
                        <td>${service.clientPhone}</td>
                        <td>${service.serviceName}</td>
                        <td>${service.servicePrice ? service.servicePrice + ' lei' : 'N/A'}</td>
                        <td>${service.expiryDate.toLocaleDateString('ro-RO')}</td>
                        <td>${service.daysUntilExpiry} zile</td>
                        <td>
                            <button class="btn btn-primary" onclick="sendSingleExpirationSMS('${service.clientPhone}', '${service.clientName}', '${service.serviceName}', '${service.expiryDate.toLocaleDateString('ro-RO')}', ${service.servicePrice})">
                                ğŸ“± Trimite SMS
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
            `;
            
            return html;
        }

        // GenereazÄƒ istoricul notificÄƒrilor
        function generateNotificationsHistory(notificationsSnapshot) {
            if (notificationsSnapshot.empty) {
                return '<p>ğŸ“­ Nu existÄƒ notificÄƒri trimise Ã®ncÄƒ</p>';
            }
            
            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ğŸ‘¤ Client</th>
                            <th>ğŸ“ Telefon</th>
                            <th>ğŸ”§ Serviciu</th>
                            <th>ğŸ’° PreÈ›</th>
                            <th>ğŸ“„ Mesaj</th>
                            <th>ğŸ“… Data Trimiterii</th>
                            <th>ğŸ“Š Status</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            notificationsSnapshot.forEach(doc => {
                const notification = doc.data();
                const sentAt = notification.sentAt ? notification.sentAt.toDate().toLocaleDateString('ro-RO') : 'N/A';
                
                html += `
                    <tr>
                        <td>${notification.clientName}</td>
                        <td>${notification.phoneNumber}</td>
                        <td>${notification.serviceName}</td>
                        <td>${notification.servicePrice ? notification.servicePrice + ' lei' : 'N/A'}</td>
                        <td>${notification.message.substring(0, 50)}...</td>
                        <td>${sentAt}</td>
                        <td>âœ… Trimis</td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
            `;
            
            return html;
        }

        // FuncÈ›ii helper pentru acÈ›iuni SMS
        async function sendSingleExpirationSMS(phoneNumber, clientName, serviceName, expiryDate, servicePrice = null) {
            await sendSMSNotification(phoneNumber, clientName, serviceName, expiryDate, servicePrice);
            loadNotifications();
        }

        async function sendExpirationReminders() {
            const expiringServices = await checkExpiringServices(3);
            if (expiringServices.length > 0) {
                if (confirm(`Trimiti SMS cÄƒtre ${expiringServices.length} clienÈ›i cu servicii care expirÄƒ?`)) {
                    await sendBulkExpirationSMS(expiringServices);
                    loadNotifications();
                }
            } else {
                alert('Nu existÄƒ servicii care expirÄƒ Ã®n urmÄƒtoarele 3 zile');
            }
        }

        // Modal pentru trimiterea SMS-ului personalizat
        function showSMSModal(clientId, clientName, clientPhone) {
            const message = prompt(
                `Trimite SMS cÄƒtre ${clientName} (${clientPhone}):\n\nIntroduceÈ›i mesajul:`,
                `BunÄƒ ziua ${clientName}! Mesaj de la AdInstalGaz. Pentru informaÈ›ii: 0755123456`
            );
            
            if (message) {
                sendCustomSMS(clientPhone, clientName, message);
            }
        }

        // Trimitere SMS personalizat
        async function sendCustomSMS(phoneNumber, clientName, customMessage) {
            try {
                showLoading(true);
                
                console.log('ğŸ“± Trimit SMS personalizat cÄƒtre:', phoneNumber);
                
                await simulateSMSSend(phoneNumber, customMessage);
                
                await db.collection('notifications').add({
                    clientName: clientName,
                    phoneNumber: phoneNumber,
                    message: customMessage,
                    serviceName: 'Mesaj personalizat',
                    sentAt: firebase.firestore.FieldValue.serverTimestamp(),
                    sentBy: currentUser.uid,
                    status: 'sent'
                });
                
                alert(`âœ… SMS personalizat trimis cÄƒtre ${clientName}`);
                
            } catch (error) {
                console.error('âŒ Eroare SMS personalizat:', error);
                alert('Eroare la trimiterea SMS-ului');
            } finally {
                showLoading(false);
            }
        }

        // ====================================================================
        // ğŸ“¦ FUNCÈšII DE EXPORT (din artifact-ul anterior)
        // ====================================================================
        const collectReportData = async (filters = {}) => {
            try {
                console.log('ğŸ“Š Colectez date pentru raport...');
                
                let clientsQuery = firebase.firestore().collection('clients');
                
                if (filters.startDate) {
                    clientsQuery = clientsQuery.where('createdAt', '>=', new Date(filters.startDate));
                }
                if (filters.endDate) {
                    clientsQuery = clientsQuery.where('createdAt', '<=', new Date(filters.endDate));
                }
                
                const clientsSnapshot = await clientsQuery.get();
                const clients = clientsSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data(),
                    createdAt: doc.data().createdAt?.toDate ? doc.data().createdAt.toDate() : new Date()
                }));
                
                let worksQuery = firebase.firestore().collection('lucrari');
                
                if (filters.startDate) {
                    worksQuery = worksQuery.where('createdAt', '>=', new Date(filters.startDate));
                }
                if (filters.endDate) {
                    worksQuery = worksQuery.where('createdAt', '<=', new Date(filters.endDate));
                }
                if (filters.status) {
                    worksQuery = worksQuery.where('status', '==', filters.status);
                }
                if (filters.workerId) {
                    worksQuery = worksQuery.where('assignedTo', '==', filters.workerId);
                }
                
                const worksSnapshot = await worksQuery.get();
                const works = worksSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data(),
                    createdAt: doc.data().createdAt?.toDate ? doc.data().createdAt.toDate() : new Date(),
                    completedAt: doc.data().completedAt?.toDate ? doc.data().completedAt.toDate() : null
                }));
                
                const workersSnapshot = await firebase.firestore().collection('workers').get();
                const workers = workersSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                console.log(`âœ… Date colectate: ${clients.length} clienÈ›i, ${works.length} lucrÄƒri, ${workers.length} lucrÄƒtori`);
                
                return {
                    clients,
                    works,
                    workers,
                    summary: {
                        totalClients: clients.length,
                        totalWorks: works.length,
                        completedWorks: works.filter(w => w.status === 'completed').length,
                        pendingWorks: works.filter(w => w.status === 'pending').length,
                        inProgressWorks: works.filter(w => w.status === 'in_progress').length
                    }
                };
                
            } catch (error) {
                console.error('âŒ Eroare colectare date:', error);
                throw error;
            }
        };

        const exportToPDF = async (data, reportType = 'complete') => {
            try {
                console.log('ğŸ“„ Generez raport PDF...');
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFontSize(20);
                doc.setTextColor(44, 62, 80);
                doc.text('AdInstalGaz SRL', 20, 20);
                
                doc.setFontSize(12);
                doc.setTextColor(127, 140, 141);
                doc.text('Raport Activitate', 20, 30);
                doc.text(`Data generÄƒrii: ${new Date().toLocaleDateString('ro-RO')}`, 20, 37);
                
                let yPos = 50;
                
                doc.setFontSize(16);
                doc.setTextColor(52, 73, 94);
                doc.text('ğŸ“Š Sumar General', 20, yPos);
                yPos += 10;
                
                doc.setFontSize(11);
                doc.setTextColor(0, 0, 0);
                doc.text(`Total clienÈ›i: ${data.summary.totalClients}`, 25, yPos);
                doc.text(`Total lucrÄƒri: ${data.summary.totalWorks}`, 25, yPos + 7);
                doc.text(`LucrÄƒri completate: ${data.summary.completedWorks}`, 25, yPos + 14);
                doc.text(`LucrÄƒri Ã®n progres: ${data.summary.inProgressWorks}`, 25, yPos + 21);
                doc.text(`LucrÄƒri Ã®n aÈ™teptare: ${data.summary.pendingWorks}`, 25, yPos + 28);
                
                yPos += 45;
                
                if (reportType === 'complete' || reportType === 'clients') {
                    doc.setFontSize(14);
                    doc.setTextColor(52, 73, 94);
                    doc.text('ğŸ‘¥ ClienÈ›i', 20, yPos);
                    yPos += 5;
                    
                    const clientsTableData = data.clients.map(client => [
                        client.name || 'N/A',
                        client.phone || 'N/A',
                        getCityName(client),
                        getShortAddress(client),
                        client.createdAt ? client.createdAt.toLocaleDateString('ro-RO') : 'N/A'
                    ]);
                    
                    doc.autoTable({
                        startY: yPos,
                        head: [['Nume Client', 'Telefon', 'OraÈ™', 'AdresÄƒ', 'Data AdÄƒugÄƒrii']],
                        body: clientsTableData,
                        theme: 'striped',
                        headStyles: { fillColor: [52, 73, 94] },
                        margin: { left: 20, right: 20 }
                    });
                    
                    yPos = doc.lastAutoTable.finalY + 15;
                }
                
                if (reportType === 'complete' || reportType === 'works') {
                    if (yPos > 220) {
                        doc.addPage();
                        yPos = 20;
                    }
                    
                    doc.setFontSize(14);
                    doc.setTextColor(52, 73, 94);
                    doc.text('ğŸ”§ LucrÄƒri', 20, yPos);
                    yPos += 5;
                    
                    const worksTableData = data.works.map(work => {
                        const client = data.clients.find(c => c.id === work.clientId);
                        const worker = data.workers.find(w => w.id === work.assignedTo);
                        
                        return [
                            client?.name || 'Client necunoscut',
                            formatServiceType(work.workType),
                            worker?.name || 'Neasignat',
                            work.status === 'completed' ? 'âœ… CompletatÄƒ' : 
                            work.status === 'in_progress' ? 'ğŸ”„ Ãn progres' : 'â³ Ãn aÈ™teptare',
                            work.price ? work.price + ' lei' : 'N/A',
                            work.createdAt ? work.createdAt.toLocaleDateString('ro-RO') : 'N/A'
                        ];
                    });
                    
                    doc.autoTable({
                        startY: yPos,
                        head: [['Client', 'Tip Lucrare', 'LucrÄƒtor', 'Status', 'PreÈ›', 'Data CreÄƒrii']],
                        body: worksTableData,
                        theme: 'striped',
                        headStyles: { fillColor: [52, 73, 94] },
                        margin: { left: 20, right: 20 }
                    });
                }
                
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(127, 140, 141);
                    doc.text(`Pagina ${i} din ${pageCount}`, 20, 285);
                    doc.text('AdInstalGaz SRL - Raport generat automat', 120, 285);
                }
                
                const filename = `Raport_AdInstalGaz_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(filename);
                
                console.log('âœ… PDF generat cu succes:', filename);
                return { success: true, filename };
                
            } catch (error) {
                console.error('âŒ Eroare generare PDF:', error);
                return { success: false, error: error.message };
            }
        };

        const exportToExcel = async (data, reportType = 'complete') => {
            try {
                console.log('ğŸ“Š Generez raport Excel...');
                
                const workbook = XLSX.utils.book_new();
                
                const summaryData = [
                    ['RAPORT ADINSTALGAZ SRL', '', '', ''],
                    ['Data generÄƒrii:', new Date().toLocaleDateString('ro-RO'), '', ''],
                    ['', '', '', ''],
                    ['SUMAR GENERAL', '', '', ''],
                    ['Total clienÈ›i:', data.summary.totalClients, '', ''],
                    ['Total lucrÄƒri:', data.summary.totalWorks, '', ''],
                    ['LucrÄƒri completate:', data.summary.completedWorks, '', ''],
                    ['LucrÄƒri Ã®n progres:', data.summary.inProgressWorks, '', ''],
                    ['LucrÄƒri Ã®n aÈ™teptare:', data.summary.pendingWorks, '', ''],
                ];
                
                const summarySheet = XLSX.utils.aoa_to_sheet(summaryData);
                XLSX.utils.book_append_sheet(workbook, summarySheet, 'Sumar');
                
                if (reportType === 'complete' || reportType === 'clients') {
                    const clientsData = [
                        ['Nume Client', 'Telefon', 'Email', 'OraÈ™', 'Strada', 'NumÄƒr', 'Bloc', 'Apartament', 'Data AdÄƒugÄƒrii', 'Nr. LucrÄƒri', 'Total Cheltuit']
                    ];
                    
                    data.clients.forEach(client => {
                        const clientWorks = data.works.filter(w => w.clientId === client.id);
                        const totalSpent = clientWorks
                            .filter(w => w.status === 'completed' && w.price)
                            .reduce((sum, w) => sum + (w.price || 0), 0);
                        
                        const addr = client.addressDetails || {};
                        
                        clientsData.push([
                            client.name || 'N/A',
                            client.phone || 'N/A',
                            client.email || 'N/A',
                            addr.city || getCityName(client),
                            addr.street || 'N/A',
                            addr.number || 'N/A',
                            addr.block || '',
                            addr.apartment || '',
                            client.createdAt ? client.createdAt.toLocaleDateString('ro-RO') : 'N/A',
                            clientWorks.length,
                            totalSpent
                        ]);
                    });
                    
                    const clientsSheet = XLSX.utils.aoa_to_sheet(clientsData);
                    clientsSheet['!cols'] = [
                        { wch: 20 }, { wch: 15 }, { wch: 25 }, { wch: 15 }, { wch: 20 }, { wch: 8 }, { wch: 8 }, { wch: 8 }, { wch: 15 }, { wch: 12 }, { wch: 15 }
                    ];
                    XLSX.utils.book_append_sheet(workbook, clientsSheet, 'ClienÈ›i');
                }
                
                if (reportType === 'complete' || reportType === 'works') {
                    const worksData = [
                        ['Client', 'Tip Lucrare', 'LucrÄƒtor Asignat', 'Status', 'PreÈ› (lei)', 'Data CreÄƒrii', 'Data FinalizÄƒrii', 'ObservaÈ›ii']
                    ];
                    
                    data.works.forEach(work => {
                        const client = data.clients.find(c => c.id === work.clientId);
                        const worker = data.workers.find(w => w.id === work.assignedTo);
                        
                        worksData.push([
                            client?.name || 'Client necunoscut',
                            formatServiceType(work.workType),
                            worker?.name || 'Neasignat',
                            work.status === 'completed' ? 'CompletatÄƒ' : 
                            work.status === 'in_progress' ? 'Ãn progres' : 'Ãn aÈ™teptare',
                            work.price || 0,
                            work.createdAt ? work.createdAt.toLocaleDateString('ro-RO') : 'N/A',
                            work.completedAt ? work.completedAt.toLocaleDateString('ro-RO') : 'N/A',
                            work.notes || ''
                        ]);
                    });
                    
                    const worksSheet = XLSX.utils.aoa_to_sheet(worksData);
                    worksSheet['!cols'] = [
                        { wch: 20 }, { wch: 25 }, { wch: 18 }, { wch: 12 }, { wch: 10 }, { wch: 15 }, { wch: 15 }, { wch: 25 }
                    ];
                    XLSX.utils.book_append_sheet(workbook, worksSheet, 'LucrÄƒri');
                }
                
                const workersData = [
                    ['Nume LucrÄƒtor', 'Email', 'Telefon', 'ZonÄƒ', 'Total LucrÄƒri', 'Completate', 'Ãn Progres', 'Rata Succes']
                ];
                
                data.workers.forEach(worker => {
                    const workerTasks = data.works.filter(w => w.assignedTo === worker.id);
                    const completedTasks = workerTasks.filter(w => w.status === 'completed');
                    const inProgressTasks = workerTasks.filter(w => w.status === 'in_progress');
                    const successRate = workerTasks.length > 0 ? 
                        ((completedTasks.length / workerTasks.length) * 100).toFixed(1) + '%' : '0%';
                    
                    workersData.push([
                        worker.name || 'N/A',
                        worker.email || 'N/A',
                        worker.phone || 'N/A',
                        worker.zone || 'N/A',
                        workerTasks.length,
                        completedTasks.length,
                        inProgressTasks.length,
                        successRate
                    ]);
                });
                
                const workersSheet = XLSX.utils.aoa_to_sheet(workersData);
                workersSheet['!cols'] = [
                    { wch: 18 }, { wch: 25 }, { wch: 15 }, { wch: 12 }, { wch: 12 }, { wch: 12 }, { wch: 12 }, { wch: 12 }
                ];
                XLSX.utils.book_append_sheet(workbook, workersSheet, 'PerformanÈ›Äƒ LucrÄƒtori');
                
                const filename = `Raport_AdInstalGaz_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(workbook, filename);
                
                console.log('âœ… Excel generat cu succes:', filename);
                return { success: true, filename };
                
            } catch (error) {
                console.error('âŒ Eroare generare Excel:', error);
                return { success: false, error: error.message };
            }
        };

        const generateReport = async (filters = {}, format = 'pdf', reportType = 'complete') => {
            try {
                console.log(`ğŸ¯ Generez raport ${format.toUpperCase()} - tip: ${reportType}`);
                
                const data = await collectReportData(filters);
                
                let result;
                if (format === 'pdf') {
                    result = await exportToPDF(data, reportType);
                } else if (format === 'excel' || format === 'xlsx') {
                    result = await exportToExcel(data, reportType);
                } else {
                    throw new Error('Format nesuportat. FoloseÈ™te "pdf" sau "excel"');
                }
                
                return result;
                
            } catch (error) {
                console.error('âŒ Eroare generare raport:', error);
                return { success: false, error: error.message };
            }
        };

        const quickExport = {
            completePDF: () => generateReport({}, 'pdf', 'complete'),
            completeExcel: () => generateReport({}, 'excel', 'complete'),
            clientsPDF: () => generateReport({}, 'pdf', 'clients'),
            clientsExcel: () => generateReport({}, 'excel', 'clients'),
            worksPDF: () => generateReport({}, 'pdf', 'works'),
            worksExcel: () => generateReport({}, 'excel', 'works'),
            monthlyPDF: () => {
                const endDate = new Date();
                const startDate = new Date();
                startDate.setDate(startDate.getDate() - 30);
                return generateReport({ startDate, endDate }, 'pdf', 'complete');
            },
            workerReport: (workerId) => generateReport({ workerId }, 'excel', 'works')
        };

        // ====================================================================
        // ğŸ¯ Authentication Functions
        // ====================================================================
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                showLoading(true);
                const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                console.log('âœ… Login successful');
                
            } catch (error) {
                console.error('âŒ Login error:', error);
                alert('Eroare la conectare: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            try {
                showLoading(true);
                const result = await handleRegistration(name, email, password);
                
                if (result.success) {
                    alert(result.message);
                } else {
                    alert(result.message);
                }
                
            } catch (error) {
                console.error('âŒ Register error:', error);
                alert('Eroare la Ã®nregistrare: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function showLoginForm() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
        }

        function showRegisterForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }

        function logout() {
            firebase.auth().signOut();
        }

        // ====================================================================
        // ğŸ¯ UI Functions
        // ====================================================================
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showTab(tabName) {
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => tab.style.display = 'none');
            
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).style.display = 'block';
            
            event.target.classList.add('active');
            
            loadTabData(tabName);
        }

        function loadTabData(tabName) {
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'clienti':
                    loadClientsWithSMS();
                    break;
                case 'lucratori':
                    loadWorkers();
                    break;
                case 'lucrarile-mele':
                    loadMyWorks();
                    break;
                case 'finalizate':
                    loadCompletedWorks();
                    break;
                case 'asignari':
                    loadAssignments();
                    break;
                case 'notificari':
                    loadNotifications();
                    break;
            }
        }

        function createNavigationTabs(role) {
            const navigationTabs = document.getElementById('navigationTabs');
            let tabsHTML = '';
            
            if (role === 'admin') {
                tabsHTML = `
                    <button class="tab active" onclick="showTab('dashboard')">ğŸ“Š Dashboard</button>
                    <button class="tab" onclick="showTab('clienti')">ğŸ‘¥ ClienÈ›i</button>
                    <button class="tab" onclick="showTab('lucratori')">ğŸ‘¨â€ğŸ”§ LucrÄƒtori</button>
                    <button class="tab" onclick="showTab('asignari')">ğŸ“‹ AsignÄƒri</button>
                    <button class="tab" onclick="showTab('notificari')">ğŸ”” NotificÄƒri</button>
                    <button class="tab" onclick="showTab('rapoarte')">ğŸ“Š Rapoarte</button>
                `;
            } else if (role === 'worker') {
                tabsHTML = `
                    <button class="tab active" onclick="showTab('dashboard')">ğŸ  Dashboard</button>
                    <button class="tab" onclick="showTab('lucrarile-mele')">ğŸ”§ LucrÄƒrile Mele</button>
                    <button class="tab" onclick="showTab('finalizate')">âœ… Finalizate</button>
                `;
            }
            
            navigationTabs.innerHTML = tabsHTML;
        }

        // ====================================================================
        // ğŸ¯ Data Loading Functions
        // ====================================================================
        async function loadDashboard() {
            try {
                const statsGrid = document.getElementById('statsGrid');
                
                if (userRole === 'admin') {
                    const clientsSnapshot = await db.collection('clients').get();
                    const workersSnapshot = await db.collection('workers').get();
                    const worksSnapshot = await db.collection('lucrari').get();
                    
                    const completedWorks = worksSnapshot.docs.filter(doc => doc.data().status === 'completed').length;
                    
                    // CalculeazÄƒ totalul venituri din lucrÄƒrile completate
                    const totalRevenue = worksSnapshot.docs
                        .filter(doc => doc.data().status === 'completed' && doc.data().price)
                        .reduce((sum, doc) => sum + (doc.data().price || 0), 0);
                    
                    statsGrid.innerHTML = `
                        <div class="stat-card">
                            <div class="stat-number">${clientsSnapshot.size}</div>
                            <div>ğŸ‘¥ Total ClienÈ›i</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${workersSnapshot.size}</div>
                            <div>ğŸ‘¨â€ğŸ”§ Total LucrÄƒtori</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${worksSnapshot.size}</div>
                            <div>ğŸ”§ Total LucrÄƒri</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${completedWorks}</div>
                            <div>âœ… Completate</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${totalRevenue}</div>
                            <div>ğŸ’° Venituri (lei)</div>
                        </div>
                    `;
                } else if (userRole === 'worker') {
                    const myWorksSnapshot = await db.collection('lucrari')
                        .where('assignedTo', '==', workerId)
                        .get();
                    
                    const myCompletedWorks = myWorksSnapshot.docs.filter(doc => doc.data().status === 'completed').length;
                    const myInProgressWorks = myWorksSnapshot.docs.filter(doc => doc.data().status === 'in_progress').length;
                    
                    // CalculeazÄƒ venitul lucrÄƒtorului din lucrÄƒrile completate
                    const myRevenue = myWorksSnapshot.docs
                        .filter(doc => doc.data().status === 'completed' && doc.data().price)
                        .reduce((sum, doc) => sum + (doc.data().price || 0), 0);
                    
                    statsGrid.innerHTML = `
                        <div class="stat-card">
                            <div class="stat-number">${myWorksSnapshot.size}</div>
                            <div>ğŸ”§ Total LucrÄƒri</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${myCompletedWorks}</div>
                            <div>âœ… Completate</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${myInProgressWorks}</div>
                            <div>ğŸ”„ Ãn Progres</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${myRevenue}</div>
                            <div>ğŸ’° Venituri (lei)</div>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('âŒ Eroare la Ã®ncÄƒrcarea dashboard-ului:', error);
            }
        }

        // FuncÈ›ie pentru afiÈ™area adresei scurte Ã®n tabele
        function getShortAddress(client) {
            if (client.addressDetails) {
                const addr = client.addressDetails;
                let shortAddr = `${addr.street} ${addr.number}`;
                if (addr.block) shortAddr += `, Bl.${addr.block}`;
                if (addr.apartment) shortAddr += `, Ap.${addr.apartment}`;
                return shortAddr;
            }
            return client.address || 'N/A';
        }

        // FuncÈ›ie pentru afiÈ™area oraÈ™ului
        function getCityName(client) {
            if (client.addressDetails && client.addressDetails.city) {
                return client.addressDetails.city;
            }
            // ÃncearcÄƒ sÄƒ extragi oraÈ™ul din adresa veche
            const address = client.address || '';
            const parts = address.split(',');
            return parts[parts.length - 1]?.trim() || 'N/A';
        }

        // FuncÈ›ie modificatÄƒ pentru Ã®ncÄƒrcarea clienÈ›ilor cu buton SMS
        async function loadClientsWithSMS() {
            try {
                const clientsTableBody = document.getElementById('clientsTableBody');
                const clientsSnapshot = await db.collection('clients').orderBy('createdAt', 'desc').get();
                
                let html = '';
                clientsSnapshot.forEach(doc => {
                    const client = doc.data();
                    const createdAt = client.createdAt ? client.createdAt.toDate().toLocaleDateString('ro-RO') : 'N/A';
                    const shortAddress = getShortAddress(client);
                    const cityName = getCityName(client);
                    
                    html += `
                        <tr>
                            <td><strong>${client.name || 'N/A'}</strong></td>
                            <td>${client.phone || 'N/A'}</td>
                            <td>${client.email || 'N/A'}</td>
                            <td><span style="background: #e3f2fd; padding: 4px 8px; border-radius: 12px; font-size: 12px;">${cityName}</span></td>
                            <td title="${client.address || ''}">${shortAddress}</td>
                            <td>${createdAt}</td>
                            <td>
                                <button class="btn btn-primary" onclick="assignWorkToClient('${doc.id}')">ğŸ“‹ AsigneazÄƒ</button>
                                <button class="btn btn-success" onclick="showSMSModal('${doc.id}', '${client.name}', '${client.phone}')">ğŸ“± SMS</button>
                                <button class="btn btn-info" onclick="showClientDetails('${doc.id}')">ğŸ‘ï¸ Detalii</button>
                                <button class="btn btn-danger" onclick="deleteClient('${doc.id}')">ğŸ—‘ï¸ È˜terge</button>
                            </td>
                        </tr>
                    `;
                });
                
                clientsTableBody.innerHTML = html;
                
            } catch (error) {
                console.error('âŒ Eroare la Ã®ncÄƒrcarea clienÈ›ilor:', error);
            }
        }

        async function loadWorkers() {
            try {
                const workersTableBody = document.getElementById('workersTableBody');
                const workersSnapshot = await db.collection('workers').get();
                
                let html = '';
                workersSnapshot.forEach(doc => {
                    const worker = doc.data();
                    const status = worker.userId ? 'âœ… Ãnregistrat' : 'â³ Ãn aÈ™teptare';
                    
                    html += `
                        <tr>
                            <td>${worker.name || 'N/A'}</td>
                            <td>${worker.email || 'N/A'}</td>
                            <td>${worker.phone || 'N/A'}</td>
                            <td>${worker.zone || 'N/A'}</td>
                            <td>${status}</td>
                            <td>
                                <button class="btn btn-danger" onclick="deleteWorker('${doc.id}')">ğŸ—‘ï¸ È˜terge</button>
                            </td>
                        </tr>
                    `;
                });
                
                workersTableBody.innerHTML = html;
                
            } catch (error) {
                console.error('âŒ Eroare la Ã®ncÄƒrcarea lucrÄƒtorilor:', error);
            }
        }

        async function loadMyWorks() {
            try {
                const myWorksTableBody = document.getElementById('myWorksTableBody');
                const worksSnapshot = await db.collection('lucrari')
                    .where('assignedTo', '==', workerId)
                    .where('status', 'in', ['pending', 'in_progress'])
                    .get();
                
                let html = '';
                for (const doc of worksSnapshot.docs) {
                    const work = doc.data();
                    
                    const clientDoc = await db.collection('clients').doc(work.clientId).get();
                    const clientName = clientDoc.exists ? clientDoc.data().name : 'Client necunoscut';
                    
                    const createdAt = work.createdAt ? work.createdAt.toDate().toLocaleDateString('ro-RO') : 'N/A';
                    const statusText = work.status === 'pending' ? 'â³ Ãn aÈ™teptare' : 'ğŸ”„ Ãn progres';
                    
                    html += `
                        <tr>
                            <td>${clientName}</td>
                            <td>${formatServiceType(work.workType)}</td>
                            <td>${work.price ? work.price + ' lei' : 'N/A'}</td>
                            <td>${createdAt}</td>
                            <td>${statusText}</td>
                            <td>
                                ${work.status === 'pending' ? 
                                    `<button class="btn btn-primary" onclick="startWork('${doc.id}')">ğŸš€ Ãncepe</button>` :
                                    `<button class="btn btn-success" onclick="showCompleteWorkModal('${doc.id}')">âœ… FinalizeazÄƒ</button>`
                                }
                            </td>
                        </tr>
                    `;
                }
                
                myWorksTableBody.innerHTML = html;
                
            } catch (error) {
                console.error('âŒ Eroare la Ã®ncÄƒrcarea lucrÄƒrilor:', error);
            }
        }

        async function loadCompletedWorks() {
            try {
                const completedWorksTableBody = document.getElementById('completedWorksTableBody');
                const worksSnapshot = await db.collection('lucrari')
                    .where('assignedTo', '==', workerId)
                    .where('status', '==', 'completed')
                    .get();
                
                let html = '';
                for (const doc of worksSnapshot.docs) {
                    const work = doc.data();
                    
                    const clientDoc = await db.collection('clients').doc(work.clientId).get();
                    const clientName = clientDoc.exists ? clientDoc.data().name : 'Client necunoscut';
                    
                    const completedAt = work.completedAt ? work.completedAt.toDate().toLocaleDateString('ro-RO') : 'N/A';
                    const nextServiceDate = work.nextServiceDate ? work.nextServiceDate.toDate().toLocaleDateString('ro-RO') : 'N/A';
                    
                    html += `
                        <tr>
                            <td>${clientName}</td>
                            <td>${formatServiceType(work.workType)}</td>
                            <td>${work.price ? work.price + ' lei' : 'N/A'}</td>
                            <td>${completedAt}</td>
                            <td>${nextServiceDate}</td>
                            <td>ğŸ“„ Vezi documente</td>
                        </tr>
                    `;
                }
                
                completedWorksTableBody.innerHTML = html;
                
            } catch (error) {
                console.error('âŒ Eroare la Ã®ncÄƒrcarea lucrÄƒrilor finalizate:', error);
            }
        }

        async function loadAssignments() {
            try {
                const assignmentsTableBody = document.getElementById('assignmentsTableBody');
                const worksSnapshot = await db.collection('lucrari').orderBy('createdAt', 'desc').get();
                
                let html = '';
                for (const doc of worksSnapshot.docs) {
                    const work = doc.data();
                    
                    const clientDoc = await db.collection('clients').doc(work.clientId).get();
                    const workerDoc = await db.collection('workers').doc(work.assignedTo).get();
                    
                    const clientName = clientDoc.exists ? clientDoc.data().name : 'Client necunoscut';
                    const workerName = workerDoc.exists ? workerDoc.data().name : 'LucrÄƒtor necunoscut';
                    const createdAt = work.createdAt ? work.createdAt.toDate().toLocaleDateString('ro-RO') : 'N/A';
                    
                    const statusText = work.status === 'completed' ? 'âœ… CompletatÄƒ' : 
                                     work.status === 'in_progress' ? 'ğŸ”„ Ãn progres' : 'â³ Ãn aÈ™teptare';
                    
                    html += `
                        <tr>
                            <td>${clientName}</td>
                            <td>${workerName}</td>
                            <td>${formatServiceType(work.workType)}</td>
                            <td>${work.price ? work.price + ' lei' : 'N/A'}</td>
                            <td>${createdAt}</td>
                            <td>${statusText}</td>
                            <td>
                                <button class="btn btn-danger" onclick="deleteAssignment('${doc.id}')">ğŸ—‘ï¸ È˜terge</button>
                            </td>
                        </tr>
                    `;
                }
                
                assignmentsTableBody.innerHTML = html;
                
            } catch (error) {
                console.error('âŒ Eroare la Ã®ncÄƒrcarea asignÄƒrilor:', error);
            }
        }

        // ====================================================================
        // ğŸ¯ Modal Functions
        // ====================================================================
        function showAddClientModal() {
            document.getElementById('addClientModal').style.display = 'block';
        }

        function showAddWorkerModal() {
            document.getElementById('addWorkerModal').style.display = 'block';
        }

        function showAssignWorkModal() {
            loadClientsAndWorkersForAssignment();
            document.getElementById('assignWorkModal').style.display = 'block';
        }

        function showCompleteWorkModal(workId) {
            document.getElementById('completeWorkId').value = workId;
            document.getElementById('completeWorkModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        async function loadClientsAndWorkersForAssignment() {
            try {
                const clientSelect = document.getElementById('assignClient');
                const workerSelect = document.getElementById('assignWorker');
                
                const clientsSnapshot = await db.collection('clients').get();
                clientSelect.innerHTML = '<option value="">SelecteazÄƒ clientul</option>';
                clientsSnapshot.forEach(doc => {
                    const client = doc.data();
                    clientSelect.innerHTML += `<option value="${doc.id}">${client.name}</option>`;
                });
                
                const workersSnapshot = await db.collection('workers').get();
                workerSelect.innerHTML = '<option value="">SelecteazÄƒ lucrÄƒtorul</option>';
                workersSnapshot.forEach(doc => {
                    const worker = doc.data();
                    workerSelect.innerHTML += `<option value="${doc.id}">${worker.name}</option>`;
                });
                
            } catch (error) {
                console.error('âŒ Eroare la Ã®ncÄƒrcarea datelor pentru asignare:', error);
            }
        }

        // ====================================================================
        // ğŸ¯ CRUD Functions
        // ====================================================================
        // FuncÈ›ie pentru construirea adresei complete
        function buildFullAddress(street, number, block, stair, apartment, floor, city) {
            let address = `${street} ${number}`;
            
            if (block) address += `, Bl. ${block}`;
            if (stair) address += `, Sc. ${stair}`;
            if (apartment) address += `, Ap. ${apartment}`;
            if (floor) address += `, Et. ${floor}`;
            address += `, ${city}`;
            
            return address;
        }

        // FuncÈ›ie pentru resetarea formularului client
        function resetClientForm() {
            document.getElementById('clientFirstName').value = '';
            document.getElementById('clientLastName').value = '';
            document.getElementById('clientPhone').value = '';
            document.getElementById('clientEmail').value = '';
            document.getElementById('clientStreet').value = '';
            document.getElementById('clientNumber').value = '';
            document.getElementById('clientBlock').value = '';
            document.getElementById('clientStair').value = '';
            document.getElementById('clientApartment').value = '';
            document.getElementById('clientFloor').value = '';
            document.getElementById('clientCity').value = '';
        }

        async function addClient(event) {
            event.preventDefault();
            
            try {
                const firstName = document.getElementById('clientFirstName').value;
                const lastName = document.getElementById('clientLastName').value;
                const phone = document.getElementById('clientPhone').value;
                const email = document.getElementById('clientEmail').value;
                const street = document.getElementById('clientStreet').value;
                const number = document.getElementById('clientNumber').value;
                const block = document.getElementById('clientBlock').value;
                const stair = document.getElementById('clientStair').value;
                const apartment = document.getElementById('clientApartment').value;
                const floor = document.getElementById('clientFloor').value;
                const city = document.getElementById('clientCity').value;
                
                const fullName = `${firstName} ${lastName}`;
                const fullAddress = buildFullAddress(street, number, block, stair, apartment, floor, city);
                
                const clientData = {
                    name: fullName,
                    firstName: firstName,
                    lastName: lastName,
                    phone: phone,
                    email: email,
                    address: fullAddress,
                    addressDetails: {
                        street: street,
                        number: number,
                        block: block || '',
                        stair: stair || '',
                        apartment: apartment || '',
                        floor: floor || '',
                        city: city
                    },
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    createdBy: currentUser.uid
                };
                
                await db.collection('clients').add(clientData);
                
                alert('âœ… Client adÄƒugat cu succes!');
                closeModal('addClientModal');
                loadClientsWithSMS();
                resetClientForm();
                
            } catch (error) {
                console.error('âŒ Eroare la adÄƒugarea clientului:', error);
                alert('Eroare la adÄƒugarea clientului: ' + error.message);
            }
        }

        async function addWorker(event) {
            event.preventDefault();
            
            try {
                const workerData = {
                    name: document.getElementById('workerName').value,
                    email: document.getElementById('workerEmail').value,
                    phone: document.getElementById('workerPhone').value,
                    zone: document.getElementById('workerZone').value,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    createdBy: currentUser.uid
                };
                
                await db.collection('workers').add(workerData);
                
                alert('âœ… LucrÄƒtor adÄƒugat cu succes! Poate sÄƒ se Ã®nregistreze cu emailul: ' + workerData.email);
                closeModal('addWorkerModal');
                loadWorkers();
                
                document.getElementById('workerName').value = '';
                document.getElementById('workerEmail').value = '';
                document.getElementById('workerPhone').value = '';
                document.getElementById('workerZone').value = '';
                
            } catch (error) {
                console.error('âŒ Eroare la adÄƒugarea lucrÄƒtorului:', error);
                alert('Eroare la adÄƒugarea lucrÄƒtorului: ' + error.message);
            }
        }

        async function assignWork(event) {
            event.preventDefault();
            
            try {
                const workPrice = document.getElementById('workPrice').value;
                
                const workData = {
                    clientId: document.getElementById('assignClient').value,
                    assignedTo: document.getElementById('assignWorker').value,
                    workType: document.getElementById('workType').value,
                    price: workPrice ? parseInt(workPrice) : 0,
                    description: document.getElementById('workDescription').value,
                    priority: document.getElementById('workPriority').value,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    createdBy: currentUser.uid
                };
                
                await db.collection('lucrari').add(workData);
                
                alert('âœ… Lucrare asignatÄƒ cu succes!');
                closeModal('assignWorkModal');
                
                document.getElementById('assignClient').value = '';
                document.getElementById('assignWorker').value = '';
                document.getElementById('workType').value = '';
                document.getElementById('workPrice').value = '';
                document.getElementById('workDescription').value = '';
                document.getElementById('workPriority').value = 'normal';
                
            } catch (error) {
                console.error('âŒ Eroare la asignarea lucrÄƒrii:', error);
                alert('Eroare la asignarea lucrÄƒrii: ' + error.message);
            }
        }

        async function startWork(workId) {
            try {
                await db.collection('lucrari').doc(workId).update({
                    status: 'in_progress',
                    startedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                alert('âœ… Lucrarea a fost Ã®nceputÄƒ!');
                loadMyWorks();
                
            } catch (error) {
                console.error('âŒ Eroare la Ã®nceperea lucrÄƒrii:', error);
                alert('Eroare la Ã®nceperea lucrÄƒrii: ' + error.message);
            }
        }

        async function completeWorkWithDetails(event) {
            event.preventDefault();
            
            try {
                const workId = document.getElementById('completeWorkId').value;
                const nextServiceDate = new Date(document.getElementById('nextServiceDate').value);
                const notes = document.getElementById('workNotes').value;
                
                await db.collection('lucrari').doc(workId).update({
                    status: 'completed',
                    completedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    nextServiceDate: nextServiceDate,
                    notes: notes
                });
                
                alert('âœ… Lucrarea a fost finalizatÄƒ cu data urmÄƒtorului serviciu!');
                closeModal('completeWorkModal');
                loadMyWorks();
                
                document.getElementById('nextServiceDate').value = '';
                document.getElementById('workNotes').value = '';
                
            } catch (error) {
                console.error('âŒ Eroare la finalizarea lucrÄƒrii:', error);
                alert('Eroare la finalizarea lucrÄƒrii: ' + error.message);
            }
        }

        // FuncÈ›ii de refresh È™i È™tergere
        async function refreshClients() {
            try {
                console.log('ğŸ”„ Actualizez lista clienÈ›ilor...');
                await loadClientsWithSMS();
                alert('âœ… Lista clienÈ›ilor actualizatÄƒ!');
            } catch (error) {
                console.error('âŒ Eroare la actualizarea clienÈ›ilor:', error);
                alert('Eroare la actualizare: ' + error.message);
            }
        }

        async function refreshWorkers() {
            try {
                console.log('ğŸ”„ Actualizez lista lucrÄƒtorilor...');
                await loadWorkers();
                alert('âœ… Lista lucrÄƒtorilor actualizatÄƒ!');
            } catch (error) {
                console.error('âŒ Eroare la actualizarea lucrÄƒtorilor:', error);
                alert('Eroare la actualizare: ' + error.message);
            }
        }

        async function deleteClient(clientId) {
            if (confirm('EÈ™ti sigur cÄƒ vrei sÄƒ È™tergi acest client?')) {
                try {
                    await db.collection('clients').doc(clientId).delete();
                    alert('âœ… Client È™ters cu succes!');
                    loadClientsWithSMS();
                } catch (error) {
                    console.error('âŒ Eroare la È™tergerea clientului:', error);
                    alert('Eroare la È™tergere: ' + error.message);
                }
            }
        }

        async function deleteWorker(workerId) {
            if (confirm('EÈ™ti sigur cÄƒ vrei sÄƒ È™tergi acest lucrÄƒtor?')) {
                try {
                    await db.collection('workers').doc(workerId).delete();
                    alert('âœ… LucrÄƒtor È™ters cu succes!');
                    loadWorkers();
                } catch (error) {
                    console.error('âŒ Eroare la È™tergerea lucrÄƒtorului:', error);
                    alert('Eroare la È™tergere: ' + error.message);
                }
            }
        }

        async function assignWorkToClient(clientId) {
            await loadClientsAndWorkersForAssignment();
            document.getElementById('assignClient').value = clientId;
            showAssignWorkModal();
        }

        async function deleteAssignment(assignmentId) {
            if (confirm('EÈ™ti sigur cÄƒ vrei sÄƒ È™tergi aceastÄƒ asignare?')) {
                try {
                    await db.collection('lucrari').doc(assignmentId).delete();
                    alert('âœ… Asignare È™tearsÄƒ cu succes!');
                    loadAssignments();
                } catch (error) {
                    console.error('âŒ Eroare la È™tergerea asignÄƒrii:', error);
                    alert('Eroare la È™tergere: ' + error.message);
                }
            }
        }

        // ====================================================================
        // ğŸ¯ Export Functions
        // ====================================================================
        const generateCustomReport = async (format) => {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const status = document.getElementById('reportStatus').value;
            
            const filters = {};
            if (startDate) filters.startDate = new Date(startDate);
            if (endDate) filters.endDate = new Date(endDate);
            if (status) filters.status = status;
            
            const result = await generateReport(filters, format, 'complete');
            
            if (result.success) {
                alert(`âœ… Raport ${format.toUpperCase()} generat: ${result.filename}`);
            } else {
                alert(`âŒ Eroare: ${result.error}`);
            }
        };

        // ====================================================================
        // ğŸ¯ Auth State Observer
        // ====================================================================
        firebase.auth().onAuthStateChanged(async (user) => {
            if (user) {
                console.log('ğŸ‘¤ User authenticated:', user.email);
                currentUser = user;
                
                try {
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        userRole = userData.role;
                        workerId = userData.workerId;
                        
                        console.log('ğŸ­ User role:', userRole);
                        
                        document.getElementById('authContainer').style.display = 'none';
                        document.getElementById('mainApp').style.display = 'block';
                        document.getElementById('userInfo').style.display = 'flex';
                        document.getElementById('userEmail').textContent = user.email;
                        document.getElementById('userRole').textContent = userRole === 'admin' ? 'ğŸ‘‘ Administrator' : 'ğŸ‘¨â€ğŸ”§ LucrÄƒtor';
                        
                        createNavigationTabs(userRole);
                        loadDashboard();
                        
                        // Verificare automatÄƒ expirÄƒri pentru admin
                        if (userRole === 'admin') {
                            autoCheckExpirations();
                        }
                        
                    } else {
                        console.error('âŒ User document not found in Firestore');
                        alert('Eroare: Datele utilizatorului nu au fost gÄƒsite');
                        firebase.auth().signOut();
                    }
                    
                } catch (error) {
                    console.error('âŒ Error loading user data:', error);
                    alert('Eroare la Ã®ncÄƒrcarea datelor utilizatorului');
                }
                
            } else {
                console.log('ğŸ‘¤ User not authenticated');
                currentUser = null;
                userRole = null;
                workerId = null;
                
                document.getElementById('authContainer').style.display = 'block';
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('userInfo').style.display = 'none';
            }
        });

        // ====================================================================
        // ğŸ¯ Initialize App
        // ====================================================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”¥ Firebase PWA Ready - Service Worker not needed!');
            
            window.onclick = function(event) {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            };
        });
    </script>
</body>
</html>
