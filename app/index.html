<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdInstalGaz SRL - Sistem Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .logout-btn:hover {
            background: #c0392b;
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #ecf0f1;
            border: none;
            cursor: pointer;
            font-size: 14px;
            color: #555;
            border-right: 1px solid #ddd;
        }

        .tab:last-child {
            border-right: none;
        }

        .tab.active {
            background: #3498db;
            color: white;
        }

        .tab:hover:not(.active) {
            background: #d5dbdb;
        }

        .content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-height: 500px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-row.full {
            grid-template-columns: 1fr;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: white;
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            background: #2980b9;
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-warning {
            background: #f39c12;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-size: 14px;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .search-box {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            border-left: 4px solid;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .hidden {
            display: none;
        }

        .file-upload {
            border: 2px dashed #ddd;
            padding: 20px;
            text-align: center;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .file-upload:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            float: right;
            font-size: 24px;
            cursor: pointer;
            color: #aaa;
        }

        .close:hover {
            color: #000;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                border-right: none;
                border-bottom: 1px solid #ddd;
            }
            
            .tab:last-child {
                border-bottom: none;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen">
        <div class="login-container">
            <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">AdInstalGaz SRL</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>Parola:</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn" style="width: 100%;">Autentificare</button>
            </form>
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 4px;">
                <strong>Conturi demo:</strong><br>
                Admin: admin@adinstalgaz.ro / 123456<br>
                Lucrător: lucrator@adinstalgaz.ro / 123456
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <div class="container">
            <div class="header">
                <div class="logo">AdInstalGaz SRL</div>
                <div class="user-info">
                    <span id="userDisplay"></span>
                    <button class="logout-btn" onclick="logout()">Deconectare</button>
                </div>
            </div>

            <!-- Dashboard pentru afișarea alertelor -->
            <div id="dashboard">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalClients">0</div>
                        <div class="stat-label">Total Clienți</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeServices">0</div>
                        <div class="stat-label">Servicii Active</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="expiringServices">0</div>
                        <div class="stat-label">Expiră în 7 zile</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="urgentServices">0</div>
                        <div class="stat-label">Expiră în 2 zile</div>
                    </div>
                </div>

                <div id="alertsContainer"></div>
            </div>

            <!-- Navigation Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="showTab('clients')">Clienți</button>
                <button class="tab" onclick="showTab('services')">Servicii</button>
                <button class="tab" onclick="showTab('programming')">Programări</button>
                <button class="tab" onclick="showTab('work')">Lucrări</button>
                <button class="tab" onclick="showTab('reports')">Rapoarte</button>
                <button class="tab" onclick="showTab('documents')" id="documentsTab">Documente</button>
                <button class="tab" onclick="showTab('notifications')" id="notificationsTab">Notificări</button>
            </div>

            <!-- Content Area -->
            <div class="content">
                <!-- Clienți Tab -->
                <div id="clientsTab" class="tab-content">
                    <h3>Gestionare Clienți</h3>
                    
                    <div class="form-row">
                        <div>
                            <button class="btn btn-success" onclick="showAddClientModal()">Adaugă Client Nou</button>
                        </div>
                        <div>
                            <input type="text" class="search-box" placeholder="Caută clienți..." onkeyup="searchClients(this.value)">
                        </div>
                    </div>

                    <table class="table" id="clientsTable">
                        <thead>
                            <tr>
                                <th>Nume</th>
                                <th>Telefon</th>
                                <th>Email</th>
                                <th>Adresă</th>
                                <th>Status</th>
                                <th>Acțiuni</th>
                            </tr>
                        </thead>
                        <tbody id="clientsTableBody"></tbody>
                    </table>
                </div>

                <!-- Servicii Tab -->
                <div id="servicesTab" class="tab-content hidden">
                    <h3>Gestionare Servicii</h3>
                    
                    <div class="form-row">
                        <div>
                            <select id="serviceClientFilter" onchange="filterServices()">
                                <option value="">Toți clienții</option>
                            </select>
                        </div>
                        <div>
                            <select id="serviceStatusFilter" onchange="filterServices()">
                                <option value="">Toate statusurile</option>
                                <option value="activ">Activ</option>
                                <option value="expirat">Expirat</option>
                                <option value="expira_curand">Expiră curând</option>
                            </select>
                        </div>
                    </div>

                    <table class="table" id="servicesTable">
                        <thead>
                            <tr>
                                <th>Client</th>
                                <th>Tip Serviciu</th>
                                <th>Data Start</th>
                                <th>Data Expirare</th>
                                <th>Status</th>
                                <th>Acțiuni</th>
                            </tr>
                        </thead>
                        <tbody id="servicesTableBody"></tbody>
                    </table>
                </div>

                <!-- Programări Tab -->
                <div id="programmingTab" class="tab-content hidden">
                    <h3>Programări Servicii</h3>
                    
                    <div class="alert alert-warning">
                        <strong>Atenție!</strong> Clienții vor primi notificări automate cu 7 zile și 2 zile înaintea expirării serviciilor.
                    </div>

                    <div class="form-row">
                        <div>
                            <select id="programmingFilter" onchange="filterProgramming()">
                                <option value="expiring">Servicii care expiră</option>
                                <option value="all">Toate serviciile</option>
                                <option value="urgent">Urgent (2 zile)</option>
                                <option value="warning">Atenție (7 zile)</option>
                            </select>
                        </div>
                        <div>
                            <button class="btn btn-success" onclick="sendNotifications()">Trimite Notificări</button>
                        </div>
                    </div>

                    <table class="table" id="programmingTable">
                        <thead>
                            <tr>
                                <th>Client</th>
                                <th>Serviciu</th>
                                <th>Expiră în</th>
                                <th>Telefon</th>
                                <th>Status</th>
                                <th>Acțiuni</th>
                            </tr>
                        </thead>
                        <tbody id="programmingTableBody"></tbody>
                    </table>
                </div>

                <!-- Lucrări Tab -->
                <div id="workTab" class="tab-content hidden">
                    <h3>Gestionare Lucrări</h3>
                    
                    <div class="form-row">
                        <div>
                            <button class="btn btn-success" onclick="showAddWorkModal()">Creează Lucrare Nouă</button>
                        </div>
                        <div>
                            <select id="workStatusFilter" onchange="filterWork()">
                                <option value="">Toate lucrările</option>
                                <option value="programata">Programată</option>
                                <option value="in_progress">În progres</option>
                                <option value="finalizata">Finalizată</option>
                            </select>
                        </div>
                    </div>

                    <table class="table" id="workTable">
                        <thead>
                            <tr>
                                <th>Client</th>
                                <th>Tip Lucrare</th>
                                <th>Lucrător Atribuit</th>
                                <th>Data Programată</th>
                                <th>Status</th>
                                <th>Acțiuni</th>
                            </tr>
                        </thead>
                        <tbody id="workTableBody"></tbody>
                    </table>
                </div>

                <!-- Rapoarte Tab -->
                <div id="reportsTab" class="tab-content hidden">
                    <h3>Rapoarte Detaliate</h3>
                    
                    <div class="form-row">
                        <div>
                            <label>Tip Raport:</label>
                            <select id="reportType">
                                <option value="clients">Baza de Date Clienți</option>
                                <option value="services">Servicii Implementate</option>
                                <option value="work">Lucrări Efectuate</option>
                                <option value="expiring">Servicii care Expiră</option>
                            </select>
                        </div>
                        <div>
                            <label>Perioada:</label>
                            <select id="reportPeriod">
                                <option value="today">Astăzi</option>
                                <option value="week">Săptămâna aceasta</option>
                                <option value="month">Luna aceasta</option>
                                <option value="year">Anul acesta</option>
                                <option value="custom">Personalizat</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row" id="customDateRange" style="display: none;">
                        <div>
                            <label>Data Start:</label>
                            <input type="date" id="reportStartDate">
                        </div>
                        <div>
                            <label>Data Sfârșit:</label>
                            <input type="date" id="reportEndDate">
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <button class="btn" onclick="generateReport()">Generează Raport</button>
                            <button class="btn btn-success" onclick="exportReport()">Export PDF</button>
                        </div>
                    </div>

                    <div id="reportResults"></div>
                </div>

                <!-- Documente Tab -->
                <div id="documentsTab" class="tab-content hidden">
                    <h3>Gestionare Documente</h3>
                    
                    <div class="file-upload" onclick="document.getElementById('fileInput').click()">
                        <p>Click pentru a încărca documente</p>
                        <p style="font-size: 12px; color: #666;">PDF, DOC, DOCX, JPG, PNG (max 10MB)</p>
                        <input type="file" id="fileInput" style="display: none;" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" onchange="uploadFiles(this.files)">
                    </div>

                    <div class="form-row">
                        <div>
                            <select id="documentClientFilter" onchange="filterDocuments()">
                                <option value="">Toate documentele</option>
                            </select>
                        </div>
                        <div>
                            <select id="documentTypeFilter" onchange="filterDocuments()">
                                <option value="">Toate tipurile</option>
                                <option value="certificat">Certificat</option>
                                <option value="factura">Factură</option>
                                <option value="raport">Raport</option>
                                <option value="foto">Fotografii</option>
                                <option value="altele">Altele</option>
                            </select>
                        </div>
                    </div>

                    <table class="table" id="documentsTable">
                        <thead>
                            <tr>
                                <th>Nume Fișier</th>
                                <th>Client</th>
                                <th>Tip</th>
                                <th>Data Încărcare</th>
                                <th>Încărcat de</th>
                                <th>Acțiuni</th>
                            </tr>
                        </thead>
                        <tbody id="documentsTableBody"></tbody>
                    </table>
                </div>

                <!-- Notificări Tab -->
                <div id="notificationsTab" class="tab-content hidden">
                    <h3>Sistem Notificări SMS + Email</h3>
                    
                    <!-- Configurări -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4>🔧 Configurări Simple - Fără API Complex</h4>
                        <div class="alert alert-info" style="margin: 15px 0;">
                            <strong>ℹ️ Metodă Simplă:</strong> Aplicația va deschide SMS-ul și email-ul cu mesajele pre-completate. Tu doar confirmi trimiterea - fără configurări complicate!
                        </div>
                        <div class="form-row">
                            <div>
                                <label>📱 Numărul Firmei:</label>
                                <input type="tel" id="senderPhone" value="0762614401" onchange="updateNotificationConfig()" placeholder="Numărul tău de contact">
                            </div>
                            <div>
                                <label>📧 Email-ul Firmei:</label>
                                <input type="email" id="senderEmail" value="contact@adinstalgaz.ro" onchange="updateNotificationConfig()" placeholder="Email-ul tău de contact">
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label>🏢 Numele Firmei:</label>
                                <input type="text" id="companyName" value="AdInstalGaz SRL" onchange="updateNotificationConfig()" placeholder="Numele companiei">
                            </div>
                            <div>
                                <label>📲 Metodă:</label>
                                <span class="badge badge-success">Nativă - Fără API</span>
                            </div>
                        </div>
                    </div>

                    <!-- Acțiuni rapide -->
                    <div class="form-row">
                        <div>
                            <button class="btn btn-success" onclick="sendAllNotifications()">📱 Trimite Toate Notificările</button>
                            <button class="btn btn-warning" onclick="sendUrgentNotifications()">🚨 Doar Urgente (2 zile)</button>
                        </div>
                        <div>
                            <button class="btn" onclick="testNotification()">🧪 Test Notificare</button>
                            <button class="btn" onclick="viewNotificationTemplates()">📄 Vezi Template-uri</button>
                        </div>
                    </div>

                    <!-- Progres notificări -->
                    <div id="notificationProgress" class="hidden" style="background: #e8f4fd; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h5>Progres Trimitere Notificări:</h5>
                        <div style="background: #ddd; border-radius: 10px; overflow: hidden; margin: 10px 0;">
                            <div id="progressBar" style="background: #3498db; height: 20px; width: 0%; transition: width 0.3s;"></div>
                        </div>
                        <div id="progressText">0 / 0 notificări trimise</div>
                    </div>

                    <!-- Clienți cu servicii care expiră -->
                    <h4>Clienți care necesită notificare:</h4>
                    <table class="table" id="notificationClientsTable">
                        <thead>
                            <tr>
                                <th>Client</th>
                                <th>Telefon</th>
                                <th>Serviciu</th>
                                <th>Expiră în</th>
                                <th>Ultimă Notificare</th>
                                <th>Acțiuni</th>
                            </tr>
                        </thead>
                        <tbody id="notificationClientsTableBody"></tbody>
                    </table>

                    <!-- Istoric notificări -->
                    <h4>Istoric Notificări Trimise:</h4>
                    <div class="form-row">
                        <div>
                            <select id="notificationHistoryFilter" onchange="filterNotificationHistory()">
                                <option value="">Toate notificările</option>
                                <option value="sms">Doar SMS</option>
                                <option value="email">Doar Email</option>
                                <option value="success">Reușite</option>
                                <option value="failed">Eșuate</option>
                            </select>
                        </div>
                        <div>
                            <input type="text" class="search-box" placeholder="Caută în istoric..." onkeyup="searchNotificationHistory(this.value)">
                        </div>
                    </div>

                    <table class="table" id="notificationHistoryTable">
                        <thead>
                            <tr>
                                <th>Data/Ora</th>
                                <th>Client</th>
                                <th>Tip</th>
                                <th>Canal</th>
                                <th>Status</th>
                                <th>Mesaj</th>
                                <th>Cost</th>
                            </tr>
                        </thead>
                        <tbody id="notificationHistoryTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal pentru adăugare client -->
    <div id="clientModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('clientModal')">&times;</span>
            <h3 id="clientModalTitle">Adaugă Client Nou</h3>
            <form id="clientForm">
                <input type="hidden" id="clientId">
                
                <div class="form-row">
                    <div>
                        <label>Nume Complet:*</label>
                        <input type="text" id="clientName" required>
                    </div>
                    <div>
                        <label>Telefon:*</label>
                        <input type="tel" id="clientPhone" required>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label>Email:</label>
                        <input type="email" id="clientEmail">
                    </div>
                    <div>
                        <label>Tip Client:</label>
                        <select id="clientType">
                            <option value="rezidential">Rezidențial</option>
                            <option value="comercial">Comercial</option>
                            <option value="industrial">Industrial</option>
                        </select>
                    </div>
                </div>

                <div class="form-row full">
                    <div>
                        <label>Adresă Completă:*</label>
                        <input type="text" id="clientAddress" required>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label>Județul:</label>
                        <select id="clientCounty">
                            <option value="teleorman">Teleorman</option>
                            <option value="giurgiu">Giurgiu</option>
                            <option value="alexandria">Alexandria</option>
                            <option value="bucuresti">București</option>
                            <option value="ilfov">Ilfov</option>
                        </select>
                    </div>
                    <div>
                        <label>Status Informații:</label>
                        <select id="clientStatus">
                            <option value="complet">Informații Complete</option>
                            <option value="incomplet">Informații Incomplete</option>
                            <option value="de_contactat">De Contactat</option>
                        </select>
                    </div>
                </div>

                <div class="form-row full">
                    <div>
                        <label>Observații:</label>
                        <textarea id="clientNotes" rows="3" placeholder="Observații suplimentare..."></textarea>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <button type="submit" class="btn btn-success">Salvează</button>
                    <button type="button" class="btn" onclick="closeModal('clientModal')">Anulează</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal pentru servicii -->
    <div id="serviceModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('serviceModal')">&times;</span>
            <h3>Adaugă Serviciu Nou</h3>
            <form id="serviceForm">
                <div class="form-row">
                    <div>
                        <label>Client:*</label>
                        <select id="serviceClient" required></select>
                    </div>
                    <div>
                        <label>Tip Serviciu:*</label>
                        <select id="serviceType" required>
                            <option value="">Selectează...</option>
                            <option value="instalare_gaz">Instalare Gaz</option>
                            <option value="verificare_anuala">Verificare Anuală</option>
                            <option value="reparatie">Reparație</option>
                            <option value="intretinere">Întreținere</option>
                            <option value="inlocuire_echipament">Înlocuire Echipament</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label>Data Start:*</label>
                        <input type="date" id="serviceStartDate" required onchange="calculateEndDate()">
                    </div>
                    <div>
                        <label>Data Expirare (Auto-calculată):</label>
                        <input type="date" id="serviceEndDate" readonly style="background: #f8f9fa;">
                    </div>
                </div>

                <div class="form-row full">
                    <div>
                        <label>Detalii Serviciu:</label>
                        <textarea id="serviceDetails" rows="3" placeholder="Detalii despre serviciul efectuat..."></textarea>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <button type="submit" class="btn btn-success">Salvează Serviciu</button>
                    <button type="button" class="btn" onclick="closeModal('serviceModal')">Anulează</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal pentru lucrări -->
    <div id="workModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('workModal')">&times;</span>
            <h3>Creează Lucrare Nouă</h3>
            <form id="workForm">
                <div class="form-row">
                    <div>
                        <label>Client:*</label>
                        <select id="workClient" required></select>
                    </div>
                    <div>
                        <label>Tip Lucrare:*</label>
                        <select id="workType" required>
                            <option value="">Selectează...</option>
                            <option value="instalare">Instalare Nouă</option>
                            <option value="verificare">Verificare Anuală</option>
                            <option value="reparatie">Reparație</option>
                            <option value="intretinere">Întreținere</option>
                            <option value="urgenta">Intervenție Urgentă</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label>Lucrător Atribuit:*</label>
                        <select id="workAssignee" required>
                            <option value="">Selectează lucrător...</option>
                            <option value="lucrator@adinstalgaz.ro">Ion Popescu</option>
                            <option value="lucrator2@adinstalgaz.ro">Vasile Ionescu</option>
                            <option value="lucrator3@adinstalgaz.ro">George Marinescu</option>
                        </select>
                    </div>
                    <div>
                        <label>Data Programată:*</label>
                        <input type="date" id="workScheduledDate" required>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label>Prioritate:</label>
                        <select id="workPriority">
                            <option value="normala">Normală</option>
                            <option value="ridicata">Ridicată</option>
                            <option value="urgenta">Urgentă</option>
                        </select>
                    </div>
                    <div>
                        <label>Durata Estimată (ore):</label>
                        <select id="workDuration">
                            <option value="1">1 oră</option>
                            <option value="2">2 ore</option>
                            <option value="3">3 ore</option>
                            <option value="4">4 ore</option>
                            <option value="8">O zi întreagă</option>
                        </select>
                    </div>
                </div>

                <div class="form-row full">
                    <div>
                        <label>Descriere Lucrare:</label>
                        <textarea id="workDescription" rows="3" placeholder="Descriere detaliată a lucrării..."></textarea>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <button type="submit" class="btn btn-success">Creează Lucrare</button>
                    <button type="button" class="btn" onclick="closeModal('workModal')">Anulează</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Date globale
        let currentUser = null;
        let clients = JSON.parse(localStorage.getItem('adinstalgaz_clients') || '[]');
        let services = JSON.parse(localStorage.getItem('adinstalgaz_services') || '[]');
        let work = JSON.parse(localStorage.getItem('adinstalgaz_work') || '[]');
        let documents = JSON.parse(localStorage.getItem('adinstalgaz_documents') || '[]');
        let notifications = JSON.parse(localStorage.getItem('adinstalgaz_notifications') || '[]');

        // Configurări notificări - SIMPLU ȘI DIRECT
        const notificationConfig = {
            // MODIFICĂ DOAR AICI 👇
            senderPhone: '0762614401', // Numărul real AdInstalGaz SRL
            senderEmail: 'contact@adinstalgaz.ro', // Email-ul tău real
            companyName: 'AdInstalGaz SRL', // Numele firmei
            
            // Auto-detectare furnizori disponibili
            smsProvider: 'auto',
            emailProvider: 'auto'
        };

        // Utilizatori demo
        const users = {
            'admin@adinstalgaz.ro': {
                password: '123456',
                role: 'admin',
                name: 'Administrator'
            },
            'lucrator@adinstalgaz.ro': {
                password: '123456',
                role: 'worker',
                name: 'Ion Popescu'
            }
        };

        // Inițializare aplicație
        document.addEventListener('DOMContentLoaded', function() {
            // Verifică dacă utilizatorul este deja autentificat
            const savedUser = localStorage.getItem('adinstalgaz_currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainApp();
            }

            // Încarcă configurația notificărilor
            loadNotificationConfig();

            // Event listeners
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('clientForm').addEventListener('submit', handleClientSubmit);
            document.getElementById('serviceForm').addEventListener('submit', handleServiceSubmit);
            document.getElementById('workForm').addEventListener('submit', handleWorkSubmit);
            document.getElementById('reportPeriod').addEventListener('change', handleReportPeriodChange);

            // Inițializează date demo dacă e nevoie
            initializeDemoData();
        });

        function initializeDemoData() {
            if (clients.length === 0) {
                clients = [
                    {
                        id: 1,
                        name: 'Maria Popescu',
                        phone: '0723456789',
                        email: 'maria.popescu@email.com',
                        address: 'Str. Libertății nr. 15',
                        county: 'teleorman',
                        type: 'rezidential',
                        status: 'complet',
                        notes: 'Client fidel',
                        dateAdded: '2023-01-15'
                    },
                    {
                        id: 2,
                        name: 'SC Comert SRL',
                        phone: '0734567890',
                        email: 'contact@comert.ro',
                        address: 'Bd. Republicii nr. 45',
                        county: 'teleorman',
                        type: 'comercial',
                        status: 'complet',
                        notes: 'Contract anual',
                        dateAdded: '2023-02-20'
                    }
                ];
                
                services = [
                    {
                        id: 1,
                        clientId: 1,
                        type: 'verificare_anuala',
                        startDate: '2024-07-01',
                        endDate: '2026-07-01',
                        details: 'Verificare anuală instalație gaz',
                        status: 'activ'
                    }
                ];

                saveData();
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (users[email] && users[email].password === password) {
                currentUser = {
                    email: email,
                    role: users[email].role,
                    name: users[email].name
                };
                
                localStorage.setItem('adinstalgaz_currentUser', JSON.stringify(currentUser));
                showMainApp();
            } else {
                alert('Email sau parolă greșite!');
            }
        }

        function logout() {
            localStorage.removeItem('adinstalgaz_currentUser');
            currentUser = null;
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        }

        function showMainApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('userDisplay').textContent = `${currentUser.name} (${currentUser.role === 'admin' ? 'Administrator' : 'Lucrător'})`;
            
            // Configurează interfața în funcție de rol
            setupUserInterface();
            updateDashboard();
            loadClients();
            loadServices();
            showTab('clients');
        }

        function setupUserInterface() {
            // Configurează tab-urile în funcție de rolul utilizatorului
            const tabs = document.querySelectorAll('.tab');
            
            if (currentUser.role === 'worker') {
                // Pentru lucrători, ascunde anumite tab-uri
                tabs.forEach(tab => {
                    const tabName = tab.getAttribute('onclick').match(/'([^']+)'/)[1];
                    if (['reports'].includes(tabName)) {
                        tab.style.display = 'none';
                    }
                });
            }
        }

        function showTab(tabName) {
            // Ascunde toate tab-urile
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });

            // Elimină clasa active de pe toate butoanele
            document.querySelectorAll('.tab').forEach(btn => {
                btn.classList.remove('active');
            });

            // Afișează tab-ul selectat
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            
            // Activează butonul corespunzător
            event.target.classList.add('active');

            // Încarcă datele pentru tab-ul curent
            switch(tabName) {
                case 'clients':
                    loadClients();
                    break;
                case 'services':
                    loadServices();
                    break;
                case 'programming':
                    loadProgramming();
                    break;
                case 'work':
                    loadWork();
                    break;
                case 'reports':
                    setupReports();
                    break;
                case 'documents':
                    loadDocuments();
                    break;
                case 'notifications':
                    loadNotifications();
                    loadNotificationConfig(); // Încarcă configurația când se deschide tab-ul
                    break;
            }
        }

        function updateDashboard() {
            // Calculează statistici
            const totalClientsCount = clients.length;
            const activeServicesCount = services.filter(s => s.status === 'activ').length;
            
            // Calculează servicii care expiră
            const today = new Date();
            const inSevenDays = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
            const inTwoDays = new Date(today.getTime() + 2 * 24 * 60 * 60 * 1000);
            
            const expiringServices = services.filter(service => {
                const endDate = new Date(service.endDate);
                return endDate >= today && endDate <= inSevenDays;
            });
            
            const urgentServices = services.filter(service => {
                const endDate = new Date(service.endDate);
                return endDate >= today && endDate <= inTwoDays;
            });

            // Actualizează statisticile
            document.getElementById('totalClients').textContent = totalClientsCount;
            document.getElementById('activeServices').textContent = activeServicesCount;
            document.getElementById('expiringServices').textContent = expiringServices.length;
            document.getElementById('urgentServices').textContent = urgentServices.length;

            // Generează alerte
            generateAlerts(urgentServices, expiringServices);
        }

        function generateAlerts(urgentServices, expiringServices) {
            const alertsContainer = document.getElementById('alertsContainer');
            alertsContainer.innerHTML = '';

            // Alerte urgente (2 zile)
            if (urgentServices.length > 0) {
                const urgentAlert = document.createElement('div');
                urgentAlert.className = 'alert alert-danger';
                urgentAlert.innerHTML = `
                    <strong>URGENT!</strong> ${urgentServices.length} serviciu(ri) expiră în următoarele 2 zile:
                    <ul style="margin-top: 10px;">
                        ${urgentServices.map(service => {
                            const client = clients.find(c => c.id === service.clientId);
                            return `<li>${client ? client.name : 'Client necunoscut'} - ${service.type} (expiră: ${formatDate(service.endDate)})</li>`;
                        }).join('')}
                    </ul>
                `;
                alertsContainer.appendChild(urgentAlert);
            }

            // Alerte atenție (7 zile)
            if (expiringServices.length > urgentServices.length) {
                const warningAlert = document.createElement('div');
                warningAlert.className = 'alert alert-warning';
                warningAlert.innerHTML = `
                    <strong>Atenție!</strong> ${expiringServices.length} serviciu(ri) expiră în următoarele 7 zile.
                    <button class="btn btn-warning" onclick="showTab('programming')" style="margin-left: 10px;">Vezi Programări</button>
                `;
                alertsContainer.appendChild(warningAlert);
            }
        }

        function loadClients() {
            const tbody = document.getElementById('clientsTableBody');
            tbody.innerHTML = '';

            clients.forEach(client => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${client.name}</td>
                    <td>${client.phone}</td>
                    <td>${client.email || '-'}</td>
                    <td>${client.address}</td>
                    <td>
                        <span class="badge ${getStatusClass(client.status)}">${getStatusText(client.status)}</span>
                    </td>
                    <td>
                        <button class="btn btn-sm" onclick="editClient(${client.id})">Editează</button>
                        <button class="btn btn-sm btn-success" onclick="addServiceToClient(${client.id})">Adaugă Serviciu</button>
                        ${currentUser.role === 'admin' ? `<button class="btn btn-sm btn-danger" onclick="deleteClient(${client.id})">Șterge</button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });

            updateClientSelects();
        }

        function updateClientSelects() {
            // Actualizează toate dropdown-urile cu clienți
            const selects = ['serviceClient', 'workClient', 'serviceClientFilter', 'documentClientFilter'];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    const currentValue = select.value;
                    select.innerHTML = selectId.includes('Filter') ? '<option value="">Toți clienții</option>' : '<option value="">Selectează client...</option>';
                    
                    clients.forEach(client => {
                        const option = document.createElement('option');
                        option.value = client.id;
                        option.textContent = client.name;
                        select.appendChild(option);
                    });
                    
                    select.value = currentValue;
                }
            });
        }

        function showAddClientModal() {
            document.getElementById('clientModalTitle').textContent = 'Adaugă Client Nou';
            document.getElementById('clientForm').reset();
            document.getElementById('clientId').value = '';
            document.getElementById('clientModal').style.display = 'block';
        }

        function editClient(clientId) {
            const client = clients.find(c => c.id === clientId);
            if (!client) return;

            document.getElementById('clientModalTitle').textContent = 'Editează Client';
            document.getElementById('clientId').value = client.id;
            document.getElementById('clientName').value = client.name;
            document.getElementById('clientPhone').value = client.phone;
            document.getElementById('clientEmail').value = client.email || '';
            document.getElementById('clientAddress').value = client.address;
            document.getElementById('clientCounty').value = client.county;
            document.getElementById('clientType').value = client.type;
            document.getElementById('clientStatus').value = client.status;
            document.getElementById('clientNotes').value = client.notes || '';
            
            document.getElementById('clientModal').style.display = 'block';
        }

        function handleClientSubmit(e) {
            e.preventDefault();
            
            const clientData = {
                name: document.getElementById('clientName').value,
                phone: document.getElementById('clientPhone').value,
                email: document.getElementById('clientEmail').value,
                address: document.getElementById('clientAddress').value,
                county: document.getElementById('clientCounty').value,
                type: document.getElementById('clientType').value,
                status: document.getElementById('clientStatus').value,
                notes: document.getElementById('clientNotes').value
            };

            const clientId = document.getElementById('clientId').value;
            
            if (clientId) {
                // Editare client existent
                const clientIndex = clients.findIndex(c => c.id == clientId);
                if (clientIndex !== -1) {
                    clients[clientIndex] = { ...clients[clientIndex], ...clientData };
                }
            } else {
                // Client nou
                const newClient = {
                    id: Date.now(),
                    ...clientData,
                    dateAdded: new Date().toISOString().split('T')[0]
                };
                clients.push(newClient);
            }

            saveData();
            loadClients();
            closeModal('clientModal');
            updateDashboard();
        }

        function deleteClient(clientId) {
            if (confirm('Ești sigur că vrei să ștergi acest client? Toate serviciile asociate vor fi de asemenea șterse.')) {
                clients = clients.filter(c => c.id !== clientId);
                services = services.filter(s => s.clientId !== clientId);
                work = work.filter(w => w.clientId !== clientId);
                saveData();
                loadClients();
                loadServices();
                updateDashboard();
            }
        }

        function addServiceToClient(clientId) {
            document.getElementById('serviceClient').value = clientId;
            document.getElementById('serviceModal').style.display = 'block';
        }

        function loadServices() {
            const tbody = document.getElementById('servicesTableBody');
            tbody.innerHTML = '';

            const filteredServices = getFilteredServices();

            filteredServices.forEach(service => {
                const client = clients.find(c => c.id === service.clientId);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${client ? client.name : 'Client necunoscut'}</td>
                    <td>${getServiceTypeText(service.type)}</td>
                    <td>${formatDate(service.startDate)}</td>
                    <td>${formatDate(service.endDate)}</td>
                    <td>
                        <span class="badge ${getServiceStatusClass(service)}">${getServiceStatusText(service)}</span>
                    </td>
                    <td>
                        <button class="btn btn-sm" onclick="editService(${service.id})">Detalii</button>
                        ${currentUser.role === 'admin' ? `<button class="btn btn-sm btn-danger" onclick="deleteService(${service.id})">Șterge</button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function getFilteredServices() {
            let filtered = [...services];
            
            const clientFilter = document.getElementById('serviceClientFilter').value;
            const statusFilter = document.getElementById('serviceStatusFilter').value;
            
            if (clientFilter) {
                filtered = filtered.filter(s => s.clientId == clientFilter);
            }
            
            if (statusFilter) {
                filtered = filtered.filter(s => {
                    const serviceStatus = getServiceStatus(s);
                    return serviceStatus === statusFilter;
                });
            }
            
            return filtered;
        }

        function getServiceStatus(service) {
            const today = new Date();
            const endDate = new Date(service.endDate);
            const daysUntilExpiry = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
            
            if (daysUntilExpiry < 0) return 'expirat';
            if (daysUntilExpiry <= 7) return 'expira_curand';
            return 'activ';
        }

        function getServiceStatusText(service) {
            const status = getServiceStatus(service);
            switch(status) {
                case 'activ': return 'Activ';
                case 'expira_curand': return 'Expiră curând';
                case 'expirat': return 'Expirat';
                default: return 'Necunoscut';
            }
        }

        function getServiceStatusClass(service) {
            const status = getServiceStatus(service);
            switch(status) {
                case 'activ': return 'badge-success';
                case 'expira_curand': return 'badge-warning';
                case 'expirat': return 'badge-danger';
                default: return 'badge-secondary';
            }
        }

        function calculateEndDate() {
            const startDate = document.getElementById('serviceStartDate').value;
            if (startDate) {
                const start = new Date(startDate);
                const end = new Date(start.getTime() + (2 * 365 * 24 * 60 * 60 * 1000)); // +2 ani
                document.getElementById('serviceEndDate').value = end.toISOString().split('T')[0];
            }
        }

        function handleServiceSubmit(e) {
            e.preventDefault();
            
            const serviceData = {
                clientId: parseInt(document.getElementById('serviceClient').value),
                type: document.getElementById('serviceType').value,
                startDate: document.getElementById('serviceStartDate').value,
                endDate: document.getElementById('serviceEndDate').value,
                details: document.getElementById('serviceDetails').value,
                status: 'activ'
            };

            const newService = {
                id: Date.now(),
                ...serviceData
            };
            
            services.push(newService);
            saveData();
            loadServices();
            closeModal('serviceModal');
            updateDashboard();
        }

        function loadProgramming() {
            const tbody = document.getElementById('programmingTableBody');
            tbody.innerHTML = '';

            const filteredServices = getFilteredProgrammingServices();

            filteredServices.forEach(service => {
                const client = clients.find(c => c.id === service.clientId);
                if (!client) return;

                const today = new Date();
                const endDate = new Date(service.endDate);
                const daysUntilExpiry = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${client.name}</td>
                    <td>${getServiceTypeText(service.type)}</td>
                    <td>
                        <span class="${daysUntilExpiry <= 2 ? 'text-danger' : daysUntilExpiry <= 7 ? 'text-warning' : ''}" style="font-weight: bold;">
                            ${daysUntilExpiry} zile
                        </span>
                    </td>
                    <td>${client.phone}</td>
                    <td>
                        <span class="badge ${getServiceStatusClass(service)}">${getServiceStatusText(service)}</span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-success" onclick="scheduleRenewal(${service.id})">Programează</button>
                        <button class="btn btn-sm btn-warning" onclick="sendNotification(${client.id})">Notificare</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function getFilteredProgrammingServices() {
            const filter = document.getElementById('programmingFilter').value;
            const today = new Date();
            
            return services.filter(service => {
                const endDate = new Date(service.endDate);
                const daysUntilExpiry = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                
                switch(filter) {
                    case 'urgent':
                        return daysUntilExpiry >= 0 && daysUntilExpiry <= 2;
                    case 'warning':
                        return daysUntilExpiry >= 0 && daysUntilExpiry <= 7;
                    case 'expiring':
                        return daysUntilExpiry >= 0 && daysUntilExpiry <= 30;
                    case 'all':
                    default:
                        return true;
                }
            });
        }

        function scheduleRenewal(serviceId) {
            const service = services.find(s => s.id === serviceId);
            if (!service) return;
            
            // Pre-populează formularul de lucrare cu datele serviciului
            document.getElementById('workClient').value = service.clientId;
            document.getElementById('workType').value = 'verificare';
            
            // Calculează data programată (cu 5 zile înainte de expirare)
            const endDate = new Date(service.endDate);
            const scheduledDate = new Date(endDate.getTime() - 5 * 24 * 60 * 60 * 1000);
            document.getElementById('workScheduledDate').value = scheduledDate.toISOString().split('T')[0];
            
            document.getElementById('workModal').style.display = 'block';
        }

        function sendNotification(clientId) {
            const client = clients.find(c => c.id === clientId);
            if (!client) return;
            
            // Găsește serviciul care expiră pentru acest client
            const today = new Date();
            const clientServices = services.filter(s => s.clientId === clientId);
            const expiringService = clientServices.find(service => {
                const endDate = new Date(service.endDate);
                const daysUntil = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                return daysUntil >= 0 && daysUntil <= 30;
            });

            if (!expiringService) {
                alert('Nu există servicii care să expire pentru acest client.');
                return;
            }

            // Redirecționează către tab-ul de notificări
            showTab('notifications');
            
            // Evidențiază clientul în tabel
            setTimeout(() => {
                const rows = document.querySelectorAll('#notificationClientsTableBody tr');
                rows.forEach(row => {
                    if (row.textContent.includes(client.name)) {
                        row.style.backgroundColor = '#fff3cd';
                        setTimeout(() => {
                            row.style.backgroundColor = '';
                        }, 3000);
                    }
                });
            }, 500);
        }

        function sendNotifications() {
            // Redirecționează către sistemul avansat de notificări
            showTab('notifications');
            setTimeout(() => {
                if (confirm('Vrei să trimiți toate notificările automat?\n\nAceasta va trimite SMS și email către toți clienții cu servicii care expiră în următoarele 30 de zile.')) {
                    sendAllNotifications();
                }
            }, 500);
        }

        function showAddWorkModal() {
            document.getElementById('workForm').reset();
            document.getElementById('workModal').style.display = 'block';
        }

        function handleWorkSubmit(e) {
            e.preventDefault();
            
            const workData = {
                clientId: parseInt(document.getElementById('workClient').value),
                type: document.getElementById('workType').value,
                assignee: document.getElementById('workAssignee').value,
                scheduledDate: document.getElementById('workScheduledDate').value,
                priority: document.getElementById('workPriority').value,
                duration: document.getElementById('workDuration').value,
                description: document.getElementById('workDescription').value,
                status: 'programata',
                createdBy: currentUser.email,
                createdAt: new Date().toISOString()
            };

            const newWork = {
                id: Date.now(),
                ...workData
            };
            
            work.push(newWork);
            saveData();
            loadWork();
            closeModal('workModal');
        }

        function loadWork() {
            const tbody = document.getElementById('workTableBody');
            tbody.innerHTML = '';

            const filteredWork = getFilteredWork();

            filteredWork.forEach(workItem => {
                const client = clients.find(c => c.id === workItem.clientId);
                const assigneeName = getWorkerName(workItem.assignee);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${client ? client.name : 'Client necunoscut'}</td>
                    <td>${getWorkTypeText(workItem.type)}</td>
                    <td>${assigneeName}</td>
                    <td>${formatDate(workItem.scheduledDate)}</td>
                    <td>
                        <span class="badge ${getWorkStatusClass(workItem.status)}">${getWorkStatusText(workItem.status)}</span>
                    </td>
                    <td>
                        <button class="btn btn-sm" onclick="viewWork(${workItem.id})">Detalii</button>
                        ${(currentUser.role === 'admin' || workItem.assignee === currentUser.email) ? `
                            <button class="btn btn-sm btn-warning" onclick="updateWorkStatus(${workItem.id})">Status</button>
                        ` : ''}
                        ${currentUser.role === 'admin' ? `<button class="btn btn-sm btn-danger" onclick="deleteWork(${workItem.id})">Șterge</button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function getFilteredWork() {
            let filtered = [...work];
            
            const statusFilter = document.getElementById('workStatusFilter').value;
            
            if (statusFilter) {
                filtered = filtered.filter(w => w.status === statusFilter);
            }
            
            // Dacă este lucrător, afișează doar lucrările sale
            if (currentUser.role === 'worker') {
                filtered = filtered.filter(w => w.assignee === currentUser.email);
            }
            
            return filtered;
        }

        function uploadFiles(files) {
            for (let file of files) {
                if (file.size > 10 * 1024 * 1024) { // 10MB limit
                    alert(`Fișierul ${file.name} este prea mare. Limita este 10MB.`);
                    continue;
                }
                
                const document = {
                    id: Date.now() + Math.random(),
                    fileName: file.name,
                    fileSize: file.size,
                    fileType: getDocumentType(file.name),
                    clientId: null, // Va fi setat manual
                    uploadedBy: currentUser.email,
                    uploadedAt: new Date().toISOString(),
                    // În aplicația reală, aici ar fi URL-ul fișierului
                    fileUrl: URL.createObjectURL(file)
                };
                
                documents.push(document);
            }
            
            saveData();
            loadDocuments();
            alert(`${files.length} fișier(e) încărcat(e) cu succes!`);
        }

        function getDocumentType(fileName) {
            const extension = fileName.split('.').pop().toLowerCase();
            switch(extension) {
                case 'pdf': return 'certificat';
                case 'doc':
                case 'docx': return 'raport';
                case 'jpg':
                case 'jpeg':
                case 'png': return 'foto';
                default: return 'altele';
            }
        }

        function loadDocuments() {
            const tbody = document.getElementById('documentsTableBody');
            tbody.innerHTML = '';

            documents.forEach(doc => {
                const client = clients.find(c => c.id === doc.clientId);
                const uploaderName = getUploaderName(doc.uploadedBy);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${doc.fileName}</td>
                    <td>
                        <select onchange="assignDocumentToClient(${doc.id}, this.value)" ${currentUser.role !== 'admin' ? 'disabled' : ''}>
                            <option value="">Selectează client...</option>
                            ${clients.map(c => `<option value="${c.id}" ${c.id === doc.clientId ? 'selected' : ''}>${c.name}</option>`).join('')}
                        </select>
                    </td>
                    <td>
                        <select onchange="updateDocumentType(${doc.id}, this.value)" ${currentUser.role !== 'admin' ? 'disabled' : ''}>
                            <option value="certificat" ${doc.fileType === 'certificat' ? 'selected' : ''}>Certificat</option>
                            <option value="factura" ${doc.fileType === 'factura' ? 'selected' : ''}>Factură</option>
                            <option value="raport" ${doc.fileType === 'raport' ? 'selected' : ''}>Raport</option>
                            <option value="foto" ${doc.fileType === 'foto' ? 'selected' : ''}>Fotografii</option>
                            <option value="altele" ${doc.fileType === 'altele' ? 'selected' : ''}>Altele</option>
                        </select>
                    </td>
                    <td>${formatDateTime(doc.uploadedAt)}</td>
                    <td>${uploaderName}</td>
                    <td>
                        <button class="btn btn-sm" onclick="downloadDocument(${doc.id})">Download</button>
                        ${currentUser.role === 'admin' ? `<button class="btn btn-sm btn-danger" onclick="deleteDocument(${doc.id})">Șterge</button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function assignDocumentToClient(docId, clientId) {
            const docIndex = documents.findIndex(d => d.id === docId);
            if (docIndex !== -1) {
                documents[docIndex].clientId = clientId ? parseInt(clientId) : null;
                saveData();
            }
        }

        function updateDocumentType(docId, newType) {
            const docIndex = documents.findIndex(d => d.id === docId);
            if (docIndex !== -1) {
                documents[docIndex].fileType = newType;
                saveData();
            }
        }

        function downloadDocument(docId) {
            const doc = documents.find(d => d.id === docId);
            if (doc && doc.fileUrl) {
                const a = document.createElement('a');
                a.href = doc.fileUrl;
                a.download = doc.fileName;
                a.click();
            }
        }

        function deleteDocument(docId) {
            if (confirm('Ești sigur că vrei să ștergi acest document?')) {
                documents = documents.filter(d => d.id !== docId);
                saveData();
                loadDocuments();
            }
        }

        // ===== SISTEM NOTIFICĂRI =====

        async function sendSMS(phone, message, clientName) {
            try {
                // Metodă SIMPLĂ - deschide aplicația de SMS cu mesajul pre-completat
                const encodedMessage = encodeURIComponent(message);
                const smsUrl = `sms:${phone}?body=${encodedMessage}`;
                
                // Pe desktop: copiază mesajul în clipboard
                if (navigator.clipboard) {
                    await navigator.clipboard.writeText(message);
                }
                
                // Deschide aplicația SMS (pe mobil) sau afișează mesajul (pe desktop)
                if (/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                    // Pe mobil: deschide aplicația SMS
                    window.open(smsUrl, '_blank');
                } else {
                    // Pe desktop: afișează popup cu mesajul
                    const shouldSend = confirm(
                        `SMS către ${phone}:\n\n${message}\n\n` +
                        `Mesajul a fost copiat în clipboard.\n` +
                        `Trimite SMS manual sau folosește telefonul pentru a trimite automat.\n\n` +
                        `Click OK pentru a marca ca trimis.`
                    );
                    
                    if (!shouldSend) {
                        throw new Error('Utilizatorul a anulat');
                    }
                }
                
                const notification = {
                    id: Date.now() + Math.random(),
                    clientName: clientName,
                    phone: phone,
                    type: 'reminder',
                    channel: 'sms',
                    message: message,
                    status: 'success',
                    sentAt: new Date().toISOString(),
                    cost: 0.10,
                    method: 'manual'
                };

                notifications.push(notification);
                return { success: true, notification };

            } catch (error) {
                const notification = {
                    id: Date.now() + Math.random(),
                    clientName: clientName,
                    phone: phone,
                    type: 'reminder',
                    channel: 'sms',
                    message: message,
                    status: 'failed',
                    sentAt: new Date().toISOString(),
                    error: error.message,
                    cost: 0
                };

                notifications.push(notification);
                return { success: false, error: error.message, notification };
            }
        }

        async function sendEmail(email, subject, message, clientName) {
            try {
                // Metodă SIMPLĂ - deschide aplicația de email cu conținutul pre-completat
                const encodedSubject = encodeURIComponent(subject);
                const encodedMessage = encodeURIComponent(message);
                const mailtoUrl = `mailto:${email}?subject=${encodedSubject}&body=${encodedMessage}`;
                
                // Copiază email-ul în clipboard ca backup
                if (navigator.clipboard) {
                    const emailText = `Către: ${email}\nSubiect: ${subject}\n\nMesaj:\n${message}`;
                    await navigator.clipboard.writeText(emailText);
                }
                
                // Deschide aplicația email
                window.open(mailtoUrl, '_blank');
                
                // Confirmă trimiterea
                const shouldSend = confirm(
                    `Email către ${email} a fost deschis în aplicația ta de email.\n\n` +
                    `Subiect: ${subject}\n\n` +
                    `Conținutul a fost copiat în clipboard ca backup.\n\n` +
                    `Click OK după ce trimiți email-ul pentru a-l marca ca trimis.`
                );
                
                if (!shouldSend) {
                    throw new Error('Utilizatorul a anulat');
                }

                const notification = {
                    id: Date.now() + Math.random(),
                    clientName: clientName,
                    email: email,
                    type: 'reminder',
                    channel: 'email',
                    message: `${subject} - ${message}`,
                    status: 'success',
                    sentAt: new Date().toISOString(),
                    cost: 0,
                    method: 'manual'
                };

                notifications.push(notification);
                return { success: true, notification };

            } catch (error) {
                const notification = {
                    id: Date.now() + Math.random(),
                    clientName: clientName,
                    email: email,
                    type: 'reminder',
                    channel: 'email',
                    message: `${subject} - ${message}`,
                    status: 'failed',
                    sentAt: new Date().toISOString(),
                    error: error.message,
                    cost: 0
                };

                notifications.push(notification);
                return { success: false, error: error.message, notification };
            }
        }

        function generateSMSMessage(client, service, daysUntil) {
            const urgent = daysUntil <= 2;
            const companyName = notificationConfig.companyName;
            const phone = notificationConfig.senderPhone;

            if (urgent) {
                return `🚨 URGENT ${companyName}
Domnule/Doamna ${client.name}, 
serviciul de gaz expiră în ${daysUntil} ZILE (${formatDate(service.endDate)}). 
Programați urgent: ${phone}`;
            } else {
                return `⚠️ ${companyName} - Reminder
Bună ziua, serviciul de verificare gaz 
expiră în ${daysUntil} zile (${formatDate(service.endDate)}). 
Pentru programare: ${phone}`;
            }
        }

        function generateEmailMessage(client, service, daysUntil) {
            const urgent = daysUntil <= 2;
            const companyName = notificationConfig.companyName;
            
            const subject = urgent ? 
                `🚨 URGENT - Serviciul de gaz expiră în ${daysUntil} zile` :
                `⚠️ Reminder - Serviciul de gaz expiră în ${daysUntil} zile`;

            const message = `
Stimate Domnule/Doamna ${client.name},

Vă informăm că serviciul de ${getServiceTypeText(service.type)} de la adresa ${client.address} 
${urgent ? 'EXPIRĂ în ' + daysUntil + ' ZILE' : 'va expira în ' + daysUntil + ' zile'} (${formatDate(service.endDate)}).

${urgent ? 
'🚨 Este URGENT să programați o nouă verificare pentru a menține continuitatea serviciului.' :
'Vă rugăm să programați o nouă verificare pentru a evita întreruperea serviciului.'}

Pentru programare, vă rugăm să ne contactați:
📞 Telefon: ${notificationConfig.senderPhone}
📧 Email: ${notificationConfig.senderEmail}

Program: Luni-Vineri 08:00-17:00

Vă mulțumim pentru încredere!
${companyName}
            `;

            return { subject, message };
        }

        async function sendAllNotifications() {
            // Găsește servicii care expiră în următoarele 30 de zile
            const today = new Date();
            const expiringServices = services.filter(service => {
                const endDate = new Date(service.endDate);
                const daysUntil = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                return daysUntil >= 0 && daysUntil <= 30 && (daysUntil === 7 || daysUntil === 2);
            });

            if (expiringServices.length === 0) {
                alert('Nu există servicii care să expire în următoarele 7 zile.');
                return;
            }

            // Generează toate notificările într-un popup organizat
            let allNotifications = '';
            let smsCount = 0;
            let emailCount = 0;

            expiringServices.forEach(service => {
                const client = clients.find(c => c.id === service.clientId);
                if (!client) return;

                const daysUntil = Math.ceil((new Date(service.endDate) - today) / (1000 * 60 * 60 * 24));
                
                if (client.phone) {
                    const smsMessage = generateSMSMessage(client, service, daysUntil);
                    allNotifications += `\n📱 SMS către ${client.phone} (${client.name}):\n${smsMessage}\n${'='.repeat(50)}\n`;
                    smsCount++;
                }

                if (client.email) {
                    const emailData = generateEmailMessage(client, service, daysUntil);
                    allNotifications += `\n📧 Email către ${client.email} (${client.name}):\nSubiect: ${emailData.subject}\n${'='.repeat(50)}\n`;
                    emailCount++;
                }
            });

            // Afișează toate notificările într-un popup
            const shouldProceed = confirm(
                `📋 TOATE NOTIFICĂRILE GENERATE\n\n` +
                `Total: ${smsCount} SMS-uri + ${emailCount} email-uri\n\n` +
                `${allNotifications}\n\n` +
                `🔄 Aplicația va deschide fiecare notificare pe rând.\n` +
                `După fiecare, confirmi dacă ai trimis-o.\n\n` +
                `Click OK pentru a începe procesul.`
            );

            if (!shouldProceed) return;

            // Trimite pe rând cu confirmare
            let successCount = 0;
            let failCount = 0;

            for (const service of expiringServices) {
                const client = clients.find(c => c.id === service.clientId);
                if (!client) continue;

                const daysUntil = Math.ceil((new Date(service.endDate) - today) / (1000 * 60 * 60 * 24));
                
                // SMS
                if (client.phone) {
                    const smsMessage = generateSMSMessage(client, service, daysUntil);
                    const result = await sendSMS(client.phone, smsMessage, client.name);
                    if (result.success) successCount++; else failCount++;
                    
                    // Pauză între notificări
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }

                // Email
                if (client.email) {
                    const emailData = generateEmailMessage(client, service, daysUntil);
                    const result = await sendEmail(client.email, emailData.subject, emailData.message, client.name);
                    if (result.success) successCount++; else failCount++;
                    
                    // Pauză între notificări
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }

            saveData();
            loadNotifications();
            
            alert(`✅ Procesul finalizat!\n\n${successCount} notificări trimise\n${failCount} anulate/eșuate`);
        }

        async function sendUrgentNotifications() {
            const today = new Date();
            const inTwoDays = new Date(today.getTime() + 2 * 24 * 60 * 60 * 1000);
            
            const urgentServices = services.filter(service => {
                const endDate = new Date(service.endDate);
                const daysUntil = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                return daysUntil >= 0 && daysUntil <= 2;
            });

            if (urgentServices.length === 0) {
                alert('Nu există servicii urgente care să expire în următoarele 2 zile.');
                return;
            }

            let successCount = 0;

            for (const service of urgentServices) {
                const client = clients.find(c => c.id === service.clientId);
                if (!client) continue;

                const daysUntil = Math.ceil((new Date(service.endDate) - today) / (1000 * 60 * 60 * 24));
                
                if (client.phone) {
                    const smsMessage = generateSMSMessage(client, service, daysUntil);
                    const result = await sendSMS(client.phone, smsMessage, client.name);
                    if (result.success) successCount++;
                }
            }

            saveData();
            loadNotifications();
            alert(`Notificări urgente trimise: ${successCount} SMS-uri`);
        }

        async function testNotification() {
            const testClient = {
                name: 'Client Test',
                phone: '0762614401', // Folosește numărul firmei pentru test
                email: 'test@adinstalgaz.ro' // Email de test
            };

            const testService = {
                type: 'verificare_anuala',
                endDate: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]
            };

            const smsMessage = generateSMSMessage(testClient, testService, 2);
            const emailData = generateEmailMessage(testClient, testService, 2);
            
            const choice = confirm(
                `🧪 Test Notificare\n\n` +
                `SMS către: ${testClient.phone}\n` +
                `Email către: ${testClient.email}\n\n` +
                `Click OK pentru SMS sau Cancel pentru Email`
            );
            
            if (choice) {
                // Test SMS
                await sendSMS(testClient.phone, smsMessage, testClient.name);
            } else {
                // Test Email  
                await sendEmail(testClient.email, emailData.subject, emailData.message, testClient.name);
            }
            
            saveData();
            loadNotifications();
        }

        function viewNotificationTemplates() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                    <h3>Template-uri Notificări</h3>
                    
                    <h4>SMS Urgent (2 zile):</h4>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
                        🚨 URGENT AdInstalGaz SRL<br>
                        Domnule/Doamna [NUME],<br>
                        serviciul de gaz expiră în 2 ZILE ([DATA]).<br>
                        Programați urgent: 0762614401
                    </div>

                    <h4>SMS Atenționare (7 zile):</h4>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
                        ⚠️ AdInstalGaz SRL - Reminder<br>
                        Bună ziua, serviciul de verificare gaz<br>
                        expiră în 7 zile ([DATA]).<br>
                        Pentru programare: 0762614401
                    </div>

                    <h4>Email Detaliat:</h4>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 4px;">
                        <strong>Subiect:</strong> ⚠️ Reminder - Serviciul de gaz expiră în X zile<br><br>
                        <strong>Conținut:</strong><br>
                        Stimate Domnule/Doamna [NUME],<br><br>
                        Vă informăm că serviciul de [TIP] de la adresa [ADRESĂ]<br>
                        va expira în [X] zile ([DATA]).<br><br>
                        Pentru programare:<br>
                        📞 Telefon: 0762614401<br>
                        📧 Email: contact@adinstalgaz.ro
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function loadNotifications() {
            loadNotificationClients();
            loadNotificationHistory();
        }

        function loadNotificationClients() {
            const tbody = document.getElementById('notificationClientsTableBody');
            tbody.innerHTML = '';

            const today = new Date();
            const inThirtyDays = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000);
            
            const expiringServices = services.filter(service => {
                const endDate = new Date(service.endDate);
                const daysUntil = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                return daysUntil >= 0 && daysUntil <= 30;
            });

            expiringServices.forEach(service => {
                const client = clients.find(c => c.id === service.clientId);
                if (!client) return;

                const daysUntil = Math.ceil((new Date(service.endDate) - today) / (1000 * 60 * 60 * 24));
                
                // Găsește ultima notificare pentru acest client
                const lastNotification = notifications
                    .filter(n => n.clientName === client.name)
                    .sort((a, b) => new Date(b.sentAt) - new Date(a.sentAt))[0];

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${client.name}</td>
                    <td>${client.phone || '-'}</td>
                    <td>${getServiceTypeText(service.type)}</td>
                    <td>
                        <span class="${daysUntil <= 2 ? 'text-danger' : daysUntil <= 7 ? 'text-warning' : ''}" style="font-weight: bold;">
                            ${daysUntil} zile
                        </span>
                    </td>
                    <td>
                        ${lastNotification ? 
                            `${formatDateTime(lastNotification.sentAt)} (${lastNotification.channel.toUpperCase()})` : 
                            'Niciodată'
                        }
                    </td>
                    <td>
                        ${client.phone ? `<button class="btn btn-sm btn-warning" onclick="sendSingleSMS(${service.id})">📱 SMS</button>` : ''}
                        ${client.email ? `<button class="btn btn-sm" onclick="sendSingleEmail(${service.id})">📧 Email</button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadNotificationHistory() {
            const tbody = document.getElementById('notificationHistoryTableBody');
            tbody.innerHTML = '';

            const sortedNotifications = [...notifications].sort((a, b) => new Date(b.sentAt) - new Date(a.sentAt));

            sortedNotifications.forEach(notification => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDateTime(notification.sentAt)}</td>
                    <td>${notification.clientName}</td>
                    <td>${notification.type}</td>
                    <td>
                        <span class="badge ${notification.channel === 'sms' ? 'badge-info' : 'badge-secondary'}">
                            ${notification.channel.toUpperCase()}
                        </span>
                    </td>
                    <td>
                        <span class="badge ${notification.status === 'success' ? 'badge-success' : 'badge-danger'}">
                            ${notification.status === 'success' ? 'Reușit' : 'Eșuat'}
                        </span>
                    </td>
                    <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">
                        ${notification.message}
                    </td>
                    <td>${notification.cost.toFixed(2)} lei</td>
                `;
                tbody.appendChild(row);
            });
        }

        async function sendSingleSMS(serviceId) {
            const service = services.find(s => s.id === serviceId);
            const client = clients.find(c => c.id === service.clientId);
            
            if (!client || !client.phone) {
                alert('Clientul nu are număr de telefon!');
                return;
            }

            const today = new Date();
            const daysUntil = Math.ceil((new Date(service.endDate) - today) / (1000 * 60 * 60 * 24));
            
            const message = generateSMSMessage(client, service, daysUntil);
            const result = await sendSMS(client.phone, message, client.name);
            
            if (result.success) {
                alert('SMS trimis cu succes!');
            } else {
                alert('Eroare la trimiterea SMS-ului: ' + result.error);
            }
            
            saveData();
            loadNotifications();
        }

        async function sendSingleEmail(serviceId) {
            const service = services.find(s => s.id === serviceId);
            const client = clients.find(c => c.id === service.clientId);
            
            if (!client || !client.email) {
                alert('Clientul nu are adresă de email!');
                return;
            }

            const today = new Date();
            const daysUntil = Math.ceil((new Date(service.endDate) - today) / (1000 * 60 * 60 * 24));
            
            const emailData = generateEmailMessage(client, service, daysUntil);
            const result = await sendEmail(client.email, emailData.subject, emailData.message, client.name);
            
            if (result.success) {
                alert('Email trimis cu succes!');
            } else {
                alert('Eroare la trimiterea email-ului: ' + result.error);
            }
            
            saveData();
            loadNotifications();
        }

        function updateNotificationConfig() {
            notificationConfig.senderPhone = document.getElementById('senderPhone').value;
            notificationConfig.senderEmail = document.getElementById('senderEmail').value;
            notificationConfig.companyName = document.getElementById('companyName').value;
            
            // Salvează configurația
            localStorage.setItem('adinstalgaz_notification_config', JSON.stringify(notificationConfig));
        }

        // Încarcă configurația la pornire
        function loadNotificationConfig() {
            const savedConfig = localStorage.getItem('adinstalgaz_notification_config');
            if (savedConfig) {
                const config = JSON.parse(savedConfig);
                Object.assign(notificationConfig, config);
                
                // Actualizează interfața
                if (document.getElementById('senderPhone')) {
                    document.getElementById('senderPhone').value = notificationConfig.senderPhone;
                    document.getElementById('senderEmail').value = notificationConfig.senderEmail;
                    document.getElementById('companyName').value = notificationConfig.companyName;
                }
            }
        }

        function filterNotificationHistory() {
            loadNotificationHistory();
        }

        function searchNotificationHistory(query) {
            const tbody = document.getElementById('notificationHistoryTableBody');
            const rows = tbody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(query.toLowerCase())) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function setupReports() {
            // Configurează rapoartele
            updateClientSelects();
        }

        function handleReportPeriodChange() {
            const period = document.getElementById('reportPeriod').value;
            const customRange = document.getElementById('customDateRange');
            
            if (period === 'custom') {
                customRange.style.display = 'block';
            } else {
                customRange.style.display = 'none';
            }
        }

        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const reportPeriod = document.getElementById('reportPeriod').value;
            
            let reportData = [];
            let reportTitle = '';
            
            // Obține intervalul de date
            const dateRange = getDateRange(reportPeriod);
            
            switch(reportType) {
                case 'clients':
                    reportData = generateClientsReport(dateRange);
                    reportTitle = 'Raport Baza de Date Clienți';
                    break;
                case 'services':
                    reportData = generateServicesReport(dateRange);
                    reportTitle = 'Raport Servicii Implementate';
                    break;
                case 'work':
                    reportData = generateWorkReport(dateRange);
                    reportTitle = 'Raport Lucrări Efectuate';
                    break;
                case 'expiring':
                    reportData = generateExpiringReport();
                    reportTitle = 'Raport Servicii care Expiră';
                    break;
            }
            
            displayReport(reportTitle, reportData, reportType);
        }

        function getDateRange(period) {
            const today = new Date();
            let startDate, endDate;
            
            switch(period) {
                case 'today':
                    startDate = new Date(today);
                    endDate = new Date(today);
                    break;
                case 'week':
                    startDate = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                    endDate = new Date(today);
                    break;
                case 'month':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    endDate = new Date(today);
                    break;
                case 'year':
                    startDate = new Date(today.getFullYear(), 0, 1);
                    endDate = new Date(today);
                    break;
                case 'custom':
                    startDate = new Date(document.getElementById('reportStartDate').value);
                    endDate = new Date(document.getElementById('reportEndDate').value);
                    break;
                default:
                    startDate = new Date(0);
                    endDate = new Date();
            }
            
            return { startDate, endDate };
        }

        function generateClientsReport(dateRange) {
            return clients.filter(client => {
                const clientDate = new Date(client.dateAdded);
                return clientDate >= dateRange.startDate && clientDate <= dateRange.endDate;
            }).map(client => ({
                'Nume': client.name,
                'Telefon': client.phone,
                'Email': client.email || '-',
                'Tip': client.type,
                'Status': getStatusText(client.status),
                'Data Adăugare': formatDate(client.dateAdded)
            }));
        }

        function generateServicesReport(dateRange) {
            return services.filter(service => {
                const serviceDate = new Date(service.startDate);
                return serviceDate >= dateRange.startDate && serviceDate <= dateRange.endDate;
            }).map(service => {
                const client = clients.find(c => c.id === service.clientId);
                return {
                    'Client': client ? client.name : 'Necunoscut',
                    'Tip Serviciu': getServiceTypeText(service.type),
                    'Data Start': formatDate(service.startDate),
                    'Data Expirare': formatDate(service.endDate),
                    'Status': getServiceStatusText(service)
                };
            });
        }

        function generateWorkReport(dateRange) {
            return work.filter(workItem => {
                const workDate = new Date(workItem.scheduledDate);
                return workDate >= dateRange.startDate && workDate <= dateRange.endDate;
            }).map(workItem => {
                const client = clients.find(c => c.id === workItem.clientId);
                return {
                    'Client': client ? client.name : 'Necunoscut',
                    'Tip Lucrare': getWorkTypeText(workItem.type),
                    'Lucrător': getWorkerName(workItem.assignee),
                    'Data Programată': formatDate(workItem.scheduledDate),
                    'Status': getWorkStatusText(workItem.status),
                    'Prioritate': workItem.priority
                };
            });
        }

        function generateExpiringReport() {
            const today = new Date();
            const inThirtyDays = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000);
            
            return services.filter(service => {
                const endDate = new Date(service.endDate);
                return endDate >= today && endDate <= inThirtyDays;
            }).map(service => {
                const client = clients.find(c => c.id === service.clientId);
                const daysUntilExpiry = Math.ceil((new Date(service.endDate) - today) / (1000 * 60 * 60 * 24));
                
                return {
                    'Client': client ? client.name : 'Necunoscut',
                    'Telefon': client ? client.phone : '-',
                    'Tip Serviciu': getServiceTypeText(service.type),
                    'Data Expirare': formatDate(service.endDate),
                    'Zile Rămase': daysUntilExpiry,
                    'Urgență': daysUntilExpiry <= 2 ? 'URGENT' : daysUntilExpiry <= 7 ? 'ATENȚIE' : 'NORMAL'
                };
            }).sort((a, b) => a['Zile Rămase'] - b['Zile Rămase']);
        }

        function displayReport(title, data, type) {
            const resultsDiv = document.getElementById('reportResults');
            
            if (data.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="alert alert-warning">
                        <strong>Nu au fost găsite date pentru perioada selectată.</strong>
                    </div>
                `;
                return;
            }
            
            // Creează tabelul
            const table = document.createElement('table');
            table.className = 'table';
            
            // Header
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            Object.keys(data[0]).forEach(key => {
                const th = document.createElement('th');
                th.textContent = key;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // Body
            const tbody = document.createElement('tbody');
            data.forEach(row => {
                const tr = document.createElement('tr');
                Object.values(row).forEach(value => {
                    const td = document.createElement('td');
                    td.textContent = value;
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);
            
            resultsDiv.innerHTML = `
                <h4>${title}</h4>
                <p><strong>Total înregistrări:</strong> ${data.length}</p>
                <div style="overflow-x: auto;">
                    ${table.outerHTML}
                </div>
            `;
        }

        function exportReport() {
            // În aplicația reală, aici ar fi logica de export PDF
            alert('Funcționalitatea de export PDF va fi implementată în versiunea finală.');
        }

        // Funcții utilitare
        function getStatusText(status) {
            switch(status) {
                case 'complet': return 'Complet';
                case 'incomplet': return 'Incomplet';
                case 'de_contactat': return 'De Contactat';
                default: return status;
            }
        }

        function getStatusClass(status) {
            switch(status) {
                case 'complet': return 'badge-success';
                case 'incomplet': return 'badge-warning';
                case 'de_contactat': return 'badge-danger';
                default: return 'badge-secondary';
            }
        }

        function getServiceTypeText(type) {
            switch(type) {
                case 'instalare_gaz': return 'Instalare Gaz';
                case 'verificare_anuala': return 'Verificare Anuală';
                case 'reparatie': return 'Reparație';
                case 'intretinere': return 'Întreținere';
                case 'inlocuire_echipament': return 'Înlocuire Echipament';
                default: return type;
            }
        }

        function getWorkTypeText(type) {
            switch(type) {
                case 'instalare': return 'Instalare Nouă';
                case 'verificare': return 'Verificare Anuală';
                case 'reparatie': return 'Reparație';
                case 'intretinere': return 'Întreținere';
                case 'urgenta': return 'Intervenție Urgentă';
                default: return type;
            }
        }

        function getWorkStatusText(status) {
            switch(status) {
                case 'programata': return 'Programată';
                case 'in_progress': return 'În Progres';
                case 'finalizata': return 'Finalizată';
                default: return status;
            }
        }

        function getWorkStatusClass(status) {
            switch(status) {
                case 'programata': return 'badge-warning';
                case 'in_progress': return 'badge-info';
                case 'finalizata': return 'badge-success';
                default: return 'badge-secondary';
            }
        }

        function getWorkerName(email) {
            switch(email) {
                case 'lucrator@adinstalgaz.ro': return 'Ion Popescu';
                case 'lucrator2@adinstalgaz.ro': return 'Vasile Ionescu';
                case 'lucrator3@adinstalgaz.ro': return 'George Marinescu';
                default: return email || 'Neatribuit';
            }
        }

        function getUploaderName(email) {
            if (email === 'admin@adinstalgaz.ro') return 'Administrator';
            return getWorkerName(email);
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('ro-RO');
        }

        function formatDateTime(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleString('ro-RO');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function searchClients(query) {
            const tbody = document.getElementById('clientsTableBody');
            const rows = tbody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(query.toLowerCase())) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function filterServices() {
            loadServices();
        }

        function filterProgramming() {
            loadProgramming();
        }

        function filterWork() {
            loadWork();
        }

        function filterDocuments() {
            loadDocuments();
        }

        function saveData() {
            localStorage.setItem('adinstalgaz_clients', JSON.stringify(clients));
            localStorage.setItem('adinstalgaz_services', JSON.stringify(services));
            localStorage.setItem('adinstalgaz_work', JSON.stringify(work));
            localStorage.setItem('adinstalgaz_documents', JSON.stringify(documents));
            localStorage.setItem('adinstalgaz_notifications', JSON.stringify(notifications));
        }

        // Închide modalurile când se face click în afara lor
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Auto-save la fiecare 30 de secunde
        setInterval(saveData, 30000);
    </script>

    <style>
        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .badge-secondary {
            background: #e2e3e5;
            color: #383d41;
        }

        .text-danger {
            color: #dc3545 !important;
        }

        .text-warning {
            color: #ffc107 !important;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }
    </style>
</body>
</html>
