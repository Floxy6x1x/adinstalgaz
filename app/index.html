<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdInstalGaz SRL - Management System</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkFkSW5zdGFsR2F6IFNSTCIsCiAgInNob3J0X25hbWUiOiAiQWRJbnN0YWxHYXoiLAogICJkZXNjcmlwdGlvbiI6ICJTaXN0ZW0gbWFuYWdlbWVudCBBZEluc3RhbEdheiIsCiAgInN0YXJ0X3VybCI6ICIvIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjZmZmZmZmIiwKICAidGhlbWVfY29sb3IiOiAiIzI1NjNlYiIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU5USTBJaUJvWldsbmFIUTlJalV5TkNJZ2RtbGxkMEp2ZUQwaU1DQXdJRFV5TkNBMU1qUWlJR1pwYkd3OUlpTXlOVFl6WldJaVBqeGphWEpqYkdVZ1kzZzlJakkyTWlJZ1kzazlJakkyTWlJZ2NqMGlNVEF3SWlCbWFXeHNQU0lqTWpVMk0yVmlJaTgrUEhSbGVIUWdlRDBpTWpZeUlpQjVQU0l5T0RZaUlIUmxlSFF0WVc1amFHOXlQU0p0YVdSa2JHVWlJR1pwYkd3OUluZG9hWFJsSWlCbWIyNTBMWE5wZW1VOUlqTXdJaUIyYVd4clBTSWlQakJJUFQ5MGVYQmxQUzlqYVhKamJHVWdlbU5zZFhScGRtVWdhV1FrZVNFaVBDOTBlSFIrUEM5emRtYysifSwKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlOVEV5SWlCb1pXbG5hSFE5SWpVeE1pSWdkbWxsZDBKdmVEMGlNQ0F3SURGE01qUWlJR1pwYkd3OUlpTXlOVFl6WldJaVBqeGphWEpqYkdVZ1kzZzlJakkxTmlJZ1kzazlJakkxTmlJZ2NqMGlNakF3SWlCbWFXeHNQU0lqTWpVMk0yVmlJaTgrUEhSbGVIUWdlRDBpTWpVMklpQjVQU0l6TURBaUlIUmxlSFF0WVc1amFHOXlQU0p0YVdSa2JHVWlJR1pwYkd3OUluZG9hWFJsSWlCbWIyNTBMWE5wZW1VOUlqWXdJaUIyYVd4clBTSWlQa2hKUEM5MFpYaDBQand2YzNabktUd3ZaMitkRUJ5UXVDOVhBOHFhZHM5TnZQa1F0em9TQjE2YlNGbVBnYUlWL3h1TC9tNWlLN3BBQXFLQU5ZSytKRW1LZCIsInNpemVzIjogIjUxMng1MTIiLCJ0eXBlIjogImltYWdlL3N2Zyt4bWwifQogIF0sCiAgImNhdGVnb3JpZXMiOiBbImJ1c2luZXNzIiwgInV0aWxpdGllcyJdCn0=">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="AdInstalGaz">
    
    <!-- External Libraries -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyD9yoIQ__cK0zIPlvSRlu1h7O1MtmrfLXA",
            authDomain: "adinstalgaz-pwa.firebaseapp.com",
            projectId: "adinstalgaz-pwa",
            storageBucket: "adinstalgaz-pwa.firebasestorage.app",
            messagingSenderId: "623851795901",
            appId: "1:623851795901:web:63072fdef30693f4698ed4"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const auth = firebase.auth();
        const db = firebase.firestore();

        // SERVICIILE COMPANIEI
        const SERVICES = {
            verificare_instalatie: { name: 'Verificare Instala»õie Gaz', price: 150, validity: 2 },
            revizie_instalatie: { name: 'Revizie Instala»õie Gaz', price: 250, validity: 2 },
            verificare_centrala: { name: 'Verificare CentralƒÉ', price: 150, validity: 2 },
            oferta_completa: { name: 'OFERTƒÇ: Instala»õii + CentralƒÉ', price: 250, validity: 2 },
            serviciu_urgenta: { name: 'Servicii Urgen»õƒÉ', price: 0, validity: 0 }
        };

        // FIREBASE UTILITIES
        const FirebaseUtils = {
            // Collection references
            getClientsRef: () => db.collection('clients'),
            getWorkersRef: () => db.collection('workers'),
            getAssignmentsRef: () => db.collection('assignments'),
            getUsersRef: () => db.collection('users'),

            // Generic CRUD operations
            async create(collection, data) {
                try {
                    const docRef = await db.collection(collection).add({
                        ...data,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    return { id: docRef.id, ...data };
                } catch (error) {
                    console.error(`Error creating document in ${collection}:`, error);
                    throw error;
                }
            },

            async read(collection, id) {
                try {
                    const doc = await db.collection(collection).doc(id).get();
                    if (doc.exists) {
                        return { id: doc.id, ...doc.data() };
                    }
                    return null;
                } catch (error) {
                    console.error(`Error reading document from ${collection}:`, error);
                    throw error;
                }
            },

            async update(collection, id, data) {
                try {
                    await db.collection(collection).doc(id).update({
                        ...data,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    return { id, ...data };
                } catch (error) {
                    console.error(`Error updating document in ${collection}:`, error);
                    throw error;
                }
            },

            async delete(collection, id) {
                try {
                    await db.collection(collection).doc(id).delete();
                    return true;
                } catch (error) {
                    console.error(`Error deleting document from ${collection}:`, error);
                    throw error;
                }
            },

            async getAll(collection, orderBy = 'createdAt', direction = 'desc') {
                try {
                    const snapshot = await db.collection(collection)
                        .orderBy(orderBy, direction)
                        .get();
                    
                    return snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                } catch (error) {
                    console.error(`Error getting all documents from ${collection}:`, error);
                    throw error;
                }
            },

            // Real-time listeners
            onSnapshot(collection, callback, errorCallback) {
                return db.collection(collection)
                    .orderBy('createdAt', 'desc')
                    .onSnapshot(
                        snapshot => {
                            const data = snapshot.docs.map(doc => ({
                                id: doc.id,
                                ...doc.data()
                            }));
                            callback(data);
                        },
                        errorCallback || console.error
                    );
            },

            // Initialize default data
            async initializeDefaultData() {
                try {
                    // Check if data already exists
                    const clientsSnapshot = await this.getClientsRef().limit(1).get();
                    if (!clientsSnapshot.empty) {
                        console.log('Default data already exists');
                        return;
                    }

                    console.log('Initializing default data...');

                    // Create default clients
                    const defaultClients = [
                        { 
                            name: 'Popescu Ion', 
                            phone: '0721234567', 
                            email: 'ion.popescu@email.com',
                            address: 'Str. Libertatii nr. 15, Bucuresti',
                            lastService: '2024-01-15',
                            serviceType: 'verificare_instalatie',
                            expiresAt: '2026-01-15'
                        },
                        { 
                            name: 'Ionescu Maria', 
                            phone: '0732456789', 
                            email: 'maria.ionescu@email.com',
                            address: 'Bd. Revolutiei nr. 42, Cluj-Napoca',
                            lastService: '2024-02-20',
                            serviceType: 'oferta_completa',
                            expiresAt: '2026-02-20'
                        },
                        { 
                            name: 'Marinescu George', 
                            phone: '0743567890', 
                            email: 'george.marinescu@email.com',
                            address: 'Str. Mihai Eminescu nr. 8, Iasi',
                            lastService: '2023-03-10',
                            serviceType: 'verificare_centrala',
                            expiresAt: '2025-03-10'
                        }
                    ];

                    for (const client of defaultClients) {
                        await this.create('clients', client);
                    }

                    // Create default workers
                    const defaultWorkers = [
                        { 
                            name: 'Munteanu Adrian', 
                            phone: '0712345678',
                            email: 'adrian.munteanu@adinstalgazsrl.ro',
                            zone: 'Bucuresti'
                        },
                        { 
                            name: 'Stanescu Bogdan', 
                            phone: '0723456789',
                            email: 'bogdan.stanescu@adinstalgazsrl.ro',
                            zone: 'Cluj-Napoca'
                        }
                    ];

                    for (const worker of defaultWorkers) {
                        await this.create('workers', worker);
                    }

                    console.log('Default data initialized successfully');
                } catch (error) {
                    console.error('Error initializing default data:', error);
                }
            }
        };

        function AdInstalGazApp() {
            // Authentication state
            const [user, setUser] = useState(null);
            const [userProfile, setUserProfile] = useState(null);
            const [userRole, setUserRole] = useState(null);
            const [loading, setLoading] = useState(true);
            const [authLoading, setAuthLoading] = useState(false);
            
            // Application state
            const [activeTab, setActiveTab] = useState('dashboard');
            
            // PWA state
            const [deferredPrompt, setDeferredPrompt] = useState(null);
            const [showInstallPrompt, setShowInstallPrompt] = useState(false);
            const [syncStatus, setSyncStatus] = useState('synced');
            const [isOnline, setIsOnline] = useState(navigator.onLine);
            
            // Data state with Firebase sync
            const [clients, setClients] = useState([]);
            const [workers, setWorkers] = useState([]);
            const [assignments, setAssignments] = useState([]);

            // Modals
            const [smsModal, setSmsModal] = useState(false);
            const [smsRecipient, setSmsRecipient] = useState('');
            const [smsMessage, setSmsMessage] = useState('');
            const [assignmentModal, setAssignmentModal] = useState(false);
            const [selectedClient, setSelectedClient] = useState(null);
            const [documentModal, setDocumentModal] = useState(false);
            const [selectedAssignment, setSelectedAssignment] = useState(null);

            // Firebase listeners refs
            const unsubscribeRefs = useRef([]);

            // Authentication effect
            useEffect(() => {
                const unsubscribeAuth = auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        setUser(user);
                        try {
                            // Get user profile from Firestore
                            const userDoc = await FirebaseUtils.read('users', user.uid);
                            if (userDoc) {
                                setUserProfile(userDoc);
                                setUserRole(userDoc.role);
                            } else {
                                // Create user profile if doesn't exist
                                const defaultProfile = {
                                    name: user.displayName || user.email.split('@')[0],
                                    email: user.email,
                                    role: 'admin' // Default role
                                };
                                await db.collection('users').doc(user.uid).set(defaultProfile);
                                setUserProfile(defaultProfile);
                                setUserRole('admin');
                            }
                        } catch (error) {
                            console.error('Error fetching user profile:', error);
                        }
                    } else {
                        setUser(null);
                        setUserProfile(null);
                        setUserRole(null);
                    }
                    setLoading(false);
                });

                return () => unsubscribeAuth();
            }, []);

            // Data listeners effect
            useEffect(() => {
                if (user) {
                    setSyncStatus('syncing');
                    
                    // Initialize default data if needed
                    FirebaseUtils.initializeDefaultData();

                    // Set up real-time listeners
                    const unsubscribeClients = FirebaseUtils.onSnapshot('clients', setClients);
                    const unsubscribeWorkers = FirebaseUtils.onSnapshot('workers', setWorkers);
                    const unsubscribeAssignments = FirebaseUtils.onSnapshot('assignments', setAssignments);

                    unsubscribeRefs.current = [unsubscribeClients, unsubscribeWorkers, unsubscribeAssignments];

                    setTimeout(() => setSyncStatus('synced'), 1000);
                } else {
                    // Clean up listeners
                    unsubscribeRefs.current.forEach(unsubscribe => unsubscribe && unsubscribe());
                    unsubscribeRefs.current = [];
                    setClients([]);
                    setWorkers([]);
                    setAssignments([]);
                }

                return () => {
                    unsubscribeRefs.current.forEach(unsubscribe => unsubscribe && unsubscribe());
                };
            }, [user]);

            // PWA Installation handling
            useEffect(() => {
                const handleBeforeInstallPrompt = (e) => {
                    e.preventDefault();
                    setDeferredPrompt(e);
                    setShowInstallPrompt(true);
                };

                window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
                return () => window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
            }, []);

            // Online/Offline detection
            useEffect(() => {
                const handleOnline = () => {
                    setIsOnline(true);
                    setSyncStatus('syncing');
                    setTimeout(() => setSyncStatus('synced'), 1000);
                };

                const handleOffline = () => {
                    setIsOnline(false);
                    setSyncStatus('offline');
                };

                window.addEventListener('online', handleOnline);
                window.addEventListener('offline', handleOffline);

                return () => {
                    window.removeEventListener('online', handleOnline);
                    window.removeEventListener('offline', handleOffline);
                };
            }, []);

            const handleInstallApp = async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    if (outcome === 'accepted') {
                        setDeferredPrompt(null);
                        setShowInstallPrompt(false);
                    }
                }
            };

            // Authentication functions
            const handleLogin = async (email, password) => {
                try {
                    setAuthLoading(true);
                    await auth.signInWithEmailAndPassword(email, password);
                    return true;
                } catch (error) {
                    console.error('Login error:', error);
                    return false;
                }
            };

            const handleRegister = async (email, password, name, role = 'admin') => {
                try {
                    setAuthLoading(true);
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    
                    // Create user profile in Firestore
                    await db.collection('users').doc(userCredential.user.uid).set({
                        name,
                        email,
                        role,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    return true;
                } catch (error) {
                    console.error('Registration error:', error);
                    return false;
                } finally {
                    setAuthLoading(false);
                }
            };

            const handleLogout = async () => {
                try {
                    await auth.signOut();
                    setActiveTab('dashboard');
                } catch (error) {
                    console.error('Logout error:', error);
                }
            };

            // SMS Functions
            const sendSMS = async () => {
                if (!smsRecipient || !smsMessage.trim()) {
                    alert('Completa»õi toate c√¢mpurile!');
                    return;
                }

                setSyncStatus('syncing');
                
                try {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    const smsLog = {
                        recipient: smsRecipient,
                        message: smsMessage,
                        sentAt: firebase.firestore.FieldValue.serverTimestamp(),
                        status: 'sent',
                        sentBy: user.uid
                    };

                    await FirebaseUtils.create('sms_logs', smsLog);

                    alert(`‚úÖ SMS trimis cu succes cƒÉtre ${smsRecipient}!`);
                    setSmsRecipient('');
                    setSmsMessage('');
                    setSmsModal(false);
                    
                } catch (error) {
                    alert('‚ùå Eroare la trimiterea SMS-ului.');
                    console.error('SMS Error:', error);
                } finally {
                    setSyncStatus('synced');
                }
            };

            const sendQuickSMS = (client, messageType) => {
                const messages = {
                    reminder: `Buna ziua ${client.name}! Va reamintim ca certificatul pentru instalatia de gaz expira la ${client.expiresAt}. Va rugam sa ne contactati pentru reprogramare. AdInstalGaz SRL - 0721.123.456`,
                    appointment: `Buna ziua ${client.name}! Va confirmam programarea pentru verificarea instalatiei la adresa ${client.address} maine la ora 10:00. AdInstalGaz SRL`,
                    completion: `Buna ziua ${client.name}! Verificarea instalatiei a fost finalizata cu succes. Certificatul este valabil pana la ${new Date(Date.now() + 2*365*24*60*60*1000).toLocaleDateString('ro-RO')}. AdInstalGaz SRL`
                };

                setSmsRecipient(client.phone);
                setSmsMessage(messages[messageType] || '');
                setSmsModal(true);
            };

            // Assignment Functions
            const assignWork = async (client, serviceType, scheduledDate, notes) => {
                try {
                    const newAssignment = {
                        clientId: client.id,
                        workerId: userRole === 'admin' ? workers[0]?.id : userProfile.workerId, 
                        serviceType,
                        scheduledDate,
                        status: 'assigned',
                        notes,
                        documents: [],
                        assignedBy: user.uid
                    };

                    await FirebaseUtils.create('assignments', newAssignment);
                    setAssignmentModal(false);
                    alert('‚úÖ Lucrare asignatƒÉ cu succes!');
                } catch (error) {
                    alert('‚ùå Eroare la asignarea lucrƒÉrii.');
                    console.error('Assignment Error:', error);
                }
            };

            const updateAssignmentStatus = async (assignmentId, newStatus) => {
                try {
                    await FirebaseUtils.update('assignments', assignmentId, { 
                        status: newStatus,
                        updatedBy: user.uid
                    });
                    alert(`‚úÖ Status actualizat la: ${newStatus}`);
                } catch (error) {
                    alert('‚ùå Eroare la actualizarea statusului.');
                    console.error('Status Update Error:', error);
                }
            };

            const uploadDocument = async (assignmentId, documentType) => {
                try {
                    const assignment = assignments.find(a => a.id === assignmentId);
                    if (!assignment) return;

                    const newDocument = {
                        type: documentType,
                        name: `${documentType}_${Date.now()}.pdf`,
                        uploadedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        uploadedBy: user.uid
                    };

                    const updatedDocuments = [...(assignment.documents || []), newDocument];
                    
                    await FirebaseUtils.update('assignments', assignmentId, { 
                        documents: updatedDocuments 
                    });

                    setDocumentModal(false);
                    alert('‚úÖ Document √ÆncƒÉrcat cu succes!');
                } catch (error) {
                    alert('‚ùå Eroare la √ÆncƒÉrcarea documentului.');
                    console.error('Document Upload Error:', error);
                }
            };

            // Utility Functions
            const getClientById = (clientId) => clients.find(c => c.id === clientId);
            const getWorkerById = (workerId) => workers.find(w => w.id === workerId);
            
            const getExpiringClients = () => {
                const in30Days = new Date(Date.now() + 30*24*60*60*1000);
                return clients.filter(client => new Date(client.expiresAt) <= in30Days);
            };

            const getWorkerAssignments = (workerId) => {
                return assignments.filter(a => a.workerId === workerId);
            };

            // Show loading screen while checking authentication
            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600">
                        <div className="text-center text-white">
                            <div className="loading-spinner mx-auto mb-4"></div>
                            <p className="text-xl">Se √ÆncarcƒÉ aplica»õia...</p>
                        </div>
                    </div>
                );
            }

            // Components
            function LoginForm({ onLogin, onRegister }) {
                const [email, setEmail] = useState('');
                const [password, setPassword] = useState('');
                const [name, setName] = useState('');
                const [isRegisterMode, setIsRegisterMode] = useState(false);
                const [error, setError] = useState('');

                const handleSubmit = async (e) => {
                    e.preventDefault();
                    setError('');
                    
                    let success = false;
                    if (isRegisterMode) {
                        if (!name.trim()) {
                            setError('Numele este obligatoriu!');
                            return;
                        }
                        success = await onRegister(email, password, name);
                        if (!success) {
                            setError('Eroare la √Ænregistrare! Verifica»õi datele introduse.');
                        }
                    } else {
                        success = await onLogin(email, password);
                        if (!success) {
                            setError('Creden»õiale incorecte!');
                        }
                    }
                };

                return (
                    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600">
                        <div className="max-w-md w-full mx-4">
                            <div className="bg-white rounded-xl shadow-2xl p-8">
                                <div className="text-center mb-8">
                                    <h1 className="text-3xl font-bold text-gray-800">AdInstalGaz SRL</h1>
                                    <p className="text-gray-600 mt-2">Sistem Management</p>
                                </div>
                                
                                <form onSubmit={handleSubmit} className="space-y-6">
                                    {isRegisterMode && (
                                        <div>
                                            <input
                                                type="text"
                                                placeholder="Nume complet"
                                                value={name}
                                                onChange={(e) => setName(e.target.value)}
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                required
                                            />
                                        </div>
                                    )}
                                    
                                    <div>
                                        <input
                                            type="email"
                                            placeholder="Email"
                                            value={email}
                                            onChange={(e) => setEmail(e.target.value)}
                                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                            required
                                        />
                                    </div>
                                    
                                    <div>
                                        <input
                                            type="password"
                                            placeholder="ParolƒÉ"
                                            value={password}
                                            onChange={(e) => setPassword(e.target.value)}
                                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                            required
                                        />
                                    </div>
                                    
                                    {error && (
                                        <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                                            {error}
                                        </div>
                                    )}
                                    
                                    <button
                                        type="submit"
                                        disabled={authLoading}
                                        className="w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
                                    >
                                        {authLoading ? (
                                            <>
                                                <div className="loading-spinner mr-3"></div>
                                                {isRegisterMode ? 'Se √ÆnregistreazƒÉ...' : 'Se conecteazƒÉ...'}
                                            </>
                                        ) : (
                                            isRegisterMode ? '√énregistrare' : 'Conectare'
                                        )}
                                    </button>
                                </form>
                                
                                <div className="mt-6 text-center">
                                    <button
                                        onClick={() => {
                                            setIsRegisterMode(!isRegisterMode);
                                            setError('');
                                        }}
                                        className="text-blue-600 hover:text-blue-800 text-sm"
                                    >
                                        {isRegisterMode 
                                            ? 'Ai deja cont? ConecteazƒÉ-te' 
                                            : 'Nu ai cont? √énregistreazƒÉ-te'
                                        }
                                    </button>
                                </div>

                                {!isRegisterMode && (
                                    <div className="mt-6 text-center text-sm text-gray-600">
                                        <p className="mb-2">üí° Pentru testare po»õi crea un cont nou</p>
                                        <p>sau folosi creden»õialele demo din vechea versiune</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            function Header() {
                return (
                    <header className="bg-white shadow-sm border-b border-gray-200 mb-6">
                        <div className="flex items-center justify-between py-4 px-6">
                            <div>
                                <h1 className="text-2xl font-bold text-gray-900">AdInstalGaz SRL</h1>
                                <p className="text-gray-600">
                                    {userRole === 'admin' ? 'Panou Administrator' : 'Panou LucrƒÉtor'}
                                </p>
                            </div>
                            <div className="flex items-center space-x-4">
                                <button 
                                    onClick={() => setSmsModal(true)}
                                    className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                                >
                                    <span>üì±</span>
                                    <span className="hidden sm:inline">SMS</span>
                                </button>
                                
                                <div className="text-right">
                                    <p className="text-sm font-medium text-gray-700">{userProfile?.name}</p>
                                    <p className="text-xs text-gray-500">{userRole === 'admin' ? 'Administrator' : 'LucrƒÉtor'}</p>
                                </div>
                                <button
                                    onClick={handleLogout}
                                    className="text-gray-600 hover:text-gray-800 p-2"
                                    title="Deconectare"
                                >
                                    üö™
                                </button>
                            </div>
                        </div>
                    </header>
                );
            }

            function Navigation() {
                const adminTabs = [
                    { id: 'dashboard', name: 'Dashboard', icon: 'üè†' },
                    { id: 'clients', name: 'Clien»õi', icon: 'üë•' },
                    { id: 'assignments', name: 'AsignƒÉri', icon: 'üìã' },
                    { id: 'workers', name: 'LucrƒÉtori', icon: 'üë®‚Äçüîß' },
                    { id: 'reports', name: 'Rapoarte', icon: 'üìä' }
                ];

                const workerTabs = [
                    { id: 'dashboard', name: 'Dashboard', icon: 'üè†' },
                    { id: 'my-work', name: 'LucrƒÉrile Mele', icon: 'üîß' },
                    { id: 'completed', name: 'Finalizate', icon: '‚úÖ' }
                ];

                const tabs = userRole === 'admin' ? adminTabs : workerTabs;

                return (
                    <nav className="bg-white rounded-lg shadow mb-6 sticky top-0 z-40">
                        <div className="px-4">
                            <div className="flex space-x-8 overflow-x-auto">
                                {tabs.map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors ${
                                            activeTab === tab.id
                                                ? 'border-blue-500 text-blue-600'
                                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                                        }`}
                                    >
                                        <span className="mr-2">{tab.icon}</span>
                                        {tab.name}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </nav>
                );
            }

            function Dashboard() {
                const expiringClients = getExpiringClients();
                const totalAssignments = userRole === 'admin' 
                    ? assignments.length 
                    : getWorkerAssignments(userProfile?.workerId).length;
                
                const completedAssignments = userRole === 'admin'
                    ? assignments.filter(a => a.status === 'completed').length
                    : getWorkerAssignments(userProfile?.workerId).filter(a => a.status === 'completed').length;

                return (
                    <div className="space-y-6">
                        {/* Firebase Status Indicator */}
                        <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                            <div className="flex items-center">
                                <span className="text-green-600 mr-2">üî•</span>
                                <span className="text-green-800 font-medium">Firebase Backend Activ</span>
                                <span className="ml-auto text-sm text-green-600">
                                    {isOnline ? 'üü¢ Online' : 'üî¥ Offline'}
                                </span>
                            </div>
                        </div>

                        {/* Stats Overview */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <div className="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-lg shadow">
                                <div className="flex items-center">
                                    <span className="text-3xl mr-4">üë•</span>
                                    <div>
                                        <p className="text-sm opacity-90">Total Clien»õi</p>
                                        <p className="text-2xl font-bold">{clients.length}</p>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-gradient-to-r from-red-500 to-red-600 text-white p-6 rounded-lg shadow">
                                <div className="flex items-center">
                                    <span className="text-3xl mr-4">‚ö†Ô∏è</span>
                                    <div>
                                        <p className="text-sm opacity-90">ExpirƒÉri √Æn 30 zile</p>
                                        <p className="text-2xl font-bold">{expiringClients.length}</p>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-gradient-to-r from-yellow-500 to-yellow-600 text-white p-6 rounded-lg shadow">
                                <div className="flex items-center">
                                    <span className="text-3xl mr-4">üìã</span>
                                    <div>
                                        <p className="text-sm opacity-90">LucrƒÉri Totale</p>
                                        <p className="text-2xl font-bold">{totalAssignments}</p>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-lg shadow">
                                <div className="flex items-center">
                                    <span className="text-3xl mr-4">‚úÖ</span>
                                    <div>
                                        <p className="text-sm opacity-90">Finalizate</p>
                                        <p className="text-2xl font-bold">{completedAssignments}</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Expiring Certificates Alert */}
                        {expiringClients.length > 0 && (
                            <div className="bg-red-50 border border-red-200 rounded-lg p-6">
                                <h3 className="text-lg font-semibold text-red-800 mb-4">‚ö†Ô∏è Clien»õi cu CertificƒÉri ce ExpirƒÉ Cur√¢nd</h3>
                                <div className="space-y-3">
                                    {expiringClients.map(client => (
                                        <div key={client.id} className="flex items-center justify-between bg-white p-3 rounded border border-red-200">
                                            <div>
                                                <p className="font-medium text-gray-900">{client.name}</p>
                                                <p className="text-sm text-gray-600">{SERVICES[client.serviceType]?.name}</p>
                                                <p className="text-sm text-red-600">ExpirƒÉ: {client.expiresAt}</p>
                                            </div>
                                            <button 
                                                onClick={() => sendQuickSMS(client, 'reminder')}
                                                className="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors"
                                            >
                                                üì± Trimite Reminder
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Quick Actions */}
                        <div className="bg-white rounded-lg shadow p-6">
                            <h3 className="text-lg font-semibold text-gray-800 mb-4">üöÄ Ac»õiuni Rapide</h3>
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                {userRole === 'admin' ? (
                                    <>
                                        <button 
                                            onClick={() => setActiveTab('clients')}
                                            className="p-4 text-left border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors"
                                        >
                                            <div className="text-2xl mb-2">üë•</div>
                                            <div className="font-semibold">GestioneazƒÉ Clien»õi</div>
                                        </button>
                                        <button 
                                            onClick={() => setActiveTab('assignments')}
                                            className="p-4 text-left border border-gray-200 rounded-lg hover:bg-green-50 hover:border-green-300 transition-colors"
                                        >
                                            <div className="text-2xl mb-2">üìã</div>
                                            <div className="font-semibold">AsigneazƒÉ LucrƒÉri</div>
                                        </button>
                                        <button 
                                            onClick={() => setSmsModal(true)}
                                            className="p-4 text-left border border-gray-200 rounded-lg hover:bg-purple-50 hover:border-purple-300 transition-colors"
                                        >
                                            <div className="text-2xl mb-2">üì±</div>
                                            <div className="font-semibold">Trimite SMS</div>
                                        </button>
                                        <button 
                                            onClick={() => setActiveTab('reports')}
                                            className="p-4 text-left border border-gray-200 rounded-lg hover:bg-yellow-50 hover:border-yellow-300 transition-colors"
                                        >
                                            <div className="text-2xl mb-2">üìä</div>
                                            <div className="font-semibold">Vezi Rapoarte</div>
                                        </button>
                                    </>
                                ) : (
                                    <>
                                        <button 
                                            onClick={() => setActiveTab('my-work')}
                                            className="p-4 text-left border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors"
                                        >
                                            <div className="text-2xl mb-2">üîß</div>
                                            <div className="font-semibold">LucrƒÉrile Mele</div>
                                        </button>
                                        <button 
                                            onClick={() => setActiveTab('completed')}
                                            className="p-4 text-left border border-gray-200 rounded-lg hover:bg-green-50 hover:border-green-300 transition-colors"
                                        >
                                            <div className="text-2xl mb-2">‚úÖ</div>
                                            <div className="font-semibold">Finalizate</div>
                                        </button>
                                        <button 
                                            onClick={() => setSmsModal(true)}
                                            className="p-4 text-left border border-gray-200 rounded-lg hover:bg-purple-50 hover:border-purple-300 transition-colors"
                                        >
                                            <div className="text-2xl mb-2">üì±</div>
                                            <div className="font-semibold">ContacteazƒÉ Client</div>
                                        </button>
                                        <button className="p-4 text-left border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors opacity-50">
                                            <div className="text-2xl mb-2">üìÑ</div>
                                            <div className="font-semibold">Documente</div>
                                        </button>
                                    </>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            function ClientsTab() {
                return (
                    <div className="space-y-6">
                        <div className="bg-white rounded-lg shadow">
                            <div className="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                                <h3 className="text-lg font-semibold text-gray-800">üë• Gestionare Clien»õi</h3>
                                <button className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    + AdaugƒÉ Client
                                </button>
                            </div>
                            <div className="overflow-x-auto">
                                <table className="min-w-full divide-y divide-gray-200">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Client</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contact</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ultimul Serviciu</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ExpirƒÉ</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ac»õiuni</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white divide-y divide-gray-200">
                                        {clients.map(client => {
                                            const isExpiringSoon = new Date(client.expiresAt) <= new Date(Date.now() + 30*24*60*60*1000);
                                            return (
                                                <tr key={client.id} className="hover:bg-gray-50">
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        <div>
                                                            <div className="text-sm font-medium text-gray-900">{client.name}</div>
                                                            <div className="text-sm text-gray-500">{client.address}</div>
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        <div className="text-sm text-gray-900">{client.phone}</div>
                                                        <div className="text-sm text-gray-500">{client.email}</div>
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        <div className="text-sm text-gray-900">{SERVICES[client.serviceType]?.name}</div>
                                                        <div className="text-sm text-gray-500">{client.lastService}</div>
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                                                            isExpiringSoon 
                                                                ? 'bg-red-100 text-red-800' 
                                                                : 'bg-green-100 text-green-800'
                                                        }`}>
                                                            {client.expiresAt}
                                                        </span>
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                                        <button 
                                                            onClick={() => {
                                                                setSelectedClient(client);
                                                                setAssignmentModal(true);
                                                            }}
                                                            className="text-blue-600 hover:text-blue-900"
                                                        >
                                                            üìã AsigneazƒÉ
                                                        </button>
                                                        <button 
                                                            onClick={() => sendQuickSMS(client, 'reminder')}
                                                            className="text-green-600 hover:text-green-900"
                                                        >
                                                            üì± SMS
                                                        </button>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                );
            }

            function AssignmentsTab() {
                return (
                    <div className="space-y-6">
                        <div className="bg-white rounded-lg shadow">
                            <div className="px-6 py-4 border-b border-gray-200">
                                <h3 className="text-lg font-semibold text-gray-800">üìã Toate AsignƒÉrile</h3>
                            </div>
                            <div className="overflow-x-auto">
                                <table className="min-w-full divide-y divide-gray-200">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Client</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Serviciu</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">LucrƒÉtor</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data ProgramatƒÉ</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ac»õiuni</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white divide-y divide-gray-200">
                                        {assignments.map(assignment => {
                                            const client = getClientById(assignment.clientId);
                                            const worker = getWorkerById(assignment.workerId);
                                            return (
                                                <tr key={assignment.id} className="hover:bg-gray-50">
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        <div className="text-sm font-medium text-gray-900">{client?.name}</div>
                                                        <div className="text-sm text-gray-500">{client?.address}</div>
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        <div className="text-sm text-gray-900">{SERVICES[assignment.serviceType]?.name}</div>
                                                        <div className="text-sm text-gray-500">{SERVICES[assignment.serviceType]?.price} RON</div>
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{worker?.name}</td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{assignment.scheduledDate}</td>
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                                                            assignment.status === 'completed' ? 'bg-green-100 text-green-800' :
                                                            assignment.status === 'in_progress' ? 'bg-yellow-100 text-yellow-800' :
                                                            'bg-blue-100 text-blue-800'
                                                        }`}>
                                                            {assignment.status === 'assigned' ? 'Asignat' :
                                                             assignment.status === 'in_progress' ? '√én progres' : 'Finalizat'}
                                                        </span>
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                        <button 
                                                            onClick={() => sendQuickSMS(client, 'appointment')}
                                                            className="text-blue-600 hover:text-blue-900 mr-3"
                                                        >
                                                            üì± SMS Client
                                                        </button>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                );
            }

            function MyWorkTab() {
                const myAssignments = getWorkerAssignments(userProfile?.workerId);
                const pendingWork = myAssignments.filter(a => a.status !== 'completed');

                return (
                    <div className="space-y-6">
                        <div className="bg-white rounded-lg shadow">
                            <div className="px-6 py-4 border-b border-gray-200">
                                <h3 className="text-lg font-semibold text-gray-800">üîß LucrƒÉrile Mele ({pendingWork.length} active)</h3>
                            </div>
                            <div className="p-6 space-y-4">
                                {pendingWork.length === 0 ? (
                                    <div className="text-center py-8 text-gray-500">
                                        <div className="text-4xl mb-4">‚úÖ</div>
                                        <p>Nu ave»õi lucrƒÉri active momentan</p>
                                    </div>
                                ) : (
                                    pendingWork.map(assignment => {
                                        const client = getClientById(assignment.clientId);
                                        return (
                                            <div key={assignment.id} className="border border-gray-200 rounded-lg p-4">
                                                <div className="flex justify-between items-start mb-4">
                                                    <div>
                                                        <h4 className="font-semibold text-lg text-gray-900">{client?.name}</h4>
                                                        <p className="text-gray-600">{client?.address}</p>
                                                        <p className="text-sm text-gray-500">üìû {client?.phone}</p>
                                                    </div>
                                                    <span className={`px-3 py-1 text-sm font-semibold rounded-full ${
                                                        assignment.status === 'in_progress' ? 'bg-yellow-100 text-yellow-800' : 'bg-blue-100 text-blue-800'
                                                    }`}>
                                                        {assignment.status === 'assigned' ? 'Asignat' : '√én progres'}
                                                    </span>
                                                </div>
                                                
                                                <div className="bg-gray-50 rounded p-3 mb-4">
                                                    <p className="font-medium text-gray-700">üìã {SERVICES[assignment.serviceType]?.name}</p>
                                                    <p className="text-sm text-gray-600">üìÖ Programat: {assignment.scheduledDate}</p>
                                                    <p className="text-sm text-gray-600">üí∞ Tarif: {SERVICES[assignment.serviceType]?.price} RON</p>
                                                    {assignment.notes && (
                                                        <p className="text-sm text-gray-600 mt-2">üìù {assignment.notes}</p>
                                                    )}
                                                </div>

                                                <div className="flex flex-wrap gap-2">
                                                    {assignment.status === 'assigned' && (
                                                        <button 
                                                            onClick={() => updateAssignmentStatus(assignment.id, 'in_progress')}
                                                            className="px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 transition-colors"
                                                        >
                                                            üöÄ √éncepe Lucrarea
                                                        </button>
                                                    )}
                                                    
                                                    {assignment.status === 'in_progress' && (
                                                        <>
                                                            <button 
                                                                onClick={() => {
                                                                    setSelectedAssignment(assignment);
                                                                    setDocumentModal(true);
                                                                }}
                                                                className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"
                                                            >
                                                                üìÑ √éncarcƒÉ Document
                                                            </button>
                                                            <button 
                                                                onClick={() => updateAssignmentStatus(assignment.id, 'completed')}
                                                                className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors"
                                                            >
                                                                ‚úÖ FinalizeazƒÉ
                                                            </button>
                                                        </>
                                                    )}
                                                    
                                                    <button 
                                                        onClick={() => sendQuickSMS(client, 'appointment')}
                                                        className="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors"
                                                    >
                                                        üì± SMS Client
                                                    </button>
                                                </div>

                                                {assignment.documents && assignment.documents.length > 0 && (
                                                    <div className="mt-4 pt-4 border-t border-gray-200">
                                                        <p className="text-sm font-medium text-gray-700 mb-2">üìé Documente √ÆncƒÉrcate:</p>
                                                        <div className="space-y-1">
                                                            {assignment.documents.map((doc, index) => (
                                                                <div key={index} className="text-sm text-gray-600 bg-gray-100 p-2 rounded">
                                                                    {doc.type}: {doc.name}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            function CompletedTab() {
                const myAssignments = getWorkerAssignments(userProfile?.workerId);
                const completedWork = myAssignments.filter(a => a.status === 'completed');

                return (
                    <div className="space-y-6">
                        <div className="bg-white rounded-lg shadow">
                            <div className="px-6 py-4 border-b border-gray-200">
                                <h3 className="text-lg font-semibold text-gray-800">‚úÖ LucrƒÉri Finalizate ({completedWork.length})</h3>
                            </div>
                            <div className="overflow-x-auto">
                                <table className="min-w-full divide-y divide-gray-200">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Client</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Serviciu</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Documente</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white divide-y divide-gray-200">
                                        {completedWork.map(assignment => {
                                            const client = getClientById(assignment.clientId);
                                            return (
                                                <tr key={assignment.id} className="hover:bg-gray-50">
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        <div className="text-sm font-medium text-gray-900">{client?.name}</div>
                                                        <div className="text-sm text-gray-500">{client?.phone}</div>
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        <div className="text-sm text-gray-900">{SERVICES[assignment.serviceType]?.name}</div>
                                                        <div className="text-sm text-gray-500">{SERVICES[assignment.serviceType]?.price} RON</div>
                                                    </td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{assignment.scheduledDate}</td>
                                                    <td className="px-6 py-4 whitespace-nowrap">
                                                        <span className="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                                            {assignment.documents?.length || 0} documente
                                                        </span>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                );
            }

            function WorkersTab() {
                return (
                    <div className="space-y-6">
                        <div className="bg-white rounded-lg shadow">
                            <div className="px-6 py-4 border-b border-gray-200">
                                <h3 className="text-lg font-semibold text-gray-800">üë®‚Äçüîß Gestionare LucrƒÉtori</h3>
                            </div>
                            <div className="p-6">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {workers.map(worker => {
                                        const workerAssignments = getWorkerAssignments(worker.id);
                                        const activeAssignments = workerAssignments.filter(a => a.status !== 'completed');
                                        const completedAssignments = workerAssignments.filter(a => a.status === 'completed');
                                        
                                        return (
                                            <div key={worker.id} className="border border-gray-200 rounded-lg p-4">
                                                <div className="flex items-center mb-4">
                                                    <div className="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                                                        <span className="text-xl">üë®‚Äçüîß</span>
                                                    </div>
                                                    <div>
                                                        <h4 className="font-semibold text-lg text-gray-900">{worker.name}</h4>
                                                        <p className="text-gray-600">Zona: {worker.zone}</p>
                                                        <p className="text-sm text-gray-500">{worker.phone}</p>
                                                    </div>
                                                </div>
                                                
                                                <div className="grid grid-cols-2 gap-4 mb-4">
                                                    <div className="bg-yellow-50 p-3 rounded">
                                                        <p className="text-sm font-medium text-yellow-800">LucrƒÉri Active</p>
                                                        <p className="text-2xl font-bold text-yellow-600">{activeAssignments.length}</p>
                                                    </div>
                                                    <div className="bg-green-50 p-3 rounded">
                                                        <p className="text-sm font-medium text-green-800">Finalizate</p>
                                                        <p className="text-2xl font-bold text-green-600">{completedAssignments.length}</p>
                                                    </div>
                                                </div>

                                                {activeAssignments.length > 0 && (
                                                    <div>
                                                        <p className="text-sm font-medium text-gray-700 mb-2">LucrƒÉri curente:</p>
                                                        <div className="space-y-2">
                                                            {activeAssignments.slice(0, 2).map(assignment => {
                                                                const client = getClientById(assignment.clientId);
                                                                return (
                                                                    <div key={assignment.id} className="text-sm bg-gray-50 p-2 rounded">
                                                                        <span className="font-medium">{client?.name}</span>
                                                                        <span className="text-gray-500 ml-2">- {assignment.scheduledDate}</span>
                                                                    </div>
                                                                );
                                                            })}
                                                            {activeAssignments.length > 2 && (
                                                                <p className="text-sm text-gray-500">+{activeAssignments.length - 2} mai multe...</p>
                                                            )}
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            function ReportsTab() {
                const totalRevenue = assignments
                    .filter(a => a.status === 'completed')
                    .reduce((sum, a) => sum + (SERVICES[a.serviceType]?.price || 0), 0);

                const serviceStats = Object.keys(SERVICES).map(serviceType => {
                    const assignmentList = assignments.filter(a => a.serviceType === serviceType);
                    const completed = assignmentList.filter(a => a.status === 'completed');
                    const revenue = completed.reduce((sum, a) => sum + (SERVICES[serviceType]?.price || 0), 0);
                    
                    return {
                        service: SERVICES[serviceType].name,
                        total: assignmentList.length,
                        completed: completed.length,
                        revenue
                    };
                }).filter(stat => stat.total > 0);

                return (
                    <div className="space-y-6">
                        {/* Revenue Overview */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div className="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-lg shadow">
                                <h3 className="text-lg font-semibold mb-2">üí∞ Venituri Totale</h3>
                                <p className="text-3xl font-bold">{totalRevenue.toLocaleString()} RON</p>
                                <p className="text-green-100 text-sm">Din lucrƒÉri finalizate</p>
                            </div>
                            
                            <div className="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-lg shadow">
                                <h3 className="text-lg font-semibold mb-2">üìã LucrƒÉri Totale</h3>
                                <p className="text-3xl font-bold">{assignments.length}</p>
                                <p className="text-blue-100 text-sm">Toate asignƒÉrile</p>
                            </div>
                            
                            <div className="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-lg shadow">
                                <h3 className="text-lg font-semibold mb-2">‚≠ê Rata Finalizare</h3>
                                <p className="text-3xl font-bold">
                                    {assignments.length > 0 
                                        ? Math.round((assignments.filter(a => a.status === 'completed').length / assignments.length) * 100)
                                        : 0}%
                                </p>
                                <p className="text-purple-100 text-sm">LucrƒÉri finalizate</p>
                            </div>
                        </div>

                        {/* Services Report */}
                        <div className="bg-white rounded-lg shadow">
                            <div className="px-6 py-4 border-b border-gray-200">
                                <h3 className="text-lg font-semibold text-gray-800">üìä Raport pe Servicii</h3>
                            </div>
                            <div className="overflow-x-auto">
                                <table className="min-w-full divide-y divide-gray-200">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Serviciu</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total AsignƒÉri</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Finalizate</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Venituri (RON)</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rata Finalizare</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white divide-y divide-gray-200">
                                        {serviceStats.map((stat, index) => (
                                            <tr key={index} className="hover:bg-gray-50">
                                                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{stat.service}</td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{stat.total}</td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{stat.completed}</td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900">{stat.revenue.toLocaleString()}</td>
                                                <td className="px-6 py-4 whitespace-nowrap">
                                                    <div className="flex items-center">
                                                        <div className="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                                            <div 
                                                                className="bg-blue-500 h-2 rounded-full" 
                                                                style={{width: `${stat.total > 0 ? (stat.completed / stat.total) * 100 : 0}%`}}
                                                            ></div>
                                                        </div>
                                                        <span className="text-sm text-gray-600">
                                                            {stat.total > 0 ? Math.round((stat.completed / stat.total) * 100) : 0}%
                                                        </span>
                                                    </div>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                );
            }

            const renderActiveTab = () => {
                if (userRole === 'admin') {
                    switch(activeTab) {
                        case 'dashboard': return <Dashboard />;
                        case 'clients': return <ClientsTab />;
                        case 'assignments': return <AssignmentsTab />;
                        case 'workers': return <WorkersTab />;
                        case 'reports': return <ReportsTab />;
                        default: return <Dashboard />;
                    }
                } else {
                    switch(activeTab) {
                        case 'dashboard': return <Dashboard />;
                        case 'my-work': return <MyWorkTab />;
                        case 'completed': return <CompletedTab />;
                        default: return <Dashboard />;
                    }
                }
            };

            return (
                <div className="min-h-screen bg-gray-100">
                    {!user ? (
                        <LoginForm onLogin={handleLogin} onRegister={handleRegister} />
                    ) : (
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <Header />
                            <Navigation />
                            {renderActiveTab()}
                            
                            {/* PWA Install Prompt */}
                            {showInstallPrompt && (
                                <div className="fixed bottom-4 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-lg max-w-sm slide-in z-50">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <p className="font-semibold">InstaleazƒÉ aplica»õia</p>
                                            <p className="text-sm opacity-90">Pentru acces rapid »ôi offline</p>
                                        </div>
                                        <div className="flex gap-2 ml-4">
                                            <button 
                                                onClick={handleInstallApp}
                                                className="bg-white text-blue-600 px-3 py-1 rounded text-sm font-semibold"
                                            >
                                                InstaleazƒÉ
                                            </button>
                                            <button 
                                                onClick={() => setShowInstallPrompt(false)}
                                                className="text-white opacity-70 hover:opacity-100"
                                            >
                                                ‚úï
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            {/* Sync Status Indicator */}
                            <div className="fixed bottom-4 left-4 flex items-center gap-2 bg-white px-3 py-2 rounded-lg shadow-lg z-40">
                                <div className={`w-2 h-2 rounded-full ${
                                    syncStatus === 'synced' ? 'bg-green-500' : 
                                    syncStatus === 'syncing' ? 'bg-yellow-500 pulse' : 'bg-red-500'
                                }`}></div>
                                <span className="text-sm text-gray-600">
                                    {syncStatus === 'synced' ? 'üî• Firebase' : 
                                     syncStatus === 'syncing' ? 'Se sincronizeazƒÉ...' : 'Offline'}
                                </span>
                            </div>

                            {/* SMS Modal */}
                            {smsModal && (
                                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                    <div className="bg-white rounded-lg p-6 w-full max-w-md mx-4">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="text-lg font-semibold text-gray-800">üì± Trimite SMS</h3>
                                            <button 
                                                onClick={() => setSmsModal(false)}
                                                className="text-gray-500 hover:text-gray-700 text-xl"
                                            >
                                                √ó
                                            </button>
                                        </div>
                                        
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">NumƒÉr telefon</label>
                                                <input
                                                    type="tel"
                                                    value={smsRecipient}
                                                    onChange={(e) => setSmsRecipient(e.target.value)}
                                                    placeholder="07xxxxxxxx"
                                                    className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                />
                                            </div>

                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Mesaj</label>
                                                <textarea
                                                    value={smsMessage}
                                                    onChange={(e) => setSmsMessage(e.target.value)}
                                                    placeholder="Mesajul SMS..."
                                                    rows={5}
                                                    maxLength={160}
                                                    className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                />
                                                <div className="text-right mt-1">
                                                    <span className="text-xs text-gray-500">{smsMessage.length}/160 caractere</span>
                                                </div>
                                            </div>

                                            <div className="flex gap-3">
                                                <button
                                                    onClick={() => setSmsModal(false)}
                                                    className="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                                                >
                                                    AnuleazƒÉ
                                                </button>
                                                <button
                                                    onClick={sendSMS}
                                                    disabled={!smsRecipient || !smsMessage.trim()}
                                                    className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
                                                >
                                                    üì§ Trimite SMS
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Assignment Modal */}
                            {assignmentModal && selectedClient && (
                                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                    <div className="bg-white rounded-lg p-6 w-full max-w-md mx-4">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="text-lg font-semibold text-gray-800">üìã AsigneazƒÉ Lucrare</h3>
                                            <button 
                                                onClick={() => setAssignmentModal(false)}
                                                className="text-gray-500 hover:text-gray-700 text-xl"
                                            >
                                                √ó
                                            </button>
                                        </div>
                                        
                                        <form onSubmit={(e) => {
                                            e.preventDefault();
                                            const formData = new FormData(e.target);
                                            assignWork(
                                                selectedClient,
                                                formData.get('serviceType'),
                                                formData.get('scheduledDate'),
                                                formData.get('notes')
                                            );
                                        }} className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Client</label>
                                                <input
                                                    type="text"
                                                    value={selectedClient.name}
                                                    disabled
                                                    className="w-full border border-gray-300 rounded-lg px-3 py-2 bg-gray-100"
                                                />
                                            </div>

                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Serviciu</label>
                                                <select
                                                    name="serviceType"
                                                    required
                                                    className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500"
                                                >
                                                    {Object.entries(SERVICES).map(([key, service]) => (
                                                        <option key={key} value={key}>
                                                            {service.name} - {service.price > 0 ? `${service.price} RON` : 'Tarif personalizat'}
                                                        </option>
                                                    ))}
                                                </select>
                                            </div>

                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Data programatƒÉ</label>
                                                <input
                                                    type="date"
                                                    name="scheduledDate"
                                                    required
                                                    className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500"
                                                />
                                            </div>

                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Observa»õii</label>
                                                <textarea
                                                    name="notes"
                                                    placeholder="Observa»õii pentru lucrƒÉtor..."
                                                    rows={3}
                                                    className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500"
                                                />
                                            </div>

                                            <div className="flex gap-3">
                                                <button
                                                    type="button"
                                                    onClick={() => setAssignmentModal(false)}
                                                    className="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                                                >
                                                    AnuleazƒÉ
                                                </button>
                                                <button
                                                    type="submit"
                                                    className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                                                >
                                                    üìã AsigneazƒÉ
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            )}

                            {/* Document Upload Modal */}
                            {documentModal && selectedAssignment && (
                                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                    <div className="bg-white rounded-lg p-6 w-full max-w-md mx-4">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="text-lg font-semibold text-gray-800">üìÑ √éncarcƒÉ Document</h3>
                                            <button 
                                                onClick={() => setDocumentModal(false)}
                                                className="text-gray-500 hover:text-gray-700 text-xl"
                                            >
                                                √ó
                                            </button>
                                        </div>
                                        
                                        <div className="space-y-4">
                                            <p className="text-sm text-gray-600">
                                                Client: <span className="font-medium">{getClientById(selectedAssignment.clientId)?.name}</span>
                                            </p>
                                            
                                            <div className="grid grid-cols-1 gap-3">
                                                <button
                                                    onClick={() => uploadDocument(selectedAssignment.id, 'Certificat Conformitate')}
                                                    className="p-4 text-left border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors"
                                                >
                                                    <div className="font-medium">üìú Certificat Conformitate</div>
                                                    <div className="text-sm text-gray-500">Document principal de conformitate</div>
                                                </button>
                                                
                                                <button
                                                    onClick={() => uploadDocument(selectedAssignment.id, 'Poze Instalatie')}
                                                    className="p-4 text-left border border-gray-200 rounded-lg hover:bg-green-50 hover:border-green-300 transition-colors"
                                                >
                                                    <div className="font-medium">üì∏ Poze Instala»õie</div>
                                                    <div className="text-sm text-gray-500">Fotografii √Ænainte/dupƒÉ</div>
                                                </button>
                                                
                                                <button
                                                    onClick={() => uploadDocument(selectedAssignment.id, 'Raport Tehnic')}
                                                    className="p-4 text-left border border-gray-200 rounded-lg hover:bg-yellow-50 hover:border-yellow-300 transition-colors"
                                                >
                                                    <div className="font-medium">üìã Raport Tehnic</div>
                                                    <div className="text-sm text-gray-500">Detalii tehnice verificƒÉri</div>
                                                </button>
                                            </div>

                                            <button
                                                onClick={() => setDocumentModal(false)}
                                                className="w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                                            >
                                                √énchide
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        // Render the application
        ReactDOM.render(<AdInstalGazApp />, document.getElementById('root'));
    </script>

    <!-- Service Worker Registration -->
    <script>
        // Create service worker as a blob URL
        const swCode = `
            const CACHE_NAME = 'adinstalgazsrl-firebase-v1';
            const urlsToCache = [
                '/',
                '/offline.html'
            ];

            self.addEventListener('install', event => {
                event.waitUntil(
                    caches.open(CACHE_NAME)
                        .then(cache => {
                            return cache.addAll(urlsToCache.filter(url => !url.startsWith('http')));
                        })
                );
            });

            self.addEventListener('fetch', event => {
                event.respondWith(
                    caches.match(event.request)
                        .then(response => {
                            if (response) {
                                return response;
                            }
                            
                            const fetchRequest = event.request.clone();
                            
                            return fetch(fetchRequest).then(response => {
                                if (!response || response.status !== 200 || response.type !== 'basic') {
                                    return response;
                                }
                                
                                const responseToCache = response.clone();
                                
                                caches.open(CACHE_NAME)
                                    .then(cache => {
                                        cache.put(event.request, responseToCache);
                                    });
                                
                                return response;
                            }).catch(() => {
                                if (event.request.destination === 'document') {
                                    return new Response('<h1>Offline</h1><p>Aplica»õia func»õioneazƒÉ offline cu Firebase!</p>', {
                                        headers: { 'Content-Type': 'text/html' }
                                    });
                                }
                            });
                        })
                );
            });

            self.addEventListener('activate', event => {
                event.waitUntil(
                    caches.keys().then(cacheNames => {
                        return Promise.all(
                            cacheNames.map(cacheName => {
                                if (cacheName !== CACHE_NAME) {
                                    return caches.delete(cacheName);
                                }
                            })
                        );
                    })
                );
            });

            self.addEventListener('sync', event => {
                if (event.tag === 'background-sync') {
                    event.waitUntil(
                        self.clients.matchAll().then(clients => {
                            clients.forEach(client => {
                                client.postMessage({
                                    type: 'SYNC_DATA'
                                });
                            });
                        })
                    );
                }
            });
        `;
        
        // Register service worker with blob URL
        if ('serviceWorker' in navigator) {
            const swBlob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(swBlob);
            
            navigator.serviceWorker.register(swUrl)
                .then(registration => {
                    console.log('Service Worker registered successfully:', registration);
                })
                .catch(error => {
                    console.log('Service Worker registration failed:', error);
                });
        }
    </script>
</body>
</html>
