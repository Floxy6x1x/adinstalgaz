<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdInstalGaz - Sistem Management</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #f4f6f9; }
        
        .login-screen { display: flex; min-height: 100vh; align-items: center; justify-content: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .login-card { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); width: 100%; max-width: 400px; }
        .login-title { text-align: center; font-size: 2.2em; color: #333; margin-bottom: 10px; font-weight: 600; }
        .login-subtitle { text-align: center; color: #666; margin-bottom: 30px; }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #555; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px; transition: border-color 0.3s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #667eea; }
        .form-group input[readonly] { background: #f8f9fa; color: #666; }
        
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s; margin-right: 10px; margin-bottom: 10px; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5a6fd8; transform: translateY(-1px); }
        .btn-success { background: #27ae60; color: white; }
        .btn-success:hover { background: #219a52; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-danger:hover { background: #c0392b; }
        .btn-warning { background: #f39c12; color: white; }
        .btn-warning:hover { background: #e67e22; }
        .btn-secondary { background: #95a5a6; color: white; }
        .btn-secondary:hover { background: #7f8c8d; }
        .btn-login { width: 100%; padding: 14px; background: #667eea; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 500; cursor: pointer; }
        .btn-login:hover { background: #5a6fd8; }
        
        .app-container { display: none; padding: 20px; max-width: 1400px; margin: 0 auto; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .header h1 { font-size: 2.2em; font-weight: 600; }
        .header p { opacity: 0.9; margin-top: 5px; }
        .user-info { display: flex; align-items: center; gap: 15px; }
        .user-avatar { width: 45px; height: 45px; border-radius: 50%; background: rgba(255,255,255,0.2); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px; }
        .logout-btn { padding: 8px 16px; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; }
        .logout-btn:hover { background: rgba(255,255,255,0.3); }
        
        .nav-tabs { display: flex; gap: 5px; margin-bottom: 25px; background: white; padding: 8px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow-x: auto; }
        .nav-tab { padding: 12px 20px; background: transparent; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; color: #666; transition: all 0.3s; white-space: nowrap; }
        .nav-tab:hover { background: #f8f9fa; color: #333; }
        .nav-tab.active { background: #667eea; color: white; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3); }
        
        .section { display: none; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .section.active { display: block; }
        .section h2 { color: #333; margin-bottom: 25px; font-size: 1.8em; font-weight: 600; }
        .section h3 { color: #555; margin: 25px 0 15px 0; font-size: 1.3em; font-weight: 500; }
        
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .apartment-fields { display: none; }
        .apartment-fields.show { display: contents; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; border-left: 4px solid #667eea; transition: transform 0.3s; }
        .stat-card:hover { transform: translateY(-3px); }
        .stat-card.warning { border-left-color: #f39c12; }
        .stat-card.success { border-left-color: #27ae60; }
        .stat-card.danger { border-left-color: #e74c3c; }
        .stat-number { font-size: 2.8em; font-weight: bold; color: #333; margin-bottom: 8px; }
        .stat-label { color: #666; font-size: 0.95em; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        th { background: #f8f9fa; padding: 15px; text-align: left; font-weight: 600; color: #555; border-bottom: 2px solid #e1e5e9; }
        td { padding: 12px 15px; border-bottom: 1px solid #e1e5e9; }
        tr:hover { background: #f8f9fa; }
        
        .badge { padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 500; display: inline-block; }
        .badge-success { background: #d4edda; color: #155724; }
        .badge-warning { background: #fff3cd; color: #856404; }
        .badge-danger { background: #f8d7da; color: #721c24; }
        .badge-info { background: #d1ecf1; color: #0c5460; }
        
        .alert { padding: 15px; margin-bottom: 20px; border-radius: 8px; border-left: 4px solid; }
        .alert-success { background: #d4edda; color: #155724; border-left-color: #28a745; }
        .alert-warning { background: #fff3cd; color: #856404; border-left-color: #ffc107; }
        .alert-danger { background: #f8d7da; color: #721c24; border-left-color: #dc3545; }
        .alert-info { background: #d1ecf1; color: #0c5460; border-left-color: #17a2b8; }
        
        .notification { position: fixed; top: 20px; right: 20px; padding: 15px 20px; border-radius: 8px; color: white; font-weight: 500; z-index: 1000; transform: translateX(400px); transition: transform 0.3s; max-width: 350px; }
        .notification.show { transform: translateX(0); }
        .notification.success { background: #27ae60; }
        .notification.error { background: #e74c3c; }
        .notification.warning { background: #f39c12; }
        .notification.info { background: #3498db; }
        
        .search-box { margin-bottom: 20px; }
        .search-box input { padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; width: 300px; font-size: 14px; }
        .search-box input:focus { outline: none; border-color: #667eea; }
        
        .credentials-box { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px; font-size: 13px; color: #666; border-left: 4px solid #17a2b8; }
        
        @media (max-width: 768px) {
            .app-container { padding: 10px; }
            .header { flex-direction: column; gap: 15px; text-align: center; }
            .form-grid { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: 1fr; }
            .nav-tabs { flex-wrap: wrap; }
            table { font-size: 14px; }
            th, td { padding: 8px; }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-card">
            <div class="login-title">AdInstalGaz</div>
            <div class="login-subtitle">Sistem Management Profesional</div>
            
            <form onsubmit="login(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" required placeholder="florin.iordache@adinstalgaz.ro">
                </div>
                <div class="form-group">
                    <label>ParolÄƒ</label>
                    <input type="password" id="loginPassword" required placeholder="IntroduceÈ›i parola">
                </div>
                <button type="submit" class="btn-login">Conectare</button>
            </form>
            
            <div class="credentials-box">
                <strong>ðŸ“§ Conturi de testare:</strong><br>
                <code>florin.iordache@adinstalgaz.ro</code> â†’ <code>AdInstalGaz2025!</code><br>
                <code>admin@adinstalgaz.ro</code> â†’ <code>Admin123!</code><br>
                <code>lucrator@adinstalgaz.ro</code> â†’ <code>Lucrator123!</code>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="app-container">
        <div class="header">
            <div>
                <h1>AdInstalGaz</h1>
                <p>Sistem Complet de Management Servicii Gaz</p>
            </div>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">F</div>
                <div>
                    <div style="font-weight: 600;" id="userName">Florin Iordache</div>
                    <div style="font-size: 13px; opacity: 0.9;">Administrator</div>
                </div>
                <button class="logout-btn" onclick="logout()">IeÈ™ire</button>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('dashboard')">Dashboard</button>
            <button class="nav-tab" onclick="showSection('clienti')">ClienÈ›i</button>
            <button class="nav-tab" onclick="showSection('servicii')">Servicii</button>
            <button class="nav-tab" onclick="showSection('lucrari')">LucrÄƒri</button>
            <button class="nav-tab" onclick="showSection('rapoarte')">Rapoarte</button>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="section active">
            <h2>Dashboard</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalClienti">0</div>
                    <div class="stat-label">Total ClienÈ›i</div>
                </div>
                <div class="stat-card success">
                    <div class="stat-number" id="totalServicii">0</div>
                    <div class="stat-label">Total Servicii</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-number" id="expirariUrgente">0</div>
                    <div class="stat-label">ExpirÄƒri Ã®n 30 zile</div>
                </div>
                <div class="stat-card danger">
                    <div class="stat-number" id="totalLucrari">0</div>
                    <div class="stat-label">Total LucrÄƒri</div>
                </div>
            </div>
            <div id="alerteExpirari"></div>
        </div>

        <!-- ClienÈ›i -->
        <div id="clienti" class="section">
            <h2>Gestionare ClienÈ›i</h2>
            
            <h3>AdaugÄƒ Client Nou</h3>
            <form id="formClient" onsubmit="addClient(event)">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nume Complet *</label>
                        <input type="text" id="numeClient" required placeholder="Ex: Ion Popescu">
                    </div>
                    <div class="form-group">
                        <label>Telefon *</label>
                        <input type="tel" id="telefonClient" required placeholder="Ex: 0721234567">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="emailClient" placeholder="client@email.com">
                    </div>
                    <div class="form-group">
                        <label>JudeÈ› *</label>
                        <select id="judetClient" required onchange="updateCities()">
                            <option value="">SelecteazÄƒ judeÈ›ul</option>
                            <option value="Teleorman">Teleorman</option>
                            <option value="Giurgiu">Giurgiu</option>
                            <option value="ArgeÈ™">ArgeÈ™</option>
                            <option value="Olt">Olt</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>OraÈ™ *</label>
                        <select id="orasClient" required>
                            <option value="">SelecteazÄƒ judeÈ›ul mai Ã®ntÃ¢i</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Strada *</label>
                        <input type="text" id="stradaClient" required placeholder="Ex: Str. LibertÄƒÈ›ii">
                    </div>
                    <div class="form-group">
                        <label>NumÄƒrul *</label>
                        <input type="text" id="numarClient" required placeholder="Ex: 25A">
                    </div>
                    <div class="form-group">
                        <label>Tip LocuinÈ›Äƒ *</label>
                        <select id="tipLocuinta" required onchange="toggleApartmentFields()">
                            <option value="">SelecteazÄƒ tipul</option>
                            <option value="casa">CasÄƒ</option>
                            <option value="apartament">Apartament/Bloc</option>
                        </select>
                    </div>
                    <div class="apartment-fields" id="apartmentFields">
                        <div class="form-group">
                            <label>Bloc</label>
                            <input type="text" id="blocClient" placeholder="Ex: A3">
                        </div>
                        <div class="form-group">
                            <label>Scara</label>
                            <input type="text" id="scaraClient" placeholder="Ex: B">
                        </div>
                        <div class="form-group">
                            <label>Etaj</label>
                            <input type="text" id="etajClient" placeholder="Ex: 4">
                        </div>
                        <div class="form-group">
                            <label>Apartament</label>
                            <input type="text" id="apartamentClient" placeholder="Ex: 15">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>ObservaÈ›ii</label>
                    <textarea id="observatiiClient" placeholder="Note suplimentare despre client" style="height: 80px;"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">SalveazÄƒ Client</button>
                <button type="button" class="btn btn-secondary" onclick="resetClientForm()">Reset</button>
            </form>

            <h3>Lista ClienÈ›i</h3>
            <div class="search-box">
                <input type="text" id="searchClienti" placeholder="CautÄƒ dupÄƒ nume sau telefon..." onkeyup="searchClients()">
            </div>
            <table id="tabelClienti">
                <thead>
                    <tr>
                        <th>Nume</th>
                        <th>Telefon</th>
                        <th>Email</th>
                        <th>AdresÄƒ CompletÄƒ</th>
                        <th>Servicii</th>
                        <th>AcÈ›iuni</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Servicii -->
        <div id="servicii" class="section">
            <h2>Gestionare Servicii</h2>
            
            <h3>AdaugÄƒ Serviciu Nou</h3>
            <form id="formServiciu" onsubmit="addService(event)">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Client *</label>
                        <select id="clientServiciu" required>
                            <option value="">SelecteazÄƒ clientul</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tip Serviciu *</label>
                        <select id="tipServiciu" required onchange="calculateExpiration()">
                            <option value="">SelecteazÄƒ tipul serviciului</option>
                            <option value="Verificare InstalaÈ›ie Gaz" data-years="2" data-price="150">Verificare InstalaÈ›ie Gaz (2 ani) - 150 Lei</option>
                            <option value="Revizie InstalaÈ›ie Gaz" data-years="1" data-price="250">Revizie InstalaÈ›ie Gaz (1 an) - 250 Lei</option>
                            <option value="Verificare CentralÄƒ" data-years="2" data-price="150">Verificare CentralÄƒ (2 ani) - 150 Lei</option>
                            <option value="InstalaÈ›ii Gaz + CentralÄƒ" data-years="2" data-price="300">InstalaÈ›ii Gaz + CentralÄƒ (2 ani) - 300 Lei</option>
                            <option value="Servicii de UrgenÈ›Äƒ" data-years="0" data-price="0">Servicii de UrgenÈ›Äƒ - PreÈ› variabil</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Data ÃŽnceput *</label>
                        <input type="date" id="dataInceput" required onchange="calculateExpiration()">
                    </div>
                    <div class="form-group">
                        <label>Data Expirare *</label>
                        <input type="date" id="dataExpirare" required readonly>
                    </div>
                    <div class="form-group">
                        <label>PreÈ› (Lei) *</label>
                        <input type="number" id="pretServiciu" required min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>ObservaÈ›ii</label>
                        <textarea id="observatiiServiciu" placeholder="Detalii despre serviciu"></textarea>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">SalveazÄƒ Serviciu</button>
                <button type="button" class="btn btn-secondary" onclick="resetServiceForm()">Reset</button>
            </form>

            <h3>Lista Servicii</h3>
            <div class="search-box">
                <input type="text" id="searchServicii" placeholder="CautÄƒ servicii..." onkeyup="searchServices()">
            </div>
            <table id="tabelServicii">
                <thead>
                    <tr>
                        <th>Client</th>
                        <th>Tip Serviciu</th>
                        <th>Data ÃŽnceput</th>
                        <th>Data Expirare</th>
                        <th>PreÈ›</th>
                        <th>Status</th>
                        <th>Zile RÄƒmase</th>
                        <th>AcÈ›iuni</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- LucrÄƒri -->
        <div id="lucrari" class="section">
            <h2>Gestionare LucrÄƒri</h2>
            
            <h3>AdaugÄƒ Lucrare NouÄƒ</h3>
            <form id="formLucrare" onsubmit="addWork(event)">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Client *</label>
                        <select id="clientLucrare" required>
                            <option value="">SelecteazÄƒ clientul</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tip Lucrare *</label>
                        <select id="tipLucrare" required>
                            <option value="">SelecteazÄƒ tipul lucrÄƒrii</option>
                            <option value="Verificare InstalaÈ›ie Gaz">Verificare InstalaÈ›ie Gaz</option>
                            <option value="Revizie InstalaÈ›ie Gaz">Revizie InstalaÈ›ie Gaz</option>
                            <option value="Verificare CentralÄƒ">Verificare CentralÄƒ</option>
                            <option value="InstalaÈ›ii Gaz + CentralÄƒ">InstalaÈ›ii Gaz + CentralÄƒ</option>
                            <option value="ReparaÈ›ie UrgentÄƒ">ReparaÈ›ie UrgentÄƒ</option>
                            <option value="ConsultanÈ›Äƒ">ConsultanÈ›Äƒ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Data Programare *</label>
                        <input type="date" id="dataProgramare" required>
                    </div>
                    <div class="form-group">
                        <label>Ora Programare</label>
                        <input type="time" id="oraProgramare">
                    </div>
                    <div class="form-group">
                        <label>PreÈ› (Lei) *</label>
                        <input type="number" id="pretLucrare" required min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="statusLucrare">
                            <option value="programata">ProgramatÄƒ</option>
                            <option value="in-progres">ÃŽn Progres</option>
                            <option value="finalizata">FinalizatÄƒ</option>
                            <option value="anulata">AnulatÄƒ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ObservaÈ›ii</label>
                        <textarea id="observatiiLucrare" placeholder="Detalii despre lucrare"></textarea>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">SalveazÄƒ Lucrare</button>
                <button type="button" class="btn btn-secondary" onclick="resetWorkForm()">Reset</button>
            </form>

            <h3>Lista LucrÄƒri</h3>
            <div style="margin-bottom: 20px;">
                <button class="btn btn-secondary" onclick="filterWorks('all')">Toate</button>
                <button class="btn btn-warning" onclick="filterWorks('programata')">Programate</button>
                <button class="btn btn-info" onclick="filterWorks('in-progres')">ÃŽn Progres</button>
                <button class="btn btn-success" onclick="filterWorks('finalizata')">Finalizate</button>
            </div>
            <table id="tabelLucrari">
                <thead>
                    <tr>
                        <th>Client</th>
                        <th>Tip Lucrare</th>
                        <th>Data Programare</th>
                        <th>Ora</th>
                        <th>PreÈ›</th>
                        <th>Status</th>
                        <th>AcÈ›iuni</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Rapoarte -->
        <div id="rapoarte" class="section">
            <h2>Rapoarte È™i Export</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>Tip Raport</label>
                    <select id="tipRaport">
                        <option value="clienti">Raport ClienÈ›i</option>
                        <option value="servicii">Raport Servicii</option>
                        <option value="lucrari">Raport LucrÄƒri</option>
                        <option value="expirari">Servicii Care ExpirÄƒ</option>
                        <option value="financiar">Raport Financiar</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Data de la</label>
                    <input type="date" id="dataStart">
                </div>
                <div class="form-group">
                    <label>Data pÃ¢nÄƒ la</label>
                    <input type="date" id="dataEnd">
                </div>
                <div class="form-group">
                    <label>Format Export</label>
                    <select id="formatExport">
                        <option value="excel">Excel (.xlsx)</option>
                        <option value="csv">CSV</option>
                    </select>
                </div>
            </div>
            
            <div style="margin-bottom: 30px;">
                <button class="btn btn-success" onclick="generateReport()">GenereazÄƒ È™i DescarcÄƒ Raport</button>
                <button class="btn btn-warning" onclick="sendSMSNotifications()">Trimite NotificÄƒri SMS</button>
            </div>
            
            <div id="reportPreview"></div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        // Date globale
        let clients = JSON.parse(localStorage.getItem('adinstalgaz_clients') || '[]');
        let services = JSON.parse(localStorage.getItem('adinstalgaz_services') || '[]');
        let works = JSON.parse(localStorage.getItem('adinstalgaz_works') || '[]');
        let currentUser = JSON.parse(localStorage.getItem('adinstalgaz_current_user') || 'null');

        // Date pentru judeÈ›e È™i oraÈ™e
        const counties = {
            'Teleorman': ['Alexandria', 'RoÈ™iorii de Vede', 'Turnu MÄƒgurele', 'Zimnicea', 'Videle'],
            'Giurgiu': ['Giurgiu', 'Bolintin-Vale', 'MihÄƒileÈ™ti'],
            'ArgeÈ™': ['PiteÈ™ti', 'CÃ¢mpulung', 'Curtea de ArgeÈ™', 'Mioveni'],
            'Olt': ['Slatina', 'Caracal', 'BalÈ™', 'Corabia']
        };

        // Utilizatori autorizaÈ›i
        const authorizedUsers = [
            { email: 'florin.iordache@adinstalgaz.ro', password: 'AdInstalGaz2025!', name: 'Florin Iordache', role: 'Administrator' },
            { email: 'admin@adinstalgaz.ro', password: 'Admin123!', name: 'Administrator', role: 'Administrator' },
            { email: 'lucrator@adinstalgaz.ro', password: 'Lucrator123!', name: 'LucrÄƒtor', role: 'LucrÄƒtor' }
        ];

        // FuncÈ›ii de bazÄƒ
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            setTimeout(() => notification.classList.remove('show'), 4000);
        }

        function saveData() {
            localStorage.setItem('adinstalgaz_clients', JSON.stringify(clients));
            localStorage.setItem('adinstalgaz_services', JSON.stringify(services));
            localStorage.setItem('adinstalgaz_works', JSON.stringify(works));
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('ro-RO');
        }

        function generateId() {
            return Date.now() + Math.random().toString(36).substr(2, 9);
        }

        // FuncÈ›ii de autentificare
        function login(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            const user = authorizedUsers.find(u => u.email === email && u.password === password);
            
            if (!user) {
                showNotification('Email sau parolÄƒ incorectÄƒ!', 'error');
                return;
            }
            
            currentUser = user;
            localStorage.setItem('adinstalgaz_current_user', JSON.stringify(user));
            
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            updateUserInfo();
            showSection('dashboard');
            showNotification(`Bine ai venit, ${user.name}!`, 'success');
        }

        function logout() {
            if (confirm('Sigur doriÈ›i sÄƒ ieÈ™iÈ›i?')) {
                currentUser = null;
                localStorage.removeItem('adinstalgaz_current_user');
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('loginEmail').value = '';
                document.getElementById('loginPassword').value = '';
            }
        }

        function updateUserInfo() {
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
            }
        }

        // FuncÈ›ii pentru secÈ›iuni
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(sectionName).classList.add('active');
            event.target.classList.add('active');
            
            switch(sectionName) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'clienti':
                    displayClients();
                    break;
                case 'servicii':
                    displayServices();
                    updateClientSelects();
                    break;
                case 'lucrari':
                    displayWorks();
                    updateClientSelects();
                    break;
            }
        }

        // FuncÈ›ii pentru Dashboard
        function updateDashboard() {
            document.getElementById('totalClienti').textContent = clients.length;
            document.getElementById('totalServicii').textContent = services.length;
            document.getElementById('totalLucrari').textContent = works.length;
            
            const urgentExpiries = services.filter(s => {
                const daysLeft = Math.ceil((new Date(s.expiryDate) - new Date()) / (1000 * 60 * 60 * 24));
                return daysLeft >= 0 && daysLeft <= 30;
            }).length;
            
            document.getElementById('expirariUrgente').textContent = urgentExpiries;
            
            const alertsDiv = document.getElementById('alerteExpirari');
            if (urgentExpiries > 0) {
                alertsDiv.innerHTML = `
                    <div class="alert alert-warning">
                        <strong>AtenÈ›ie!</strong> AveÈ›i ${urgentExpiries} servicii care expirÄƒ Ã®n urmÄƒtoarele 30 de zile.
                        <button class="btn btn-warning" onclick="sendSMSNotifications()" style="margin-left: 15px;">
                            Trimite NotificÄƒri SMS
                        </button>
                    </div>
                `;
            } else {
                alertsDiv.innerHTML = '';
            }
        }

        // FuncÈ›ii pentru ClienÈ›i
        function updateCities() {
            const county = document.getElementById('judetClient').value;
            const citySelect = document.getElementById('orasClient');
            
            citySelect.innerHTML = '<option value="">SelecteazÄƒ oraÈ™ul</option>';
            
            if (county && counties[county]) {
                counties[county].forEach(city => {
                    citySelect.innerHTML += `<option value="${city}">${city}</option>`;
                });
            }
        }

        function toggleApartmentFields() {
            const type = document.getElementById('tipLocuinta').value;
            const apartmentFields = document.getElementById('apartmentFields');
            
            if (type === 'apartament') {
                apartmentFields.classList.add('show');
            } else {
                apartmentFields.classList.remove('show');
            }
        }

        function addClient(event) {
            event.preventDefault();
            
            const client = {
                id: generateId(),
                name: document.getElementById('numeClient').value,
                phone: document.getElementById('telefonClient').value,
                email: document.getElementById('emailClient').value,
                county: document.getElementById('judetClient').value,
                city: document.getElementById('orasClient').value,
                street: document.getElementById('stradaClient').value,
                number: document.getElementById('numarClient').value,
                houseType: document.getElementById('tipLocuinta').value,
                block: document.getElementById('blocClient').value,
                staircase: document.getElementById('scaraClient').value,
                floor: document.getElementById('etajClient').value,
                apartment: document.getElementById('apartamentClient').value,
                notes: document.getElementById('observatiiClient').value,
                createdAt: new Date().toISOString()
            };
            
            clients.push(client);
            saveData();
            displayClients();
            updateClientSelects();
            resetClientForm();
            showNotification('Client adÄƒugat cu succes!', 'success');
        }

        function resetClientForm() {
            document.getElementById('formClient').reset();
            document.getElementById('apartmentFields').classList.remove('show');
            document.getElementById('orasClient').innerHTML = '<option value="">SelecteazÄƒ judeÈ›ul mai Ã®ntÃ¢i</option>';
        }

        function displayClients() {
            const tbody = document.querySelector('#tabelClienti tbody');
            tbody.innerHTML = '';
            
            const searchTerm = document.getElementById('searchClienti').value.toLowerCase();
            const filteredClients = clients.filter(client => 
                client.name.toLowerCase().includes(searchTerm) ||
                client.phone.includes(searchTerm)
            );
            
            filteredClients.forEach(client => {
                const fullAddress = buildFullAddress(client);
                const serviceCount = services.filter(s => s.clientId === client.id).length;
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${client.name}</strong></td>
                    <td>${client.phone}</td>
                    <td>${client.email || '-'}</td>
                    <td>${fullAddress}</td>
                    <td><span class="badge badge-info">${serviceCount} servicii</span></td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteClient('${client.id}')">È˜terge</button>
                    </td>
                `;
            });
        }

        function buildFullAddress(client) {
            let address = `${client.street} nr. ${client.number}`;
            if (client.houseType === 'apartament') {
                if (client.block) address += `, Bl. ${client.block}`;
                if (client.staircase) address += `, Sc. ${client.staircase}`;
                if (client.floor) address += `, Et. ${client.floor}`;
                if (client.apartment) address += `, Ap. ${client.apartment}`;
            }
            address += `, ${client.city}, ${client.county}`;
            return address;
        }

        function searchClients() {
            displayClients();
        }

        function deleteClient(id) {
            if (confirm('Sigur doriÈ›i sÄƒ È™tergeÈ›i acest client?')) {
                clients = clients.filter(c => c.id !== id);
                services = services.filter(s => s.clientId !== id);
                works = works.filter(w => w.clientId !== id);
                saveData();
                displayClients();
                updateClientSelects();
                showNotification('Client È™ters!', 'warning');
            }
        }

        function updateClientSelects() {
            const selects = ['clientServiciu', 'clientLucrare'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    const currentValue = select.value;
                    select.innerHTML = '<option value="">SelecteazÄƒ clientul</option>';
                    clients.forEach(client => {
                        select.innerHTML += `<option value="${client.id}">${client.name} - ${client.phone}</option>`;
                    });
                    select.value = currentValue;
                }
            });
        }

        // FuncÈ›ii pentru Servicii
        function calculateExpiration() {
            const serviceType = document.getElementById('tipServiciu');
            const startDate = document.getElementById('dataInceput').value;
            const expiryDate = document.getElementById('dataExpirare');
            const price = document.getElementById('pretServiciu');
            
            if (!serviceType.value || !startDate) return;
            
            const selectedOption = serviceType.options[serviceType.selectedIndex];
            const years = parseInt(selectedOption.getAttribute('data-years'));
            const servicePrice = selectedOption.getAttribute('data-price');
            
            if (years > 0) {
                const start = new Date(startDate);
                start.setFullYear(start.getFullYear() + years);
                expiryDate.value = start.toISOString().split('T')[0];
            } else {
                const start = new Date(startDate);
                start.setFullYear(start.getFullYear() + 1);
                expiryDate.value = start.toISOString().split('T')[0];
            }
            
            if (servicePrice !== '0') {
                price.value = servicePrice;
            } else {
                price.value = '';
                price.removeAttribute('readonly');
                price.placeholder = 'IntroduceÈ›i preÈ›ul manual';
            }
        }

        function addService(event) {
            event.preventDefault();
            
            const service = {
                id: generateId(),
                clientId: document.getElementById('clientServiciu').value,
                type: document.getElementById('tipServiciu').value,
                startDate: document.getElementById('dataInceput').value,
                expiryDate: document.getElementById('dataExpirare').value,
                price: parseFloat(document.getElementById('pretServiciu').value),
                notes: document.getElementById('observatiiServiciu').value,
                createdAt: new Date().toISOString()
            };
            
            services.push(service);
            saveData();
            displayServices();
            resetServiceForm();
            showNotification('Serviciu adÄƒugat cu succes!', 'success');
        }

        function resetServiceForm() {
            document.getElementById('formServiciu').reset();
            document.getElementById('pretServiciu').setAttribute('readonly', '');
        }

        function displayServices() {
            const tbody = document.querySelector('#tabelServicii tbody');
            tbody.innerHTML = '';
            
            const searchTerm = document.getElementById('searchServicii').value.toLowerCase();
            const filteredServices = services.filter(service => {
                const client = clients.find(c => c.id === service.clientId);
                return client && (
                    client.name.toLowerCase().includes(searchTerm) ||
                    service.type.toLowerCase().includes(searchTerm)
                );
            });
            
            filteredServices.forEach(service => {
                const client = clients.find(c => c.id === service.clientId);
                const daysLeft = Math.ceil((new Date(service.expiryDate) - new Date()) / (1000 * 60 * 60 * 24));
                
                let statusBadge, daysBadge;
                if (daysLeft < 0) {
                    statusBadge = '<span class="badge badge-danger">Expirat</span>';
                    daysBadge = `<span class="badge badge-danger">${Math.abs(daysLeft)} zile depÄƒÈ™ite</span>`;
                } else if (daysLeft <= 7) {
                    statusBadge = '<span class="badge badge-warning">ExpirÄƒ curÃ¢nd</span>';
                    daysBadge = `<span class="badge badge-warning">${daysLeft} zile</span>`;
                } else if (daysLeft <= 30) {
                    statusBadge = '<span class="badge badge-info">Activ</span>';
                    daysBadge = `<span class="badge badge-info">${daysLeft} zile</span>`;
                } else {
                    statusBadge = '<span class="badge badge-success">Activ</span>';
                    daysBadge = `<span class="badge badge-success">${daysLeft} zile</span>`;
                }
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${client ? client.name : 'Client È™ters'}</strong></td>
                    <td>${service.type}</td>
                    <td>${formatDate(service.startDate)}</td>
                    <td>${formatDate(service.expiryDate)}</td>
                    <td>${service.price} Lei</td>
                    <td>${statusBadge}</td>
                    <td>${daysBadge}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteService('${service.id}')">È˜terge</button>
                    </td>
                `;
            });
        }

        function searchServices() {
            displayServices();
        }

        function deleteService(id) {
            if (confirm('Sigur doriÈ›i sÄƒ È™tergeÈ›i acest serviciu?')) {
                services = services.filter(s => s.id !== id);
                saveData();
                displayServices();
                showNotification('Serviciu È™ters!', 'warning');
            }
        }

        // FuncÈ›ii pentru LucrÄƒri
        function addWork(event) {
            event.preventDefault();
            
            const work = {
                id: generateId(),
                clientId: document.getElementById('clientLucrare').value,
                type: document.getElementById('tipLucrare').value,
                scheduledDate: document.getElementById('dataProgramare').value,
                scheduledTime: document.getElementById('oraProgramare').value,
                price: parseFloat(document.getElementById('pretLucrare').value),
                status: document.getElementById('statusLucrare').value,
                notes: document.getElementById('observatiiLucrare').value,
                createdAt: new Date().toISOString()
            };
            
            works.push(work);
            saveData();
            displayWorks();
            resetWorkForm();
            showNotification('Lucrare adÄƒugatÄƒ cu succes!', 'success');
        }

        function resetWorkForm() {
            document.getElementById('formLucrare').reset();
        }

        function displayWorks(filter = 'all') {
            const tbody = document.querySelector('#tabelLucrari tbody');
            tbody.innerHTML = '';
            
            let filteredWorks = works;
            if (filter !== 'all') {
                filteredWorks = works.filter(w => w.status === filter);
            }
            
            filteredWorks.forEach(work => {
                const client = clients.find(c => c.id === work.clientId);
                
                let statusBadge;
                switch(work.status) {
                    case 'programata':
                        statusBadge = '<span class="badge badge-info">ProgramatÄƒ</span>';
                        break;
                    case 'in-progres':
                        statusBadge = '<span class="badge badge-warning">ÃŽn Progres</span>';
                        break;
                    case 'finalizata':
                        statusBadge = '<span class="badge badge-success">FinalizatÄƒ</span>';
                        break;
                    case 'anulata':
                        statusBadge = '<span class="badge badge-danger">AnulatÄƒ</span>';
                        break;
                    default:
                        statusBadge = `<span class="badge badge-secondary">${work.status}</span>`;
                }
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${client ? client.name : 'Client È™ters'}</strong></td>
                    <td>${work.type}</td>
                    <td>${formatDate(work.scheduledDate)}</td>
                    <td>${work.scheduledTime || '-'}</td>
                    <td>${work.price} Lei</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteWork('${work.id}')">È˜terge</button>
                    </td>
                `;
            });
        }

        function filterWorks(status) {
            displayWorks(status);
        }

        function deleteWork(id) {
            if (confirm('Sigur doriÈ›i sÄƒ È™tergeÈ›i aceastÄƒ lucrare?')) {
                works = works.filter(w => w.id !== id);
                saveData();
                displayWorks();
                showNotification('Lucrare È™tearsÄƒ!', 'warning');
            }
        }

        // FuncÈ›ii pentru Rapoarte
        function generateReport() {
            const reportType = document.getElementById('tipRaport').value;
            const startDate = document.getElementById('dataStart').value;
            const endDate = document.getElementById('dataEnd').value;
            const format = document.getElementById('formatExport').value;
            
            let data = [];
            let filename = '';
            
            switch(reportType) {
                case 'clienti':
                    data = clients.map(c => ({
                        'Nume': c.name,
                        'Telefon': c.phone,
                        'Email': c.email || '',
                        'AdresÄƒ': buildFullAddress(c),
                        'Servicii': services.filter(s => s.clientId === c.id).length,
                        'Data Creare': formatDate(c.createdAt)
                    }));
                    filename = 'raport-clienti';
                    break;
                    
                case 'servicii':
                    data = services.map(s => {
                        const client = clients.find(c => c.id === s.clientId);
                        const daysLeft = Math.ceil((new Date(s.expiryDate) - new Date()) / (1000 * 60 * 60 * 24));
                        return {
                            'Client': client ? client.name : 'Client È™ters',
                            'Telefon': client ? client.phone : '',
                            'Tip Serviciu': s.type,
                            'Data ÃŽnceput': formatDate(s.startDate),
                            'Data Expirare': formatDate(s.expiryDate),
                            'Zile RÄƒmase': daysLeft,
                            'PreÈ›': s.price + ' Lei'
                        };
                    });
                    filename = 'raport-servicii';
                    break;
                    
                case 'lucrari':
                    let filteredWorks = works;
                    if (startDate && endDate) {
                        filteredWorks = works.filter(w => {
                            const workDate = new Date(w.scheduledDate);
                            return workDate >= new Date(startDate) && workDate <= new Date(endDate);
                        });
                    }
                    
                    data = filteredWorks.map(w => {
                        const client = clients.find(c => c.id === w.clientId);
                        return {
                            'Client': client ? client.name : 'Client È™ters',
                            'Telefon': client ? client.phone : '',
                            'Tip Lucrare': w.type,
                            'Data Programare': formatDate(w.scheduledDate),
                            'Ora': w.scheduledTime || '',
                            'PreÈ›': w.price + ' Lei',
                            'Status': w.status
                        };
                    });
                    filename = 'raport-lucrari';
                    break;
                    
                case 'expirari':
                    data = services.filter(s => {
                        const daysLeft = Math.ceil((new Date(s.expiryDate) - new Date()) / (1000 * 60 * 60 * 24));
                        return daysLeft >= -30 && daysLeft <= 60;
                    }).map(s => {
                        const client = clients.find(c => c.id === s.clientId);
                        const daysLeft = Math.ceil((new Date(s.expiryDate) - new Date()) / (1000 * 60 * 60 * 24));
                        const status = daysLeft < 0 ? 'EXPIRAT' : daysLeft <= 7 ? 'URGENT' : daysLeft <= 30 ? 'ATENÈšIE' : 'OK';
                        return {
                            'Client': client ? client.name : 'Client È™ters',
                            'Telefon': client ? client.phone : '',
                            'Tip Serviciu': s.type,
                            'Data Expirare': formatDate(s.expiryDate),
                            'Zile RÄƒmase': Math.abs(daysLeft),
                            'Status': status,
                            'PreÈ›': s.price + ' Lei'
                        };
                    });
                    filename = 'raport-expirari';
                    break;
                    
                case 'financiar':
                    let financialWorks = works.filter(w => w.status === 'finalizata');
                    if (startDate && endDate) {
                        financialWorks = financialWorks.filter(w => {
                            const workDate = new Date(w.scheduledDate);
                            return workDate >= new Date(startDate) && workDate <= new Date(endDate);
                        });
                    }
                    
                    data = financialWorks.map(w => {
                        const client = clients.find(c => c.id === w.clientId);
                        return {
                            'Client': client ? client.name : 'Client È™ters',
                            'Tip Lucrare': w.type,
                            'Data': formatDate(w.scheduledDate),
                            'PreÈ›': w.price + ' Lei'
                        };
                    });
                    
                    const total = financialWorks.reduce((sum, w) => sum + w.price, 0);
                    data.push({
                        'Client': '',
                        'Tip Lucrare': '',
                        'Data': 'TOTAL:',
                        'PreÈ›': total + ' Lei'
                    });
                    
                    filename = 'raport-financiar';
                    break;
            }
            
            if (data.length === 0) {
                showNotification('Nu existÄƒ date pentru export!', 'warning');
                return;
            }
            
            if (format === 'excel') {
                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Raport');
                XLSX.writeFile(wb, `${filename}-${new Date().toISOString().split('T')[0]}.xlsx`);
            } else {
                let csv = '\ufeff';
                csv += Object.keys(data[0]).join(',') + '\n';
                data.forEach(row => {
                    csv += Object.values(row).map(val => `"${val}"`).join(',') + '\n';
                });
                
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `${filename}-${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
            }
            
            showNotification(`Raport exportat cu succes! ${data.length} Ã®nregistrÄƒri.`, 'success');
        }

        // FuncÈ›ii pentru SMS
        function sendSMSNotifications() {
            const expiringSoon = services.filter(s => {
                const daysLeft = Math.ceil((new Date(s.expiryDate) - new Date()) / (1000 * 60 * 60 * 24));
                return daysLeft >= 0 && daysLeft <= 7;
            });
            
            if (expiringSoon.length === 0) {
                showNotification('Nu existÄƒ servicii care expirÄƒ Ã®n urmÄƒtoarele 7 zile.', 'info');
                return;
            }
            
            let smsText = 'LISTÄ‚ SMS NOTIFICÄ‚RI EXPIRARE SERVICII\n';
            smsText += `Data: ${new Date().toLocaleDateString('ro-RO')}\n`;
            smsText += `Total: ${expiringSoon.length} notificÄƒri\n\n`;
            
            expiringSoon.forEach((service, index) => {
                const client = clients.find(c => c.id === service.clientId);
                if (client) {
                    const daysLeft = Math.ceil((new Date(service.expiryDate) - new Date()) / (1000 * 60 * 60 * 24));
                    const expiryDate = formatDate(service.expiryDate);
                    
                    smsText += `${index + 1}. ${client.name} - ${client.phone}\n`;
                    smsText += `   Serviciu: ${service.type}\n`;
                    smsText += `   ExpirÄƒ Ã®n: ${daysLeft} zile (${expiryDate})\n`;
                    smsText += `   Mesaj SMS: BunÄƒ ziua ${client.name}! Serviciul de ${service.type} expirÄƒ la ${expiryDate}. Pentru reÃ®nnoire contactaÈ›i 0762614401. MulÈ›umim! AdInstalGaz\n\n`;
                }
            });
            
            const blob = new Blob([smsText], { type: 'text/plain;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `sms-notificari-${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
            
            showNotification(`ListÄƒ SMS generatÄƒ cu ${expiringSoon.length} notificÄƒri!`, 'success');
        }

        // IniÈ›ializare aplicaÈ›ie
        document.addEventListener('DOMContentLoaded', function() {
            if (currentUser) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                updateUserInfo();
                updateDashboard();
                updateClientSelects();
            } else {
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
            }
        });
    </script>
</body>
</html>
