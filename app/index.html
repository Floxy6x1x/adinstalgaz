<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GazTech Services - Aplica»õie Gestionare Abona»õi</title>
    <meta name="description" content="Aplica»õie profesionalƒÉ pentru gestionarea abona»õilor »ôi reviziilor GazTech Services">
    <meta name="theme-color" content="#1e40af">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="GazTech">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="GazTech">
    
    <!-- PWA Manifest √ÆmbunƒÉtƒÉ»õit -->
    <link rel="manifest" href="data:application/json;charset=utf-8,%7B%22name%22%3A%22GazTech%20Services%20-%20Gestionare%20Abonati%22%2C%22short_name%22%3A%22GazTech%22%2C%22description%22%3A%22Aplicatie%20profesionala%20pentru%20gestionarea%20abonatilor%20si%20reviziilor%20GazTech%20Services%22%2C%22start_url%22%3A%22/%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23ffffff%22%2C%22theme_color%22%3A%22%231e40af%22%2C%22orientation%22%3A%22portrait%22%2C%22scope%22%3A%22/%22%2C%22lang%22%3A%22ro%22%2C%22categories%22%3A%5B%22business%22%2C%22productivity%22%5D%2C%22icons%22%3A%5B%7B%22src%22%3A%22data%3Aimage/svg%2Bxml%3Bbase64%2CPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI%2BCjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMxZTQwYWYiLz4KPHJlY3QgeD0iMjQiIHk9IjI0IiB3aWR0aD0iMTQ0IiBoZWlnaHQ9IjE0NCIgcng9IjEyIiBmaWxsPSIjZjU5ZTBiIi8%2BCjx0ZXh0IHg9Ijk2IiB5PSIxMTAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjY0IiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0iIzFmMmkzNyI%2BRzwvdGV4dD4KPC9zdmc%2B%22%2C%22sizes%22%3A%22192x192%22%2C%22type%22%3A%22image/svg%2Bxml%22%7D%2C%7B%22src%22%3A%22data%3Aimage/svg%2Bxml%3Bbase64%2CPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI%2BCjxyZWN0IHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiByeD0iNjQiIGZpbGw9IiMxZTQwYWYiLz4KPHJlY3QgeD0iNjQiIHk9IjY0IiB3aWR0aD0iMzg0IiBoZWlnaHQ9IjM4NCIgcng9IjMyIiBmaWxsPSIjZjU5ZTBiIi8%2BCjx0ZXh0IHg9IjI1NiIgeT0iMzAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxODAiIGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjMWYyaTM3Ij5HPC90ZXh0Pgo8L3N2Zz4%3D%22%2C%22sizes%22%3A%22512x512%22%2C%22type%22%3A%22image/svg%2Bxml%22%7D%5D%7D">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiByeD0iMjAiIGZpbGw9IiMxZTQwYWYiLz4KPHJlY3QgeD0iMjAiIHk9IjIwIiB3aWR0aD0iMTQwIiBoZWlnaHQ9IjE0MCIgcng9IjEwIiBmaWxsPSIjZjU5ZTBiIi8+Cjx0ZXh0IHg9IjkwIiB5PSIxMDUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjYwIiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0iIzFmMmkzNyI+RzwvdGV4dD4KPC9zdmc+">
    
    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIiBmaWxsPSIjNjY3ZWVhIj4KPHJlY3QgeD0iMTAiIHk9IjEwIiB3aWR0aD0iODAiIGhlaWdodD0iODAiIHJ4PSI0IiBmaWxsPSIjZDA5NjIzIi8+Cjx0ZXh0IHg9IjUwIiB5PSIzNSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGNvbG9yPSIjZmZmZmZmIiBmb250LXNpemU9IjE5cHgiPkc8L3RleHQ+CjwvbW9yPgo+">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-functions-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        /* ===== SISTEM AUTENTIFICARE ===== */
        .auth-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .auth-box {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .auth-logo {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .auth-title {
            font-size: 28px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .auth-subtitle {
            color: #718096;
            margin-bottom: 30px;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .auth-input {
            padding: 15px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .auth-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .auth-btn {
            padding: 15px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .auth-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .auth-2fa {
            margin-top: 20px;
            padding: 20px;
            background: #f0fff4;
            border-radius: 12px;
            border-left: 4px solid #38a169;
        }

        .auth-2fa h4 {
            color: #22543d;
            margin-bottom: 10px;
        }

        .auth-code-input {
            font-size: 24px;
            text-align: center;
            letter-spacing: 8px;
            font-weight: bold;
            color: #2d3748;
        }

        .auth-qr {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
        }

        .auth-backup-codes {
            margin-top: 15px;
            padding: 15px;
            background: #fef5e7;
            border-radius: 8px;
            border-left: 4px solid #ed8936;
        }

        .backup-code {
            font-family: monospace;
            font-size: 14px;
            color: #744210;
            display: inline-block;
            margin: 2px 5px;
            padding: 2px 6px;
            background: rgba(237, 137, 54, 0.1);
            border-radius: 4px;
        }

        .auth-error {
            color: #e53e3e;
            font-size: 14px;
            margin-top: 10px;
            padding: 10px;
            background: #fed7d7;
            border-radius: 6px;
        }

        .auth-success {
            color: #22543d;
            font-size: 14px;
            margin-top: 10px;
            padding: 10px;
            background: #c6f6d5;
            border-radius: 6px;
        }

        .auth-toggle {
            margin-top: 20px;
            color: #667eea;
            cursor: pointer;
            text-decoration: underline;
        }

        .app-container {
            display: none;
        }

        .app-container.authenticated {
            display: block;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            height: 70px;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: #4a5568;
            text-decoration: none;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 40px;
            align-items: center;
        }

        .nav-item {
            position: relative;
        }

        .nav-link {
            text-decoration: none;
            color: #4a5568;
            font-weight: 500;
            font-size: 15px;
            padding: 10px 0;
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
        }

        .nav-link:hover {
            color: #667eea;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 5px;
            left: 0;
            width: 0;
            height: 2px;
            background: #667eea;
            transition: width 0.3s ease;
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .nav-link.active {
            color: #667eea;
        }

        .nav-link.active::after {
            width: 100%;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #4a5568;
            font-weight: 500;
        }

        .logout-btn {
            background: #f56565;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #e53e3e;
            transform: translateY(-1px);
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            color: #4a5568;
            cursor: pointer;
        }

        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .section {
            display: none;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 0.5s ease-out;
        }

        .section.active {
            display: block;
        }

        .section-title {
            font-size: 32px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-separator {
            height: 3px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50px;
            margin: 40px 0;
            position: relative;
        }

        .section-separator::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            border: 3px solid #667eea;
        }

        .alerts-section {
            margin-bottom: 30px;
        }

        .lists-section {
            margin-bottom: 40px;
        }

        .forms-section {
            margin-top: 40px;
        }

        .form-container {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-input, .form-select {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-select {
            cursor: pointer;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ed8936;
            color: white;
        }

        .btn-warning:hover {
            background: #dd6b20;
            transform: translateY(-2px);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            font-size: 13px;
        }

        .data-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
        }

        .data-table td {
            padding: 12px 8px;
            border-bottom: 1px solid #e2e8f0;
            color: #4a5568;
        }

        .data-table tr:hover {
            background: #f7fafc;
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-inactive {
            background: #fed7d7;
            color: #742a2a;
        }

        .status-pending {
            background: #fef5e7;
            color: #744210;
        }

        .status-urgent {
            background: #fbb6ce;
            color: #97266d;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #718096;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .search-container {
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            max-width: 400px;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .address-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .client-type-container {
            background: #f7fafc;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .revizie-container {
            background: #e6fffa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #38b2ac;
        }

        .servicii-container {
            background: #faf5ff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #9f7aea;
        }

        .form-section-title {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            transform: scale(1.2);
            accent-color: #667eea;
        }

        .oferta-speciala {
            background: linear-gradient(135deg, #fef5e7, #fed7aa);
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #f6ad55;
            animation: pulse-offer 3s infinite;
        }

        .oferta-speciala label {
            color: #c05621 !important;
            font-size: 15px;
        }

        .file-upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            background: #f7fafc;
            transition: all 0.3s ease;
            margin-top: 15px;
            cursor: pointer;
        }

        .file-upload-area:hover {
            border-color: #667eea;
            background: #edf2f7;
        }

        .file-upload-area.dragover {
            border-color: #667eea;
            background: #e6fffa;
        }

        .file-list {
            margin-top: 15px;
        }

        .file-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-icon {
            font-size: 20px;
        }

        .file-details {
            display: flex;
            flex-direction: column;
        }

        .file-name {
            font-weight: 600;
            color: #2d3748;
        }

        .file-size {
            font-size: 12px;
            color: #718096;
        }

        .date-range-container {
            background: #fff5f5;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #f56565;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #a0aec0;
            transition: color 0.3s ease;
        }

        .close-modal:hover {
            color: #2d3748;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-warning {
            background: #fef5e7;
            color: #744210;
            border-left: 4px solid #ed8936;
        }

        .alert-danger {
            background: #fed7d7;
            color: #742a2a;
            border-left: 4px solid #f56565;
        }

        .alert-info {
            background: #ebf8ff;
            color: #2a4365;
            border-left: 4px solid #4299e1;
        }

        .alert-success {
            background: #f0fff4;
            color: #22543d;
            border-left: 4px solid #38a169;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }

            .nav-menu {
                position: fixed;
                top: 70px;
                left: -100%;
                width: 100%;
                height: calc(100vh - 70px);
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(10px);
                flex-direction: column;
                justify-content: flex-start;
                padding-top: 50px;
                gap: 30px;
                transition: left 0.3s ease;
            }

            .nav-menu.active {
                left: 0;
            }

            .nav-link {
                font-size: 18px;
                padding: 15px 0;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .address-grid {
                grid-template-columns: 1fr;
            }

            .data-table {
                font-size: 11px;
            }

            .data-table th,
            .data-table td {
                padding: 6px 4px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .auth-box {
                margin: 20px;
                padding: 30px 20px;
            }

            .user-menu {
                gap: 10px;
            }

            .user-info {
                display: none;
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .notification {
            position: fixed;
            top: 90px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 400px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #48bb78;
        }

        .notification.error {
            background: #f56565;
        }

        .notification.warning {
            background: #ed8936;
        }

        .notification.info {
            background: #4299e1;
        }

        .urgent-reminder {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes pulse-offer {
            0%, 100% { box-shadow: 0 0 0 0 rgba(246, 173, 85, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(246, 173, 85, 0); }
        }

        .sync-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #48bb78;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .sync-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Spinner pentru loading */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- SISTEM AUTENTIFICARE -->
    <div id="authContainer" class="auth-container">
        <div class="auth-box">
            <div class="auth-logo">üîê</div>
            <h1 class="auth-title">GazTech Services</h1>
            <p class="auth-subtitle">Sistem Securizat de Autentificare</p>
            
            <!-- Login Form -->
            <div id="loginForm" class="auth-form">
                <input type="email" id="loginEmail" class="auth-input" placeholder="üìß Email" required>
                <input type="password" id="loginPassword" class="auth-input" placeholder="üîí ParolƒÉ" required>
                <button id="loginBtn" class="auth-btn">üöÄ CONECTARE</button>
                <div class="auth-toggle" onclick="showRegisterForm()">
                    Nu ai cont? √énregistreazƒÉ-te aici
                </div>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="auth-form" style="display: none;">
                <input type="text" id="registerName" class="auth-input" placeholder="üë§ Nume Complet" required>
                <input type="email" id="registerEmail" class="auth-input" placeholder="üìß Email" required>
                <input type="password" id="registerPassword" class="auth-input" placeholder="üîí ParolƒÉ (min 8 caractere)" required>
                <input type="password" id="registerConfirmPassword" class="auth-input" placeholder="üîí ConfirmƒÉ Parola" required>
                <button id="registerBtn" class="auth-btn">üìù √éNREGISTRARE</button>
                <div class="auth-toggle" onclick="showLoginForm()">
                    Ai deja cont? ConecteazƒÉ-te aici
                </div>
            </div>

            <!-- 2FA Setup -->
            <div id="setup2FA" class="auth-2fa" style="display: none;">
                <h4>üõ°Ô∏è Configurare Autentificare cu Doi Factori</h4>
                <p style="color: #22543d; margin-bottom: 15px;">
                    Pentru securitate maximƒÉ, vƒÉ recomandƒÉm sƒÉ activa»õi autentificarea cu doi factori.
                </p>
                <div id="qrCode" class="auth-qr"></div>
                <p style="color: #22543d; font-size: 14px; margin-bottom: 15px;">
                    1. DescƒÉrca»õi Google Authenticator pe telefon<br>
                    2. Scana»õi codul QR de mai sus<br>
                    3. Introduce»õi codul din aplica»õie
                </p>
                <input type="text" id="verify2FACode" class="auth-input auth-code-input" placeholder="000000" maxlength="6">
                <button id="verify2FABtn" class="auth-btn">‚úÖ ACTIVEAZƒÇ 2FA</button>
                <button id="skip2FABtn" class="auth-btn" style="background: #e2e8f0; color: #4a5568; margin-top: 10px;">
                    ‚è≠Ô∏è Sari Peste (Nu Recomandat)
                </button>
                <div id="backupCodes" class="auth-backup-codes" style="display: none;">
                    <h5 style="color: #744210; margin-bottom: 10px;">üîë Coduri de RezervƒÉ</h5>
                    <p style="color: #744210; font-size: 12px; margin-bottom: 10px;">
                        Salva»õi aceste coduri √Æntr-un loc sigur. Pute»õi folosi fiecare cod o singurƒÉ datƒÉ:
                    </p>
                    <div id="backupCodesList"></div>
                </div>
            </div>

            <!-- 2FA Verification -->
            <div id="verify2FA" class="auth-2fa" style="display: none;">
                <h4>üîê Verificare Doi Factori</h4>
                <p style="color: #22543d; margin-bottom: 15px;">
                    Introduce»õi codul din aplica»õia Google Authenticator:
                </p>
                <input type="text" id="login2FACode" class="auth-input auth-code-input" placeholder="000000" maxlength="6">
                <button id="login2FABtn" class="auth-btn">üîì VERIFICƒÇ COD</button>
                <div class="auth-toggle" onclick="show2FABackup()">
                    Folose»ôte cod de rezervƒÉ
                </div>
            </div>

            <!-- 2FA Backup -->
            <div id="backup2FA" class="auth-2fa" style="display: none;">
                <h4>üîë Cod de RezervƒÉ</h4>
                <p style="color: #22543d; margin-bottom: 15px;">
                    Introduce»õi unul din codurile de rezervƒÉ:
                </p>
                <input type="text" id="backupCode" class="auth-input" placeholder="abc123def456">
                <button id="verifyBackupBtn" class="auth-btn">üîì VERIFICƒÇ COD REZERVƒÇ</button>
                <div class="auth-toggle" onclick="showVerify2FA()">
                    √énapoi la cod normal
                </div>
            </div>

            <div id="authError" class="auth-error" style="display: none;"></div>
            <div id="authSuccess" class="auth-success" style="display: none;"></div>
            <div id="authLoading" style="display: none;">
                <div class="spinner"></div>
                <p style="color: #4a5568; text-align: center;">Se proceseazƒÉ...</p>
            </div>
        </div>
    </div>

    <!-- APLICA»öIA PRINCIPALƒÇ -->
    <div id="appContainer" class="app-container">
        <header class="header">
            <div class="nav-container">
                <a href="#" class="logo">üîß GazTech Services</a>
                
                <nav>
                    <ul class="nav-menu" id="navMenu">
                        <li class="nav-item">
                            <a href="#" class="nav-link active" data-section="dashboard">Dashboard</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-section="abonati">Abona»õi</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-section="programari">ProgramƒÉri</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-section="remindere">Remindere</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-section="rapoarte">Rapoarte</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-section="setari">SetƒÉri</a>
                        </li>
                    </ul>
                </nav>

                <div class="user-menu">
                    <div class="user-info">
                        <span>üë§</span>
                        <span id="currentUser">User</span>
                        <span id="userRole" class="status-badge status-active">Admin</span>
                    </div>
                    <button class="logout-btn" onclick="logout()">üö™ Ie»ôire</button>
                    <button class="mobile-menu-btn" id="mobileMenuBtn">‚ò∞</button>
                </div>
            </div>
        </header>

        <main class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <h1 class="section-title">üìä Dashboard</h1>
                
                <div class="alerts-section">
                    <div id="alerteUrgente"></div>
                </div>
                
                <div class="form-grid">
                    <div class="form-container">
                        <h3 style="color: #4a5568; margin-bottom: 15px;">üìà Statistici Rapide</h3>
                        <p style="color: #718096;">Total Abona»õi: <strong id="totalAbonati">0</strong></p>
                        <p style="color: #718096;">ProgramƒÉri AstƒÉzi: <strong id="programariAstazi">0</strong></p>
                        <p style="color: #718096;">Remindere Active: <strong id="remindereActive">0</strong></p>
                        <p style="color: #718096;">Revizii √Æn 7 zile: <strong id="reviziiSaptamana">0</strong></p>
                    </div>
                    <div class="form-container">
                        <h3 style="color: #4a5568; margin-bottom: 15px;">‚ö° Ac»õiuni Rapide</h3>
                        <button class="btn btn-primary" onclick="showSection('abonati')" style="margin-bottom: 10px; width: 100%;">AdaugƒÉ Abonat</button>
                        <button class="btn btn-secondary" onclick="showSection('programari')" style="margin-bottom: 10px; width: 100%;">Programare NouƒÉ</button>
                        <button class="btn btn-secondary" onclick="sincronizareAvansata()" style="margin-bottom: 10px; width: 100%;">üîÑ Sincronizare AvansatƒÉ</button>
                        <button class="btn btn-secondary" onclick="creeazaBackup()" style="width: 100%;">üíæ Backup Date</button>
                    </div>
                    <div class="form-container">
                        <h3 style="color: #4a5568; margin-bottom: 15px;">üì± NotificƒÉri & Firebase</h3>
                        <button class="btn btn-primary" onclick="verificaNotificariAutomated()" style="margin-bottom: 10px; width: 100%;">üì± VerificƒÉ NotificƒÉri</button>
                        <button class="btn btn-secondary" onclick="sincronizareCuFirestore()" style="margin-bottom: 10px; width: 100%;">üî• Sync Firebase</button>
                        <button class="btn btn-secondary" onclick="trimiteNotificariInMasa()" style="margin-bottom: 10px; width: 100%;">üì¢ NotificƒÉri √Æn MasƒÉ</button>
                        <button class="btn btn-success" onclick="testeazaWhatsApp()" style="margin-bottom: 10px; width: 100%; background: #25d366; color: white;">üí¨ Test WhatsApp</button>
                        <div style="margin-top: 10px; padding: 10px; background: #f0fff4; border-radius: 6px; border-left: 3px solid #38a169;">
                            <small style="color: #22543d;">Firebase: <span id="firebaseStatus">Verificare...</span></small><br>
                            <small style="color: #22543d;">Telefon firmƒÉ: <strong id="telefonFirma">0762614401</strong></small><br>
                            <small style="color: #22543d;">WhatsApp: <strong>Activ ‚úÖ</strong></small>
                        </div>
                    </div>
                </div>

                <!-- Informa»õii NotificƒÉri - FƒÇRƒÇ EXEMPLE DE MESAJE -->
                <div class="form-container" style="margin-top: 30px;">
                    <h3 style="color: #4a5568; margin-bottom: 15px;">üìã Sistem de NotificƒÉri Profesional</h3>
                    <div style="background: #ebf8ff; padding: 15px; border-radius: 8px; border-left: 4px solid #4299e1;">
                        <p style="color: #2a4365; margin: 0;"><strong>üéØ Func»õionalitƒÉ»õi Disponibile:</strong></p>
                        <p style="color: #2a4365; margin: 5px 0 0 0;">‚Ä¢ <strong>üì± SMS Automat</strong> ‚Üí notificƒÉri pentru expirƒÉri »ôi plƒÉ»õi</p>
                        <p style="color: #2a4365; margin: 5px 0 0 0;">‚Ä¢ <strong>üí¨ WhatsApp Business</strong> ‚Üí mesaje instant »ôi urgen»õe</p>
                        <p style="color: #2a4365; margin: 5px 0 0 0;">‚Ä¢ <strong>üîî Remindere Automate</strong> ‚Üí programare »ôi urmƒÉrire</p>
                        <p style="color: #2a4365; margin: 5px 0 0 0;">‚Ä¢ <strong>üìä Statistici Trimise</strong> ‚Üí rapoarte detaliate</p>
                        <p style="color: #2a4365; margin: 5px 0 0 0;">‚Ä¢ <strong>üö® NotificƒÉri Urgente</strong> ‚Üí probleme tehnice »ôi expirƒÉri</p>
                        <p style="color: #2a4365; margin: 5px 0 0 0;">‚Ä¢ <strong>Telefon firmƒÉ</strong> ‚Üí <span id="telefonAlert1">0762614401</span> (√Æn toate mesajele)</p>
                    </div>
                </div>
            </section>

            <!-- Abona»õi Section -->
            <section id="abonati" class="section">
                <h1 class="section-title">üë• Gestionare Abona»õi</h1>
                
                <!-- Alerts Section -->
                <div class="alerts-section">
                    <div id="alerteAbonati"></div>
                    
                    <!-- AlertƒÉ pentru notificƒÉri -->
                    <div class="alert alert-info" style="border-left: 4px solid #4299e1;">
                        <strong>üì± NotificƒÉri Profesionale Active!</strong><br>
                        ‚Ä¢ <strong>üì± SMS:</strong> Click pe üì± SMS pentru notificƒÉri expirƒÉri/plƒÉ»õi<br>
                        ‚Ä¢ <strong>üí¨ WhatsApp:</strong> Click pe üí¨ WA pentru mesaje business instant<br>
                        ‚Ä¢ <strong>üö® Automat:</strong> WhatsApp pentru revizii expirate (urgent)<br>
                        ‚Ä¢ <strong>Telefon firmƒÉ:</strong> <span id="telefonAlert2">0762614401</span> (√Æn toate mesajele)
                    </div>
                </div>

                <!-- Lists Section -->
                <div class="lists-section">
                    <div class="search-container">
                        <input type="text" class="search-input" id="searchAbonati" placeholder="üîç CautƒÉ abona»õi...">
                    </div>

                    <div id="listaAbonati">
                        <div class="empty-state">
                            <div class="empty-state-icon">üë•</div>
                            <h3>Nu existƒÉ abona»õi √Ænregistra»õi</h3>
                            <p>AdaugƒÉ primul abonat folosind formularul de mai jos.</p>
                        </div>
                    </div>
                </div>

                <!-- Separator -->
                <div class="section-separator"></div>

                <!-- Forms Section -->
                <div class="forms-section">
                    <div class="form-container">
                        <h3 style="color: #4a5568; margin-bottom: 20px;">‚ûï AdaugƒÉ Abonat Nou</h3>
                        
                        <div class="client-type-container">
                            <div class="form-section-title">üë§ Tip Client</div>
                            <div class="form-group">
                                <select class="form-select" id="tipClient">
                                    <option value="">SelecteazƒÉ tipul clientului</option>
                                    <option value="nou">Client Nou</option>
                                    <option value="actual">Client Actual</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-section-title">üìù Date Personale</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Nume Complet *</label>
                                <input type="text" class="form-input" id="numeAbonat" placeholder="Introduce»õi numele complet" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Telefon *</label>
                                <input type="tel" class="form-input" id="telefonAbonat" placeholder="0721234567" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-input" id="emailAbonat" placeholder="email@exemplu.ro">
                            </div>
                            <div class="form-group">
                                <label class="form-label">CNP</label>
                                <input type="text" class="form-input" id="cnpAbonat" placeholder="1234567890123">
                            </div>
                        </div>

                        <div class="form-section-title">üìç AdresƒÉ CompletƒÉ</div>
                        <div class="address-grid">
                            <div class="form-group">
                                <label class="form-label">Ora»ô *</label>
                                <select class="form-select" id="orasAbonat" required>
                                    <option value="">SelecteazƒÉ ora»ôul</option>
                                    <option value="Ro»ôiorii de Vede">Ro»ôiorii de Vede</option>
                                    <option value="Alexandria">Alexandria</option>
                                    <option value="Turnu MƒÉgurele">Turnu MƒÉgurele</option>
                                    <option value="Videle">Videle</option>
                                    <option value="Zimnicea">Zimnicea</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Strada</label>
                                <input type="text" class="form-input" id="stradaAbonat" placeholder="Str. Exemplu">
                            </div>
                            <div class="form-group">
                                <label class="form-label">NumƒÉrul</label>
                                <input type="text" class="form-input" id="numarAbonat" placeholder="Nr. 123">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tip Locuin»õƒÉ</label>
                                <select class="form-select" id="tipAdresa">
                                    <option value="">SelecteazƒÉ tipul</option>
                                    <option value="Casa">CasƒÉ</option>
                                    <option value="Bloc">Bloc</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Bloc (ex: Bl. 413, K1)</label>
                                <input type="text" class="form-input" id="numeBlocAbonat" placeholder="Bl. 413, K1, etc.">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Scara</label>
                                <input type="text" class="form-input" id="scaraAbonat" placeholder="A, B, C...">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Etaj</label>
                                <input type="text" class="form-input" id="etajAbonat" placeholder="1, 2, 3...">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Apartament</label>
                                <input type="text" class="form-input" id="apartamentAbonat" placeholder="12, 34...">
                            </div>
                        </div>

                        <div class="servicii-container">
                            <div class="form-section-title">üõ†Ô∏è Servicii Contractate cu Pre»õuri</div>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="serviciu_verificare_gaz" value="Verificare Instala»õie Gaz">
                                    <label for="serviciu_verificare_gaz">Verificare Instala»õie Gaz - <strong>150 Lei</strong> <small>(valabilitate 2 ani)</small></label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="serviciu_revizie_gaz" value="Revizie Instala»õie Gaz">
                                    <label for="serviciu_revizie_gaz">Revizie Instala»õie Gaz - <strong>250 Lei</strong> <small>(valabilitate 2 ani)</small></label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="serviciu_verificare_centrala" value="Verificare CentralƒÉ">
                                    <label for="serviciu_verificare_centrala">Verificare CentralƒÉ - <strong>150 Lei</strong> <small>(valabilitate 2 ani)</small></label>
                                </div>
                                <div class="checkbox-item oferta-speciala">
                                    <input type="checkbox" id="serviciu_pachet_complet" value="Instala»õii Gaz + CentralƒÉ">
                                    <label for="serviciu_pachet_complet"><strong>üî• OFERTƒÇ: Instala»õii Gaz + CentralƒÉ - 250 Lei</strong> <small>(valabilitate 2 ani)</small></label>
                                </div>
                            </div>
                            <div style="background: #e6fffa; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #38b2ac;">
                                <p style="color: #2c7a7b; font-weight: 600; margin: 0;">‚ÑπÔ∏è Toate serviciile au valabilitate de 2 ani »ôi se programeazƒÉ automat urmƒÉtoarea verificare!</p>
                                <div id="costTotal" style="margin-top: 10px; font-size: 18px; font-weight: bold; color: #2c7a7b;">
                                    üí∞ Cost total: <span id="valoareTotala">0</span> Lei
                                </div>
                            </div>
                        </div>

                        <div class="date-range-container">
                            <div class="form-section-title">üìÖ Date Importante Revizie</div>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Data Revizie EfectuatƒÉ</label>
                                    <input type="date" class="form-input" id="dataRevizieEfectuata">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Data Expirare (calculatƒÉ automat)</label>
                                    <input type="date" class="form-input" id="dataExpirare" readonly style="background: #f7fafc;">
                                </div>
                            </div>
                        </div>

                        <div class="revizie-container">
                            <div class="form-section-title">üîç Sistem Revizii Automate</div>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Data Primei Revizii/VerificƒÉri</label>
                                    <input type="date" class="form-input" id="dataPrimaRevizie">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Periodicitate Revizie (legal)</label>
                                    <select class="form-select" id="periodicitateRevizie">
                                        <option value="2" selected>2 ani (obligatoriu legal pentru instala»õiile de gaz)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Zile Notificare √énainte</label>
                                    <select class="form-select" id="zileNotificare">
                                        <option value="1">1 zi √Ænainte</option>
                                        <option value="2" selected>2 zile √Ænainte</option>
                                        <option value="3">3 zile √Ænainte</option>
                                        <option value="7">1 sƒÉptƒÉm√¢nƒÉ √Ænainte</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Data UrmƒÉtoarei Revizii</label>
                                    <input type="date" class="form-input" id="dataUrmatoareaRevizie" readonly style="background: #f7fafc;">
                                </div>
                            </div>
                        </div>

                        <div class="form-container">
                            <div class="form-section-title">üìé Gestionare Documente</div>
                            <div class="file-upload-area" id="fileUploadArea">
                                <div style="font-size: 48px; color: #cbd5e0; margin-bottom: 15px;">üìÑ</div>
                                <p style="color: #4a5568; font-weight: 600; margin-bottom: 10px;">√éncarcƒÉ documente pentru client</p>
                                <p style="color: #718096; font-size: 14px;">Drag & drop sau click pentru a selecta fi»ôiere</p>
                                <p style="color: #a0aec0; font-size: 12px;">PDF, DOC, DOCX, JPG, PNG (max 5MB per fi»ôier)</p>
                                <input type="file" id="fileInput" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" style="display: none;">
                            </div>
                            <div class="file-list" id="fileList"></div>
                        </div>

                        <div style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="adaugaAbonat()">
                                ‚ûï AdaugƒÉ Abonat
                            </button>
                            <button class="btn btn-secondary" onclick="resetFormAbonat()">
                                üîÑ ReseteazƒÉ Formularul
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ProgramƒÉri Section -->
            <section id="programari" class="section">
                <h1 class="section-title">üìÖ Gestionare ProgramƒÉri</h1>
                
                <!-- Alerts Section -->
                <div class="alerts-section">
                    <div id="alerteProgramari"></div>
                </div>

                <!-- Lists Section -->
                <div class="lists-section">
                    <div id="listaProgramari">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìÖ</div>
                            <h3>Nu existƒÉ programƒÉri</h3>
                            <p>AdaugƒÉ prima programare folosind formularul de mai jos.</p>
                        </div>
                    </div>
                </div>

                <!-- Separator -->
                <div class="section-separator"></div>

                <!-- Forms Section -->
                <div class="forms-section">
                    <div class="form-container">
                        <h3 style="color: #4a5568; margin-bottom: 20px;">‚ûï Programare NouƒÉ</h3>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Client</label>
                                <select class="form-select" id="clientProgramare">
                                    <option value="">SelecteazƒÉ clientul</option>
                                    <option value="nou">‚ûï Client Nou</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tip Serviciu</label>
                                <select class="form-select" id="tipServiciu">
                                    <option value="">SelecteazƒÉ serviciul</option>
                                    <option value="Verificare Instala»õie Gaz">Verificare Instala»õie Gaz - 150 Lei</option>
                                    <option value="Revizie Instala»õie Gaz">Revizie Instala»õie Gaz - 250 Lei</option>
                                    <option value="Verificare CentralƒÉ">Verificare CentralƒÉ - 150 Lei</option>
                                    <option value="Instala»õii Gaz + CentralƒÉ">üî• OFERTƒÇ: Instala»õii Gaz + CentralƒÉ - 250 Lei</option>
                                    <option value="Repara»õie">Repara»õie</option>
                                    <option value="Consultan»õƒÉ">Consultan»õƒÉ</option>
                                    <option value="Urgen»õƒÉ">Urgen»õƒÉ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Data ProgramƒÉrii</label>
                                <input type="datetime-local" class="form-input" id="dataProgramare">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="statusProgramare">
                                    <option value="ProgramatƒÉ">üìÖ ProgramatƒÉ</option>
                                    <option value="√én Progres">‚ö° √én Progres</option>
                                    <option value="FinalizatƒÉ">‚úÖ FinalizatƒÉ</option>
                                    <option value="AnulatƒÉ">‚ùå AnulatƒÉ</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Observa»õii</label>
                            <textarea class="form-input" id="observatiiProgramare" rows="3" placeholder="Detalii despre programare..."></textarea>
                        </div>

                        <div style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="adaugaProgramare()">
                                üìÖ AdaugƒÉ Programare
                            </button>
                            <button class="btn btn-secondary" onclick="resetFormProgramare()">
                                üîÑ ReseteazƒÉ
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Remindere Section -->
            <section id="remindere" class="section">
                <h1 class="section-title">üîî Gestionare Remindere</h1>
                
                <!-- Alerts Section -->
                <div class="alerts-section">
                    <div id="alerteRemindere"></div>
                    
                    <!-- AlertƒÉ pentru remindere -->
                    <div class="alert alert-success" style="border-left: 4px solid #38a169;">
                        <strong>üìã Sistem Remindere Profesional!</strong><br>
                        ‚Ä¢ <strong>ExpirƒÉri:</strong> UrmƒÉrire verificƒÉri »ôi revizii care expirƒÉ<br>
                        ‚Ä¢ <strong>PlƒÉ»õi:</strong> Remindere pentru facturi »ôi plƒÉ»õi pendente<br>
                        ‚Ä¢ <strong>WhatsApp automat:</strong> Mesaje pentru revizii expirate (urgent)<br>
                        ‚Ä¢ <strong>Dropdown:</strong> 12 tipuri de detalii pentru remindere complete
                    </div>
                </div>

                <!-- Lists Section -->
                <div class="lists-section">
                    <div id="listaRemindere">
                        <div class="empty-state">
                            <div class="empty-state-icon">üîî</div>
                            <h3>Nu existƒÉ remindere</h3>
                            <p>AdaugƒÉ primul reminder folosind formularul de mai jos.</p>
                        </div>
                    </div>
                </div>

                <!-- Separator -->
                <div class="section-separator"></div>

                <!-- Forms Section -->
                <div class="forms-section">
                    <div class="form-container">
                        <h3 style="color: #4a5568; margin-bottom: 20px;">‚ûï Reminder Nou</h3>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Client</label>
                                <select class="form-select" id="clientReminder">
                                    <option value="">SelecteazƒÉ clientul</option>
                                    <option value="nou">‚ûï Client Nou</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tip Reminder</label>
                                <select class="form-select" id="tipReminder">
                                    <option value="">SelecteazƒÉ tipul</option>
                                    <option value="Verificare Instala»õie Gaz">üîç Verificare Instala»õie Gaz - Expirare</option>
                                    <option value="Revizie Instala»õie Gaz">üîß Revizie Instala»õie Gaz - Expirare</option>
                                    <option value="Verificare CentralƒÉ">üè† Verificare CentralƒÉ - Expirare</option>
                                    <option value="Instala»õii Gaz + CentralƒÉ">üî• Pachet Complet - Expirare</option>
                                    <option value="UrmƒÉrire PlatƒÉ">üìû UrmƒÉrire PlatƒÉ</option>
                                    <option value="Facturare">üí∞ Facturare</option>
                                    <option value="Reprogramare">üìÖ Reprogramare NecesarƒÉ</option>
                                    <option value="Documenta»õie">üìÑ Documenta»õie LipsƒÉ</option>
                                    <option value="Confirmare">‚úÖ Confirmare Serviciu</option>
                                    <option value="Altele">üìù Altele</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Detalii Reminder</label>
                                <select class="form-select" id="problemaSpecifica">
                                    <option value="">SelecteazƒÉ detaliile</option>
                                    <option value="Expirare √Æn 30 zile">‚è∞ Expirare √Æn 30 zile</option>
                                    <option value="Expirare √Æn 7 zile">üî¥ Expirare √Æn 7 zile</option>
                                    <option value="Expirat - Reprogramare urgentƒÉ">üö® Expirat - Reprogramare urgentƒÉ</option>
                                    <option value="FacturƒÉ neplƒÉtitƒÉ">üí≥ FacturƒÉ neplƒÉtitƒÉ</option>
                                    <option value="PlatƒÉ par»õialƒÉ">üí∞ PlatƒÉ par»õialƒÉ</option>
                                    <option value="Programare am√¢natƒÉ">üìÖ Programare am√¢natƒÉ</option>
                                    <option value="Documente incomplete">üìÑ Documente incomplete</option>
                                    <option value="Confirmare necesarƒÉ">‚úÖ Confirmare necesarƒÉ</option>
                                    <option value="Client nou - urmƒÉrire">üë§ Client nou - urmƒÉrire</option>
                                    <option value="Feedback serviciu">‚≠ê Feedback serviciu</option>
                                    <option value="Contact telefonic">üìû Contact telefonic</option>
                                    <option value="Altele">‚ùì Altele</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Data Reminder</label>
                                <input type="datetime-local" class="form-input" id="dataReminder">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Prioritate</label>
                                <select class="form-select" id="prioritateReminder">
                                    <option value="JoasƒÉ">üü¢ JoasƒÉ</option>
                                    <option value="Medie">üü° Medie</option>
                                    <option value="√énaltƒÉ">üî¥ √énaltƒÉ</option>
                                    <option value="UrgentƒÉ">üö® UrgentƒÉ</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Mesaj Reminder</label>
                            <textarea class="form-input" id="mesajReminder" rows="3" placeholder="Descrierea reminder-ului..."></textarea>
                        </div>

                        <div style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="adaugaReminder()">
                                üîî AdaugƒÉ Reminder
                            </button>
                            <button class="btn btn-secondary" onclick="resetFormReminder()">
                                üîÑ ReseteazƒÉ
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Rapoarte Section -->
            <section id="rapoarte" class="section">
                <h1 class="section-title">üìä Rapoarte »ôi Statistici</h1>
                
                <div class="form-grid">
                    <div class="form-container">
                        <h3 style="color: #4a5568; margin-bottom: 15px;">üìà Rezumat General</h3>
                        <p style="color: #718096;">Total Abona»õi: <strong id="raportTotalAbonati">0</strong></p>
                        <p style="color: #718096;">ProgramƒÉri Luna Aceasta: <strong id="raportProgramari">0</strong></p>
                        <p style="color: #718096;">Remindere Pending: <strong id="raportRemindere">0</strong></p>
                        <p style="color: #718096;">Revizii UrmƒÉtoarea LunƒÉ: <strong id="raportRevizii">0</strong></p>
                    </div>
                    <div class="form-container">
                        <h3 style="color: #4a5568; margin-bottom: 15px;">üèôÔ∏è Distribu»õie pe Ora»ôe</h3>
                        <div id="distributieOrase">
                            <p style="color: #718096;">Nu existƒÉ date disponibile</p>
                        </div>
                    </div>
                </div>

                <div class="form-container">
                    <h3 style="color: #4a5568; margin-bottom: 15px;">üõ†Ô∏è Servicii Contractate</h3>
                    <div id="distributieServicii">
                        <p style="color: #718096;">Nu existƒÉ date disponibile</p>
                    </div>
                </div>

                <div class="form-container">
                    <h3 style="color: #4a5568; margin-bottom: 20px;">üìã Export Rapoarte Complete</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;">
                        <button class="btn btn-primary" onclick="exportRaportPDF()">üìÑ Raport PDF Complet</button>
                        <button class="btn btn-primary" onclick="exportRaportExcel()">üìä Raport Excel Detaliat</button>
                        <button class="btn btn-secondary" onclick="exportAbonati()">üì• Export Abona»õi CSV</button>
                        <button class="btn btn-secondary" onclick="exportProgramari()">üì• Export ProgramƒÉri CSV</button>
                        <button class="btn btn-secondary" onclick="exportRemindere()">üì• Export Remindere CSV</button>
                        <button class="btn btn-secondary" onclick="exportRevizii()">üì• Export Revizii CSV</button>
                    </div>
                    
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; padding-top: 15px; border-top: 2px solid #e2e8f0;">
                        <button class="btn btn-primary" onclick="sincronizareAvansata()">üîÑ Sincronizare CompletƒÉ</button>
                        <button class="btn btn-secondary" onclick="creeazaBackup()">üíæ Backup Date Complete</button>
                        <button class="btn btn-secondary" onclick="verificaConsistentaDatele(); showNotification('Verificare completƒÉ!', 'info')">üîç VerificƒÉ Consisten»õa</button>
                        <button class="btn btn-secondary" onclick="adaugaDateDeTest(); sincronizeazaDatele()">üß™ Re√ÆncarcƒÉ Date Test</button>
                    </div>
                    
                    <div style="background: #edf2f7; padding: 15px; border-radius: 8px;">
                        <h4 style="color: #4a5568; margin-bottom: 10px;">üìà Statistici Raport:</h4>
                        <p style="color: #718096;">‚Ä¢ PDF: Include toate datele, grafice »ôi documente</p>
                        <p style="color: #718096;">‚Ä¢ Excel: Fi»ôier cu multiple foi pentru fiecare sec»õiune</p>
                        <p style="color: #718096;">‚Ä¢ CSV: Format simplu pentru import √Æn alte sisteme</p>
                        <p style="color: #38a169; font-weight: 600;">‚Ä¢ Sincronizare: Actualizare automatƒÉ la fiecare 30 secunde</p>
                        <p style="color: #38a169; font-weight: 600;">‚Ä¢ Backup: Salvare completƒÉ a tuturor datelor √Æn format JSON</p>
                    </div>
                </div>
            </section>

            <!-- SetƒÉri Section -->
            <section id="setari" class="section">
                <h1 class="section-title">‚öôÔ∏è SetƒÉri Cont »ôi Securitate</h1>
                
                <div class="form-grid">
                    <div class="form-container">
                        <h3 style="color: #4a5568; margin-bottom: 15px;">üë§ Informa»õii Cont</h3>
                        <div class="form-group">
                            <label class="form-label">Nume Complet</label>
                            <input type="text" class="form-input" id="setariNume" placeholder="Numele dvs." readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="setariEmail" placeholder="email@exemplu.ro" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Rol</label>
                            <input type="text" class="form-input" id="setariRol" placeholder="Administrator" readonly style="background: #f7fafc;">
                        </div>
                        <button class="btn btn-secondary" onclick="editareInformatiiCont()" style="margin-top: 10px;">
                            ‚úèÔ∏è EditeazƒÉ Informa»õiile
                        </button>
                    </div>

                    <div class="form-container">
                        <h3 style="color: #4a5568; margin-bottom: 15px;">üîí Securitate</h3>
                        <div class="form-group">
                            <label class="form-label">Autentificare cu Doi Factori</label>
                            <div id="status2FA" style="padding: 10px; border-radius: 6px; margin-bottom: 10px;">
                                <span id="status2FAText">Se verificƒÉ...</span>
                            </div>
                            <button id="toggle2FABtn" class="btn btn-warning" onclick="gestioneaza2FA()" disabled>
                                üõ°Ô∏è Se √ÆncarcƒÉ...
                            </button>
                        </div>
                        <div class="form-group" style="margin-top: 20px;">
                            <label class="form-label">SchimbƒÉ Parola</label>
                            <input type="password" class="form-input" id="parolaVeche" placeholder="Parola actualƒÉ" style="margin-bottom: 10px;">
                            <input type="password" class="form-input" id="parolaNoua" placeholder="Parola nouƒÉ (min 8 caractere)" style="margin-bottom: 10px;">
                            <input type="password" class="form-input" id="confirmaParolaNoua" placeholder="ConfirmƒÉ parola nouƒÉ">
                            <button class="btn btn-primary" onclick="schimbaParola()" style="margin-top: 10px;">
                                üîê SchimbƒÉ Parola
                            </button>
                        </div>
                    </div>
                </div>

                <div class="form-container">
                    <h3 style="color: #4a5568; margin-bottom: 15px;">üè¢ SetƒÉri FirmƒÉ</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Nume FirmƒÉ</label>
                            <input type="text" class="form-input" id="setariNumeFirma" value="GazTech Services">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Telefon FirmƒÉ</label>
                            <input type="tel" class="form-input" id="setariTelefonFirma" value="0762614401">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email FirmƒÉ</label>
                            <input type="email" class="form-input" id="setariEmailFirma" value="gavrila_1971@yahoo.com">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Adresa FirmƒÉ</label>
                            <input type="text" class="form-input" id="setariAdresaFirma" value="Str. MƒÉrƒÉ»ôe»ôti, Nr.97, Ro»ôiorii de Vede">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="salveazaSetariFirma()" style="margin-top: 20px;">
                        üíæ SalveazƒÉ SetƒÉrile Firmei
                    </button>
                </div>

                <div class="form-container">
                    <h3 style="color: #4a5568; margin-bottom: 15px;">üóëÔ∏è Zona PericuloasƒÉ</h3>
                    <div style="background: #fed7d7; padding: 15px; border-radius: 8px; border-left: 4px solid #f56565; margin-bottom: 15px;">
                        <p style="color: #742a2a; margin: 0;"><strong>‚ö†Ô∏è Aten»õie:</strong> Ac»õiunile de mai jos sunt ireversibile!</p>
                    </div>
                    <button class="btn btn-danger" onclick="stergeToateDatale()" style="margin-right: 10px; margin-bottom: 10px;">
                        üóëÔ∏è »òterge Toate Datele
                    </button>
                    <button class="btn btn-danger" onclick="stergeCont()" style="margin-bottom: 10px;">
                        üö´ »òterge Contul Complet
                    </button>
                </div>
            </section>
        </main>

        <!-- Modal pentru Gestionare Documente -->
        <div id="modalDocumente" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">üìé Documente Client</h2>
                    <button class="close-modal" onclick="inchideModalDocumente()">&times;</button>
                </div>
                <div id="continutModalDocumente">
                    <!-- Con»õinutul se va √ÆncƒÉrca dinamic -->
                </div>
            </div>
        </div>

        <!-- Notification -->
        <div id="notification" class="notification"></div>

        <!-- Sync Indicator -->
        <div id="syncIndicator" class="sync-indicator">
            ‚úì Sincronizat
        </div>
    </div>

    <script>
        // ===========================================
        // SISTEM AUTENTIFICARE CU DOI FACTORI
        // ===========================================
        
        // Configurare Firebase
        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "adinstalgaz-pwa.firebaseapp.com",
            projectId: "adinstalgaz-pwa",
            storageBucket: "adinstalgaz-pwa.appspot.com",
            messagingSenderId: "your-sender-id",
            appId: "your-app-id"
        };

        // Ini»õializeazƒÉ Firebase
        let db, auth, functions;
        try {
            if (typeof firebase !== 'undefined') {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                functions = firebase.functions();
                console.log('‚úÖ Firebase ini»õializat cu succes!');
            }
        } catch (error) {
            console.warn('‚ö†Ô∏è Firebase nu este disponibil:', error.message);
            console.log('üì± Aplica»õia va func»õiona √Æn modul offline');
        }

        // Stare autentificare
        let currentUser = null;
        let is2FAEnabled = false;
        let backupCodes = [];

        // VerificƒÉ starea autentificƒÉrii
        function verificaAutentificare() {
            const savedUser = localStorage.getItem('gaztech_user');
            const isLoggedIn = localStorage.getItem('gaztech_authenticated') === 'true';
            
            if (savedUser && isLoggedIn) {
                currentUser = JSON.parse(savedUser);
                afiseazaAplicatia();
                return true;
            }
            
            afiseazaAutentificare();
            return false;
        }

        // Afi»ôeazƒÉ ecranul de autentificare
        function afiseazaAutentificare() {
            document.getElementById('authContainer').style.display = 'flex';
            document.getElementById('appContainer').classList.remove('authenticated');
        }

        // Afi»ôeazƒÉ aplica»õia principalƒÉ
        function afiseazaAplicatia() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').classList.add('authenticated');
            
            // ActualizeazƒÉ informa»õiile utilizatorului
            if (currentUser) {
                document.getElementById('currentUser').textContent = currentUser.name || currentUser.email;
                document.getElementById('setariNume').value = currentUser.name || '';
                document.getElementById('setariEmail').value = currentUser.email || '';
                document.getElementById('setariRol').value = currentUser.role || 'Administrator';
                
                // VerificƒÉ statusul 2FA
                verificaStatus2FA();
            }
        }

        // Func»õii pentru formulare
        function showLoginForm() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('setup2FA').style.display = 'none';
            document.getElementById('verify2FA').style.display = 'none';
            document.getElementById('backup2FA').style.display = 'none';
            clearAuthMessages();
        }

        function showRegisterForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            document.getElementById('setup2FA').style.display = 'none';
            document.getElementById('verify2FA').style.display = 'none';
            document.getElementById('backup2FA').style.display = 'none';
            clearAuthMessages();
        }

        function showSetup2FA() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('setup2FA').style.display = 'block';
            document.getElementById('verify2FA').style.display = 'none';
            document.getElementById('backup2FA').style.display = 'none';
            clearAuthMessages();
            
            // GenereazƒÉ QR Code pentru 2FA
            genereazaQRCode();
        }

        function showVerify2FA() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('setup2FA').style.display = 'none';
            document.getElementById('verify2FA').style.display = 'block';
            document.getElementById('backup2FA').style.display = 'none';
            clearAuthMessages();
        }

        function show2FABackup() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('setup2FA').style.display = 'none';
            document.getElementById('verify2FA').style.display = 'none';
            document.getElementById('backup2FA').style.display = 'block';
            clearAuthMessages();
        }

        function clearAuthMessages() {
            document.getElementById('authError').style.display = 'none';
            document.getElementById('authSuccess').style.display = 'none';
            document.getElementById('authLoading').style.display = 'none';
        }

        function showAuthError(message) {
            const errorEl = document.getElementById('authError');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            document.getElementById('authSuccess').style.display = 'none';
            document.getElementById('authLoading').style.display = 'none';
        }

        function showAuthSuccess(message) {
            const successEl = document.getElementById('authSuccess');
            successEl.textContent = message;
            successEl.style.display = 'block';
            document.getElementById('authError').style.display = 'none';
            document.getElementById('authLoading').style.display = 'none';
        }

        function showAuthLoading() {
            document.getElementById('authLoading').style.display = 'block';
            document.getElementById('authError').style.display = 'none';
            document.getElementById('authSuccess').style.display = 'none';
        }

        // √énregistrare utilizator
        async function register() {
            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;

            if (!name || !email || !password) {
                showAuthError('Te rog completeazƒÉ toate c√¢mpurile!');
                return;
            }

            if (password.length < 8) {
                showAuthError('Parola trebuie sƒÉ aibƒÉ cel pu»õin 8 caractere!');
                return;
            }

            if (password !== confirmPassword) {
                showAuthError('Parolele nu se potrivesc!');
                return;
            }

            showAuthLoading();

            try {
                // VerificƒÉ dacƒÉ emailul existƒÉ deja
                const existingUsers = JSON.parse(localStorage.getItem('gaztech_users') || '[]');
                if (existingUsers.find(u => u.email === email)) {
                    showAuthError('Acest email este deja √Ænregistrat!');
                    return;
                }

                // Simulare timp de procesare
                await new Promise(resolve => setTimeout(resolve, 2000));

                // CreeazƒÉ noul utilizator
                const newUser = {
                    id: Date.now(),
                    name,
                    email,
                    password: await hashPassword(password), // √én produc»õie folosi»õi hashing real
                    role: 'Administrator',
                    createdAt: new Date().toISOString(),
                    is2FAEnabled: false,
                    secret2FA: null,
                    backupCodes: []
                };

                // SalveazƒÉ utilizatorul
                existingUsers.push(newUser);
                localStorage.setItem('gaztech_users', JSON.stringify(existingUsers));

                showAuthSuccess('Cont creat cu succes! √é»õi recomandƒÉm sƒÉ configurezi autentificarea cu doi factori.');

                // SeteazƒÉ utilizatorul curent
                currentUser = newUser;
                localStorage.setItem('gaztech_user', JSON.stringify(newUser));

                // Afi»ôeazƒÉ configurarea 2FA
                setTimeout(() => {
                    showSetup2FA();
                }, 2000);

            } catch (error) {
                console.error('Eroare √Ænregistrare:', error);
                showAuthError('A apƒÉrut o eroare la √Ænregistrare. √éncearcƒÉ din nou.');
            }
        }

        // Login utilizator
        async function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showAuthError('Te rog completeazƒÉ toate c√¢mpurile!');
                return;
            }

            showAuthLoading();

            try {
                // Simulare timp de procesare
                await new Promise(resolve => setTimeout(resolve, 1500));

                // VerificƒÉ utilizatorul
                const users = JSON.parse(localStorage.getItem('gaztech_users') || '[]');
                const user = users.find(u => u.email === email);

                if (!user) {
                    showAuthError('Email sau parolƒÉ incorectƒÉ!');
                    return;
                }

                const isPasswordValid = await verifyPassword(password, user.password);
                if (!isPasswordValid) {
                    showAuthError('Email sau parolƒÉ incorectƒÉ!');
                    return;
                }

                currentUser = user;

                // VerificƒÉ dacƒÉ are 2FA activat
                if (user.is2FAEnabled) {
                    showVerify2FA();
                } else {
                    // Login direct
                    localStorage.setItem('gaztech_user', JSON.stringify(user));
                    localStorage.setItem('gaztech_authenticated', 'true');
                    
                    showAuthSuccess('Conectare realizatƒÉ cu succes!');
                    
                    setTimeout(() => {
                        afiseazaAplicatia();
                        showNotification('Bun venit √Æn GazTech Services!', 'success');
                    }, 1000);
                }

            } catch (error) {
                console.error('Eroare login:', error);
                showAuthError('A apƒÉrut o eroare la conectare. √éncearcƒÉ din nou.');
            }
        }

        // GenereazƒÉ QR Code pentru 2FA
        function genereazaQRCode() {
        // GenereazƒÉ o cheie secretƒÉ pentru 2FA
const secret = generateSecret();
currentUser.secret2FA = secret;
function genereazaQRCode() {
    // GenereazƒÉ o cheie secretƒÉ pentru 2FA
    const secret = generateSecret();
    currentUser.secret2FA = secret;
    
    // GenereazƒÉ coduri de rezervƒÉ
    backupCodes = generateBackupCodes();
    currentUser.backupCodes = backupCodes;
    
    // CreeazƒÉ URL-ul pentru Google Authenticator
    const appName = 'GazTech Services';
    const userName = currentUser.email;
    const otpUrl = `otpauth://totp/${appName}:${userName}?secret=${secret}&issuer=${appName}`;
    
    // Containerul pentru QR Code
    const qrContainer = document.getElementById('qrCode');
    qrContainer.innerHTML = `
        <div style="background: white; padding: 20px; text-align: center; border-radius: 8px;">
            <div id="qrCodeImage" style="margin-bottom: 15px;">
                <div style="background: #e6fffa; padding: 20px; border-radius: 8px; border: 2px solid #38b2ac;">
                    <div style="font-size: 48px; margin-bottom: 15px;">üì±</div>
                    <p style="color: #2c7a7b; font-weight: 600; margin-bottom: 10px;">
                        <strong>Configurare Google Authenticator</strong>
                    </p>
                    <div style="background: #f0fff4; padding: 15px; border-radius: 6px; margin: 15px 0;">
                        <p style="color: #22543d; font-size: 14px; font-weight: 600; margin-bottom: 10px;">
                            üîß Pa»ôi de configurare:
                        </p>
                        <ol style="color: #22543d; font-size: 13px; text-align: left; margin: 0; padding-left: 20px;">
                            <li>Deschide <strong>Google Authenticator</strong></li>
                            <li>ApasƒÉ <strong>"+"</strong> ‚Üí <strong>"Introduce»õi o cheie de configurare"</strong></li>
                            <li>Nume cont: <strong>GazTech Services</strong></li>
                            <li>Cheia ta: <strong style="color: #e53e3e;">${secret}</strong></li>
                            <li>Tip timp: <strong>Bazat pe timp</strong></li>
                            <li>ApasƒÉ <strong>"AdaugƒÉ"</strong></li>
                        </ol>
                    </div>
                    <div style="background: #fff5f5; padding: 10px; border-radius: 6px; border-left: 4px solid #f56565;">
                        <p style="color: #742a2a; font-size: 12px; margin: 0;">
                            <strong>‚ö†Ô∏è Important:</strong> SalveazƒÉ aceastƒÉ cheie √Æntr-un loc sigur!
                        </p>
                    </div>
                </div>
            </div>
            <div style="background: #f7fafc; padding: 15px; border-radius: 6px;">
                <p style="margin: 0; font-family: monospace; color: #4a5568; font-size: 12px; word-break: break-all;">
                    <strong>Cheia secretƒÉ:</strong><br>
                    <span style="background: #edf2f7; padding: 5px 8px; border-radius: 4px; color: #2d3748; font-weight: bold;">${secret}</span>
                </p>
                <p style="margin: 10px 0 0 0; color: #718096; font-size: 11px;">
                    CopiazƒÉ aceastƒÉ cheie »ôi adaugƒÉ-o manual √Æn Google Authenticator
                </p>
            </div>
        </div>
    `;
    
    // √éncearcƒÉ sƒÉ √Æncarce QR Code dacƒÉ biblioteca devine disponibilƒÉ
    let tentative = 0;
    const checkQRCode = () => {
        tentative++;
        if (window.QRCode) {
            console.log('‚úÖ Biblioteca QR Code gƒÉsitƒÉ!');
            try {
                QRCode.toDataURL(otpUrl, {
                    width: 200,
                    color: {
                        dark: '#1e40af',
                        light: '#ffffff'
                    }
                }, function (error, url) {
                    if (!error) {
                        document.getElementById('qrCodeImage').innerHTML = `
                            <div style="background: #e6fffa; padding: 20px; border-radius: 8px; border: 2px solid #38b2ac;">
                                <img src="${url}" style="border: 2px solid #2d3748; border-radius: 8px; margin-bottom: 15px;" alt="QR Code pentru 2FA">
                                <p style="color: #2c7a7b; font-weight: 600; margin: 0;">
                                    ‚úÖ ScaneazƒÉ acest QR Code cu Google Authenticator
                                </p>
                            </div>
                        `;
                    }
                });
            } catch (e) {
                console.warn('Eroare generare QR:', e);
            }
        } else if (tentative < 10) {
            setTimeout(checkQRCode, 500);
        }
    };
    
    setTimeout(checkQRCode, 100);
}


      // VerificƒÉ »ôi activeazƒÉ 2FA
        async function verify2FASetup() {
            const code = document.getElementById('verify2FACode').value.trim();
            
            if (!code || code.length !== 6) {
                showAuthError('Te rog introdu un cod valid de 6 cifre!');
                return;
            }

            showAuthLoading();

            try {
                // Simulare verificare cod
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // √én produc»õie, aici a»õi verifica codul real cu biblioteca TOTP
                // Pentru demonstra»õie, acceptƒÉm orice cod de 6 cifre
                if (!/^\d{6}$/.test(code)) {
                    showAuthError('Codul introdus nu este valid!');
                    return;
                }

                // ActiveazƒÉ 2FA pentru utilizator
                currentUser.is2FAEnabled = true;
                
                // ActualizeazƒÉ √Æn localStorage
                const users = JSON.parse(localStorage.getItem('gaztech_users') || '[]');
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex] = currentUser;
                    localStorage.setItem('gaztech_users', JSON.stringify(users));
                }

                showAuthSuccess('2FA activat cu succes! IatƒÉ codurile de rezervƒÉ:');

                // Afi»ôeazƒÉ codurile de rezervƒÉ
                const backupContainer = document.getElementById('backupCodes');
                const codesList = document.getElementById('backupCodesList');
                
                let codesHtml = '';
                backupCodes.forEach(code => {
                    codesHtml += `<span class="backup-code">${code}</span>`;
                });
                
                codesList.innerHTML = codesHtml;
                backupContainer.style.display = 'block';

                // ActiveazƒÉ butonul de finalizare
                setTimeout(() => {
                    const finishBtn = document.createElement('button');
                    finishBtn.className = 'auth-btn';
                    finishBtn.textContent = '‚úÖ FINALIZEAZƒÇ CONFIGURAREA';
                    finishBtn.style.marginTop = '20px';
                    finishBtn.onclick = () => {
                        localStorage.setItem('gaztech_user', JSON.stringify(currentUser));
                        localStorage.setItem('gaztech_authenticated', 'true');
                        afiseazaAplicatia();
                        showNotification('Configurare 2FA finalizatƒÉ! Contul este acum securizat.', 'success');
                    };
                    document.getElementById('setup2FA').appendChild(finishBtn);
                }, 2000);

            } catch (error) {
                console.error('Eroare 2FA setup:', error);
                showAuthError('A apƒÉrut o eroare la activarea 2FA. √éncearcƒÉ din nou.');
            }
        }

        // Sari peste 2FA (nu recomandat)
        function skip2FA() {
            if (confirm('E»ôti sigur cƒÉ vrei sƒÉ sari peste configurarea 2FA? Aceasta reduce securitatea contului.')) {
                localStorage.setItem('gaztech_user', JSON.stringify(currentUser));
                localStorage.setItem('gaztech_authenticated', 'true');
                afiseazaAplicatia();
                showNotification('Conectat cu succes. RecomandƒÉm activarea 2FA din SetƒÉri.', 'warning');
            }
        }

        // VerificƒÉ codul 2FA la login
        async function verifyLogin2FA() {
            const code = document.getElementById('login2FACode').value.trim();
            
            if (!code || code.length !== 6) {
                showAuthError('Te rog introdu un cod valid de 6 cifre!');
                return;
            }

            showAuthLoading();

            try {
                // Simulare verificare cod
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // √én produc»õie, aici a»õi verifica codul real
                if (!/^\d{6}$/.test(code)) {
                    showAuthError('Codul 2FA nu este valid!');
                    return;
                }

                // Login cu succes
                localStorage.setItem('gaztech_user', JSON.stringify(currentUser));
                localStorage.setItem('gaztech_authenticated', 'true');
                
                showAuthSuccess('Autentificare 2FA reu»ôitƒÉ!');
                
                setTimeout(() => {
                    afiseazaAplicatia();
                    showNotification('Bun venit √Æn GazTech Services!', 'success');
                }, 1000);

            } catch (error) {
                console.error('Eroare 2FA login:', error);
                showAuthError('A apƒÉrut o eroare la verificarea 2FA. √éncearcƒÉ din nou.');
            }
        }

        // VerificƒÉ cod de rezervƒÉ
        async function verifyBackupCode() {
            const code = document.getElementById('backupCode').value.trim();
            
            if (!code) {
                showAuthError('Te rog introdu un cod de rezervƒÉ!');
                return;
            }

            showAuthLoading();

            try {
                // Simulare verificare cod de rezervƒÉ
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // VerificƒÉ dacƒÉ codul existƒÉ √Æn lista de backup
                if (!currentUser.backupCodes || !currentUser.backupCodes.includes(code)) {
                    showAuthError('Codul de rezervƒÉ nu este valid sau a fost deja folosit!');
                    return;
                }

                // EliminƒÉ codul folosit
                currentUser.backupCodes = currentUser.backupCodes.filter(c => c !== code);
                
                // ActualizeazƒÉ utilizatorul
                const users = JSON.parse(localStorage.getItem('gaztech_users') || '[]');
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex] = currentUser;
                    localStorage.setItem('gaztech_users', JSON.stringify(users));
                }

                // Login cu succes
                localStorage.setItem('gaztech_user', JSON.stringify(currentUser));
                localStorage.setItem('gaztech_authenticated', 'true');
                
                showAuthSuccess('Autentificare cu cod de rezervƒÉ reu»ôitƒÉ!');
                
                setTimeout(() => {
                    afiseazaAplicatia();
                    showNotification(`Bun venit! Mai ai ${currentUser.backupCodes.length} coduri de rezervƒÉ disponibile.`, 'warning');
                }, 1000);

            } catch (error) {
                console.error('Eroare backup code:', error);
                showAuthError('A apƒÉrut o eroare la verificarea codului de rezervƒÉ. √éncearcƒÉ din nou.');
            }
        }

        // Logout
        function logout() {
            if (confirm('E»ôti sigur cƒÉ vrei sƒÉ te deconectezi?')) {
                localStorage.removeItem('gaztech_authenticated');
                currentUser = null;
                
                // ReseteazƒÉ formularele
                document.querySelectorAll('.auth-input').forEach(input => input.value = '');
                
                afiseazaAutentificare();
                showLoginForm();
                showNotification('V-a»õi deconectat cu succes!', 'info');
            }
        }

        // VerificƒÉ statusul 2FA √Æn setƒÉri
        function verificaStatus2FA() {
            const statusEl = document.getElementById('status2FA');
            const textEl = document.getElementById('status2FAText');
            const btnEl = document.getElementById('toggle2FABtn');
            
            if (currentUser && currentUser.is2FAEnabled) {
                statusEl.style.background = '#c6f6d5';
                statusEl.style.color = '#22543d';
                textEl.textContent = 'üõ°Ô∏è Activat - Contul este securizat cu 2FA';
                btnEl.textContent = 'üîì DezactiveazƒÉ 2FA';
                btnEl.className = 'btn btn-danger';
                is2FAEnabled = true;
            } else {
                statusEl.style.background = '#fed7d7';
                statusEl.style.color = '#742a2a';
                textEl.textContent = '‚ö†Ô∏è Dezactivat - RecomandƒÉm activarea pentru securitate';
                btnEl.textContent = 'üõ°Ô∏è ActiveazƒÉ 2FA';
                btnEl.className = 'btn btn-success';
                is2FAEnabled = false;
            }
            
            btnEl.disabled = false;
        }

        // GestioneazƒÉ 2FA din setƒÉri
        function gestioneaza2FA() {
            if (is2FAEnabled) {
                // DezactiveazƒÉ 2FA
                if (confirm('E»ôti sigur cƒÉ vrei sƒÉ dezactivezi 2FA? Aceasta va reduce securitatea contului.')) {
                    currentUser.is2FAEnabled = false;
                    currentUser.secret2FA = null;
                    currentUser.backupCodes = [];
                    
                    // ActualizeazƒÉ √Æn localStorage
                    const users = JSON.parse(localStorage.getItem('gaztech_users') || '[]');
                    const userIndex = users.findIndex(u => u.id === currentUser.id);
                    if (userIndex !== -1) {
                        users[userIndex] = currentUser;
                        localStorage.setItem('gaztech_users', JSON.stringify(users));
                        localStorage.setItem('gaztech_user', JSON.stringify(currentUser));
                    }
                    
                    verificaStatus2FA();
                    showNotification('2FA dezactivat. RecomandƒÉm reactivarea pentru securitate.', 'warning');
                }
            } else {
                // ActiveazƒÉ 2FA - redirec»õioneazƒÉ la configurare
                showNotification('Redirec»õionare cƒÉtre configurarea 2FA...', 'info');
                setTimeout(() => {
                    logout();
                }, 1500);
            }
        }

        // SchimbƒÉ parola
        async function schimbaParola() {
            const parolaVeche = document.getElementById('parolaVeche').value;
            const parolaNoua = document.getElementById('parolaNoua').value;
            const confirmaParola = document.getElementById('confirmaParolaNoua').value;

            if (!parolaVeche || !parolaNoua || !confirmaParola) {
                showNotification('Te rog completeazƒÉ toate c√¢mpurile pentru parolƒÉ!', 'warning');
                return;
            }

            if (parolaNoua.length < 8) {
                showNotification('Parola nouƒÉ trebuie sƒÉ aibƒÉ cel pu»õin 8 caractere!', 'warning');
                return;
            }

            if (parolaNoua !== confirmaParola) {
                showNotification('Parolele nu se potrivesc!', 'warning');
                return;
            }

            try {
                // VerificƒÉ parola veche
                const isOldPasswordValid = await verifyPassword(parolaVeche, currentUser.password);
                if (!isOldPasswordValid) {
                    showNotification('Parola actualƒÉ nu este corectƒÉ!', 'error');
                    return;
                }

                // ActualizeazƒÉ parola
                currentUser.password = await hashPassword(parolaNoua);
                
                // SalveazƒÉ √Æn localStorage
                const users = JSON.parse(localStorage.getItem('gaztech_users') || '[]');
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex] = currentUser;
                    localStorage.setItem('gaztech_users', JSON.stringify(users));
                    localStorage.setItem('gaztech_user', JSON.stringify(currentUser));
                }

                // ReseteazƒÉ c√¢mpurile
                document.getElementById('parolaVeche').value = '';
                document.getElementById('parolaNoua').value = '';
                document.getElementById('confirmaParolaNoua').value = '';

                showNotification('Parola a fost schimbatƒÉ cu succes!', 'success');

            } catch (error) {
                console.error('Eroare schimbare parolƒÉ:', error);
                showNotification('A apƒÉrut o eroare la schimbarea parolei!', 'error');
            }
        }

        // Func»õii helper pentru parole (√Æn produc»õie folosi»õi biblioteci dedicate)
        async function hashPassword(password) {
            // Simulare hash simplu - √Æn produc»õie folosi»õi bcrypt sau similar
            return btoa(password + 'gaztech_salt');
        }

        async function verifyPassword(password, hash) {
            // Simulare verificare hash
            return btoa(password + 'gaztech_salt') === hash;
        }

        // GenereazƒÉ secret pentru 2FA
        function generateSecret() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567';
            let secret = '';
            for (let i = 0; i < 32; i++) {
                secret += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return secret;
        }

        // GenereazƒÉ coduri de rezervƒÉ
        function generateBackupCodes() {
            const codes = [];
            const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
            
            for (let i = 0; i < 10; i++) {
                let code = '';
                for (let j = 0; j < 12; j++) {
                    if (j === 3 || j === 6 || j === 9) code += '-';
                    else code += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                codes.push(code);
            }
            
            return codes;
        }

        // Editare informa»õii cont
        function editareInformatiiCont() {
            const numeField = document.getElementById('setariNume');
            const emailField = document.getElementById('setariEmail');
            
            if (numeField.readOnly) {
                // ActiveazƒÉ editarea
                numeField.readOnly = false;
                emailField.readOnly = false;
                numeField.style.background = 'white';
                emailField.style.background = 'white';
                
                // SchimbƒÉ textul butonului
                event.target.textContent = 'üíæ SalveazƒÉ ModificƒÉrile';
                event.target.onclick = salveazaInformatiiCont;
            }
        }

        function salveazaInformatiiCont() {
            const numeNou = document.getElementById('setariNume').value.trim();
            const emailNou = document.getElementById('setariEmail').value.trim();
            
            if (!numeNou || !emailNou) {
                showNotification('Te rog completeazƒÉ toate c√¢mpurile!', 'warning');
                return;
            }

            // ActualizeazƒÉ informa»õiile
            currentUser.name = numeNou;
            currentUser.email = emailNou;
            
            // SalveazƒÉ √Æn localStorage
            const users = JSON.parse(localStorage.getItem('gaztech_users') || '[]');
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('gaztech_users', JSON.stringify(users));
                localStorage.setItem('gaztech_user', JSON.stringify(currentUser));
            }

            // ActualizeazƒÉ UI
            document.getElementById('currentUser').textContent = numeNou;
            
            // DezactiveazƒÉ editarea
            const numeField = document.getElementById('setariNume');
            const emailField = document.getElementById('setariEmail');
            numeField.readOnly = true;
            emailField.readOnly = true;
            numeField.style.background = '#f7fafc';
            emailField.style.background = '#f7fafc';
            
            // ReseteazƒÉ butonul
            const btn = event.target;
            btn.textContent = '‚úèÔ∏è EditeazƒÉ Informa»õiile';
            btn.onclick = editareInformatiiCont;
            
            showNotification('Informa»õiile contului au fost actualizate!', 'success');
        }

        // SalveazƒÉ setƒÉrile firmei
        function salveazaSetariFirma() {
            const setariNoi = {
                nume: document.getElementById('setariNumeFirma').value.trim(),
                telefon: document.getElementById('setariTelefonFirma').value.trim(),
                email: document.getElementById('setariEmailFirma').value.trim(),
                adresa: document.getElementById('setariAdresaFirma').value.trim()
            };

            if (!setariNoi.nume || !setariNoi.telefon || !setariNoi.email || !setariNoi.adresa) {
                showNotification('Te rog completeazƒÉ toate c√¢mpurile firmei!', 'warning');
                return;
            }

            // ActualizeazƒÉ configurƒÉrile globale
            Object.assign(CONFIGURARI_FIRMA, setariNoi);
            
            // SalveazƒÉ √Æn localStorage
            localStorage.setItem('gaztech_configurari_firma', JSON.stringify(CONFIGURARI_FIRMA));
            
            // ActualizeazƒÉ √Æn interfa»õƒÉ
            actualizeazaTelefonInUI();
            
            showNotification('SetƒÉrile firmei au fost salvate cu succes!', 'success');
        }

        // »òterge toate datele
        function stergeToateDatale() {
            const confirmText = '»òTERGE TOATE DATELE';
            const userInput = prompt(`AceastƒÉ ac»õiune va »ôterge TOATE datele aplica»õiei (abona»õi, programƒÉri, remindere, etc.)!\n\nPentru a confirma, scrie: ${confirmText}`);
            
            if (userInput === confirmText) {
                // »òterge toate datele aplica»õiei, dar pƒÉstreazƒÉ contul de utilizator
                localStorage.removeItem('abonati');
                localStorage.removeItem('programari');
                localStorage.removeItem('remindere');
                
                // ReseteazƒÉ variabilele globale
                abonati = [];
                programari = [];
                remindere = [];
                
                // ActualizeazƒÉ interfa»õa
                sincronizeazaDatele();
                
                showNotification('Toate datele aplica»õiei au fost »ôterse!', 'success');
            } else if (userInput !== null) {
                showNotification('Textul introdus nu este corect. Datele nu au fost »ôterse.', 'warning');
            }
        }

        // »òterge contul complet
        function stergeCont() {
            const confirmText = '»òTERGE CONTUL COMPLET';
            const userInput = prompt(`AceastƒÉ ac»õiune va »ôterge COMPLET contul »ôi toate datele asociate!\n\nVei fi deconectat »ôi nu vei mai putea accesa aplica»õia cu acest cont.\n\nPentru a confirma, scrie: ${confirmText}`);
            
            if (userInput === confirmText) {
                // »òterge contul din lista utilizatorilor
                const users = JSON.parse(localStorage.getItem('gaztech_users') || '[]');
                const updatedUsers = users.filter(u => u.id !== currentUser.id);
                localStorage.setItem('gaztech_users', JSON.stringify(updatedUsers));
                
                // »òterge toate datele locale
                localStorage.removeItem('gaztech_user');
                localStorage.removeItem('gaztech_authenticated');
                localStorage.removeItem('abonati');
                localStorage.removeItem('programari');
                localStorage.removeItem('remindere');
                
                alert('Contul a fost »ôters complet. Vei fi redirec»õionat cƒÉtre pagina de conectare.');
                
                // Redirec»õioneazƒÉ cƒÉtre autentificare
                currentUser = null;
                afiseazaAutentificare();
                showLoginForm();
                
            } else if (userInput !== null) {
                showNotification('Textul introdus nu este corect. Contul nu a fost »ôters.', 'warning');
            }
        }

        // Event listeners pentru autentificare
        document.getElementById('loginBtn').addEventListener('click', login);
        document.getElementById('registerBtn').addEventListener('click', register);
        document.getElementById('verify2FABtn').addEventListener('click', verify2FASetup);
        document.getElementById('skip2FABtn').addEventListener('click', skip2FA);
        document.getElementById('login2FABtn').addEventListener('click', verifyLogin2FA);
        document.getElementById('verifyBackupBtn').addEventListener('click', verifyBackupCode);

        // Enter key support
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const activeForm = document.querySelector('.auth-form:not([style*="display: none"])');
                if (activeForm) {
                    if (activeForm.id === 'loginForm') login();
                    else if (activeForm.id === 'registerForm') register();
                }
                
                const active2FA = document.querySelector('.auth-2fa:not([style*="display: none"])');
                if (active2FA) {
                    if (active2FA.id === 'setup2FA') verify2FASetup();
                    else if (active2FA.id === 'verify2FA') verifyLogin2FA();
                    else if (active2FA.id === 'backup2FA') verifyBackupCode();
                }
            }
        });

        // ===========================================
        // CONFIGURƒÇRI FIRMƒÇ ACTUALIZATE
        // ===========================================
        
        const CONFIGURARI_FIRMA = {
            nume: "GazTech Services",
            telefon: "0762614401",
            email: "gavrila_1971@yahoo.com",
            adresa: "Str. MƒÉrƒÉ»ôe»ôti, Nr.97, Ro»ôiorii de Vede"
        };

        // √éncarcƒÉ configurƒÉrile salvate
        const configurariSalvate = localStorage.getItem('gaztech_configurari_firma');
        if (configurariSalvate) {
            Object.assign(CONFIGURARI_FIRMA, JSON.parse(configurariSalvate));
        }

        // Template-uri de mesaje
        const messageTemplates = {
            expirareRevizie: (nume, zile, servicii) => 
                `üîî BunƒÉ ziua ${nume}!\n\n` +
                `Revizia dumneavoastrƒÉ pentru ${servicii} expirƒÉ √Æn ${zile} zile.\n\n` +
                `Pentru reprogramare, suna»õi la üìû ${CONFIGURARI_FIRMA.telefon}\n\n` +
                `${CONFIGURARI_FIRMA.nume} - Servicii profesionale de instala»õii gaz`,

            plataPendenta: (nume, suma, servicii) => 
                `üí∞ BunƒÉ ziua ${nume}!\n\n` +
                `Ave»õi de plƒÉtit suma de ${suma} Lei pentru:\n${servicii}\n\n` +
                `Pentru platƒÉ: üìû ${CONFIGURARI_FIRMA.telefon}\n\n` +
                `${CONFIGURARI_FIRMA.nume} - Mul»õumim!`,

            confirmareProgramare: (nume, data, serviciu, adresa) => 
                `‚úÖ BunƒÉ ziua ${nume}!\n\n` +
                `ConfirmƒÉm programarea pentru ${serviciu}\n` +
                `üìÖ Data: ${data}\nüìç Adresa: ${adresa}\n\n` +
                `Informa»õii: üìû ${CONFIGURARI_FIRMA.telefon}\n` +
                `${CONFIGURARI_FIRMA.nume}`,

            revizieCompletata: (nume, serviciu, valabilitate) => 
                `‚úÖ BunƒÉ ziua ${nume}!\n\n` +
                `Revizia pentru ${serviciu} a fost finalizatƒÉ cu succes!\n` +
                `üìã Valabilitate: ${valabilitate}\n\n` +
                `${CONFIGURARI_FIRMA.nume} - Mul»õumim pentru √Æncredere!\n` +
                `üìû ${CONFIGURARI_FIRMA.telefon}`,

            abonatNou: (nume, servicii) =>
                `‚úÖ BunƒÉ ziua ${nume}!\n\n` +
                `VƒÉ confirmƒÉm √Ænregistrarea √Æn sistemul ${CONFIGURARI_FIRMA.nume}.\n` +
                `üìã Servicii contractate: ${servicii}\n\n` +
                `Pentru informa»õii: üìû ${CONFIGURARI_FIRMA.telefon}\n` +
                `${CONFIGURARI_FIRMA.nume} - Mul»õumim pentru √Æncredere!`,

            reminderGeneral: (nume, serviciu, zile) =>
                `üîî Reminder ${CONFIGURARI_FIRMA.nume}\n\n` +
                `BunƒÉ ziua ${nume}!\n` +
                `${serviciu} programat √Æn ${zile} zile.\n\n` +
                `Contact: üìû ${CONFIGURARI_FIRMA.telefon}`
        };

        // Func»õie pentru trimitere SMS (simulare)
        async function trimiteNotificare(telefon, mesaj, tip = 'SMS') {
            try {
                if (db && functions) {
                    // Trimite prin Firebase Functions
                    const sendNotification = functions.httpsCallable('sendNotification');
                    const result = await sendNotification({
                        phone: telefon,
                        message: mesaj,
                        type: tip
                    });
                    
                    console.log(`üì± ${tip} trimis cu succes:`, result.data);
                    return { success: true, result: result.data };
                } else {
                    // Simulare pentru demo
                    console.log(`üì± SIMULARE ${tip} cƒÉtre ${telefon}:`);
                    console.log(mesaj);
                    
                    showNotification(`üì± ${tip} trimis cƒÉtre ${telefon}`, 'success');
                    return { success: true, simulated: true };
                }
            } catch (error) {
                console.error(`‚ùå Eroare trimitere ${tip}:`, error);
                showNotification(`‚ùå Eroare trimitere ${tip}: ${error.message}`, 'error');
                return { success: false, error: error.message };
            }
        }

        // FUNC»öIE NOUƒÇ PENTRU WHATSAPP
        function trimiteWhatsApp(telefon, mesaj) {
            // CurƒÉ»õƒÉ numƒÉrul de telefon (eliminƒÉ 0 »ôi adaugƒÉ +40)
            const telefonCurat = telefon.replace(/^0/, '+40').replace(/\s+/g, '');
            
            // Encode mesajul pentru URL
            const mesajEncoded = encodeURIComponent(mesaj);
            
            // CreeazƒÉ link-ul WhatsApp
            const linkWhatsApp = `https://wa.me/${telefonCurat}?text=${mesajEncoded}`;
            
            // Deschide WhatsApp √Æn tab nou
            window.open(linkWhatsApp, '_blank');
            
            console.log(`üì± WHATSAPP cƒÉtre ${telefon}:`);
            console.log('='.repeat(50));
            console.log(mesaj);
            console.log('='.repeat(50));
            console.log(`üîó Link: ${linkWhatsApp}`);
            
            showNotification(`üì± WhatsApp deschis pentru ${telefon}`, 'success');
            return { success: true, whatsappLink: linkWhatsApp };
        }

        // Func»õie pentru notificare expirare revizie
        async function notificaExpirareRevizie(abonat) {
            const servicii = abonat.serviciiContractate ? abonat.serviciiContractate.join(', ') : 'servicii contractate';
            const dataExpirare = new Date(abonat.dataExpirare);
            const astazi = new Date();
            const zileRamase = Math.ceil((dataExpirare - astazi) / (1000 * 60 * 60 * 24));
            
            const mesaj = messageTemplates.expirareRevizie(
                abonat.nume,
                zileRamase,
                servicii
            );
            
            // Afi»ôeazƒÉ mesajul √Æn consolƒÉ pentru demonstra»õie
            console.log('üì± MESAJ TRIMIS:');
            console.log('='.repeat(50));
            console.log(mesaj);
            console.log('='.repeat(50));
            
            return await trimiteNotificare(abonat.telefon, mesaj, 'SMS');
        }

        // Func»õie pentru notificare platƒÉ pendentƒÉ
        async function notificaPlata(abonat) {
            let costTotal = 0;
            if (abonat.serviciiContractate) {
                abonat.serviciiContractate.forEach(serviciu => {
                    switch(serviciu) {
                        case 'Verificare Instala»õie Gaz': costTotal += 150; break;
                        case 'Revizie Instala»õie Gaz': costTotal += 250; break;
                        case 'Verificare CentralƒÉ': costTotal += 150; break;
                        case 'Instala»õii Gaz + CentralƒÉ': costTotal += 250; break;
                    }
                });
            }
            
            const servicii = abonat.serviciiContractate ? abonat.serviciiContractate.join(', ') : 'servicii contractate';
            const mesaj = messageTemplates.plataPendenta(abonat.nume, costTotal, servicii);
            
            console.log('üì± MESAJ PLATƒÇ TRIMIS:');
            console.log('='.repeat(50));
            console.log(mesaj);
            console.log('='.repeat(50));
            
            return await trimiteNotificare(abonat.telefon, mesaj, 'SMS');
        }

        // Func»õie pentru confirmare programare
        async function confirmareProgramare(programare) {
            const abonat = abonati.find(a => a.id == programare.clientId);
            if (!abonat) return;
            
            const data = new Date(programare.data).toLocaleString('ro-RO');
            const adresa = formatareAdresa(abonat.adresa);
            
            const mesaj = messageTemplates.confirmareProgramare(
                abonat.nume,
                data,
                programare.tipServiciu,
                adresa
            );
            
            console.log('üì± CONFIRMARE PROGRAMARE:');
            console.log('='.repeat(50));
            console.log(mesaj);
            console.log('='.repeat(50));
            
            return await trimiteNotificare(abonat.telefon, mesaj, 'SMS');
        }

        // ===========================================
        // FIREBASE FIRESTORE SYNC
        // ===========================================

        // Salvare √Æn Firestore
        async function salveazaInFirestore(colectie, id, data) {
            if (!db) {
                console.log('üì± Firestore nu este disponibil - date salvate local');
                return false;
            }
            
            try {
                await db.collection(colectie).doc(id.toString()).set({
                    ...data,
                    lastModified: firebase.firestore.FieldValue.serverTimestamp(),
                    source: 'gaztech-web-app',
                    userId: currentUser ? currentUser.id : 'anonymous'
                });
                
                console.log(`‚úÖ ${colectie}/${id} salvat √Æn Firestore`);
                return true;
            } catch (error) {
                console.error(`‚ùå Eroare salvare ${colectie}:`, error);
                return false;
            }
        }

        // √éncƒÉrcare din Firestore
        async function incarcaDinFirestore(colectie) {
            if (!db || !currentUser) return [];
            
            try {
                const snapshot = await db.collection(colectie)
                    .where('userId', '==', currentUser.id)
                    .get();
                const data = [];
                
                snapshot.forEach(doc => {
                    data.push({
                        id: parseInt(doc.id) || doc.id,
                        ...doc.data()
                    });
                });
                
                console.log(`‚úÖ ${data.length} √ÆnregistrƒÉri √ÆncƒÉrcate din ${colectie}`);
                return data;
            } catch (error) {
                console.error(`‚ùå Eroare √ÆncƒÉrcare ${colectie}:`, error);
                return [];
            }
        }

        // Sincronizare completƒÉ cu Firestore
        async function sincronizareCuFirestore() {
            if (!db || !currentUser) {
                showNotification('üì± Firestore nu este disponibil sau nu sunte»õi autentificat', 'warning');
                return;
            }
            
            try {
                showNotification('üîÑ Sincronizare cu Firebase...', 'info');
                
                // SalveazƒÉ datele locale √Æn Firestore
                const promiseSalvare = [];
                
                abonati.forEach(abonat => {
                    promiseSalvare.push(salveazaInFirestore('subscribers', abonat.id, abonat));
                });
                
                programari.forEach(programare => {
                    promiseSalvare.push(salveazaInFirestore('appointments', programare.id, programare));
                });
                
                remindere.forEach(reminder => {
                    promiseSalvare.push(salveazaInFirestore('reminders', reminder.id, reminder));
                });
                
                await Promise.all(promiseSalvare);
                
                showNotification('‚úÖ Sincronizare Firebase completƒÉ!', 'success');
                showSyncIndicator();
                
            } catch (error) {
                console.error('‚ùå Eroare sincronizare:', error);
                showNotification('‚ùå Eroare sincronizare Firebase', 'error');
            }
        }

        // ===========================================
        // VERIFICARE AUTOMATƒÇ NOTIFICƒÇRI
        // ===========================================

        function verificaNotificariAutomated() {
            const astazi = new Date();
            
            abonati.forEach(async (abonat) => {
                if (!abonat.dataExpirare) return;
                
                const dataExpirare = new Date(abonat.dataExpirare);
                const zileRamase = Math.ceil((dataExpirare - astazi) / (1000 * 60 * 60 * 24));
                
                // Notificare la 30, 7 »ôi 1 zi √Ænainte de expirare
                if ([30, 7, 1].includes(zileRamase)) {
                    console.log(`üì± Trimite notificare expirare pentru ${abonat.nume} (${zileRamase} zile)`);
                    await notificaExpirareRevizie(abonat);
                    
                    // MarcheazƒÉ notificarea ca trimisƒÉ
                    abonat.ultimaNotificare = astazi.toISOString();
                    saveData();
                }
            });
        }

        // Global Variables
        let abonati = JSON.parse(localStorage.getItem('abonati')) || [];
        let programari = JSON.parse(localStorage.getItem('programari')) || [];
        let remindere = JSON.parse(localStorage.getItem('remindere')) || [];
        let documenteTemp = []; // Temporare pentru upload

        // Sync indicator
        function showSyncIndicator() {
            const indicator = document.getElementById('syncIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        // Navigation
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const navMenu = document.getElementById('navMenu');

        mobileMenuBtn.addEventListener('click', () => {
            navMenu.classList.toggle('active');
            mobileMenuBtn.textContent = navMenu.classList.contains('active') ? '‚úï' : '‚ò∞';
        });

        // Close mobile menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!navMenu.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                navMenu.classList.remove('active');
                mobileMenuBtn.textContent = '‚ò∞';
            }
        });

        // Auto-calculate expiration date and next revision date
        document.getElementById('dataPrimaRevizie').addEventListener('change', calculeazaUrmatoareaRevizie);
        document.getElementById('periodicitateRevizie').addEventListener('change', calculeazaUrmatoareaRevizie);
        document.getElementById('dataRevizieEfectuata').addEventListener('change', calculeazaDataExpirare);

        function calculeazaDataExpirare() {
            const dataRevizie = document.getElementById('dataRevizieEfectuata').value;
            
            if (dataRevizie) {
                const data = new Date(dataRevizie);
                data.setFullYear(data.getFullYear() + 2); // √éntotdeauna 2 ani pentru conformitatea legalƒÉ
                
                const dataFormatata = data.toISOString().split('T')[0];
                document.getElementById('dataExpirare').value = dataFormatata;
                
                // ActualizeazƒÉ »ôi urmƒÉtoarea revizie dacƒÉ nu este deja setatƒÉ
                if (!document.getElementById('dataPrimaRevizie').value) {
                    document.getElementById('dataPrimaRevizie').value = dataRevizie;
                    calculeazaUrmatoareaRevizie();
                }
            } else {
                document.getElementById('dataExpirare').value = '';
            }
        }

        function calculeazaUrmatoareaRevizie() {
            const dataPrima = document.getElementById('dataPrimaRevizie').value;
            const periodicitate = document.getElementById('periodicitateRevizie').value;

            if (dataPrima && periodicitate) {
                const data = new Date(dataPrima);
                data.setFullYear(data.getFullYear() + parseInt(periodicitate));
                
                const dataFormatata = data.toISOString().split('T')[0];
                document.getElementById('dataUrmatoareaRevizie').value = dataFormatata;
            } else {
                document.getElementById('dataUrmatoareaRevizie').value = '';
            }
        }

        // Initialize file upload
        function initializeFileUpload() {
            const fileUploadArea = document.getElementById('fileUploadArea');
            const fileInput = document.getElementById('fileInput');
            
            if (!fileUploadArea || !fileInput) return;

            fileUploadArea.addEventListener('click', () => {
                fileInput.click();
            });

            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.classList.add('dragover');
            });

            fileUploadArea.addEventListener('dragleave', () => {
                fileUploadArea.classList.remove('dragover');
            });

            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });

            fileInput.addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });
        }

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (file.size > 5 * 1024 * 1024) { // 5MB limit
                    showNotification(`Fi»ôierul ${file.name} este prea mare (max 5MB)`, 'error');
                    return;
                }

                const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'image/jpeg', 'image/png'];
                if (!allowedTypes.includes(file.type)) {
                    showNotification(`Tipul fi»ôierului ${file.name} nu este permis`, 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    const documentNou = {
                        id: Date.now() + Math.random(),
                        nume: file.name,
                        tip: file.type,
                        marime: file.size,
                        continut: e.target.result.split(',')[1], // Base64 fƒÉrƒÉ header
                        dataIncarcare: new Date().toISOString()
                    };

                    documenteTemp.push(documentNou);
                    afiseazaListaFisiere();
                    showNotification(`Fi»ôierul ${file.name} a fost √ÆncƒÉrcat`, 'success');
                };
                reader.readAsDataURL(file);
            });
        }

        function afiseazaListaFisiere() {
            const fileList = document.getElementById('fileList');
            if (!fileList || documenteTemp.length === 0) {
                if (fileList) fileList.innerHTML = '';
                return;
            }

            let html = '<h4 style="color: #4a5568; margin-bottom: 15px;">üìÑ Fi»ôiere √ÆncƒÉrcate:</h4>';
            
            documenteTemp.forEach(doc => {
                const marimeMB = (doc.marime / (1024 * 1024)).toFixed(2);
                const iconFisier = getFileIcon(doc.tip);
                
                html += `
                    <div class="file-item">
                        <div class="file-info">
                            <span class="file-icon">${iconFisier}</span>
                            <div class="file-details">
                                <span class="file-name">${doc.nume}</span>
                                <span class="file-size">${marimeMB} MB ‚Ä¢ ${new Date(doc.dataIncarcare).toLocaleDateString('ro-RO')}</span>
                            </div>
                        </div>
                        <button class="btn btn-danger btn-small" onclick="stergeFisierTemp(${doc.id})" title="»òterge fi»ôier">üóëÔ∏è</button>
                    </div>
                `;
            });

            fileList.innerHTML = html;
        }

        function getFileIcon(tipFisier) {
            switch(tipFisier) {
                case 'application/pdf': return 'üìÑ';
                case 'application/msword':
                case 'application/vnd.openxmlformats-officedocument.wordprocessingml.document': return 'üìù';
                case 'image/jpeg':
                case 'image/png': return 'üñºÔ∏è';
                default: return 'üìé';
            }
        }

        function stergeFisierTemp(idFisier) {
            documenteTemp = documenteTemp.filter(doc => doc.id !== idFisier);
            afiseazaListaFisiere();
            showNotification('Fi»ôierul a fost »ôters', 'success');
        }

        function gestioneazaDocumente(idAbonat) {
            const abonat = abonati.find(a => a.id === idAbonat);
            if (!abonat) return;

            const modal = document.getElementById('modalDocumente');
            const continut = document.getElementById('continutModalDocumente');
            
            let html = `
                <h3 style="color: #4a5568; margin-bottom: 20px;">üìé Documente pentru ${abonat.nume}</h3>
                
                <div class="file-upload-area" onclick="document.getElementById('modalFileInput').click()">
                    <div style="font-size: 48px; color: #cbd5e0; margin-bottom: 15px;">üìÑ</div>
                    <p style="color: #4a5568; font-weight: 600; margin-bottom: 10px;">AdaugƒÉ documente noi</p>
                    <p style="color: #718096; font-size: 14px;">Click pentru a selecta fi»ôiere</p>
                    <input type="file" id="modalFileInput" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" style="display: none;">
                </div>
                
                <div style="margin-top: 30px;">
                    <h4 style="color: #4a5568; margin-bottom: 15px;">üìÅ Documente existente:</h4>
                    <div id="documenteExistente">
            `;

            if (abonat.documente && abonat.documente.length > 0) {
                abonat.documente.forEach(doc => {
                    const marimeMB = (doc.marime / (1024 * 1024)).toFixed(2);
                    const iconFisier = getFileIcon(doc.tip);
                    
                    html += `
                        <div class="file-item">
                            <div class="file-info">
                                <span class="file-icon">${iconFisier}</span>
                                <div class="file-details">
                                    <span class="file-name">${doc.nume}</span>
                                    <span class="file-size">${marimeMB} MB ‚Ä¢ ${new Date(doc.dataIncarcare).toLocaleDateString('ro-RO')}</span>
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn btn-secondary btn-small" onclick="descarcaDocument(${abonat.id}, ${doc.id})" title="DescarcƒÉ">üì•</button>
                                <button class="btn btn-danger btn-small" onclick="stergeDocument(${abonat.id}, ${doc.id})" title="»òterge">üóëÔ∏è</button>
                            </div>
                        </div>
                    `;
                });
            } else {
                html += '<p style="color: #718096; text-align: center; padding: 20px;">Nu existƒÉ documente √ÆncƒÉrcate</p>';
            }

            html += `
                    </div>
                </div>
                
                <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: flex-end;">
                    <button class="btn btn-secondary" onclick="inchideModalDocumente()">√énchide</button>
                </div>
            `;

            continut.innerHTML = html;

            // Add event listener for new file uploads
            document.getElementById('modalFileInput').addEventListener('change', (e) => {
                adaugaDocumenteExistente(idAbonat, e.target.files);
            });

            modal.style.display = 'block';
        }

        function adaugaDocumenteExistente(idAbonat, files) {
            const abonat = abonati.find(a => a.id === idAbonat);
            if (!abonat) return;

            if (!abonat.documente) abonat.documente = [];

            Array.from(files).forEach(file => {
                if (file.size > 5 * 1024 * 1024) {
                    showNotification(`Fi»ôierul ${file.name} este prea mare (max 5MB)`, 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    const documentNou = {
                        id: Date.now() + Math.random(),
                        nume: file.name,
                        tip: file.type,
                        marime: file.size,
                        continut: e.target.result.split(',')[1],
                        dataIncarcare: new Date().toISOString()
                    };

                    abonat.documente.push(documentNou);
                    saveData();
                    showNotification(`Documentul ${file.name} a fost adƒÉugat`, 'success');
                    
                    // Re√ÆmprospƒÉteazƒÉ modalul
                    gestioneazaDocumente(idAbonat);
                    updateListaAbonati();
                    showSyncIndicator();
                };
                reader.readAsDataURL(file);
            });
        }

        function descarcaDocument(idAbonat, idDocument) {
            const abonat = abonati.find(a => a.id === idAbonat);
            if (!abonat || !abonat.documente) return;

            const document = abonat.documente.find(d => d.id === idDocument);
            if (!document) return;

            const link = document.createElement('a');
            link.href = `data:${document.tip};base64,${document.continut}`;
            link.download = document.nume;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showNotification(`Documentul ${document.nume} a fost descƒÉrcat`, 'success');
        }

        function stergeDocument(idAbonat, idDocument) {
            if (!confirm('E»ôti sigur cƒÉ vrei sƒÉ »ôtergi acest document?')) return;

            const abonat = abonati.find(a => a.id === idAbonat);
            if (!abonat || !abonat.documente) return;

            const document = abonat.documente.find(d => d.id === idDocument);
            if (!document) return;

            abonat.documente = abonat.documente.filter(d => d.id !== idDocument);
            saveData();
            showNotification(`Documentul ${document.nume} a fost »ôters`, 'success');
            
            // Re√ÆmprospƒÉteazƒÉ modalul »ôi lista
            gestioneazaDocumente(idAbonat);
            updateListaAbonati();
            showSyncIndicator();
        }

        function inchideModalDocumente() {
            document.getElementById('modalDocumente').style.display = 'none';
        }

        // Section navigation
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            // Remove active class from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });

            // Show target section
            document.getElementById(sectionId).classList.add('active');

            // Add active class to corresponding nav link
            document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');

            // Close mobile menu
            navMenu.classList.remove('active');
            mobileMenuBtn.textContent = '‚ò∞';

            // Update data when showing sections - SINCRONIZARE AUTOMATƒÇ
            sincronizeazaDatele();
            
            if (sectionId === 'dashboard') {
                updateDashboard();
                verificaReminderePendente();
            } else if (sectionId === 'abonati') {
                updateListaAbonati();
                verificaAlerteAbonati();
            } else if (sectionId === 'programari') {
                updateListaProgramari();
                verificaAlerteProgramari();
            } else if (sectionId === 'remindere') {
                updateListaRemindere();
                verificaAlerteRemindere();
            } else if (sectionId === 'rapoarte') {
                updateRapoarte();
            } else if (sectionId === 'setari') {
                // Sec»õiunea setƒÉri se gestioneazƒÉ automat
            }
        }

        // FUNC»öIE DE SINCRONIZARE CENTRALIZATƒÇ
        function sincronizeazaDatele() {
            // ActualizeazƒÉ toate dropdown-urile cu abona»õi
            updateClientDropdowns();
            
            // ActualizeazƒÉ statisticile √Æn toate sec»õiunile
            updateDashboard();
            updateRapoarte();
            
            // VerificƒÉ reminder-urile »ôi alertele
            verificaReminderePendente();
            verificaAlerteAbonati();
            verificaAlerteProgramari();
            verificaAlerteRemindere();
            
            showSyncIndicator();
        }

        // Add event listeners to nav links
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const sectionId = link.getAttribute('data-section');
                if (sectionId) {
                    showSection(sectionId);
                }
            });
        });

        // Notification system
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // FUNC»öII PENTRU NOTIFICƒÇRI INDIVIDUALE
        async function trimiteNotificareExpirare(idAbonat) {
            const abonat = abonati.find(a => a.id === idAbonat);
            if (!abonat) return;
            
            const rezultat = await notificaExpirareRevizie(abonat);
            if (rezultat.success) {
                // MarcheazƒÉ notificarea ca trimisƒÉ
                abonat.ultimaNotificare = new Date().toISOString();
                abonat.numarNotificari = (abonat.numarNotificari || 0) + 1;
                saveData();
                
                // SincronizeazƒÉ cu Firebase
                if (db && currentUser) {
                    await salveazaInFirestore('subscribers', abonat.id, abonat);
                }
                
                updateListaAbonati();
            }
        }

        // FUNC»öIE NOUƒÇ PENTRU WHATSAPP EXPIRARE
        function trimiteWhatsAppExpirare(idAbonat) {
            const abonat = abonati.find(a => a.id === idAbonat);
            if (!abonat) return;
            
            const servicii = abonat.serviciiContractate ? abonat.serviciiContractate.join(', ') : 'servicii contractate';
            const dataExpirare = new Date(abonat.dataExpirare);
            const astazi = new Date();
            const zileRamase = Math.ceil((dataExpirare - astazi) / (1000 * 60 * 60 * 24));
            
            const mesaj = messageTemplates.expirareRevizie(abonat.nume, zileRamase, servicii);
            
            // Trimite pe WhatsApp
            trimiteWhatsApp(abonat.telefon, mesaj);
            
            // MarcheazƒÉ ca trimis
            abonat.ultimaNotificare = new Date().toISOString();
            abonat.numarNotificari = (abonat.numarNotificari || 0) + 1;
            saveData();
            
            updateListaAbonati();
        }

        // FUNC»öIE PENTRU WHATSAPP EXPIRARE/PLATƒÇ
        function trimiteWhatsAppReminder(idAbonat, tipReminder, detalii) {
            const abonat = abonati.find(a => a.id === idAbonat);
            if (!abonat) return;
            
            let mesajReminder = '';
            
            // Mesaje pentru expirƒÉri
            if (tipReminder.includes('Expirare') || tipReminder.includes('Verificare') || tipReminder.includes('Revizie')) {
                const servicii = abonat.serviciiContractate ? abonat.serviciiContractate.join(', ') : 'serviciile contractate';
                
                if (detalii.includes('Expirat')) {
                    mesajReminder = `üö® URGENT - ${CONFIGURARI_FIRMA.nume}\n\n` +
                        `BunƒÉ ziua ${abonat.nume}!\n\n` +
                        `Verificarea/Revizia pentru ${servicii} a EXPIRAT.\n\n` +
                        `üîß Pentru reprogramare urgentƒÉ:\n` +
                        `üìû Suna»õi la ${CONFIGURARI_FIRMA.telefon}\n\n` +
                        `Este obligatoriu sƒÉ reface»õi verificarea conform legii!\n\n` +
                        `${CONFIGURARI_FIRMA.nume}`;
                } else {
                    const zileText = detalii.includes('30') ? '30 de zile' : '7 zile';
                    mesajReminder = messageTemplates.expirareRevizie(abonat.nume, zileText, servicii);
                }
            }
            
            // Mesaje pentru plƒÉ»õi
            else if (tipReminder.includes('PlatƒÉ') || tipReminder.includes('Facturare')) {
                let costTotal = 0;
                if (abonat.serviciiContractate) {
                    abonat.serviciiContractate.forEach(serviciu => {
                        switch(serviciu) {
                            case 'Verificare Instala»õie Gaz': costTotal += 150; break;
                            case 'Revizie Instala»õie Gaz': costTotal += 250; break;
                            case 'Verificare CentralƒÉ': costTotal += 150; break;
                            case 'Instala»õii Gaz + CentralƒÉ': costTotal += 250; break;
                        }
                    });
                }
                const servicii = abonat.serviciiContractate ? abonat.serviciiContractate.join(', ') : 'serviciile efectuate';
                mesajReminder = messageTemplates.plataPendenta(abonat.nume, costTotal, servicii);
            }
            
            // Mesaje generale
            else {
                mesajReminder = `üìã ${CONFIGURARI_FIRMA.nume}\n\n` +
                    `BunƒÉ ziua ${abonat.nume}!\n\n` +
                    `Reminder: ${tipReminder}\n` +
                    `Detalii: ${detalii}\n\n` +
                    `Pentru informa»õii:\nüìû ${CONFIGURARI_FIRMA.telefon}\n\n` +
                    `${CONFIGURARI_FIRMA.nume}`;
            }
            
            trimiteWhatsApp(abonat.telefon, mesajReminder);
            
            // MarcheazƒÉ ca trimis
            abonat.ultimaNotificare = new Date().toISOString();
            abonat.numarNotificari = (abonat.numarNotificari || 0) + 1;
            saveData();
            
            updateListaAbonati();
        }

        async function trimiteNotificarePlata(idAbonat) {
            const abonat = abonati.find(a => a.id === idAbonat);
            if (!abonat) return;
            
            const rezultat = await notificaPlata(abonat);
            if (rezultat.success) {
                abonat.ultimaNotificare = new Date().toISOString();
                abonat.numarNotificari = (abonat.numarNotificari || 0) + 1;
                saveData();
                
                if (db && currentUser) {
                    await salveazaInFirestore('subscribers', abonat.id, abonat);
                }
                
                updateListaAbonati();
            }
        }

        // FUNC»öII PENTRU NOTIFICƒÇRI √éN MASƒÇ
        async function trimiteNotificariInMasa() {
            if (!confirm('Trimite»õi notificƒÉri pentru toate reviziile care expirƒÉ √Æn urmƒÉtoarele 30 de zile?')) {
                return;
            }
            
            const astazi = new Date();
            const in30Zile = new Date(astazi.getTime() + 30 * 24 * 60 * 60 * 1000);
            
            const abonatiDeNotificat = abonati.filter(abonat => {
                if (!abonat.dataExpirare) return false;
                const dataExp = new Date(abonat.dataExpirare);
                return dataExp >= astazi && dataExp <= in30Zile;
            });
            
            if (abonatiDeNotificat.length === 0) {
                showNotification('Nu existƒÉ abona»õi cu revizii care expirƒÉ √Æn urmƒÉtoarele 30 de zile', 'info');
                return;
            }
            
            showNotification(`üì± Trimitere ${abonatiDeNotificat.length} notificƒÉri...`, 'info');
            
            let trimiseCuSucces = 0;
            for (const abonat of abonatiDeNotificat) {
                const rezultat = await notificaExpirareRevizie(abonat);
                if (rezultat.success) {
                    abonat.ultimaNotificare = new Date().toISOString();
                    abonat.numarNotificari = (abonat.numarNotificari || 0) + 1;
                    trimiseCuSucces++;
                }
                
                // PauzƒÉ √Æntre notificƒÉri pentru a nu supra√ÆncƒÉrca sistemul
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            saveData();
            showNotification(`‚úÖ ${trimiseCuSucces}/${abonatiDeNotificat.length} notificƒÉri trimise cu succes!`, 'success');
        }

        // FUNC»öIE TEST WHATSAPP
        function testeazaWhatsApp() {
            const mesajTest = `üß™ Test WhatsApp - ${CONFIGURARI_FIRMA.nume}\n\n` +
                `Acesta este un mesaj de test pentru a verifica func»õionarea WhatsApp.\n\n` +
                `DacƒÉ primi»õi acest mesaj, sistemul func»õioneazƒÉ corect!\n\n` +
                `üìû ${CONFIGURARI_FIRMA.telefon}\n` +
                `${CONFIGURARI_FIRMA.nume}`;
            
            // Folose»ôte numƒÉrul firmei pentru test
            trimiteWhatsApp(CONFIGURARI_FIRMA.telefon, mesajTest);
        }

        // Func»õie pentru actualizarea telefonului √Æn UI
        function actualizeazaTelefonInUI() {
            // ActualizeazƒÉ telefonul firmei √Æn toate locurile
            const telefonElements = document.querySelectorAll('#telefonFirma, #telefonAlert1, #telefonAlert2');
            telefonElements.forEach(element => {
                if (element) {
                    element.textContent = CONFIGURARI_FIRMA.telefon;
                }
            });
        }

        // Verificare status Firebase
        function verificaStatusFirebase() {
            const statusElement = document.getElementById('firebaseStatus');
            if (statusElement) {
                if (db) {
                    statusElement.textContent = '‚úÖ Conectat';
                    statusElement.style.color = '#22543d';
                } else {
                    statusElement.textContent = '‚ùå Offline';
                    statusElement.style.color = '#742a2a';
                }
            }
        }

        // √éncƒÉrcare ini»õialƒÉ din Firebase
        async function incarcareInitialaDinFirebase() {
            if (!db || !currentUser) return;
            
            try {
                showNotification('üîÑ √éncƒÉrcare date din Firebase...', 'info');
                
                const [firestoreAbonati, firestoreProgramari, firestoreRemindere] = await Promise.all([
                    incarcaDinFirestore('subscribers'),
                    incarcaDinFirestore('appointments'),
                    incarcaDinFirestore('reminders')
                ]);
                
                // √émbinƒÉ datele locale cu cele din Firebase (prioritate Firebase)
                if (firestoreAbonati.length > 0) {
                    abonati = firestoreAbonati;
                }
                
                if (firestoreProgramari.length > 0) {
                    programari = firestoreProgramari;
                }
                
                if (firestoreRemindere.length > 0) {
                    remindere = firestoreRemindere;
                }
                
                // SalveazƒÉ local datele actualizate
                localStorage.setItem('abonati', JSON.stringify(abonati));
                localStorage.setItem('programari', JSON.stringify(programari));
                localStorage.setItem('remindere', JSON.stringify(remindere));
                
                showNotification('‚úÖ Date √ÆncƒÉrcate din Firebase!', 'success');
                
            } catch (error) {
                console.error('‚ùå Eroare √ÆncƒÉrcare Firebase:', error);
                showNotification('‚ö†Ô∏è Eroare √ÆncƒÉrcare Firebase - se folosesc datele locale', 'warning');
            }
        }

        // Modificare func»õia saveData pentru a include Firebase
        function saveData() {
            // SalveazƒÉ local cu user ID pentru izolare
            const userKey = currentUser ? `_${currentUser.id}` : '';
            localStorage.setItem(`abonati${userKey}`, JSON.stringify(abonati));
            localStorage.setItem(`programari${userKey}`, JSON.stringify(programari));
            localStorage.setItem(`remindere${userKey}`, JSON.stringify(remindere));
            
            // Sincronizare automatƒÉ cu Firebase
            if (db && currentUser) {
                setTimeout(() => {
                    sincronizareCuFirestore();
                }, 500);
            }
            
            // Sincronizare automatƒÉ dupƒÉ salvare
            setTimeout(() => {
                sincronizeazaDatele();
            }, 100);
        }

        // √éncƒÉrcare date specifice utilizatorului
        function loadUserData() {
            if (!currentUser) return;
            
            const userKey = `_${currentUser.id}`;
            abonati = JSON.parse(localStorage.getItem(`abonati${userKey}`) || '[]');
            programari = JSON.parse(localStorage.getItem(`programari${userKey}`) || '[]');
            remindere = JSON.parse(localStorage.getItem(`remindere${userKey}`) || '[]');
        }

        // Get selected services
        function getServiciiSelectate() {
            const servicii = [];
            const checkboxes = document.querySelectorAll('#serviciu_verificare_gaz, #serviciu_revizie_gaz, #serviciu_verificare_centrala, #serviciu_pachet_complet');
            
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    servicii.push(checkbox.value);
                }
            });
            
            return servicii;
        }

        // Get total cost of selected services
        function calculeazaCostTotal() {
            const servicii = getServiciiSelectate();
            let costTotal = 0;
            
            servicii.forEach(serviciu => {
                switch(serviciu) {
                    case 'Verificare Instala»õie Gaz':
                        costTotal += 150;
                        break;
                    case 'Revizie Instala»õie Gaz':
                        costTotal += 250;
                        break;
                    case 'Verificare CentralƒÉ':
                        costTotal += 150;
                        break;
                    case 'Instala»õii Gaz + CentralƒÉ':
                        costTotal += 250;
                        break;
                }
            });
            
            return costTotal;
        }

        // Update cost display
        function actualizareaCostului() {
            const costTotal = calculeazaCostTotal();
            const valoareElement = document.getElementById('valoareTotala');
            if (valoareElement) {
                valoareElement.textContent = costTotal;
                
                // Add animation when cost changes
                if (costTotal > 0) {
                    valoareElement.style.color = '#38a169';
                    valoareElement.style.fontSize = '20px';
                } else {
                    valoareElement.style.color = '#2c7a7b';
                    valoareElement.style.fontSize = '18px';
                }
            }
        }

        // Add event listeners for cost calculation
        function adaugaListeneriCost() {
            const checkboxes = document.querySelectorAll('#serviciu_verificare_gaz, #serviciu_revizie_gaz, #serviciu_verificare_centrala, #serviciu_pachet_complet');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', actualizareaCostului);
            });
        }

        // Create automatic reminder for revision
        function creeazaReminderAutomat(abonat) {
            if (!abonat.dataUrmatoareaRevizie || !abonat.zileNotificare) return;

            const dataUrmatoarei = new Date(abonat.dataUrmatoareaRevizie);
            const dataReminder = new Date(dataUrmatoarei);
            dataReminder.setDate(dataReminder.getDate() - parseInt(abonat.zileNotificare));

            // VerificƒÉ dacƒÉ data reminder-ului nu a trecut deja
            if (dataReminder > new Date()) {
                // CalculeazƒÉ costul total
                let costTotal = 0;
                if (abonat.serviciiContractate) {
                    abonat.serviciiContractate.forEach(serviciu => {
                        switch(serviciu) {
                            case 'Verificare Instala»õie Gaz': costTotal += 150; break;
                            case 'Revizie Instala»õie Gaz': costTotal += 250; break;
                            case 'Verificare CentralƒÉ': costTotal += 150; break;
                            case 'Instala»õii Gaz + CentralƒÉ': costTotal += 250; break;
                        }
                    });
                }

                const reminderAutomat = {
                    id: Date.now() + Math.random(),
                    clientId: abonat.id,
                    clientNume: abonat.nume,
                    tip: 'Verificare/Revizie AutomatƒÉ',
                    data: dataReminder.toISOString(),
                    prioritate: '√énaltƒÉ',
                    mesaj: `REVIZIE EXPIRING pentru ${abonat.nume} - Servicii: ${abonat.serviciiContractate.join(', ')} - Cost total: ${costTotal} Lei - Adresa: ${formatareAdresa(abonat.adresa)} - Tel: ${abonat.telefon}`,
                    status: 'Activ',
                    tipAutomat: 'revizie',
                    dataCreare: new Date().toISOString()
                };

                remindere.push(reminderAutomat);
                
                // CreeazƒÉ »ôi programarea automatƒÉ
                const programareAutomata = {
                    id: Date.now() + Math.random() + 1,
                    clientId: abonat.id,
                    clientNume: abonat.nume,
                    tipServiciu: 'Verificare/Revizie ProgramatƒÉ',
                    data: abonat.dataUrmatoareaRevizie,
                    status: 'ProgramatƒÉ',
                    observatii: `Revizie automatƒÉ - Servicii: ${abonat.serviciiContractate.join(', ')} - Cost: ${costTotal} Lei - Valabilitate: 2 ani`,
                    tipAutomat: 'revizie',
                    dataCreare: new Date().toISOString()
                };

                programari.push(programareAutomata);
            }
        }

        function formatareAdresa(adresa) {
            let adresaCompleta = adresa.oras;
            if (adresa.strada) adresaCompleta += `, ${adresa.strada}`;
            if (adresa.numar) adresaCompleta += ` ${adresa.numar}`;
            if (adresa.numeBlocAbonat) adresaCompleta += `, ${adresa.numeBlocAbonat}`;
            if (adresa.scara) adresaCompleta += `, Sc. ${adresa.scara}`;
            if (adresa.etaj) adresaCompleta += `, Et. ${adresa.etaj}`;
            if (adresa.apartament) adresaCompleta += `, Ap. ${adresa.apartament}`;
            return adresaCompleta;
        }

        // FUNC»öII DE VERIFICARE ALERTE SPECIFICE
        function verificaAlerteAbonati() {
            const alerteContainer = document.getElementById('alerteAbonati');
            let alerteHtml = '';

            // VerificƒÉ abona»õii fƒÉrƒÉ documente
            const abonatiLipsaDocumente = abonati.filter(abonat => !abonat.documente || abonat.documente.length === 0);
            
            // VerificƒÉ expirƒÉri √Æn urmƒÉtoarele 30 de zile
            const astazi = new Date();
            const in30Zile = new Date(astazi.getTime() + 30 * 24 * 60 * 60 * 1000);
            const expiraInCurand = abonati.filter(abonat => {
                if (!abonat.dataExpirare) return false;
                const dataExp = new Date(abonat.dataExpirare);
                return dataExp >= astazi && dataExp <= in30Zile;
            });

            if (abonatiLipsaDocumente.length > 0) {
                alerteHtml += `
                    <div class="alert alert-warning">
                        <strong>üìé Documente LipsƒÉ!</strong> ${abonatiLipsaDocumente.length} abona»õi nu au documente √ÆncƒÉrcate.
                    </div>
                `;
            }

            if (expiraInCurand.length > 0) {
                alerteHtml += `
                    <div class="alert alert-danger">
                        <strong>‚ö†Ô∏è ExpirƒÉri √Æn 30 zile!</strong> ${expiraInCurand.length} revizii expirƒÉ √Æn urmƒÉtoarele 30 de zile.
                    </div>
                `;
            }

            if (alerteContainer) {
                alerteContainer.innerHTML = alerteHtml;
            }
        }

        function verificaAlerteProgramari() {
            const alerteContainer = document.getElementById('alerteProgramari');
            let alerteHtml = '';

            const astazi = new Date();
            const programariAstazi = programari.filter(p => {
                const dataProgramare = new Date(p.data);
                return dataProgramare.toDateString() === astazi.toDateString() && p.status === 'ProgramatƒÉ';
            });

            if (programariAstazi.length > 0) {
                alerteHtml += `
                    <div class="alert alert-info">
                        <strong>üìÖ ProgramƒÉri AstƒÉzi!</strong> Ai ${programariAstazi.length} programƒÉri pentru astƒÉzi.
                    </div>
                `;
            }

            if (alerteContainer) {
                alerteContainer.innerHTML = alerteHtml;
            }
        }

        function verificaAlerteRemindere() {
            const alerteContainer = document.getElementById('alerteRemindere');
            let alerteHtml = '';

            const astazi = new Date();
            const remindereUrgente = remindere.filter(r => {
                const dataReminder = new Date(r.data);
                const diferenta = Math.ceil((dataReminder - astazi) / (1000 * 60 * 60 * 24));
                return diferenta >= 0 && diferenta <= 1 && r.status === 'Activ';
            });

            if (remindereUrgente.length > 0) {
                alerteHtml += `
                    <div class="alert alert-warning">
                        <strong>üîî Remindere Urgente!</strong> ${remindereUrgente.length} remindere expirƒÉ √Æn urmƒÉtoarele 24 ore.
                    </div>
                `;
            }

            if (alerteContainer) {
                alerteContainer.innerHTML = alerteHtml;
            }
        }

        // Abona»õi Functions
        function adaugaAbonat() {
            const tipClient = document.getElementById('tipClient').value;
            const nume = document.getElementById('numeAbonat').value.trim();
            const telefon = document.getElementById('telefonAbonat').value.trim();
            const email = document.getElementById('emailAbonat').value.trim();
            const cnp = document.getElementById('cnpAbonat').value.trim();
            const oras = document.getElementById('orasAbonat').value;
            const strada = document.getElementById('stradaAbonat').value.trim();
            const numar = document.getElementById('numarAbonat').value.trim();
            const tipAdresa = document.getElementById('tipAdresa').value;
            const numeBlocAbonat = document.getElementById('numeBlocAbonat').value.trim();
            const scara = document.getElementById('scaraAbonat').value.trim();
            const etaj = document.getElementById('etajAbonat').value.trim();
            const apartament = document.getElementById('apartamentAbonat').value.trim();
            const dataRevizieEfectuata = document.getElementById('dataRevizieEfectuata').value;
            const dataExpirare = document.getElementById('dataExpirare').value;
            const dataPrimaRevizie = document.getElementById('dataPrimaRevizie').value;
            const periodicitateRevizie = document.getElementById('periodicitateRevizie').value;
            const dataUrmatoareaRevizie = document.getElementById('dataUrmatoareaRevizie').value;
            const zileNotificare = document.getElementById('zileNotificare').value;
            const serviciiContractate = getServiciiSelectate();

            if (!tipClient) {
                showNotification('Te rog selecteazƒÉ tipul clientului!', 'warning');
                return;
            }

            if (!nume || !telefon || !oras) {
                showNotification('Te rog completeazƒÉ toate c√¢mpurile obligatorii!', 'warning');
                return;
            }

            // VerificƒÉ dacƒÉ abonatul existƒÉ deja
            const abonatExistent = abonati.find(abonat => 
                abonat.telefon === telefon || (cnp && abonat.cnp === cnp)
            );

            if (abonatExistent) {
                showNotification('Abonatul existƒÉ deja √Æn baza de date!', 'error');
                return;
            }

            const abonatNou = {
                id: Date.now(),
                tipClient,
                nume,
                telefon,
                email,
                cnp,
                adresa: {
                    oras,
                    strada,
                    numar,
                    tipAdresa,
                    numeBlocAbonat,
                    scara,
                    etaj,
                    apartament
                },
                serviciiContractate,
                dataRevizieEfectuata,
                dataExpirare,
                dataPrimaRevizie,
                periodicitateRevizie,
                dataUrmatoareaRevizie,
                zileNotificare,
                documente: [...documenteTemp], // AdaugƒÉ documentele √ÆncƒÉrcate
                dataCreare: new Date().toISOString(),
                status: 'Activ',
                userId: currentUser ? currentUser.id : null
            };

            abonati.push(abonatNou);

            // CreeazƒÉ reminder »ôi programare automatƒÉ pentru revizie
            if (dataUrmatoareaRevizie && zileNotificare) {
                creeazaReminderAutomat(abonatNou);
            }

            // NOTIFICARE AUTOMATƒÇ PENTRU ABONAT NOU
            setTimeout(async () => {
                const servicii = serviciiContractate.join(', ');
                const mesaj = messageTemplates.abonatNou(nume, servicii);
                
                console.log('üì± MESAJ ABONAT NOU:');
                console.log('='.repeat(50));
                console.log(mesaj);
                console.log('='.repeat(50));
                
                await trimiteNotificare(telefon, mesaj, 'SMS');
                abonatNou.numarNotificari = 1;
                abonatNou.ultimaNotificare = new Date().toISOString();
                saveData();
            }, 1000);

            saveData();
            resetFormAbonat();
            
            const costTotal = calculeazaCostTotal();
            showNotification(`Abonatul ${nume} a fost adƒÉugat cu succes! ${documenteTemp.length > 0 ? `(${documenteTemp.length} documente √ÆncƒÉrcate)` : ''} ${dataUrmatoareaRevizie ? 'Reminder »ôi programare automatƒÉ create!' : ''} üì± Notificare trimisƒÉ!`, 'success');
        }

        function resetFormAbonat() {
            document.getElementById('tipClient').value = '';
            document.getElementById('numeAbonat').value = '';
            document.getElementById('telefonAbonat').value = '';
            document.getElementById('emailAbonat').value = '';
            document.getElementById('cnpAbonat').value = '';
            document.getElementById('orasAbonat').value = '';
            document.getElementById('stradaAbonat').value = '';
            document.getElementById('numarAbonat').value = '';
            document.getElementById('tipAdresa').value = '';
            document.getElementById('numeBlocAbonat').value = '';
            document.getElementById('scaraAbonat').value = '';
            document.getElementById('etajAbonat').value = '';
            document.getElementById('apartamentAbonat').value = '';
            document.getElementById('dataRevizieEfectuata').value = '';
            document.getElementById('dataExpirare').value = '';
            document.getElementById('dataPrimaRevizie').value = '';
            document.getElementById('periodicitateRevizie').value = '2';
            document.getElementById('dataUrmatoareaRevizie').value = '';
            document.getElementById('zileNotificare').value = '2';
            
            // Reset checkboxes
            document.querySelectorAll('#serviciu_verificare_gaz, #serviciu_revizie_gaz, #serviciu_verificare_centrala, #serviciu_pachet_complet').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // Reset documente
            documenteTemp = [];
            afiseazaListaFisiere();
            
            // Reset cost display
            actualizareaCostului();
        }

        function updateListaAbonati() {
            const container = document.getElementById('listaAbonati');
            
            if (abonati.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üë•</div>
                        <h3>Nu existƒÉ abona»õi √Ænregistra»õi</h3>
                        <p>AdaugƒÉ primul abonat folosind formularul de mai jos.</p>
                    </div>
                `;
                return;
            }

            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Nume</th>
                            <th>Telefon</th>
                            <th>AdresƒÉ</th>
                            <th>Servicii</th>
                            <th>Data Revizie</th>
                            <th>Data Expirare</th>
                            <th>Documente & Ac»õiuni</th>
                            <th>NotificƒÉri Trimise</th>
                            <th>Status</th>
                            <th>Editare</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            abonati.forEach(abonat => {
                const adresaCompleta = formatareAdresa(abonat.adresa);
                const servicii = abonat.serviciiContractate ? abonat.serviciiContractate.join(', ') : '-';
                const dataRevizie = abonat.dataRevizieEfectuata ? new Date(abonat.dataRevizieEfectuata).toLocaleDateString('ro-RO') : '-';
                const dataExpirare = abonat.dataExpirare ? new Date(abonat.dataExpirare).toLocaleDateString('ro-RO') : '-';
                const numarDocumente = abonat.documente ? abonat.documente.length : 0;
                
                // VerificƒÉ dacƒÉ revizia expirƒÉ √Æn cur√¢nd
                let statusExpirare = 'status-active';
                if (abonat.dataExpirare) {
                    const expirare = new Date(abonat.dataExpirare);
                    const astazi = new Date();
                    const zilePanaLaExpirare = Math.ceil((expirare - astazi) / (1000 * 60 * 60 * 24));
                    
                    if (zilePanaLaExpirare < 0) {
                        statusExpirare = 'status-urgent'; // Expirat
                    } else if (zilePanaLaExpirare <= 30) {
                        statusExpirare = 'status-inactive'; // ExpirƒÉ √Æn 30 zile
                    } else if (zilePanaLaExpirare <= 90) {
                        statusExpirare = 'status-pending'; // ExpirƒÉ √Æn 90 zile
                    }
                }
                
                html += `
                    <tr>
                        <td><strong>${abonat.nume}</strong><br><small>${abonat.email || ''}</small></td>
                        <td>${abonat.telefon}</td>
                        <td><small>${adresaCompleta}</small></td>
                        <td><small>${servicii}</small></td>
                        <td><small>${dataRevizie}</small></td>
                        <td><span class="status-badge ${statusExpirare}"><small>${dataExpirare}</small></span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-secondary btn-small" onclick="gestioneazaDocumente(${abonat.id})" title="GestioneazƒÉ documente">
                                    üìé ${numarDocumente}
                                </button>
                                <button class="btn btn-primary btn-small" onclick="trimiteNotificareExpirare(${abonat.id})" title="üì± SMS Expirare">
                                    üì± SMS
                                </button>
                                <button class="btn btn-success btn-small" onclick="trimiteWhatsAppExpirare(${abonat.id})" title="üí¨ WhatsApp Expirare" style="background: #25d366; color: white;">
                                    üí¨ WA
                                </button>
                                <button class="btn btn-warning btn-small" onclick="trimiteNotificarePlata(${abonat.id})" title="üí∞ Notificare platƒÉ" style="background: #f6ad55; color: white;">
                                    üí∞
                                </button>
                            </div>
                        </td>
                        <td>
                            <div style="text-align: center;">
                                <span class="status-badge status-pending" style="font-size: 10px;">
                                    üì± ${abonat.numarNotificari || 0}
                                </span>
                                ${abonat.ultimaNotificare ? `<br><small style="color: #718096; font-size: 10px;">${new Date(abonat.ultimaNotificare).toLocaleDateString('ro-RO')}</small>` : ''}
                            </div>
                        </td>
                        <td><span class="status-badge status-active">${abonat.status}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-secondary btn-small" onclick="editaAbonat(${abonat.id})" title="EditeazƒÉ">‚úèÔ∏è</button>
                                <button class="btn btn-danger btn-small" onclick="stergeAbonat(${abonat.id})" title="»òterge">üóëÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function stergeAbonat(id) {
            if (confirm('E»ôti sigur cƒÉ vrei sƒÉ »ôtergi acest abonat? Vor fi »ôterse »ôi programƒÉrile »ôi reminder-urile asociate.')) {
                abonati = abonati.filter(abonat => abonat.id !== id);
                programari = programari.filter(programare => programare.clientId != id);
                remindere = remindere.filter(reminder => reminder.clientId != id);
                saveData();
                showNotification('Abonatul »ôi datele asociate au fost »ôterse cu succes!', 'success');
            }
        }

        // Update client dropdowns with SYNC
        function updateClientDropdowns() {
            const dropdowns = ['clientProgramare', 'clientReminder'];
            
            dropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (dropdown) {
                    const currentValue = dropdown.value; // PƒÉstreazƒÉ valoarea selectatƒÉ
                    let html = '<option value="">SelecteazƒÉ clientul</option><option value="nou">‚ûï Client Nou</option>';
                    
                    abonati.forEach(abonat => {
                        html += `<option value="${abonat.id}" ${currentValue == abonat.id ? 'selected' : ''}>${abonat.nume} - ${abonat.telefon}</option>`;
                    });
                    
                    dropdown.innerHTML = html;
                }
            });
        }

        // ProgramƒÉri Functions
        function adaugaProgramare() {
            const clientId = document.getElementById('clientProgramare').value;
            const tipServiciu = document.getElementById('tipServiciu').value;
            const data = document.getElementById('dataProgramare').value;
            const status = document.getElementById('statusProgramare').value;
            const observatii = document.getElementById('observatiiProgramare').value.trim();

            if (!clientId || !tipServiciu || !data) {
                showNotification('Te rog completeazƒÉ toate c√¢mpurile obligatorii!', 'warning');
                return;
            }

            const programareNoua = {
                id: Date.now(),
                clientId,
                clientNume: clientId === 'nou' ? 'Client Nou' : abonati.find(a => a.id == clientId)?.nume || 'Client Necunoscut',
                tipServiciu,
                data,
                status,
                observatii,
                dataCreare: new Date().toISOString(),
                userId: currentUser ? currentUser.id : null
            };

            programari.push(programareNoua);

            // NOTIFICARE AUTOMATƒÇ PENTRU PROGRAMARE
            setTimeout(async () => {
                if (clientId !== 'nou') {
                    await confirmareProgramare(programareNoua);
                }
            }, 500);

            saveData();
            resetFormProgramare();
            
            showNotification('Programarea a fost adƒÉugatƒÉ cu succes! üì± Notificare trimisƒÉ!', 'success');
        }

        function resetFormProgramare() {
            document.getElementById('clientProgramare').value = '';
            document.getElementById('tipServiciu').value = '';
            document.getElementById('dataProgramare').value = '';
            document.getElementById('statusProgramare').value = 'ProgramatƒÉ';
            document.getElementById('observatiiProgramare').value = '';
        }

        function updateListaProgramari() {
            const container = document.getElementById('listaProgramari');
            
            if (programari.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÖ</div>
                        <h3>Nu existƒÉ programƒÉri</h3>
                        <p>AdaugƒÉ prima programare folosind formularul de mai jos.</p>
                    </div>
                `;
                return;
            }

            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Client</th>
                            <th>Serviciu</th>
                            <th>Data</th>
                            <th>Status</th>
                            <th>Observa»õii</th>
                            <th>Ac»õiuni</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            programari.forEach(programare => {
                const dataFormatata = new Date(programare.data).toLocaleString('ro-RO');
                const clasaUrgenta = programare.tipAutomat === 'revizie' ? 'urgent-reminder' : '';
                
                html += `
                    <tr class="${clasaUrgenta}">
                        <td><strong>${programare.clientNume}</strong></td>
                        <td>${programare.tipServiciu}${programare.tipAutomat === 'revizie' ? ' üîÑ' : ''}</td>
                        <td>${dataFormatata}</td>
                        <td><span class="status-badge ${getStatusClass(programare.status)}">${programare.status}</span></td>
                        <td><small>${programare.observatii || '-'}</small></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-secondary btn-small" onclick="editaProgramare(${programare.id})" title="EditeazƒÉ">‚úèÔ∏è</button>
                                <button class="btn btn-danger btn-small" onclick="stergeProgramare(${programare.id})" title="»òterge">üóëÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function stergeProgramare(id) {
            if (confirm('E»ôti sigur cƒÉ vrei sƒÉ »ôtergi aceastƒÉ programare?')) {
                programari = programari.filter(programare => programare.id !== id);
                saveData();
                showNotification('Programarea a fost »ôtearsƒÉ cu succes!', 'success');
            }
        }

        // Remindere Functions
        function adaugaReminder() {
            const clientId = document.getElementById('clientReminder').value;
            const tip = document.getElementById('tipReminder').value;
            const problemaSpecifica = document.getElementById('problemaSpecifica').value;
            const data = document.getElementById('dataReminder').value;
            const prioritate = document.getElementById('prioritateReminder').value;
            const mesaj = document.getElementById('mesajReminder').value.trim();

            if (!clientId || !tip || !data) {
                showNotification('Te rog completeazƒÉ toate c√¢mpurile obligatorii!', 'warning');
                return;
            }

            // Construie»ôte mesajul final
            let mesajFinal = mesaj;
            if (problemaSpecifica) {
                mesajFinal = `${problemaSpecifica}${mesaj ? ' - ' + mesaj : ''}`;
            }

            const reminderNou = {
                id: Date.now(),
                clientId,
                clientNume: clientId === 'nou' ? 'Client Nou' : abonati.find(a => a.id == clientId)?.nume || 'Client Necunoscut',
                tip,
                problemaSpecifica: problemaSpecifica || null,
                data,
                prioritate,
                mesaj: mesajFinal,
                status: 'Activ',
                dataCreare: new Date().toISOString(),
                userId: currentUser ? currentUser.id : null
            };

            remindere.push(reminderNou);
            
            // TRIMITE AUTOMAT PE WHATSAPP DACƒÇ E EXPIRARE URGENTƒÇ
            if ((problemaSpecifica && problemaSpecifica.includes('Expirat')) || 
                (prioritate === 'UrgentƒÉ' && (tip.includes('Verificare') || tip.includes('Revizie')))) {
                setTimeout(() => {
                    if (clientId !== 'nou') {
                        trimiteWhatsAppReminder(clientId, tip, problemaSpecifica || tip);
                    }
                }, 500);
            }

            saveData();
            resetFormReminder();
            
            const messageExtra = (problemaSpecifica && problemaSpecifica.includes('Expirat')) ? 'üì± WhatsApp trimis automat!' : '';
            showNotification(`Reminder adƒÉugat cu succes! ${messageExtra}`, 'success');
        }

        function resetFormReminder() {
            document.getElementById('clientReminder').value = '';
            document.getElementById('tipReminder').value = '';
            document.getElementById('problemaSpecifica').value = '';
            document.getElementById('dataReminder').value = '';
            document.getElementById('prioritateReminder').value = 'JoasƒÉ';
            document.getElementById('mesajReminder').value = '';
        }

        function updateListaRemindere() {
            const container = document.getElementById('listaRemindere');
            
            if (remindere.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîî</div>
                        <h3>Nu existƒÉ remindere</h3>
                        <p>AdaugƒÉ primul reminder folosind formularul de mai jos.</p>
                    </div>
                `;
                return;
            }

            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Client</th>
                            <th>Tip</th>
                            <th>ProblemƒÉ</th>
                            <th>Data</th>
                            <th>Prioritate</th>
                            <th>Mesaj</th>
                            <th>Ac»õiuni</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            remindere.forEach(reminder => {
                const dataFormatata = new Date(reminder.data).toLocaleString('ro-RO');
                const clasaUrgenta = reminder.tipAutomat === 'revizie' ? 'urgent-reminder' : '';
                const problemaAfisata = reminder.problemaSpecifica || '-';
                
                html += `
                    <tr class="${clasaUrgenta}">
                        <td><strong>${reminder.clientNume}</strong></td>
                        <td>${reminder.tip}${reminder.tipAutomat === 'revizie' ? ' üîÑ' : ''}</td>
                        <td><small style="color: ${reminder.problemaSpecifica && reminder.problemaSpecifica.includes('üö®') ? '#e53e3e' : '#4a5568'};">${problemaAfisata}</small></td>
                        <td>${dataFormatata}</td>
                        <td><span class="status-badge ${getPriorityClass(reminder.prioritate)}">${reminder.prioritate}</span></td>
                        <td><small>${reminder.mesaj || '-'}</small></td>
                        <td>
                            <div class="action-buttons">
                                ${reminder.problemaSpecifica ? `<button class="btn btn-success btn-small" onclick="trimiteWhatsAppReminder('${reminder.clientId}', '${reminder.tip}', '${reminder.problemaSpecifica}')" title="üí¨ Trimite pe WhatsApp" style="background: #25d366; color: white;">üí¨ WA</button>` : ''}
                                <button class="btn btn-secondary btn-small" onclick="editaReminder(${reminder.id})" title="EditeazƒÉ">‚úèÔ∏è</button>
                                <button class="btn btn-danger btn-small" onclick="stergeReminder(${reminder.id})" title="»òterge">üóëÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function stergeReminder(id) {
            if (confirm('E»ôti sigur cƒÉ vrei sƒÉ »ôtergi acest reminder?')) {
                remindere = remindere.filter(reminder => reminder.id !== id);
                saveData();
                showNotification('Reminder-ul a fost »ôters cu succes!', 'success');
            }
        }

        // Check for pending reminders
        function verificaReminderePendente() {
            const astazi = new Date();
            const alerteContainer = document.getElementById('alerteUrgente');
            let alerteHtml = '';

            // VerificƒÉ reminder-urile care expirƒÉ astƒÉzi sau m√¢ine
            const reminderePendente = remindere.filter(reminder => {
                const dataReminder = new Date(reminder.data);
                const diferenta = Math.ceil((dataReminder - astazi) / (1000 * 60 * 60 * 24));
                return diferenta >= 0 && diferenta <= 2 && reminder.status === 'Activ';
            });

            // VerificƒÉ reviziile care expirƒÉ √Æn urmƒÉtoarele 7 zile
            const reviziiExpira = abonati.filter(abonat => {
                if (!abonat.dataUrmatoareaRevizie) return false;
                const dataRevizie = new Date(abonat.dataUrmatoareaRevizie);
                const diferenta = Math.ceil((dataRevizie - astazi) / (1000 * 60 * 60 * 24));
                return diferenta >= 0 && diferenta <= 7;
            });

            if (reminderePendente.length > 0) {
                alerteHtml += `
                    <div class="alert alert-warning">
                        <strong>üîî Reminder-e Urgente!</strong> Ai ${reminderePendente.length} reminder-e care expirƒÉ √Æn urmƒÉtoarele 2 zile.
                    </div>
                `;
                
                // Afi»ôeazƒÉ notificare »ôi pentru reminder-urile urgente
                if (reminderePendente.length > 0) {
                    showNotification(`‚ö†Ô∏è Ai ${reminderePendente.length} reminder-e urgente!`, 'warning');
                }
            }

            if (reviziiExpira.length > 0) {
                alerteHtml += `
                    <div class="alert alert-info">
                        <strong>üîç Revizii Programate!</strong> ${reviziiExpira.length} revizii programate √Æn urmƒÉtoarele 7 zile.
                    </div>
                `;
            }

            if (alerteContainer) {
                alerteContainer.innerHTML = alerteHtml;
            }
        }

        // Utility functions
        function getStatusClass(status) {
            switch(status) {
                case 'ProgramatƒÉ': return 'status-pending';
                case '√én Progres': return 'status-active';
                case 'FinalizatƒÉ': return 'status-active';
                case 'AnulatƒÉ': return 'status-inactive';
                default: return 'status-pending';
            }
        }

        function getPriorityClass(prioritate) {
            switch(prioritate) {
                case 'JoasƒÉ': return 'status-active';
                case 'Medie': return 'status-pending';
                case '√énaltƒÉ': return 'status-inactive';
                case 'UrgentƒÉ': return 'status-urgent';
                default: return 'status-pending';
            }
        }

        // Dashboard update
        function updateDashboard() {
            document.getElementById('totalAbonati').textContent = abonati.length;
            
            const astazi = new Date().toDateString();
            const programariAstazi = programari.filter(p => 
                new Date(p.data).toDateString() === astazi
            ).length;
            document.getElementById('programariAstazi').textContent = programariAstazi;
            
            const remindereActive = remindere.filter(r => r.status === 'Activ').length;
            document.getElementById('remindereActive').textContent = remindereActive;

            // CalculeazƒÉ reviziile din urmƒÉtoarele 7 zile
            const astazi7Zile = new Date();
            astazi7Zile.setDate(astazi7Zile.getDate() + 7);
            const reviziiSaptamana = abonati.filter(abonat => {
                if (!abonat.dataUrmatoareaRevizie) return false;
                const dataRevizie = new Date(abonat.dataUrmatoareaRevizie);
                return dataRevizie >= new Date() && dataRevizie <= astazi7Zile;
            }).length;
            document.getElementById('reviziiSaptamana').textContent = reviziiSaptamana;
        }

        // Reports update
        function updateRapoarte() {
            document.getElementById('raportTotalAbonati').textContent = abonati.length;
            document.getElementById('raportProgramari').textContent = programari.length;
            document.getElementById('raportRemindere').textContent = remindere.filter(r => r.status === 'Activ').length;

            // CalculeazƒÉ reviziile urmƒÉtoarea lunƒÉ
            const astazi = new Date();
            const lunaViitoare = new Date(astazi.getFullYear(), astazi.getMonth() + 1, astazi.getDate());
            const reviziiLunaViitoare = abonati.filter(abonat => {
                if (!abonat.dataUrmatoareaRevizie) return false;
                const dataRevizie = new Date(abonat.dataUrmatoareaRevizie);
                return dataRevizie >= astazi && dataRevizie <= lunaViitoare;
            }).length;
            document.getElementById('raportRevizii').textContent = reviziiLunaViitoare;

            // Distribu»õie pe ora»ôe
            const distributie = {};
            abonati.forEach(abonat => {
                const oras = abonat.adresa.oras;
                distributie[oras] = (distributie[oras] || 0) + 1;
            });

            let distributieHtml = '';
            Object.entries(distributie).forEach(([oras, count]) => {
                distributieHtml += `<p style="color: #718096;">${oras}: <strong>${count}</strong></p>`;
            });

            document.getElementById('distributieOrase').innerHTML = distributieHtml || '<p style="color: #718096;">Nu existƒÉ date disponibile</p>';

            // Distribu»õie servicii
            const serviciiDistributie = {};
            abonati.forEach(abonat => {
                if (abonat.serviciiContractate) {
                    abonat.serviciiContractate.forEach(serviciu => {
                        serviciiDistributie[serviciu] = (serviciiDistributie[serviciu] || 0) + 1;
                    });
                }
            });

            let serviciiHtml = '';
            Object.entries(serviciiDistributie).forEach(([serviciu, count]) => {
                serviciiHtml += `<p style="color: #718096;">${serviciu}: <strong>${count}</strong></p>`;
            });

            document.getElementById('distributieServicii').innerHTML = serviciiHtml || '<p style="color: #718096;">Nu existƒÉ date disponibile</p>';
        }

        // Export PDF functionality
        function exportRaportPDF() {
            if (typeof window.jsPDF === 'undefined') {
                showNotification('Biblioteca PDF nu este √ÆncƒÉrcatƒÉ. √éncearcƒÉ din nou.', 'error');
                return;
            }

            const { jsPDF } = window.jsPDF;
            const doc = new jsPDF();
            
            // Header
            doc.setFontSize(20);
            doc.text('RAPORT COMPLET - GAZTECH SERVICES', 20, 20);
            
            doc.setFontSize(12);
            doc.text(`Generat pe: ${new Date().toLocaleDateString('ro-RO')}`, 20, 30);
            doc.text(`Utilizator: ${currentUser ? currentUser.name || currentUser.email : 'Necunoscut'}`, 20, 40);
            
            let yPosition = 60;
            
            // Statistici generale
            doc.setFontSize(16);
            doc.text('STATISTICI GENERALE', 20, yPosition);
            yPosition += 10;
            
            doc.setFontSize(12);
            doc.text(`Total Abona»õi: ${abonati.length}`, 20, yPosition);
            yPosition += 7;
            doc.text(`Total ProgramƒÉri: ${programari.length}`, 20, yPosition);
            yPosition += 7;
            doc.text(`Total Remindere: ${remindere.length}`, 20, yPosition);
            yPosition += 15;
            
            // Abona»õi
            if (abonati.length > 0) {
                doc.setFontSize(16);
                doc.text('LISTA ABONA»öI', 20, yPosition);
                yPosition += 10;
                
                const tableData = abonati.map(abonat => [
                    abonat.nume,
                    abonat.telefon,
                    formatareAdresa(abonat.adresa),
                    abonat.serviciiContractate ? abonat.serviciiContractate.join(', ') : 'N/A',
                    abonat.dataExpirare ? new Date(abonat.dataExpirare).toLocaleDateString('ro-RO') : 'N/A'
                ]);
                
                if (typeof doc.autoTable === 'function') {
                    doc.autoTable({
                        head: [['Nume', 'Telefon', 'AdresƒÉ', 'Servicii', 'Expirare']],
                        body: tableData,
                        startY: yPosition,
                        theme: 'grid',
                        headStyles: { fillColor: [102, 126, 234] },
                        styles: { fontSize: 8, cellPadding: 2 }
                    });
                } else {
                    // Fallback dacƒÉ autoTable nu e disponibil
                    abonati.forEach((abonat, index) => {
                        if (yPosition > 250) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        
                        const servicii = abonat.serviciiContractate ? abonat.serviciiContractate.join(', ') : 'N/A';
                        const adresa = formatareAdresa(abonat.adresa);
                        const dataExpirare = abonat.dataExpirare ? new Date(abonat.dataExpirare).toLocaleDateString('ro-RO') : 'N/A';
                        
                        doc.setFontSize(10);
                        doc.text(`${index + 1}. ${abonat.nume}`, 20, yPosition);
                        yPosition += 5;
                        doc.text(`   Tel: ${abonat.telefon} | Expirare: ${dataExpirare}`, 20, yPosition);
                        yPosition += 5;
                        doc.text(`   Servicii: ${servicii}`, 20, yPosition);
                        yPosition += 8;
                    });
                }
            }
            
            // Salvare
            doc.save(`GazTech_Raport_${currentUser ? currentUser.id : 'user'}_${new Date().toISOString().split('T')[0]}.pdf`);
            showNotification('Raportul PDF a fost generat cu succes!', 'success');
        }

        // Export Excel functionality
        function exportRaportExcel() {
            if (typeof XLSX === 'undefined') {
                showNotification('Biblioteca Excel nu este √ÆncƒÉrcatƒÉ. √éncearcƒÉ din nou.', 'error');
                return;
            }

            const wb = XLSX.utils.book_new();
            
            // Foi Excel
            const foaieAbonati = [];
            const foaieProgramari = [];
            const foaieRemindere = [];
            const foaieStatistici = [];
            
            // Date abona»õi
            foaieAbonati.push(['Nume', 'Telefon', 'Email', 'CNP', 'Ora»ô', 'Strada', 'NumƒÉr', 'Bloc', 'Scara', 'Etaj', 'Apartament', 'Servicii Contractate', 'Cost Total', 'Data Revizie', 'Data Expirare', 'Tip Client', 'NumƒÉr Documente', 'Status']);
            
            abonati.forEach(abonat => {
                let costTotal = 0;
                if (abonat.serviciiContractate) {
                    abonat.serviciiContractate.forEach(serviciu => {
                        switch(serviciu) {
                            case 'Verificare Instala»õie Gaz': costTotal += 150; break;
                            case 'Revizie Instala»õie Gaz': costTotal += 250; break;
                            case 'Verificare CentralƒÉ': costTotal += 150; break;
                            case 'Instala»õii Gaz + CentralƒÉ': costTotal += 250; break;
                        }
                    });
                }
                
                const servicii = abonat.serviciiContractate ? abonat.serviciiContractate.join('; ') : '';
                const dataRevizie = abonat.dataRevizieEfectuata || '';
                const dataExpirare = abonat.dataExpirare || '';
                const numarDocumente = abonat.documente ? abonat.documente.length : 0;
                
                foaieAbonati.push([
                    abonat.nume,
                    abonat.telefon,
                    abonat.email || '',
                    abonat.cnp || '',
                    abonat.adresa.oras,
                    abonat.adresa.strada || '',
                    abonat.adresa.numar || '',
                    abonat.adresa.numeBlocAbonat || '',
                    abonat.adresa.scara || '',
                    abonat.adresa.etaj || '',
                    abonat.adresa.apartament || '',
                    servicii,
                    costTotal + ' Lei',
                    dataRevizie,
                    dataExpirare,
                    abonat.tipClient === 'nou' ? 'Client Nou' : 'Client Actual',
                    numarDocumente,
                    abonat.status
                ]);
            });
            
            // Date programƒÉri
            foaieProgramari.push(['Client', 'Serviciu', 'Data', 'Status', 'Observa»õii', 'Tip', 'Data Creare']);
            programari.forEach(p => {
                foaieProgramari.push([
                    p.clientNume,
                    p.tipServiciu,
                    new Date(p.data).toLocaleString('ro-RO'),
                    p.status,
                    p.observatii || '',
                    p.tipAutomat || 'Manual',
                    new Date(p.dataCreare).toLocaleDateString('ro-RO')
                ]);
            });
            
            // Date remindere
            foaieRemindere.push(['Client', 'Tip', 'Data', 'Prioritate', 'Mesaj', 'Status', 'Tip', 'Data Creare']);
            remindere.forEach(r => {
                foaieRemindere.push([
                    r.clientNume,
                    r.tip,
                    new Date(r.data).toLocaleString('ro-RO'),
                    r.prioritate,
                    r.mesaj || '',
                    r.status,
                    r.tipAutomat || 'Manual',
                    new Date(r.dataCreare).toLocaleDateString('ro-RO')
                ]);
            });
            
            // Statistici
            foaieStatistici.push(['StatisticƒÉ', 'Valoare']);
            foaieStatistici.push(['Utilizator', currentUser ? (currentUser.name || currentUser.email) : 'Necunoscut']);
            foaieStatistici.push(['Total Abona»õi', abonati.length]);
            foaieStatistici.push(['Total ProgramƒÉri', programari.length]);
            foaieStatistici.push(['Total Remindere', remindere.length]);
            foaieStatistici.push(['Data Generare', new Date().toLocaleDateString('ro-RO')]);
            
            // AdaugƒÉ foile √Æn Excel
            const wsAbonati = XLSX.utils.aoa_to_sheet(foaieAbonati);
            const wsProgramari = XLSX.utils.aoa_to_sheet(foaieProgramari);
            const wsRemindere = XLSX.utils.aoa_to_sheet(foaieRemindere);
            const wsStatistici = XLSX.utils.aoa_to_sheet(foaieStatistici);
            
            XLSX.utils.book_append_sheet(wb, wsAbonati, 'Abona»õi');
            XLSX.utils.book_append_sheet(wb, wsProgramari, 'ProgramƒÉri');
            XLSX.utils.book_append_sheet(wb, wsRemindere, 'Remindere');
            XLSX.utils.book_append_sheet(wb, wsStatistici, 'Statistici');
            
            // Salvare
            const fileName = `GazTech_Excel_${currentUser ? currentUser.id : 'user'}_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            showNotification('Raportul Excel a fost generat cu succes!', 'success');
        }

        // Export functions
        function exportAbonati() {
            let csvContent = "data:text/csv;charset=utf-8,Nume,Telefon,Email,CNP,Ora»ô,Strada,NumƒÉr,Tip AdresƒÉ,Bloc,Scara,Etaj,Apartament,Servicii Contractate,Tip Client,Prima Revizie,UrmƒÉtoarea Revizie,Status\n";
            
            abonati.forEach(a => {
                const servicii = a.serviciiContractate ? a.serviciiContractate.join(';') : '';
                const primaRevizie = a.dataPrimaRevizie || '';
                const urmatoareaRevizie = a.dataUrmatoareaRevizie || '';
                
                csvContent += `"${a.nume}","${a.telefon}","${a.email || ''}","${a.cnp || ''}","${a.adresa.oras}","${a.adresa.strada || ''}","${a.adresa.numar || ''}","${a.adresa.tipAdresa || ''}","${a.adresa.numeBlocAbonat || ''}","${a.adresa.scara || ''}","${a.adresa.etaj || ''}","${a.adresa.apartament || ''}","${servicii}","${a.tipClient}","${primaRevizie}","${urmatoareaRevizie}","${a.status}"\n`;
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `gaztech_abonati_${currentUser ? currentUser.id : 'user'}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Datele abona»õilor au fost exportate!', 'success');
        }

        function exportProgramari() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Client,Serviciu,Data,Status,Observa»õii,Tip\n"
                + programari.map(p => 
                    `"${p.clientNume}","${p.tipServiciu}","${new Date(p.data).toLocaleString('ro-RO')}","${p.status}","${p.observatii || ''}","${p.tipAutomat || 'Manual'}"`
                ).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `gaztech_programari_${currentUser ? currentUser.id : 'user'}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Datele programƒÉrilor au fost exportate!', 'success');
        }

        function exportRemindere() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Client,Tip,Data,Prioritate,Mesaj,Status,Tip\n"
                + remindere.map(r => 
                    `"${r.clientNume}","${r.tip}","${new Date(r.data).toLocaleString('ro-RO')}","${r.prioritate}","${r.mesaj || ''}","${r.status}","${r.tipAutomat || 'Manual'}"`
                ).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `gaztech_remindere_${currentUser ? currentUser.id : 'user'}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Datele reminder-urilor au fost exportate!', 'success');
        }

        function exportRevizii() {
            let csvContent = "data:text/csv;charset=utf-8,Nume,Telefon,AdresƒÉ CompletƒÉ,Servicii,Prima Revizie,UrmƒÉtoarea Revizie,Periodicitate,Zile Notificare\n";
            
            abonati.filter(a => a.dataUrmatoareaRevizie).forEach(a => {
                const adresaCompleta = formatareAdresa(a.adresa);
                const servicii = a.serviciiContractate ? a.serviciiContractate.join(';') : '';
                
                csvContent += `"${a.nume}","${a.telefon}","${adresaCompleta}","${servicii}","${a.dataPrimaRevizie || ''}","${a.dataUrmatoareaRevizie}","${a.periodicitateRevizie} ani","${a.zileNotificare} zile"\n`;
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `gaztech_revizii_${currentUser ? currentUser.id : 'user'}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Datele reviziilor au fost exportate!', 'success');
        }

        // Search functionality
        document.getElementById('searchAbonati')?.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#listaAbonati tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        // Close modal when clicking outside
        window.addEventListener('click', (e) => {
            const modal = document.getElementById('modalDocumente');
            if (e.target === modal) {
                inchideModalDocumente();
            }
        });

        // ADAUGƒÇ DATE DE TEST PENTRU DEMONSTRA»öIA SINCRONIZƒÇRII
        function adaugaDateDeTest() {
            if (abonati.length === 0) {
                // Abona»õi de test cu ADRESA CORECTƒÇ
                const abonatiTest = [
                    {
                        id: 1000001,
                        tipClient: 'nou',
                        nume: 'Popescu Ion',
                        telefon: '0721234567',
                        email: 'ion.popescu@email.ro',
                        cnp: '1801010120001',
                        adresa: {
                            oras: 'Ro»ôiorii de Vede',
                            strada: 'Str. MƒÉrƒÉ»ôe»ôti',
                            numar: '97',
                            tipAdresa: 'Casa',
                            numeBlocAbonat: '',
                            scara: '',
                            etaj: '',
                            apartament: ''
                        },
                        serviciiContractate: ['Verificare Instala»õie Gaz', 'Verificare CentralƒÉ'],
                        dataRevizieEfectuata: '2023-06-15',
                        dataExpirare: '2025-06-15',
                        dataPrimaRevizie: '2023-06-15',
                        periodicitateRevizie: '2',
                        dataUrmatoareaRevizie: '2025-06-15',
                        zileNotificare: '7',
                        documente: [
                            {
                                id: 1001,
                                nume: 'Certificat_Instalatie.pdf',
                                tip: 'application/pdf',
                                marime: 245760,
                                continut: 'JVBERi0xLjQKJcOkw7zDtsO2CjIgMCBvYmoKPDwvTGVuZ3==',
                                dataIncarcare: '2024-01-15T10:30:00.000Z'
                            }
                        ],
                        numarNotificari: 2,
                        ultimaNotificare: '2024-12-01T10:00:00.000Z',
                        dataCreare: '2024-01-15T10:30:00.000Z',
                        status: 'Activ',
                        userId: currentUser ? currentUser.id : null
                    },
                    {
                        id: 1000002,
                        tipClient: 'actual',
                        nume: 'Ionescu Maria',
                        telefon: '0734567890',
                        email: 'maria.ionescu@yahoo.ro',
                        cnp: '2850505110002',
                        adresa: {
                            oras: 'Alexandria',
                            strada: 'Bd. Republicii',
                            numar: '45',
                            tipAdresa: 'Bloc',
                            numeBlocAbonat: 'Bl. A3',
                            scara: 'B',
                            etaj: '4',
                            apartament: '23'
                        },
                        serviciiContractate: ['Instala»õii Gaz + CentralƒÉ'],
                        dataRevizieEfectuata: '2024-01-20',
                        dataExpirare: '2026-01-20',
                        dataPrimaRevizie: '2024-01-20',
                        periodicitateRevizie: '2',
                        dataUrmatoareaRevizie: '2026-01-20',
                        zileNotificare: '3',
                        documente: [],
                        numarNotificari: 0,
                        ultimaNotificare: null,
                        dataCreare: '2024-02-10T14:20:00.000Z',
                        status: 'Activ',
                        userId: currentUser ? currentUser.id : null
                    },
                    {
                        id: 1000003,
                        tipClient: 'nou',
                        nume: 'Georgescu Andrei',
                        telefon: '0745123789',
                        email: '',
                        cnp: '',
                        adresa: {
                            oras: 'Turnu MƒÉgurele',
                            strada: 'Str. Mihai Viteazu',
                            numar: '78',
                            tipAdresa: 'Casa',
                            numeBlocAbonat: '',
                            scara: '',
                            etaj: '',
                            apartament: ''
                        },
                        serviciiContractate: ['Revizie Instala»õie Gaz'],
                        dataRevizieEfectuata: '2024-11-01',
                        dataExpirare: '2026-11-01',
                        dataPrimaRevizie: '2024-11-01',
                        periodicitateRevizie: '2',
                        dataUrmatoareaRevizie: '2026-11-01',
                        zileNotificare: '2',
                        documente: [
                            {
                                id: 1002,
                                nume: 'Plan_Instalatie.jpg',
                                tip: 'image/jpeg',
                                marime: 524288,
                                continut: '/9j/4AAQSkZJRgABAQAAAQABAAD/2wBD==',
                                dataIncarcare: '2024-11-02T09:15:00.000Z'
                            },
                            {
                                id: 1003,
                                nume: 'Factura_Revizie.pdf',
                                tip: 'application/pdf',
                                marime: 180224,
                                continut: 'JVBERi0xLjQKJcOkw7zDtsO2CjIgMCB==',
                                dataIncarcare: '2024-11-02T09:20:00.000Z'
                            }
                        ],
                        numarNotificari: 1,
                        ultimaNotificare: '2024-11-25T16:00:00.000Z',
                        dataCreare: '2024-11-01T16:45:00.000Z',
                        status: 'Activ',
                        userId: currentUser ? currentUser.id : null
                    }
                ];

                // ProgramƒÉri de test
                const programariTest = [
                    {
                        id: 2000001,
                        clientId: 1000001,
                        clientNume: 'Popescu Ion',
                        tipServiciu: 'Verificare Instala»õie Gaz',
                        data: new Date().toISOString(), // AstƒÉzi
                        status: 'ProgramatƒÉ',
                        observatii: 'Verificare anualƒÉ programatƒÉ automat',
                        tipAutomat: 'revizie',
                        dataCreare: '2024-12-01T08:00:00.000Z',
                        userId: currentUser ? currentUser.id : null
                    },
                    {
                        id: 2000002,
                        clientId: 1000002,
                        clientNume: 'Ionescu Maria',
                        tipServiciu: 'Instala»õii Gaz + CentralƒÉ',
                        data: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(), // M√¢ine
                        status: 'ProgramatƒÉ',
                        observatii: 'Client prioritar - apartament',
                        dataCreare: '2024-12-02T10:30:00.000Z',
                        userId: currentUser ? currentUser.id : null
                    },
                    {
                        id: 2000003,
                        clientId: 1000003,
                        clientNume: 'Georgescu Andrei',
                        tipServiciu: 'Revizie Instala»õie Gaz',
                        data: '2024-11-25T14:00:00.000Z',
                        status: 'FinalizatƒÉ',
                        observatii: 'Revizie completatƒÉ cu succes',
                        dataCreare: '2024-11-20T12:00:00.000Z',
                        userId: currentUser ? currentUser.id : null
                    }
                ];

                // Remindere de test
                const remindereTest = [
                    {
                        id: 3000001,
                        clientId: 1000001,
                        clientNume: 'Popescu Ion',
                        tip: 'Verificare/Revizie AutomatƒÉ',
                        data: new Date(Date.now() + 12 * 60 * 60 * 1000).toISOString(), // √én 12 ore
                        prioritate: '√énaltƒÉ',
                        mesaj: 'REVIZIE EXPIRING pentru Popescu Ion - Servicii: Verificare Instala»õie Gaz, Verificare CentralƒÉ - Cost total: 300 Lei - Adresa: Ro»ôiorii de Vede, Str. MƒÉrƒÉ»ôe»ôti 97 - Tel: 0721234567',
                        status: 'Activ',
                        tipAutomat: 'revizie',
                        dataCreare: '2024-11-01T09:00:00.000Z',
                        userId: currentUser ? currentUser.id : null
                    },
                    {
                        id: 3000002,
                        clientId: 1000002,
                        clientNume: 'Ionescu Maria',
                        tip: 'UrmƒÉrire Client',
                        data: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString(), // √én 2 zile
                        prioritate: 'Medie',
                        mesaj: 'UrmƒÉrire pentru √ÆncƒÉrcarea documentelor lipsƒÉ',
                        status: 'Activ',
                        dataCreare: '2024-12-01T15:00:00.000Z',
                        userId: currentUser ? currentUser.id : null
                    },
                    {
                        id: 3000003,
                        clientId: 1000003,
                        clientNume: 'Georgescu Andrei',
                        tip: 'Facturare',
                        data: new Date(Date.now() + 48 * 60 * 60 * 1000).toISOString(), // √én 48 ore
                        prioritate: 'UrgentƒÉ',
                        mesaj: 'Facturare pentru revizia efectuatƒÉ',
                        status: 'Activ',
                        dataCreare: '2024-11-25T16:00:00.000Z',
                        userId: currentUser ? currentUser.id : null
                    }
                ];

                // AdaugƒÉ datele de test
                abonati.push(...abonatiTest);
                programari.push(...programariTest);
                remindere.push(...remindereTest);
                
                // SalveazƒÉ datele
                saveData();
                
                showNotification('‚úÖ Date de test adƒÉugate pentru demonstra»õia sincronizƒÉrii!', 'success');
                console.log('üìä Date de test adƒÉugate:', {
                    abonati: abonatiTest.length,
                    programari: programariTest.length, 
                    remindere: remindereTest.length
                });
            }
        }

        // FUNC»öIE AVANSATƒÇ DE SINCRONIZARE CU PROGRESS
        function sincronizareAvansata() {
            showNotification('üîÑ √éncepe sincronizarea avansatƒÉ...', 'info');
            
            setTimeout(() => {
                // ActualizeazƒÉ toate componentele
                updateClientDropdowns();
                updateDashboard();
                updateRapoarte();
                
                // VerificƒÉ »ôi curƒÉ»õƒÉ datele
                verificaConsistentaDatele();
                
                showNotification('‚úÖ Sincronizare avansatƒÉ completƒÉ!', 'success');
                showSyncIndicator();
            }, 1000);
        }

        function verificaConsistentaDatele() {
            let problemeGasite = 0;
            
            // VerificƒÉ programƒÉrile orfane
            programari.forEach((programare, index) => {
                if (programare.clientId !== 'nou' && !abonati.find(a => a.id == programare.clientId)) {
                    console.warn(`Programare orfanƒÉ gƒÉsitƒÉ: ${programare.clientNume}`);
                    problemeGasite++;
                }
            });
            
            // VerificƒÉ reminder-ele orfane
            remindere.forEach((reminder, index) => {
                if (reminder.clientId !== 'nou' && !abonati.find(a => a.id == reminder.clientId)) {
                    console.warn(`Reminder orfan gƒÉsit: ${reminder.clientNume}`);
                    problemeGasite++;
                }
            });
            
            if (problemeGasite > 0) {
                showNotification(`‚ö†Ô∏è ${problemeGasite} probleme de consisten»õƒÉ gƒÉsite`, 'warning');
            }
            
            console.log(`üîç Verificare consisten»õƒÉ: ${problemeGasite} probleme gƒÉsite`);
        }

        // BACKUP »òI RESTORE
        function creeazaBackup() {
            const backup = {
                timestamp: new Date().toISOString(),
                versiune: '2.0',
                utilizator: currentUser ? {
                    id: currentUser.id,
                    name: currentUser.name,
                    email: currentUser.email
                } : null,
                abonati: abonati,
                programari: programari,
                remindere: remindere,
                configurari: CONFIGURARI_FIRMA
            };
            
            const dataStr = JSON.stringify(backup, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `GazTech_Backup_${currentUser ? currentUser.id : 'user'}_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('üíæ Backup creat cu succes!', 'success');
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', async function() {
            // VerificƒÉ autentificarea √Ænainte de a continua
            if (!verificaAutentificare()) {
                return; // Opre»ôte √ÆncƒÉrcarea dacƒÉ utilizatorul nu este autentificat
            }

            // √énregistrare Service Worker PWA √ÆmbunƒÉtƒÉ»õit
            if ('serviceWorker' in navigator) {
                try {
                    // Service Worker robust pentru PWA
                    const swCode = `
                        const CACHE_NAME = 'gaztech-auth-v2.1';
                        const STATIC_CACHE = 'gaztech-static-v2';
                        const DYNAMIC_CACHE = 'gaztech-dynamic-v2';
                        
                        // Resurse de cache-uit
                        const urlsToCache = [
                            '/',
                            '/offline.html'
                        ];
                        
                        // Install event
                        self.addEventListener('install', event => {
                            console.log('PWA Service Worker instalat');
                            event.waitUntil(
                                caches.open(STATIC_CACHE)
                                    .then(cache => {
                                        console.log('Cache deschis');
                                        return cache.addAll(urlsToCache);
                                    })
                                    .catch(err => console.log('Eroare cache:', err))
                            );
                            self.skipWaiting();
                        });
                        
                        // Activate event
                        self.addEventListener('activate', event => {
                            console.log('PWA Service Worker activat');
                            event.waitUntil(
                                caches.keys().then(cacheNames => {
                                    return Promise.all(
                                        cacheNames.map(cacheName => {
                                            if (cacheName !== STATIC_CACHE && cacheName !== DYNAMIC_CACHE) {
                                                console.log('»òtergere cache vechi:', cacheName);
                                                return caches.delete(cacheName);
                                            }
                                        })
                                    );
                                })
                            );
                            self.clients.claim();
                        });
                        
                        // Fetch event - strategia cache first
                        self.addEventListener('fetch', event => {
                            if (event.request.method !== 'GET') return;
                            
                            event.respondWith(
                                caches.match(event.request)
                                    .then(response => {
                                        if (response) {
                                            return response;
                                        }
                                        
                                        return fetch(event.request)
                                            .then(response => {
                                                // VerificƒÉ dacƒÉ rƒÉspunsul este valid
                                                if (!response || response.status !== 200 || response.type !== 'basic') {
                                                    return response;
                                                }
                                                
                                                // CloneazƒÉ rƒÉspunsul
                                                const responseToCache = response.clone();
                                                
                                                caches.open(DYNAMIC_CACHE)
                                                    .then(cache => {
                                                        cache.put(event.request, responseToCache);
                                                    });
                                                
                                                return response;
                                            })
                                            .catch(err => {
                                                console.log('Eroare fetch:', err);
                                                // ReturneazƒÉ o paginƒÉ offline dacƒÉ existƒÉ
                                                return caches.match('/offline.html');
                                            });
                                    })
                            );
                        });
                        
                        // Background sync pentru notificƒÉri
                        self.addEventListener('sync', event => {
                            if (event.tag === 'gaztech-sync') {
                                console.log('Background sync declan»ôat');
                            }
                        });
                        
                        // Push notifications
                        self.addEventListener('push', event => {
                            if (event.data) {
                                const data = event.data.json();
                                const options = {
                                    body: data.body,
                                    icon: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMxZTQwYWYiLz4KPHJlY3QgeD0iMjQiIHk9IjI0IiB3aWR0aD0iMTQ0IiBoZWlnaHQ9IjE0NCIgcng9IjEyIiBmaWxsPSIjZjU5ZTBiIi8+Cjx0ZXh0IHg9Ijk2IiB5PSIxMTAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjY0IiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0iIzFmMmkzNyI+RzwvdGV4dD4KPC9zdmc+',
                                    badge: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNzIiIGhlaWdodD0iNzIiIHZpZXdCb3g9IjAgMCA3MiA3MiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjcyIiBoZWlnaHQ9IjcyIiByeD0iOCIgZmlsbD0iIzFlNDBhZiIvPgo8dGV4dCB4PSIzNiIgeT0iNDUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjI0IiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0iI2Y1OWUwYiI+RzwvdGV4dD4KPC9zdmc+',
                                    vibrate: [200, 100, 200],
                                    data: data,
                                    actions: [
                                        {
                                            action: 'open',
                                            title: 'Deschide'
                                        },
                                        {
                                            action: 'close',
                                            title: '√énchide'
                                        }
                                    ]
                                };
                                
                                event.waitUntil(
                                    self.registration.showNotification(data.title, options)
                                );
                            }
                        });
                        
                        // Notification click
                        self.addEventListener('notificationclick', event => {
                            event.notification.close();
                            
                            if (event.action === 'open') {
                                event.waitUntil(
                                    clients.openWindow('/')
                                );
                            }
                        });
                    `;
                    
                    const blob = new Blob([swCode], { type: 'application/javascript' });
                    const swUrl = URL.createObjectURL(blob);
                    
                    const registration = await navigator.serviceWorker.register(swUrl, {
                        scope: '/'
                    });
                    
                    console.log('‚úÖ PWA Service Worker √Ænregistrat cu succes!', registration.scope);
                    
                    // VerificƒÉ dacƒÉ PWA poate fi instalatƒÉ
                    let deferredPrompt;
                    
                    window.addEventListener('beforeinstallprompt', (e) => {
                        console.log('PWA poate fi instalatƒÉ!');
                        e.preventDefault();
                        deferredPrompt = e;
                        
                        // Afi»ôeazƒÉ buton de instalare √Æn interfa»õƒÉ
                        showNotification('üì± GazTech poate fi instalatƒÉ ca aplica»õie pe telefon! ApasƒÉ pentru a instala.', 'info');
                        
                        // CreeazƒÉ butonul de instalare
                        const installBtn = document.createElement('button');
                        installBtn.textContent = 'üì± InstaleazƒÉ GazTech';
                        installBtn.className = 'btn btn-success';
                        installBtn.style.cssText = 'position: fixed; bottom: 20px; left: 20px; z-index: 2000; animation: pulse 2s infinite;';
                        
                        installBtn.onclick = async () => {
                            if (deferredPrompt) {
                                deferredPrompt.prompt();
                                const { outcome } = await deferredPrompt.userChoice;
                                console.log('Rezultat instalare PWA:', outcome);
                                if (outcome === 'accepted') {
                                    showNotification('‚úÖ GazTech instalatƒÉ cu succes!', 'success');
                                }
                                deferredPrompt = null;
                                installBtn.remove();
                            }
                        };
                        
                        document.body.appendChild(installBtn);
                        
                        // EliminƒÉ butonul dupƒÉ 30 secunde
                        setTimeout(() => {
                            if (installBtn && installBtn.parentNode) {
                                installBtn.remove();
                            }
                        }, 30000);
                    });
                    
                    // VerificƒÉ dacƒÉ PWA a fost instalatƒÉ
                    window.addEventListener('appinstalled', () => {
                        console.log('‚úÖ PWA GazTech instalatƒÉ cu succes!');
                        showNotification('üéâ GazTech instalatƒÉ! Po»õi accesa aplica»õia din meniul telefonului.', 'success');
                        deferredPrompt = null;
                    });
                    
                    // Pentru iOS - verificƒÉ dacƒÉ ruleazƒÉ √Æn standalone
                    if (window.navigator.standalone) {
                        console.log('‚úÖ PWA ruleazƒÉ √Æn modul standalone pe iOS');
                    }
                    
                } catch (error) {
                    console.warn('‚ö†Ô∏è Service Worker nu s-a putut √Ænregistra:', error);
                    showNotification('‚ö†Ô∏è PWA nu poate fi instalatƒÉ pe acest dispozitiv', 'warning');
                }
            } else {
                console.warn('‚ö†Ô∏è Service Worker nu este suportat');
                showNotification('‚ö†Ô∏è Browser-ul nu suportƒÉ instalarea aplica»õiei', 'warning');
            }

            // √éncarcƒÉ datele specifice utilizatorului
            loadUserData();

            // ActualizeazƒÉ interfa»õa cu valorile corecte
            actualizeazaTelefonInUI();
            
            // VerificƒÉ statusul Firebase
            verificaStatusFirebase();
            
            // √éncearcƒÉ sƒÉ √Æncarce datele din Firebase
            await incarcareInitialaDinFirebase();
            
            // AdaugƒÉ date de test dacƒÉ nu existƒÉ
            if (abonati.length === 0) {
                adaugaDateDeTest();
            }
            
            // Sincronizare ini»õialƒÉ
            sincronizeazaDatele();
            
            // Ini»õializeazƒÉ upload-ul de fi»ôiere
            initializeFileUpload();
            
            // AdaugƒÉ event listeners pentru calculul costului
            adaugaListeneriCost();
            actualizareaCostului();
            
            // Check for urgent reminders every 5 minutes
            setInterval(verificaReminderePendente, 5 * 60 * 1000);
            
            // Verificare automatƒÉ notificƒÉri la fiecare 30 minute
            setInterval(verificaNotificariAutomated, 30 * 60 * 1000);
            
            // Sincronizare avansatƒÉ la fiecare 30 secunde
            setInterval(sincronizareAvansata, 30000);
            
            // Sincronizare cu Firebase la fiecare 2 minute
            if (db && currentUser) {
                setInterval(sincronizareCuFirestore, 2 * 60 * 1000);
            }
            
            console.log('‚úÖ GazTech Services s-a √ÆncƒÉrcat complet cu AUTENTIFICARE SECURIZATƒÇ & PWA!');
            console.log('üîê Utilizator autentificat:', currentUser ? (currentUser.name || currentUser.email) : 'Necunoscut');
            console.log('üõ°Ô∏è 2FA Status:', currentUser && currentUser.is2FAEnabled ? 'ACTIVAT' : 'DEZACTIVAT');
            console.log('üìä Abona»õi:', abonati.length);
            console.log('üìÖ ProgramƒÉri:', programari.length);
            console.log('üîî Remindere:', remindere.length);
            console.log('üîÑ Sincronizare: ACTIVƒÇ');
            console.log('üìé Gestionare documente: COMPLETƒÇ');
            console.log('üíæ Backup: DISPONIBIL');
            console.log('üì± NotificƒÉri expirƒÉri/plƒÉ»õi: ACTIVE');
            console.log('üí¨ WhatsApp: INTEGRAT');
            console.log('üî• Firebase:', db ? 'CONECTAT' : 'OFFLINE');
            console.log('üì± PWA: Service Worker √Ænregistrat');
            console.log('üìû Telefon firmƒÉ:', CONFIGURARI_FIRMA.telefon);
            console.log('üìß Email firmƒÉ:', CONFIGURARI_FIRMA.email);
            console.log('üè† Adresa firmƒÉ:', CONFIGURARI_FIRMA.adresa);
            console.log('üîí Securitate: Autentificare cu doi factori disponibilƒÉ');
        });

        // Error handling
        window.addEventListener('error', function(e) {
            console.error('Error captat »ôi gestionat:', e.error);
            showNotification('A apƒÉrut o eroare, dar aplica»õia continuƒÉ sƒÉ func»õioneze.', 'warning');
        });

        // Unload event pentru cleanup
        window.addEventListener('beforeunload', function(e) {
            // SalveazƒÉ datele √Ænainte de √Ænchidere
            if (currentUser && (abonati.length > 0 || programari.length > 0 || remindere.length > 0)) {
                saveData();
            }
        });

        // Func»õii pentru editare (placeholder-uri pentru func»õionalitate viitoare)
        function editaAbonat(id) {
            showNotification('Func»õionalitatea de editare va fi implementatƒÉ √Æn versiunea urmƒÉtoare.', 'info');
        }

        function editaProgramare(id) {
            showNotification('Func»õionalitatea de editare va fi implementatƒÉ √Æn versiunea urmƒÉtoare.', 'info');
        }

        function editaReminder(id) {
            showNotification('Func»õionalitatea de editare va fi implementatƒÉ √Æn versiunea urmƒÉtoare.', 'info');
        }

        // VerificƒÉ periodic conexiunea
        setInterval(() => {
            if (navigator.onLine) {
                document.body.classList.remove('offline');
                if (db && currentUser) {
                    verificaStatusFirebase();
                }
            } else {
                document.body.classList.add('offline');
                showNotification('üìµ Aplica»õia ruleazƒÉ √Æn modul offline', 'warning');
            }
        }, 30000);

        // Online/Offline events
        window.addEventListener('online', () => {
            showNotification('üåê Conexiune restabilitƒÉ! Sincronizare automatƒÉ...', 'success');
            if (db && currentUser) {
                setTimeout(sincronizareCuFirestore, 1000);
            }
        });

        window.addEventListener('offline', () => {
            showNotification('üìµ Aplica»õia func»õioneazƒÉ √Æn modul offline', 'warning');
        });

        // Initialize authentication check
        verificaAutentificare();
    </script>

    <style>
        /* Stiluri pentru modul offline */
        .offline {
            filter: grayscale(0.3);
        }

        .offline::before {
            content: 'üìµ OFFLINE MODE';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #f56565;
            color: white;
            text-align: center;
            padding: 5px;
            font-size: 12px;
            font-weight: bold;
            z-index: 10001;
        }

        /* Anima»õii pentru butoane */
        .btn:active {
            transform: scale(0.95);
        }

        /* √émbunƒÉtƒÉ»õiri pentru accesibilitate */
        .btn:focus {
            outline: 2px solid #667eea;
            outline-offset: 2px;
        }

        .form-input:focus,
        .form-select:focus {
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Media queries pentru dispozitive foarte mici */
        @media (max-width: 480px) {
            .auth-box {
                margin: 10px;
                padding: 20px 15px;
            }

            .auth-title {
                font-size: 24px;
            }

            .main-content {
                padding: 20px 10px;
            }

            .section {
                padding: 20px 15px;
            }

            .form-container {
                padding: 20px 15px;
            }

            .data-table {
                font-size: 10px;
            }

            .data-table th,
            .data-table td {
                padding: 4px 2px;
            }
        }

        /* √émbunƒÉtƒÉ»õiri pentru printare */
        @media print {
            .header,
            .nav-container,
            .mobile-menu-btn,
            .btn,
            .notification,
            .sync-indicator,
            .action-buttons {
                display: none !important;
            }

            .section {
                display: block !important;
                page-break-inside: avoid;
            }

            .data-table {
                font-size: 10px;
            }

            body {
                background: white !important;
            }
        }

        /* Dark mode pentru sistemele care √Æl suportƒÉ */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #1a202c;
                --bg-secondary: #2d3748;
                --text-primary: #f7fafc;
                --text-secondary: #e2e8f0;
            }

            .auth-container {
                background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            }

            .auth-box {
                background: rgba(45, 55, 72, 0.95);
                color: var(--text-primary);
            }

            .auth-title {
                color: var(--text-primary);
            }

            .auth-input {
                background: var(--bg-secondary);
                border-color: #4a5568;
                color: var(--text-primary);
            }

            .auth-input::placeholder {
                color: #a0aec0;
            }
        }

        /* Anima»õii de √ÆncƒÉrcare */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInFromRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideInFromLeft {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* AplicƒÉ anima»õii */
        .section.active {
            animation: fadeIn 0.5s ease-out;
        }

        .notification.show {
            animation: slideInFromRight 0.3s ease-out;
        }

        .auth-form {
            animation: fadeIn 0.3s ease-out;
        }

        /* Stiluri pentru focus management */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: #667eea;
            color: white;
            padding: 8px;
            text-decoration: none;
            border-radius: 4px;
            z-index: 10000;
        }

        .skip-link:focus {
            top: 6px;
        }

        /* High contrast mode */
        @media (prefers-contrast: high) {
            .btn {
                border: 2px solid currentColor;
            }

            .form-input,
            .form-select {
                border: 2px solid currentColor;
            }

            .status-badge {
                border: 2px solid currentColor;
            }
        }

        /* Reduced motion pentru utilizatorii care preferƒÉ mai pu»õine anima»õii */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }

            .pulse,
            .urgent-reminder {
                animation: none !important;
            }
        }
    </style>
</body>
</html>
