<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdInstalGaz - Jude»õul Teleorman</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-auth-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-firestore-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-storage-compat.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .county-badge {
            display: inline-block;
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: 600;
            margin-top: 10px;
        }

        .auth-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            max-width: 400px;
            margin: 50px auto;
        }

        .dashboard {
            display: none;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-tab.active {
            color: #3498db;
            background: white;
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #3498db;
        }

        .tab-content {
            padding: 30px;
            min-height: 500px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #229954);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-info {
            background: linear-gradient(45deg, #17a2b8, #138496);
            color: white;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #e9ecef;
        }

        .table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-progress {
            background: #cce5ff;
            color: #0066cc;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .modal-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #2c3e50;
        }

        .close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .user-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .city-selector {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 20px;
        }

        .city-selector label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            display: block;
        }

        .cities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .city-option {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            background: white;
        }

        .city-option:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }

        .city-option.selected {
            border-color: #3498db;
            background: #e3f2fd;
            color: #1976d2;
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .notification-item {
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
        }

        .notification-urgent {
            border-left-color: #e74c3c;
            background: #fdf2f2;
        }

        .notification-warning {
            border-left-color: #f39c12;
            background: #fffbf0;
        }

        .file-upload {
            border: 2px dashed #ddd;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }

        .file-upload.dragover {
            border-color: #3498db;
            background: #e3f2fd;
        }

        .uploaded-files {
            margin-top: 15px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 5px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #27ae60, #229954);
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .cities-grid {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AdInstalGaz</h1>
            <p>Sistem de Management Instala»õii Gaze</p>
            <div class="county-badge">Jude»õul Teleorman</div>
            <div style="margin-top: 15px; font-size: 14px; color: #666;">
                üìû <strong>0762 614 401</strong> | üìß office@adinstalgaz.ro | üåê adinstalgaz.ro<br>
                üìç Str. MƒÉrƒÉ»ôe»ôti, Nr.97, Ro»ôiorii de Vede, Teleorman
            </div>
        </div>

        <!-- Formular Autentificare -->
        <div id="authContainer" class="auth-container">
            <div id="authTabs" class="nav-tabs" style="margin-bottom: 20px;">
                <button class="nav-tab active" onclick="switchAuthTab('login')">Conectare</button>
                <button class="nav-tab" onclick="switchAuthTab('register')">√énregistrare</button>
            </div>

            <!-- Login -->
            <div id="loginForm" class="tab-pane active">
                <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">Conectare</h2>
                <div class="form-group">
                    <label for="loginEmail">Email:</label>
                    <input type="email" id="loginEmail" class="form-control" placeholder="Introduce»õi email-ul">
                </div>
                <div class="form-group">
                    <label for="loginPassword">ParolƒÉ:</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="Introduce»õi parola">
                </div>
                <button onclick="login()" class="btn btn-primary" style="width: 100%;">Conectare</button>
                <div id="loginMessage" style="margin-top: 15px;"></div>
            </div>

            <!-- Register -->
            <div id="registerForm" class="tab-pane">
                <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">√énregistrare</h2>
                <div class="form-group">
                    <label for="registerName">Nume complet:</label>
                    <input type="text" id="registerName" class="form-control" placeholder="Introduce»õi numele complet">
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email:</label>
                    <input type="email" id="registerEmail" class="form-control" placeholder="Introduce»õi email-ul">
                </div>
                <div class="form-group">
                    <label for="registerPassword">ParolƒÉ:</label>
                    <input type="password" id="registerPassword" class="form-control" placeholder="Introduce»õi parola">
                </div>
                <div class="form-group">
                    <label for="registerPhone">Telefon:</label>
                    <input type="tel" id="registerPhone" class="form-control" placeholder="Introduce»õi numƒÉrul de telefon">
                </div>
                
                <!-- Selector ora»ôe Teleorman -->
                <div class="city-selector">
                    <label>Selecta»õi ora»ôul din jude»õul Teleorman:</label>
                    <div class="cities-grid">
                        <div class="city-option" onclick="selectCity('Alexandria')">Alexandria</div>
                        <div class="city-option" onclick="selectCity('Ro»ôiorii de Vede')">Ro»ôiorii de Vede</div>
                        <div class="city-option" onclick="selectCity('Turnu MƒÉgurele')">Turnu MƒÉgurele</div>
                        <div class="city-option" onclick="selectCity('Videle')">Videle</div>
                        <div class="city-option" onclick="selectCity('Zimnicea')">Zimnicea</div>
                    </div>
                </div>
                
                <button onclick="register()" class="btn btn-primary" style="width: 100%;">√énregistrare</button>
                <div id="registerMessage" style="margin-top: 15px;"></div>
            </div>
        </div>

        <!-- Dashboard Principal -->
        <div id="dashboard" class="dashboard">
            <div class="user-info">
                <div>
                    <strong id="currentUserName">Utilizator</strong>
                    <span id="currentUserRole" class="status-badge status-pending" style="margin-left: 10px;">Rol</span>
                </div>
                <button onclick="logout()" class="btn btn-danger">Deconectare</button>
            </div>

            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('dashboard')">Dashboard</button>
                <button class="nav-tab" onclick="switchTab('clients')">Clien»õi</button>
                <button class="nav-tab" onclick="switchTab('works')">LucrƒÉri</button>
                <button class="nav-tab" onclick="switchTab('completed')">Finalizate</button>
                <button id="notificationsTab" class="nav-tab hidden" onclick="switchTab('notifications')">NotificƒÉri</button>
                <button class="nav-tab" onclick="showCompanyContactModal()">üìû Contact</button>
            </div>

            <div class="tab-content">
                <!-- Dashboard Tab -->
                <div id="dashboardPane" class="tab-pane active">
                    <h3>Dashboard - Jude»õul Teleorman</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="totalClients">0</div>
                            <div class="stat-label">Total Clien»õi</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="activeWorks">0</div>
                            <div class="stat-label">LucrƒÉri Active</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="completedWorks">0</div>
                            <div class="stat-label">LucrƒÉri Finalizate</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="pendingWorks">0</div>
                            <div class="stat-label">√én A»ôteptare</div>
                        </div>
                    </div>
                    <div id="dashboardContent">
                        <h4>Activitate RecentƒÉ</h4>
                        <div id="recentActivity"></div>
                    </div>
                </div>

                <!-- Clien»õi Tab -->
                <div id="clientsPane" class="tab-pane">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>Clien»õi - Jude»õul Teleorman</h3>
                        <button onclick="showAddClientModal()" class="btn btn-primary">+ AdaugƒÉ Client</button>
                    </div>
                    <div id="clientsTable"></div>
                </div>

                <!-- LucrƒÉri Tab -->
                <div id="worksPane" class="tab-pane">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>LucrƒÉri Active</h3>
                        <button onclick="showAddWorkModal()" class="btn btn-primary">+ AdaugƒÉ Lucrare</button>
                    </div>
                    <div id="worksTable"></div>
                </div>

                <!-- Finalizate Tab -->
                <div id="completedPane" class="tab-pane">
                    <h3>LucrƒÉri Finalizate</h3>
                    <div id="completedTable"></div>
                </div>

                <!-- NotificƒÉri Tab (doar pentru admin) -->
                <div id="notificationsPane" class="tab-pane">
                    <h3>NotificƒÉri »ôi ExpirƒÉri</h3>
                    <div class="stats-grid">
                        <div class="stat-card" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                            <div class="stat-number" id="urgentExpiring">0</div>
                            <div class="stat-label">Urgent (1-2 zile)</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                            <div class="stat-number" id="soonExpiring">0</div>
                            <div class="stat-label">√én cur√¢nd (3-7 zile)</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #27ae60, #229954);">
                            <div class="stat-number" id="smsSent">0</div>
                            <div class="stat-label">SMS Trimise</div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #8e44ad, #7d3c98);">
                            <div class="stat-number" id="totalNotifications">0</div>
                            <div class="stat-label">Total NotificƒÉri</div>
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <button onclick="checkExpiringServices()" class="btn btn-warning">üîç VerificƒÉ ExpirƒÉri</button>
                        <button onclick="sendBulkExpirationSMS()" class="btn btn-danger">üì± Trimite SMS ExpirƒÉri</button>
                        <button onclick="showSMSHistoryModal()" class="btn btn-info">üìã Istoric SMS</button>
                    </div>
                    
                    <div id="notificationsContent">
                        <h4>Servicii care expirƒÉ √Æn urmƒÉtoarele 7 zile</h4>
                        <div id="expiringServices"></div>
                        
                        <h4 style="margin-top: 30px;">NotificƒÉri Recente</h4>
                        <div id="recentNotifications"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal AdaugƒÉ Client -->
    <div id="addClientModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">AdaugƒÉ Client Nou</h3>
                <button class="close" onclick="closeModal('addClientModal')">&times;</button>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label for="clientFirstName">Nume:</label>
                    <input type="text" id="clientFirstName" class="form-control" placeholder="Numele de familie">
                </div>
                <div class="form-group">
                    <label for="clientLastName">Prenume:</label>
                    <input type="text" id="clientLastName" class="form-control" placeholder="Prenumele">
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label for="clientPhone">Telefon:</label>
                    <input type="tel" id="clientPhone" class="form-control" placeholder="07XXXXXXXX">
                </div>
                <div class="form-group">
                    <label for="clientEmail">Email:</label>
                    <input type="email" id="clientEmail" class="form-control" placeholder="email@exemplu.ro">
                </div>
            </div>

            <div class="form-group">
                <label for="clientService">Serviciu Contractat:</label>
                <select id="clientService" class="form-control">
                    <option value="">Selecta»õi serviciul contractat</option>
                    <option value="Instalare sistem gaze naturale">Instalare sistem gaze naturale</option>
                    <option value="Revizie instala»õie gaze">Revizie instala»õie gaze</option>
                    <option value="Verificare tehnicƒÉ instala»õie">Verificare tehnicƒÉ instala»õie</option>
                    <option value="√éntre»õinere sistem gaze">√éntre»õinere sistem gaze</option>
                    <option value="Repara»õie instala»õie gaze">Repara»õie instala»õie gaze</option>
                    <option value="Control periodic instala»õie">Control periodic instala»õie</option>
                    <option value="Verificare siguran»õƒÉ sistem">Verificare siguran»õƒÉ sistem</option>
                </select>
            </div>
            
            <h4 style="margin: 20px 0 10px 0; color: #2c3e50;">Adresa CompletƒÉ</h4>
            
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label for="clientStreet">Strada:</label>
                    <input type="text" id="clientStreet" class="form-control" placeholder="Numele strƒÉzii">
                </div>
                <div class="form-group">
                    <label for="clientNumber">NumƒÉrul:</label>
                    <input type="text" id="clientNumber" class="form-control" placeholder="Nr.">
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label for="clientBlock">Bloc (op»õional):</label>
                    <input type="text" id="clientBlock" class="form-control" placeholder="Bl.">
                </div>
                <div class="form-group">
                    <label for="clientFloor">Etaj (op»õional):</label>
                    <input type="text" id="clientFloor" class="form-control" placeholder="Et.">
                </div>
                <div class="form-group">
                    <label for="clientApartment">Apartament (op»õional):</label>
                    <input type="text" id="clientApartment" class="form-control" placeholder="Ap.">
                </div>
            </div>
            
            <div class="form-group">
                <label for="clientCity">Ora»ôul (Teleorman):</label>
                <select id="clientCity" class="form-control">
                    <option value="">Selecta»õi ora»ôul</option>
                    <option value="Alexandria">Alexandria</option>
                    <option value="Ro»ôiorii de Vede">Ro»ôiorii de Vede</option>
                    <option value="Turnu MƒÉgurele">Turnu MƒÉgurele</option>
                    <option value="Videle">Videle</option>
                    <option value="Zimnicea">Zimnicea</option>
                </select>
            </div>
            
            <button onclick="addClient()" class="btn btn-primary">AdaugƒÉ Client</button>
        </div>
    </div>

    <!-- Modal AdaugƒÉ Lucrare -->
    <div id="addWorkModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">AdaugƒÉ Lucrare NouƒÉ</h3>
                <button class="close" onclick="closeModal('addWorkModal')">&times;</button>
            </div>
            <div class="form-group">
                <label for="workClient">Client:</label>
                <select id="workClient" class="form-control">
                    <option value="">Selecta»õi clientul</option>
                </select>
            </div>
            <div class="form-group">
                <label for="workType">Tip Lucrare:</label>
                <select id="workType" class="form-control">
                    <option value="">Selecta»õi tipul lucrƒÉrii</option>
                    <option value="Instalare">Instalare</option>
                    <option value="Revizie">Revizie</option>
                    <option value="Repara»õie">Repara»õie</option>
                    <option value="Verificare">Verificare</option>
                    <option value="√éntre»õinere">√éntre»õinere</option>
                </select>
            </div>
            <div class="form-group">
                <label for="workDescription">Descriere:</label>
                <textarea id="workDescription" class="form-control" rows="3" placeholder="Descrierea lucrƒÉrii"></textarea>
            </div>
            <div class="form-group">
                <label for="workWorker">LucrƒÉtor Asignat:</label>
                <select id="workWorker" class="form-control">
                    <option value="">Selecta»õi lucrƒÉtorul</option>
                </select>
            </div>
            <div class="form-group">
                <label for="workPriority">Prioritate:</label>
                <select id="workPriority" class="form-control">
                    <option value="normalƒÉ">NormalƒÉ</option>
                    <option value="urgentƒÉ">UrgentƒÉ</option>
                    <option value="foarte urgentƒÉ">Foarte UrgentƒÉ</option>
                </select>
            </div>
            <button onclick="addWork()" class="btn btn-primary">AdaugƒÉ Lucrare</button>
        </div>
    </div>

    <!-- Modal Finalizare Lucrare cu Detalii -->
    <div id="completeWorkModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Finalizare Lucrare</h3>
                <button class="close" onclick="closeModal('completeWorkModal')">&times;</button>
            </div>
            <div class="form-group">
                <label for="completionNotes">Note Finalizare:</label>
                <textarea id="completionNotes" class="form-control" rows="3" placeholder="Descrie»õi lucrarea efectuatƒÉ..."></textarea>
            </div>
            <div class="form-group">
                <label for="nextServiceDate">Data UrmƒÉtorului Serviciu:</label>
                <input type="date" id="nextServiceDate" class="form-control">
            </div>
            <div class="form-group">
                <label for="nextServiceType">Tipul UrmƒÉtorului Serviciu:</label>
                <select id="nextServiceType" class="form-control">
                    <option value="Revizie">Revizie</option>
                    <option value="√éntre»õinere">√éntre»õinere</option>
                    <option value="Verificare">Verificare</option>
                    <option value="Control">Control</option>
                </select>
            </div>
            <div class="form-group">
                <label>Documente Lucrare:</label>
                <div id="workFileUpload" class="file-upload">
                    <p>üìÅ Trage»õi fi»ôierele aici sau da»õi click pentru a selecta</p>
                    <p style="font-size: 12px; color: #666;">Formate acceptate: PDF, JPG, PNG, DOC, DOCX (max 10MB)</p>
                    <input type="file" id="workFileInput" multiple accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" style="display: none;">
                </div>
                <div id="workUploadedFiles" class="uploaded-files"></div>
            </div>
            <button onclick="completeWorkWithDetails()" class="btn btn-success">FinalizeazƒÉ Lucrarea</button>
        </div>
    </div>

    <!-- Modal SMS Personalizat -->
    <div id="smsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Trimite SMS Personalizat</h3>
                <button class="close" onclick="closeModal('smsModal')">&times;</button>
            </div>
            <div class="form-group">
                <label for="smsRecipient">Destinatar:</label>
                <input type="text" id="smsRecipient" class="form-control" readonly>
            </div>
            <div class="form-group">
                <label for="smsMessage">Mesaj:</label>
                <textarea id="smsMessage" class="form-control" rows="4" placeholder="Scrie»õi mesajul SMS..."></textarea>
                <small>Caractere rƒÉmase: <span id="smsCharCount">160</span></small>
            </div>
            <button onclick="sendCustomSMS()" class="btn btn-primary">Trimite SMS</button>
        </div>
    </div>

    <!-- Modal Istoric SMS -->
    <div id="smsHistoryModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">Istoric SMS Trimise</h3>
                <button class="close" onclick="closeModal('smsHistoryModal')">&times;</button>
            </div>
            <div id="smsHistoryContent"></div>
        </div>
    </div>

    <!-- Modal Vizualizare Documente -->
    <div id="documentsModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">Documente Lucrare</h3>
                <button class="close" onclick="closeModal('documentsModal')">&times;</button>
            </div>
            <div id="documentsContent"></div>
        </div>
    </div>

    <!-- Modal Informa»õii Contact FirmƒÉ -->
    <div id="companyContactModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">Informa»õii de Contact AdInstalGaz</h3>
                <button class="close" onclick="closeModal('companyContactModal')">&times;</button>
            </div>
            
            <div style="text-align: center; padding: 20px 0;">
                <h2 style="color: #2c3e50; margin-bottom: 20px;">AdInstalGaz</h2>
                <p style="color: #666; margin-bottom: 30px;">Servicii profesionale instala»õii gaze - Jude»õul Teleorman</p>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">üìû Contact Telefonic</h4>
                    <p style="font-size: 18px; font-weight: bold; color: #3498db;">0762 614 401</p>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">üìß Email-uri</h4>
                    <p><strong>Office:</strong> office@adinstalgaz.ro</p>
                    <p><strong>ProgramƒÉri:</strong> programari@adinstalgaz.ro</p>
                    <p><strong>Manager:</strong> florin.gavrila@adinstalgaz.ro</p>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">üåê Website</h4>
                    <p><a href="https://adinstalgaz.ro" target="_blank" style="color: #3498db; text-decoration: none;">adinstalgaz.ro</a></p>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">üìç Adresa</h4>
                    <p><strong>Str. MƒÉrƒÉ»ôe»ôti, Nr.97</strong></p>
                    <p><strong>Ro»ôiorii de Vede, Teleorman</strong></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configurare Firebase
        const firebaseConfig = {
            apiKey: "demo-api-key",
            authDomain: "demo-project.firebaseapp.com",
            projectId: "demo-project",
            storageBucket: "demo-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "demo-app-id"
        };

        // Ini»õializare Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Variabile globale
        let currentUser = null;
        let currentRole = null;
        let selectedCity = '';
        let currentWorkId = null;
        let uploadedFiles = [];

        // FUNC»öII DE BAZƒÇ
        function switchAuthTab(tab) {
            document.querySelectorAll('#authTabs .nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('#authContainer .tab-pane').forEach(p => p.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + 'Form').classList.add('active');
        }

        function switchTab(tab) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + 'Pane').classList.add('active');
            
            loadTabData(tab);
        }

        function selectCity(city) {
            document.querySelectorAll('.city-option').forEach(opt => opt.classList.remove('selected'));
            event.target.classList.add('selected');
            selectedCity = city;
        }

        function showMessage(elementId, message, type = 'success') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => element.innerHTML = '', 5000);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // AUTENTIFICARE
        async function register() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const phone = document.getElementById('registerPhone').value;

            if (!name || !email || !password || !phone || !selectedCity) {
                showMessage('registerMessage', 'Toate c√¢mpurile sunt obligatorii »ôi trebuie sƒÉ selecta»õi ora»ôul!', 'danger');
                return;
            }

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // VerificƒÉ rolul bazat pe email
                const role = isWorkerEmail(email) ? 'worker' : 'client';

                await db.collection('users').doc(user.uid).set({
                    name: name,
                    email: email,
                    phone: phone,
                    city: selectedCity,
                    role: role,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                showMessage('registerMessage', 'Cont creat cu succes!', 'success');
                setTimeout(() => location.reload(), 2000);
            } catch (error) {
                showMessage('registerMessage', error.message, 'danger');
            }
        }

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showMessage('loginMessage', 'Email »ôi parola sunt obligatorii!', 'danger');
                return;
            }

            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                showMessage('loginMessage', error.message, 'danger');
            }
        }

        function logout() {
            auth.signOut();
        }

        function isWorkerEmail(email) {
            const workerEmails = [
                'admin@adinstalgaz.ro',
                'marian.popescu@adinstalgaz.ro', 
                'ion.nicolae@adinstalgaz.ro',
                'gheorghe.stan@adinstalgaz.ro'
            ];
            return workerEmails.includes(email.toLowerCase());
        }

        function isAdminEmail(email) {
            return email.toLowerCase() === 'admin@adinstalgaz.ro';
        }

        // Observer pentru starea autentificƒÉrii
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                try {
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    if (userDoc.exists) {
                        currentUser = user;
                        const userData = userDoc.data();
                        currentRole = userData.role;

                        document.getElementById('authContainer').style.display = 'none';
                        document.getElementById('dashboard').style.display = 'block';
                        
                        document.getElementById('currentUserName').textContent = userData.name;
                        document.getElementById('currentUserRole').textContent = 
                            currentRole === 'worker' ? 'LucrƒÉtor' : 'Client';
                        document.getElementById('currentUserRole').className = 
                            `status-badge ${currentRole === 'worker' ? 'status-completed' : 'status-pending'}`;

                        // Afi»ôeazƒÉ tab-ul NotificƒÉri doar pentru admin
                        if (isAdminEmail(user.email)) {
                            currentRole = 'admin';
                            document.getElementById('currentUserRole').textContent = 'Administrator';
                            document.getElementById('notificationsTab').classList.remove('hidden');
                            autoCheckExpirations();
                        }

                        loadTabData('dashboard');
                    }
                } catch (error) {
                    console.error('Eroare la √ÆncƒÉrcarea datelor utilizator:', error);
                }
            } else {
                document.getElementById('authContainer').style.display = 'block';
                document.getElementById('dashboard').style.display = 'none';
                currentUser = null;
                currentRole = null;
            }
        });

        // √éNCƒÇRCARE DATE TAB-URI
        async function loadTabData(tab) {
            switch(tab) {
                case 'dashboard':
                    await loadDashboard();
                    break;
                case 'clients':
                    await loadClients();
                    break;
                case 'works':
                    await loadWorks();
                    break;
                case 'completed':
                    await loadCompletedWorks();
                    break;
                case 'notifications':
                    if (currentRole === 'admin') {
                        await loadNotifications();
                    }
                    break;
            }
        }

        async function loadDashboard() {
            try {
                const [clientsSnapshot, worksSnapshot] = await Promise.all([
                    db.collection('clients').get(),
                    db.collection('works').get()
                ]);

                const totalClients = clientsSnapshot.size;
                const works = worksSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                const activeWorks = works.filter(w => w.status === '√Æn progres').length;
                const completedWorks = works.filter(w => w.status === 'finalizatƒÉ').length;
                const pendingWorks = works.filter(w => w.status === '√Æn a»ôteptare').length;

                document.getElementById('totalClients').textContent = totalClients;
                document.getElementById('activeWorks').textContent = activeWorks;
                document.getElementById('completedWorks').textContent = completedWorks;
                document.getElementById('pendingWorks').textContent = pendingWorks;

                // Activitate recentƒÉ
                const recentWorks = works
                    .sort((a, b) => b.createdAt?.seconds - a.createdAt?.seconds)
                    .slice(0, 5);

                let recentHtml = '';
                for (const work of recentWorks) {
                    const clientDoc = await db.collection('clients').doc(work.clientId).get();
                    const clientName = clientDoc.exists ? clientDoc.data().name : 'Client necunoscut';
                    
                    recentHtml += `
                        <div class="notification-item">
                            <strong>${work.type}</strong> - ${clientName}<br>
                            <small>Status: ${work.status} | ${work.createdAt ? new Date(work.createdAt.seconds * 1000).toLocaleDateString() : 'Data necunoscutƒÉ'}</small>
                        </div>
                    `;
                }

                document.getElementById('recentActivity').innerHTML = recentHtml || '<p>Nu existƒÉ activitate recentƒÉ.</p>';
            } catch (error) {
                console.error('Eroare la √ÆncƒÉrcarea dashboard-ului:', error);
            }
        }

        async function loadClients() {
            try {
                const snapshot = await db.collection('clients').get();
                const clients = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                let html = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nume Complet</th>
                                <th>Telefon</th>
                                <th>Ora»ô</th>
                                <th>AdresƒÉ CompletƒÉ</th>
                                <th>Serviciu Contractat</th>
                                <th>Ac»õiuni</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                clients.forEach(client => {
                    const fullName = client.name || `${client.firstName || ''} ${client.lastName || ''}`.trim();
                    const fullAddress = client.address?.fullAddress || client.address || 'AdresƒÉ necompletatƒÉ';
                    const contractedService = client.contractedService || 'Nespecificat';
                    
                    html += `
                        <tr>
                            <td><strong>${fullName}</strong><br><small>${client.email || 'FƒÉrƒÉ email'}</small></td>
                            <td>${client.phone}</td>
                            <td>${client.city}</td>
                            <td>${fullAddress}</td>
                            <td><span class="status-badge status-pending">${contractedService}</span></td>
                            <td>
                                <button onclick="showSMSModal('${client.phone}', '${fullName}', '${contractedService}')" class="btn btn-info" style="font-size: 12px; padding: 5px 10px;">üì± SMS</button>
                            </td>
                        </tr>
                    `;
                });

                html += `</tbody></table>`;
                document.getElementById('clientsTable').innerHTML = html;
            } catch (error) {
                console.error('Eroare la √ÆncƒÉrcarea clien»õilor:', error);
            }
        }

        async function loadWorks() {
            try {
                let query = db.collection('works').where('status', 'in', ['√Æn a»ôteptare', '√Æn progres']);
                
                if (currentRole === 'worker' && !isAdminEmail(currentUser.email)) {
                    query = query.where('workerId', '==', currentUser.uid);
                }

                const snapshot = await query.get();
                const works = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                let html = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Client</th>
                                <th>Tip</th>
                                <th>Descriere</th>
                                <th>Status</th>
                                <th>Prioritate</th>
                                <th>Ac»õiuni</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                for (const work of works) {
                    const clientDoc = await db.collection('clients').doc(work.clientId).get();
                    const clientName = clientDoc.exists ? clientDoc.data().name : 'Client necunoscut';
                    
                    const statusClass = work.status === '√Æn progres' ? 'status-progress' : 'status-pending';
                    const priorityBadge = work.priority === 'urgentƒÉ' ? 'style="background: #ff6b6b; color: white;"' : 
                                         work.priority === 'foarte urgentƒÉ' ? 'style="background: #ff4757; color: white;"' : '';

                    html += `
                        <tr>
                            <td>${clientName}</td>
                            <td>${work.type}</td>
                            <td>${work.description}</td>
                            <td><span class="status-badge ${statusClass}">${work.status}</span></td>
                            <td><span class="status-badge" ${priorityBadge}>${work.priority}</span></td>
                            <td>
                                ${work.status === '√Æn a»ôteptare' ? 
                                    `<button onclick="startWork('${work.id}')" class="btn btn-warning" style="font-size: 12px; padding: 5px 10px;">√éncepe</button>` : 
                                    `<button onclick="showCompleteWorkModal('${work.id}')" class="btn btn-success" style="font-size: 12px; padding: 5px 10px;">FinalizeazƒÉ</button>`
                                }
                            </td>
                        </tr>
                    `;
                }

                html += `</tbody></table>`;
                document.getElementById('worksTable').innerHTML = html;
            } catch (error) {
                console.error('Eroare la √ÆncƒÉrcarea lucrƒÉrilor:', error);
            }
        }

        async function loadCompletedWorks() {
            try {
                let query = db.collection('works').where('status', '==', 'finalizatƒÉ');
                
                if (currentRole === 'worker' && !isAdminEmail(currentUser.email)) {
                    query = query.where('workerId', '==', currentUser.uid);
                }

                const snapshot = await query.get();
                const works = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                let html = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Client</th>
                                <th>Tip</th>
                                <th>Data FinalizƒÉrii</th>
                                <th>UrmƒÉtorul Serviciu</th>
                                <th>Note</th>
                                <th>Ac»õiuni</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                for (const work of works) {
                    const clientDoc = await db.collection('clients').doc(work.clientId).get();
                    const clientName = clientDoc.exists ? clientDoc.data().name : 'Client necunoscut';
                    
                    const completedDate = work.completedAt ? new Date(work.completedAt.seconds * 1000).toLocaleDateString() : 'N/A';
                    const nextServiceDate = work.nextServiceDate ? new Date(work.nextServiceDate).toLocaleDateString() : 'Nespecificat';
                    const nextServiceType = work.nextServiceType || 'Nespecificat';

                    html += `
                        <tr>
                            <td>${clientName}</td>
                            <td>${work.type}</td>
                            <td>${completedDate}</td>
                            <td>
                                <strong>${nextServiceDate}</strong><br>
                                <small>${nextServiceType}</small>
                            </td>
                            <td>${work.completionNotes || 'FƒÉrƒÉ note'}</td>
                            <td>
                                ${work.documents && work.documents.length > 0 ? 
                                    `<button onclick="showDocuments('${work.id}')" class="btn btn-info" style="font-size: 12px; padding: 5px 10px;">üìÑ Documente</button>` : 
                                    '<small>FƒÉrƒÉ documente</small>'
                                }
                            </td>
                        </tr>
                    `;
                }

                html += `</tbody></table>`;
                document.getElementById('completedTable').innerHTML = html;
            } catch (error) {
                console.error('Eroare la √ÆncƒÉrcarea lucrƒÉrilor finalizate:', error);
            }
        }

        async function loadNotifications() {
            if (currentRole !== 'admin') return;

            try {
                await checkExpiringServices();
                
                // √éncarcƒÉ statistici SMS
                const smsSnapshot = await db.collection('smsHistory').get();
                document.getElementById('smsSent').textContent = smsSnapshot.size;
                document.getElementById('totalNotifications').textContent = smsSnapshot.size;

                // √éncarcƒÉ notificƒÉri recente
                const recentSMS = smsSnapshot.docs
                    .map(doc => ({ id: doc.id, ...doc.data() }))
                    .sort((a, b) => b.timestamp?.seconds - a.timestamp?.seconds)
                    .slice(0, 10);

                let notificationsHtml = '';
                recentSMS.forEach(sms => {
                    const date = sms.timestamp ? new Date(sms.timestamp.seconds * 1000).toLocaleString() : 'Data necunoscutƒÉ';
                    notificationsHtml += `
                        <div class="notification-item">
                            <strong>SMS trimis cƒÉtre ${sms.recipient}</strong><br>
                            <small>${sms.message}</small><br>
                            <small style="color: #666;">${date}</small>
                        </div>
                    `;
                });

                document.getElementById('recentNotifications').innerHTML = notificationsHtml || '<p>Nu existƒÉ notificƒÉri recente.</p>';
            } catch (error) {
                console.error('Eroare la √ÆncƒÉrcarea notificƒÉrilor:', error);
            }
        }

        // GESTIONARE CLIEN»öI
        function showAddClientModal() {
            document.getElementById('addClientModal').style.display = 'block';
        }

        async function addClient() {
            const firstName = document.getElementById('clientFirstName').value;
            const lastName = document.getElementById('clientLastName').value;
            const phone = document.getElementById('clientPhone').value;
            const email = document.getElementById('clientEmail').value;
            const service = document.getElementById('clientService').value;
            const street = document.getElementById('clientStreet').value;
            const number = document.getElementById('clientNumber').value;
            const block = document.getElementById('clientBlock').value;
            const floor = document.getElementById('clientFloor').value;
            const apartment = document.getElementById('clientApartment').value;
            const city = document.getElementById('clientCity').value;

            if (!firstName || !lastName || !phone || !service || !street || !number || !city) {
                alert('Toate c√¢mpurile obligatorii trebuie completate!');
                return;
            }

            // Construie»ôte adresa completƒÉ
            let fullAddress = `Str. ${street}, Nr. ${number}`;
            if (block) fullAddress += `, Bl. ${block}`;
            if (floor) fullAddress += `, Et. ${floor}`;
            if (apartment) fullAddress += `, Ap. ${apartment}`;

            try {
                await db.collection('clients').add({
                    firstName,
                    lastName,
                    name: `${firstName} ${lastName}`, // Pentru compatibilitate
                    phone,
                    email,
                    contractedService: service,
                    address: {
                        street,
                        number,
                        block,
                        floor,
                        apartment,
                        city,
                        fullAddress
                    },
                    city, // Pentru compatibilitate
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    createdBy: currentUser.uid
                });

                closeModal('addClientModal');
                // ReseteazƒÉ toate c√¢mpurile
                document.getElementById('clientFirstName').value = '';
                document.getElementById('clientLastName').value = '';
                document.getElementById('clientPhone').value = '';
                document.getElementById('clientEmail').value = '';
                document.getElementById('clientService').value = '';
                document.getElementById('clientStreet').value = '';
                document.getElementById('clientNumber').value = '';
                document.getElementById('clientBlock').value = '';
                document.getElementById('clientFloor').value = '';
                document.getElementById('clientApartment').value = '';
                document.getElementById('clientCity').value = '';
                
                await loadClients();
                alert('Client adƒÉugat cu succes!');
            } catch (error) {
                console.error('Eroare la adƒÉugarea clientului:', error);
                alert('Eroare la adƒÉugarea clientului!');
            }
        }

        // GESTIONARE LUCRƒÇRI
        async function showAddWorkModal() {
            document.getElementById('addWorkModal').style.display = 'block';
            await loadClientsForSelect();
            await loadWorkersForSelect();
        }

        async function loadClientsForSelect() {
            try {
                const snapshot = await db.collection('clients').get();
                const clients = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                let html = '<option value="">Selecta»õi clientul</option>';
                clients.forEach(client => {
                    html += `<option value="${client.id}">${client.name} - ${client.city}</option>`;
                });
                
                document.getElementById('workClient').innerHTML = html;
            } catch (error) {
                console.error('Eroare la √ÆncƒÉrcarea clien»õilor:', error);
            }
        }

        async function loadWorkersForSelect() {
            try {
                const snapshot = await db.collection('users').where('role', '==', 'worker').get();
                const workers = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                let html = '<option value="">Selecta»õi lucrƒÉtorul</option>';
                workers.forEach(worker => {
                    html += `<option value="${worker.id}">${worker.name}</option>`;
                });
                
                document.getElementById('workWorker').innerHTML = html;
            } catch (error) {
                console.error('Eroare la √ÆncƒÉrcarea lucrƒÉtorilor:', error);
            }
        }

        async function addWork() {
            const clientId = document.getElementById('workClient').value;
            const type = document.getElementById('workType').value;
            const description = document.getElementById('workDescription').value;
            const workerId = document.getElementById('workWorker').value;
            const priority = document.getElementById('workPriority').value;

            if (!clientId || !type || !description || !workerId) {
                alert('Toate c√¢mpurile sunt obligatorii!');
                return;
            }

            try {
                await db.collection('works').add({
                    clientId,
                    type,
                    description,
                    workerId,
                    priority,
                    status: '√Æn a»ôteptare',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    createdBy: currentUser.uid
                });

                closeModal('addWorkModal');
                document.getElementById('workClient').value = '';
                document.getElementById('workType').value = '';
                document.getElementById('workDescription').value = '';
                document.getElementById('workWorker').value = '';
                document.getElementById('workPriority').value = 'normalƒÉ';
                
                await loadWorks();
                alert('Lucrare adƒÉugatƒÉ cu succes!');
            } catch (error) {
                console.error('Eroare la adƒÉugarea lucrƒÉrii:', error);
                alert('Eroare la adƒÉugarea lucrƒÉrii!');
            }
        }

        async function startWork(workId) {
            try {
                await db.collection('works').doc(workId).update({
                    status: '√Æn progres',
                    startedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                await loadWorks();
                alert('Lucrarea a fost √ÆnceputƒÉ!');
            } catch (error) {
                console.error('Eroare la √Ænceperea lucrƒÉrii:', error);
                alert('Eroare la √Ænceperea lucrƒÉrii!');
            }
        }

        function showCompleteWorkModal(workId) {
            currentWorkId = workId;
            document.getElementById('completeWorkModal').style.display = 'block';
            uploadedFiles = [];
            document.getElementById('workUploadedFiles').innerHTML = '';
        }

        // üìÑ FUNC»öII UPLOAD DOCUMENTE
        function initFileUpload() {
            const fileUpload = document.getElementById('workFileUpload');
            const fileInput = document.getElementById('workFileInput');

            fileUpload.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);

            fileUpload.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUpload.classList.add('dragover');
            });

            fileUpload.addEventListener('dragleave', () => {
                fileUpload.classList.remove('dragover');
            });

            fileUpload.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUpload.classList.remove('dragover');
                handleFileSelect({ target: { files: e.dataTransfer.files } });
            });
        }

        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            
            files.forEach(file => {
                if (validateFile(file)) {
                    uploadedFiles.push(file);
                    displayUploadedFile(file);
                }
            });
        }

        function validateFile(file) {
            const allowedTypes = ['application/pdf', 'image/jpeg', 'image/png', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
            const maxSize = 10 * 1024 * 1024; // 10MB

            if (!allowedTypes.includes(file.type)) {
                alert(`Tipul fi»ôierului ${file.name} nu este acceptat!`);
                return false;
            }

            if (file.size > maxSize) {
                alert(`Fi»ôierul ${file.name} este prea mare (max 10MB)!`);
                return false;
            }

            return true;
        }

        function displayUploadedFile(file) {
            const container = document.getElementById('workUploadedFiles');
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `
                <span>üìÑ ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)</span>
                <button onclick="removeUploadedFile('${file.name}')" class="btn btn-danger" style="font-size: 12px; padding: 2px 8px;">»òterge</button>
            `;
            container.appendChild(fileItem);
        }

        function removeUploadedFile(fileName) {
            uploadedFiles = uploadedFiles.filter(file => file.name !== fileName);
            
            const container = document.getElementById('workUploadedFiles');
            const fileItems = container.querySelectorAll('.file-item');
            fileItems.forEach(item => {
                if (item.textContent.includes(fileName)) {
                    item.remove();
                }
            });
        }

        async function uploadFilesToStorage(workId) {
            const uploadPromises = uploadedFiles.map(async (file) => {
                const fileName = `${Date.now()}_${file.name}`;
                const storageRef = storage.ref(`work-documents/${workId}/${fileName}`);
                
                try {
                    const snapshot = await storageRef.put(file);
                    const downloadURL = await snapshot.ref.getDownloadURL();
                    
                    return {
                        name: file.name,
                        url: downloadURL,
                        type: file.type,
                        size: file.size,
                        uploadedAt: new Date()
                    };
                } catch (error) {
                    console.error(`Eroare la upload-ul fi»ôierului ${file.name}:`, error);
                    return null;
                }
            });

            const results = await Promise.all(uploadPromises);
            return results.filter(result => result !== null);
        }

        async function completeWorkWithDetails() {
            if (!currentWorkId) return;

            const notes = document.getElementById('completionNotes').value;
            const nextServiceDate = document.getElementById('nextServiceDate').value;
            const nextServiceType = document.getElementById('nextServiceType').value;

            if (!notes) {
                alert('Notele de finalizare sunt obligatorii!');
                return;
            }

            try {
                let documents = [];
                
                if (uploadedFiles.length > 0) {
                    documents = await uploadFilesToStorage(currentWorkId);
                }

                await db.collection('works').doc(currentWorkId).update({
                    status: 'finalizatƒÉ',
                    completedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    completionNotes: notes,
                    nextServiceDate: nextServiceDate ? new Date(nextServiceDate) : null,
                    nextServiceType: nextServiceType,
                    documents: documents
                });

                closeModal('completeWorkModal');
                currentWorkId = null;
                uploadedFiles = [];
                
                await loadWorks();
                await loadCompletedWorks();
                alert('Lucrarea a fost finalizatƒÉ cu succes!');
            } catch (error) {
                console.error('Eroare la finalizarea lucrƒÉrii:', error);
                alert('Eroare la finalizarea lucrƒÉrii!');
            }
        }

        // üì± FUNC»öII SMS »òI NOTIFICƒÇRI
        const COMPANY_INFO = {
            phone: "0762 614 401",
            emails: {
                office: "office@adinstalgaz.ro",
                appointments: "programari@adinstalgaz.ro", 
                manager: "florin.gavrila@adinstalgaz.ro"
            },
            website: "adinstalgaz.ro",
            address: "Str. MƒÉrƒÉ»ôe»ôti, Nr.97, Ro»ôiorii de Vede, Teleorman"
        };

        function showSMSModal(phone, name, contractedService = '') {
            document.getElementById('smsRecipient').value = `${name} (${phone})`;
            
            // Template mesaj automat cu datele reale
            const defaultMessage = contractedService ? 
                `Buna ziua ${name}! Va contactam de la AdInstalGaz pentru programarea lucrarii de ${contractedService}. Va rugam sa ne contactati la ${COMPANY_INFO.phone} sau ${COMPANY_INFO.emails.appointments}. Multumim!` :
                `Buna ziua ${name}! Va contactam de la AdInstalGaz. Pentru informatii si programari: ${COMPANY_INFO.phone} sau ${COMPANY_INFO.emails.appointments}. Multumim!`;
            
            document.getElementById('smsMessage').value = defaultMessage;
            document.getElementById('smsCharCount').textContent = String(160 - defaultMessage.length);
            document.getElementById('smsModal').style.display = 'block';
        }

        // ActualizeazƒÉ contorul de caractere pentru SMS
        document.addEventListener('DOMContentLoaded', function() {
            const smsMessage = document.getElementById('smsMessage');
            if (smsMessage) {
                smsMessage.addEventListener('input', function() {
                    const remaining = 160 - this.value.length;
                    document.getElementById('smsCharCount').textContent = remaining;
                });
            }
        });

        async function sendCustomSMS() {
            const recipient = document.getElementById('smsRecipient').value;
            const message = document.getElementById('smsMessage').value;

            if (!message.trim()) {
                alert('Mesajul SMS nu poate fi gol!');
                return;
            }

            try {
                // Simulare trimitere SMS de pe numƒÉrul real al firmei
                console.log(`SMS personalizat de la ${COMPANY_INFO.phone} cƒÉtre ${recipient}: ${message}`);
                
                // SalveazƒÉ √Æn istoric
                await db.collection('smsHistory').add({
                    recipient: recipient,
                    message: message,
                    type: 'personalizat',
                    sentFrom: COMPANY_INFO.phone,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    sentBy: currentUser.uid
                });

                closeModal('smsModal');
                alert(`SMS trimis cu succes de pe numƒÉrul AdInstalGaz: ${COMPANY_INFO.phone}!`);
                
                if (document.getElementById('notificationsPane').classList.contains('active')) {
                    await loadNotifications();
                }
            } catch (error) {
                console.error('Eroare la trimiterea SMS:', error);
                alert('Eroare la trimiterea SMS!');
            }
        }

        async function checkExpiringServices() {
            try {
                const now = new Date();
                const sevenDaysFromNow = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
                const threeDaysFromNow = new Date(now.getTime() + 3 * 24 * 60 * 60 * 1000);
                const twoDaysFromNow = new Date(now.getTime() + 2 * 24 * 60 * 60 * 1000);

                const snapshot = await db.collection('works')
                    .where('status', '==', 'finalizatƒÉ')
                    .where('nextServiceDate', '<=', sevenDaysFromNow)
                    .get();

                const expiringWorks = [];
                
                for (const doc of snapshot.docs) {
                    const work = { id: doc.id, ...doc.data() };
                    if (work.nextServiceDate) {
                        const clientDoc = await db.collection('clients').doc(work.clientId).get();
                        work.clientData = clientDoc.exists ? clientDoc.data() : null;
                        expiringWorks.push(work);
                    }
                }

                // SorteazƒÉ dupƒÉ data serviciului
                expiringWorks.sort((a, b) => new Date(a.nextServiceDate) - new Date(b.nextServiceDate));

                let urgentCount = 0;
                let soonCount = 0;
                let html = '';

                expiringWorks.forEach(work => {
                    const serviceDate = new Date(work.nextServiceDate);
                    const daysUntil = Math.ceil((serviceDate - now) / (1000 * 60 * 60 * 24));
                    
                    let urgencyClass = 'notification-item';
                    if (daysUntil <= 2) {
                        urgentCount++;
                        urgencyClass = 'notification-item notification-urgent';
                    } else if (daysUntil <= 7) {
                        soonCount++;
                        urgencyClass = 'notification-item notification-warning';
                    }

                    const client = work.clientData;
                    const clientName = client ? (client.name || `${client.firstName || ''} ${client.lastName || ''}`.trim()) : 'Client necunoscut';
                    const clientPhone = client ? client.phone : 'N/A';
                    const contractedService = client ? client.contractedService : null;
                    const serviceType = work.nextServiceType || contractedService || 'Serviciu';
                    const fullAddress = client?.address?.fullAddress || client?.address || 'AdresƒÉ necunoscutƒÉ';

                    html += `
                        <div class="${urgencyClass}">
                            <strong>${serviceType} - ${clientName}</strong><br>
                            <small>üìÖ Data: ${serviceDate.toLocaleDateString()} (${daysUntil} zile) | üìû Tel: ${clientPhone}</small><br>
                            <small>üìç AdresƒÉ: ${fullAddress}</small><br>
                            <small>üîß Lucrarea anterioarƒÉ: ${work.type}</small>
                        </div>
                    `;
                });

                document.getElementById('urgentExpiring').textContent = urgentCount;
                document.getElementById('soonExpiring').textContent = soonCount;
                document.getElementById('expiringServices').innerHTML = html || '<p>Nu existƒÉ servicii care expirƒÉ √Æn urmƒÉtoarele 7 zile.</p>';

            } catch (error) {
                console.error('‚ùå Eroare verificare expirƒÉri:', error);
            }
        }

        async function sendBulkExpirationSMS() {
            try {
                const now = new Date();
                const sevenDaysFromNow = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);

                const snapshot = await db.collection('works')
                    .where('status', '==', 'finalizatƒÉ')
                    .where('nextServiceDate', '<=', sevenDaysFromNow)
                    .get();

                let smsSent = 0;

                for (const doc of snapshot.docs) {
                    const work = { id: doc.id, ...doc.data() };
                    if (work.nextServiceDate) {
                        const clientDoc = await db.collection('clients').doc(work.clientId).get();
                        if (clientDoc.exists) {
                            const client = clientDoc.data();
                            const serviceDate = new Date(work.nextServiceDate);
                            const daysUntil = Math.ceil((serviceDate - now) / (1000 * 60 * 60 * 24));
                            
                            // Folose»ôte serviciul contractat din profil client sau urmƒÉtorul serviciu
                            const serviceType = work.nextServiceType || client.contractedService || 'serviciul pentru instala»õia de gaze';
                            const clientName = client.name || `${client.firstName || ''} ${client.lastName || ''}`.trim();

                            const message = `Buna ziua ${clientName}! In data de ${serviceDate.toLocaleDateString()} va expira ${serviceType}. Va rugam sa ne contactati pentru programarea efectuarii lucrarii de ${serviceType} la ${COMPANY_INFO.phone} sau ${COMPANY_INFO.emails.appointments}. AdInstalGaz - Teleorman`;

                            // Simulare trimitere SMS de pe numƒÉrul real al firmei
                            console.log(`SMS expirare de la ${COMPANY_INFO.phone} cƒÉtre ${clientName} (${client.phone}): ${message}`);
                            
                            // SalveazƒÉ √Æn istoric
                            await db.collection('smsHistory').add({
                                recipient: `${clientName} (${client.phone})`,
                                message: message,
                                type: 'expirare',
                                workId: work.id,
                                daysUntilExpiration: daysUntil,
                                serviceType: serviceType,
                                sentFrom: COMPANY_INFO.phone,
                                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                                sentBy: currentUser.uid
                            });

                            smsSent++;
                        }
                    }
                }

                alert(`Au fost trimise ${smsSent} SMS-uri de notificare expirare de pe numƒÉrul AdInstalGaz: ${COMPANY_INFO.phone}!`);
                await loadNotifications();
            } catch (error) {
                console.error('Eroare la trimiterea SMS-urilor √Æn masƒÉ:', error);
                alert('Eroare la trimiterea SMS-urilor!');
            }
        }

        async function showSMSHistoryModal() {
            try {
                const snapshot = await db.collection('smsHistory')
                    .orderBy('timestamp', 'desc')
                    .limit(50)
                    .get();

                const smsHistory = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                let html = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>De la</th>
                                <th>CƒÉtre</th>
                                <th>Tip</th>
                                <th>Mesaj</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                smsHistory.forEach(sms => {
                    const date = sms.timestamp ? new Date(sms.timestamp.seconds * 1000).toLocaleString() : 'Data necunoscutƒÉ';
                    const typeClass = sms.type === 'expirare' ? 'status-warning' : 'status-pending';
                    const sentFrom = sms.sentFrom || COMPANY_INFO.phone;
                    
                    html += `
                        <tr>
                            <td>${date}</td>
                            <td><strong>${sentFrom}</strong><br><small>AdInstalGaz</small></td>
                            <td>${sms.recipient}</td>
                            <td><span class="status-badge ${typeClass}">${sms.type}</span></td>
                            <td>${sms.message.substring(0, 100)}${sms.message.length > 100 ? '...' : ''}</td>
                        </tr>
                    `;
                });

                html += `</tbody></table>`;
                document.getElementById('smsHistoryContent').innerHTML = html;
                document.getElementById('smsHistoryModal').style.display = 'block';
            } catch (error) {
                console.error('Eroare la √ÆncƒÉrcarea istoricului SMS:', error);
            }
        }

        // Verificare automatƒÉ expirƒÉri pentru admin la login
        async function autoCheckExpirations() {
            if (currentRole === 'admin') {
                try {
                    await checkExpiringServices();
                } catch (error) {
                    console.error('‚ùå Eroare verificare automatƒÉ:', error);
                }
            }
        }

        // üìÑ VIZUALIZARE DOCUMENTE
        async function showDocuments(workId) {
            try {
                const workDoc = await db.collection('works').doc(workId).get();
                if (workDoc.exists) {
                    const work = workDoc.data();
                    const documents = work.documents || [];

                    let html = '';
                    if (documents.length > 0) {
                        html = `
                            <div style="display: grid; gap: 15px;">
                                ${documents.map(doc => `
                                    <div class="file-item">
                                        <div>
                                            <strong>üìÑ ${doc.name}</strong><br>
                                            <small>MƒÉrime: ${(doc.size / 1024 / 1024).toFixed(2)} MB | √éncƒÉrcat: ${new Date(doc.uploadedAt).toLocaleString()}</small>
                                        </div>
                                        <a href="${doc.url}" target="_blank" class="btn btn-primary" style="font-size: 12px; padding: 5px 10px;">Deschide</a>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    } else {
                        html = '<p>Nu existƒÉ documente pentru aceastƒÉ lucrare.</p>';
                    }

                    document.getElementById('documentsContent').innerHTML = html;
                    document.getElementById('documentsModal').style.display = 'block';
                }
            } catch (error) {
                console.error('Eroare la √ÆncƒÉrcarea documentelor:', error);
            }
        }

        // üìû MODAL CONTACT FIRMƒÇ
        function showCompanyContactModal() {
            document.getElementById('companyContactModal').style.display = 'block';
        }

        // Ini»õializare la √ÆncƒÉrcarea paginii
        document.addEventListener('DOMContentLoaded', function() {
            initFileUpload();
        });

        // √énchidere modal-uri la click pe backdrop
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        });
    </script>
</body>
</html>
